function CU(r,s){for(var c=0;c<s.length;c++){const d=s[c];if(typeof d!="string"&&!Array.isArray(d)){for(const p in d)if(p!=="default"&&!(p in r)){const _=Object.getOwnPropertyDescriptor(d,p);_&&Object.defineProperty(r,p,_.get?_:{enumerable:!0,get:()=>d[p]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const p of document.querySelectorAll('link[rel="modulepreload"]'))d(p);new MutationObserver(p=>{for(const _ of p)if(_.type==="childList")for(const g of _.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&d(g)}).observe(document,{childList:!0,subtree:!0});function c(p){const _={};return p.integrity&&(_.integrity=p.integrity),p.referrerPolicy&&(_.referrerPolicy=p.referrerPolicy),p.crossOrigin==="use-credentials"?_.credentials="include":p.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function d(p){if(p.ep)return;p.ep=!0;const _=c(p);fetch(p.href,_)}})();var RE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function sv(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var IU={exports:{}},ov={},wU={exports:{}},Kt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hf=Symbol.for("react.element"),Pq=Symbol.for("react.portal"),Dq=Symbol.for("react.fragment"),kq=Symbol.for("react.strict_mode"),Lq=Symbol.for("react.profiler"),Mq=Symbol.for("react.provider"),xq=Symbol.for("react.context"),Uq=Symbol.for("react.forward_ref"),Vq=Symbol.for("react.suspense"),Fq=Symbol.for("react.memo"),jq=Symbol.for("react.lazy"),e2=Symbol.iterator;function Bq(r){return r===null||typeof r!="object"?null:(r=e2&&r[e2]||r["@@iterator"],typeof r=="function"?r:null)}var bU={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},AU=Object.assign,OU={};function ah(r,s,c){this.props=r,this.context=s,this.refs=OU,this.updater=c||bU}ah.prototype.isReactComponent={};ah.prototype.setState=function(r,s){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,s,"setState")};ah.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function NU(){}NU.prototype=ah.prototype;function TI(r,s,c){this.props=r,this.context=s,this.refs=OU,this.updater=c||bU}var yI=TI.prototype=new NU;yI.constructor=TI;AU(yI,ah.prototype);yI.isPureReactComponent=!0;var t2=Array.isArray,PU=Object.prototype.hasOwnProperty,RI={current:null},DU={key:!0,ref:!0,__self:!0,__source:!0};function kU(r,s,c){var d,p={},_=null,g=null;if(s!=null)for(d in s.ref!==void 0&&(g=s.ref),s.key!==void 0&&(_=""+s.key),s)PU.call(s,d)&&!DU.hasOwnProperty(d)&&(p[d]=s[d]);var R=arguments.length-2;if(R===1)p.children=c;else if(1<R){for(var I=Array(R),P=0;P<R;P++)I[P]=arguments[P+2];p.children=I}if(r&&r.defaultProps)for(d in R=r.defaultProps,R)p[d]===void 0&&(p[d]=R[d]);return{$$typeof:Hf,type:r,key:_,ref:g,props:p,_owner:RI.current}}function Gq(r,s){return{$$typeof:Hf,type:r.type,key:s,ref:r.ref,props:r.props,_owner:r._owner}}function CI(r){return typeof r=="object"&&r!==null&&r.$$typeof===Hf}function Wq(r){var s={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(c){return s[c]})}var n2=/\/+/g;function fR(r,s){return typeof r=="object"&&r!==null&&r.key!=null?Wq(""+r.key):s.toString(36)}function rg(r,s,c,d,p){var _=typeof r;(_==="undefined"||_==="boolean")&&(r=null);var g=!1;if(r===null)g=!0;else switch(_){case"string":case"number":g=!0;break;case"object":switch(r.$$typeof){case Hf:case Pq:g=!0}}if(g)return g=r,p=p(g),r=d===""?"."+fR(g,0):d,t2(p)?(c="",r!=null&&(c=r.replace(n2,"$&/")+"/"),rg(p,s,c,"",function(P){return P})):p!=null&&(CI(p)&&(p=Gq(p,c+(!p.key||g&&g.key===p.key?"":(""+p.key).replace(n2,"$&/")+"/")+r)),s.push(p)),1;if(g=0,d=d===""?".":d+":",t2(r))for(var R=0;R<r.length;R++){_=r[R];var I=d+fR(_,R);g+=rg(_,s,c,I,p)}else if(I=Bq(r),typeof I=="function")for(r=I.call(r),R=0;!(_=r.next()).done;)_=_.value,I=d+fR(_,R++),g+=rg(_,s,c,I,p);else if(_==="object")throw s=String(r),Error("Objects are not valid as a React child (found: "+(s==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":s)+"). If you meant to render a collection of children, use an array instead.");return g}function CE(r,s,c){if(r==null)return r;var d=[],p=0;return rg(r,d,"","",function(_){return s.call(c,_,p++)}),d}function Hq(r){if(r._status===-1){var s=r._result;s=s(),s.then(function(c){(r._status===0||r._status===-1)&&(r._status=1,r._result=c)},function(c){(r._status===0||r._status===-1)&&(r._status=2,r._result=c)}),r._status===-1&&(r._status=0,r._result=s)}if(r._status===1)return r._result.default;throw r._result}var Or={current:null},sg={transition:null},Kq={ReactCurrentDispatcher:Or,ReactCurrentBatchConfig:sg,ReactCurrentOwner:RI};Kt.Children={map:CE,forEach:function(r,s,c){CE(r,function(){s.apply(this,arguments)},c)},count:function(r){var s=0;return CE(r,function(){s++}),s},toArray:function(r){return CE(r,function(s){return s})||[]},only:function(r){if(!CI(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};Kt.Component=ah;Kt.Fragment=Dq;Kt.Profiler=Lq;Kt.PureComponent=TI;Kt.StrictMode=kq;Kt.Suspense=Vq;Kt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Kq;Kt.cloneElement=function(r,s,c){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var d=AU({},r.props),p=r.key,_=r.ref,g=r._owner;if(s!=null){if(s.ref!==void 0&&(_=s.ref,g=RI.current),s.key!==void 0&&(p=""+s.key),r.type&&r.type.defaultProps)var R=r.type.defaultProps;for(I in s)PU.call(s,I)&&!DU.hasOwnProperty(I)&&(d[I]=s[I]===void 0&&R!==void 0?R[I]:s[I])}var I=arguments.length-2;if(I===1)d.children=c;else if(1<I){R=Array(I);for(var P=0;P<I;P++)R[P]=arguments[P+2];d.children=R}return{$$typeof:Hf,type:r.type,key:p,ref:_,props:d,_owner:g}};Kt.createContext=function(r){return r={$$typeof:xq,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:Mq,_context:r},r.Consumer=r};Kt.createElement=kU;Kt.createFactory=function(r){var s=kU.bind(null,r);return s.type=r,s};Kt.createRef=function(){return{current:null}};Kt.forwardRef=function(r){return{$$typeof:Uq,render:r}};Kt.isValidElement=CI;Kt.lazy=function(r){return{$$typeof:jq,_payload:{_status:-1,_result:r},_init:Hq}};Kt.memo=function(r,s){return{$$typeof:Fq,type:r,compare:s===void 0?null:s}};Kt.startTransition=function(r){var s=sg.transition;sg.transition={};try{r()}finally{sg.transition=s}};Kt.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Kt.useCallback=function(r,s){return Or.current.useCallback(r,s)};Kt.useContext=function(r){return Or.current.useContext(r)};Kt.useDebugValue=function(){};Kt.useDeferredValue=function(r){return Or.current.useDeferredValue(r)};Kt.useEffect=function(r,s){return Or.current.useEffect(r,s)};Kt.useId=function(){return Or.current.useId()};Kt.useImperativeHandle=function(r,s,c){return Or.current.useImperativeHandle(r,s,c)};Kt.useInsertionEffect=function(r,s){return Or.current.useInsertionEffect(r,s)};Kt.useLayoutEffect=function(r,s){return Or.current.useLayoutEffect(r,s)};Kt.useMemo=function(r,s){return Or.current.useMemo(r,s)};Kt.useReducer=function(r,s,c){return Or.current.useReducer(r,s,c)};Kt.useRef=function(r){return Or.current.useRef(r)};Kt.useState=function(r){return Or.current.useState(r)};Kt.useSyncExternalStore=function(r,s,c){return Or.current.useSyncExternalStore(r,s,c)};Kt.useTransition=function(){return Or.current.useTransition()};Kt.version="18.2.0";wU.exports=Kt;var Ce=wU.exports;const II=sv(Ce),zq=CU({__proto__:null,default:II},[Ce]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yq=Ce,qq=Symbol.for("react.element"),Jq=Symbol.for("react.fragment"),Xq=Object.prototype.hasOwnProperty,Qq=Yq.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,$q={key:!0,ref:!0,__self:!0,__source:!0};function LU(r,s,c){var d,p={},_=null,g=null;c!==void 0&&(_=""+c),s.key!==void 0&&(_=""+s.key),s.ref!==void 0&&(g=s.ref);for(d in s)Xq.call(s,d)&&!$q.hasOwnProperty(d)&&(p[d]=s[d]);if(r&&r.defaultProps)for(d in s=r.defaultProps,s)p[d]===void 0&&(p[d]=s[d]);return{$$typeof:qq,type:r,key:_,ref:g,props:p,_owner:Qq.current}}ov.Fragment=Jq;ov.jsx=LU;ov.jsxs=LU;IU.exports=ov;var Se=IU.exports,tC={},MU={exports:{}},_s={},xU={exports:{}},UU={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function s(xe,We){var ct=xe.length;xe.push(We);e:for(;0<ct;){var gt=ct-1>>>1,En=xe[gt];if(0<p(En,We))xe[gt]=We,xe[ct]=En,ct=gt;else break e}}function c(xe){return xe.length===0?null:xe[0]}function d(xe){if(xe.length===0)return null;var We=xe[0],ct=xe.pop();if(ct!==We){xe[0]=ct;e:for(var gt=0,En=xe.length,vs=En>>>1;gt<vs;){var An=2*(gt+1)-1,tr=xe[An],zn=An+1,Fa=xe[zn];if(0>p(tr,ct))zn<En&&0>p(Fa,tr)?(xe[gt]=Fa,xe[zn]=ct,gt=zn):(xe[gt]=tr,xe[An]=ct,gt=An);else if(zn<En&&0>p(Fa,ct))xe[gt]=Fa,xe[zn]=ct,gt=zn;else break e}}return We}function p(xe,We){var ct=xe.sortIndex-We.sortIndex;return ct!==0?ct:xe.id-We.id}if(typeof performance=="object"&&typeof performance.now=="function"){var _=performance;r.unstable_now=function(){return _.now()}}else{var g=Date,R=g.now();r.unstable_now=function(){return g.now()-R}}var I=[],P=[],k=1,L=null,x=3,H=!1,K=!1,ee=!1,re=typeof setTimeout=="function"?setTimeout:null,Y=typeof clearTimeout=="function"?clearTimeout:null,F=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function z(xe){for(var We=c(P);We!==null;){if(We.callback===null)d(P);else if(We.startTime<=xe)d(P),We.sortIndex=We.expirationTime,s(I,We);else break;We=c(P)}}function le(xe){if(ee=!1,z(xe),!K)if(c(I)!==null)K=!0,Zt(ge);else{var We=c(P);We!==null&&Ft(le,We.startTime-xe)}}function ge(xe,We){K=!1,ee&&(ee=!1,Y(ae),ae=-1),H=!0;var ct=x;try{for(z(We),L=c(I);L!==null&&(!(L.expirationTime>We)||xe&&!Ue());){var gt=L.callback;if(typeof gt=="function"){L.callback=null,x=L.priorityLevel;var En=gt(L.expirationTime<=We);We=r.unstable_now(),typeof En=="function"?L.callback=En:L===c(I)&&d(I),z(We)}else d(I);L=c(I)}if(L!==null)var vs=!0;else{var An=c(P);An!==null&&Ft(le,An.startTime-We),vs=!1}return vs}finally{L=null,x=ct,H=!1}}var Z=!1,fe=null,ae=-1,_e=5,me=-1;function Ue(){return!(r.unstable_now()-me<_e)}function Ve(){if(fe!==null){var xe=r.unstable_now();me=xe;var We=!0;try{We=fe(!0,xe)}finally{We?lt():(Z=!1,fe=null)}}else Z=!1}var lt;if(typeof F=="function")lt=function(){F(Ve)};else if(typeof MessageChannel<"u"){var Ge=new MessageChannel,Mt=Ge.port2;Ge.port1.onmessage=Ve,lt=function(){Mt.postMessage(null)}}else lt=function(){re(Ve,0)};function Zt(xe){fe=xe,Z||(Z=!0,lt())}function Ft(xe,We){ae=re(function(){xe(r.unstable_now())},We)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(xe){xe.callback=null},r.unstable_continueExecution=function(){K||H||(K=!0,Zt(ge))},r.unstable_forceFrameRate=function(xe){0>xe||125<xe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):_e=0<xe?Math.floor(1e3/xe):5},r.unstable_getCurrentPriorityLevel=function(){return x},r.unstable_getFirstCallbackNode=function(){return c(I)},r.unstable_next=function(xe){switch(x){case 1:case 2:case 3:var We=3;break;default:We=x}var ct=x;x=We;try{return xe()}finally{x=ct}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(xe,We){switch(xe){case 1:case 2:case 3:case 4:case 5:break;default:xe=3}var ct=x;x=xe;try{return We()}finally{x=ct}},r.unstable_scheduleCallback=function(xe,We,ct){var gt=r.unstable_now();switch(typeof ct=="object"&&ct!==null?(ct=ct.delay,ct=typeof ct=="number"&&0<ct?gt+ct:gt):ct=gt,xe){case 1:var En=-1;break;case 2:En=250;break;case 5:En=1073741823;break;case 4:En=1e4;break;default:En=5e3}return En=ct+En,xe={id:k++,callback:We,priorityLevel:xe,startTime:ct,expirationTime:En,sortIndex:-1},ct>gt?(xe.sortIndex=ct,s(P,xe),c(I)===null&&xe===c(P)&&(ee?(Y(ae),ae=-1):ee=!0,Ft(le,ct-gt))):(xe.sortIndex=En,s(I,xe),K||H||(K=!0,Zt(ge))),xe},r.unstable_shouldYield=Ue,r.unstable_wrapCallback=function(xe){var We=x;return function(){var ct=x;x=We;try{return xe.apply(this,arguments)}finally{x=ct}}}})(UU);xU.exports=UU;var Zq=xU.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var VU=Ce,ms=Zq;function De(r){for(var s="https://reactjs.org/docs/error-decoder.html?invariant="+r,c=1;c<arguments.length;c++)s+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+r+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var FU=new Set,vf={};function ld(r,s){$u(r,s),$u(r+"Capture",s)}function $u(r,s){for(vf[r]=s,r=0;r<s.length;r++)FU.add(s[r])}var Oa=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),nC=Object.prototype.hasOwnProperty,eJ=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,i2={},r2={};function tJ(r){return nC.call(r2,r)?!0:nC.call(i2,r)?!1:eJ.test(r)?r2[r]=!0:(i2[r]=!0,!1)}function nJ(r,s,c,d){if(c!==null&&c.type===0)return!1;switch(typeof s){case"function":case"symbol":return!0;case"boolean":return d?!1:c!==null?!c.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function iJ(r,s,c,d){if(s===null||typeof s>"u"||nJ(r,s,c,d))return!0;if(d)return!1;if(c!==null)switch(c.type){case 3:return!s;case 4:return s===!1;case 5:return isNaN(s);case 6:return isNaN(s)||1>s}return!1}function Nr(r,s,c,d,p,_,g){this.acceptsBooleans=s===2||s===3||s===4,this.attributeName=d,this.attributeNamespace=p,this.mustUseProperty=c,this.propertyName=r,this.type=s,this.sanitizeURL=_,this.removeEmptyString=g}var er={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){er[r]=new Nr(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var s=r[0];er[s]=new Nr(s,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){er[r]=new Nr(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){er[r]=new Nr(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){er[r]=new Nr(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){er[r]=new Nr(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){er[r]=new Nr(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){er[r]=new Nr(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){er[r]=new Nr(r,5,!1,r.toLowerCase(),null,!1,!1)});var wI=/[\-:]([a-z])/g;function bI(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var s=r.replace(wI,bI);er[s]=new Nr(s,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var s=r.replace(wI,bI);er[s]=new Nr(s,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var s=r.replace(wI,bI);er[s]=new Nr(s,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){er[r]=new Nr(r,1,!1,r.toLowerCase(),null,!1,!1)});er.xlinkHref=new Nr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){er[r]=new Nr(r,1,!1,r.toLowerCase(),null,!0,!0)});function AI(r,s,c,d){var p=er.hasOwnProperty(s)?er[s]:null;(p!==null?p.type!==0:d||!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(iJ(s,c,p,d)&&(c=null),d||p===null?tJ(s)&&(c===null?r.removeAttribute(s):r.setAttribute(s,""+c)):p.mustUseProperty?r[p.propertyName]=c===null?p.type===3?!1:"":c:(s=p.attributeName,d=p.attributeNamespace,c===null?r.removeAttribute(s):(p=p.type,c=p===3||p===4&&c===!0?"":""+c,d?r.setAttributeNS(d,s,c):r.setAttribute(s,c))))}var xa=VU.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,IE=Symbol.for("react.element"),Ou=Symbol.for("react.portal"),Nu=Symbol.for("react.fragment"),OI=Symbol.for("react.strict_mode"),iC=Symbol.for("react.profiler"),jU=Symbol.for("react.provider"),BU=Symbol.for("react.context"),NI=Symbol.for("react.forward_ref"),rC=Symbol.for("react.suspense"),sC=Symbol.for("react.suspense_list"),PI=Symbol.for("react.memo"),Vc=Symbol.for("react.lazy"),GU=Symbol.for("react.offscreen"),s2=Symbol.iterator;function Fp(r){return r===null||typeof r!="object"?null:(r=s2&&r[s2]||r["@@iterator"],typeof r=="function"?r:null)}var li=Object.assign,mR;function Zp(r){if(mR===void 0)try{throw Error()}catch(c){var s=c.stack.trim().match(/\n( *(at )?)/);mR=s&&s[1]||""}return`
`+mR+r}var _R=!1;function ER(r,s){if(!r||_R)return"";_R=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(s)if(s=function(){throw Error()},Object.defineProperty(s.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(s,[])}catch(P){var d=P}Reflect.construct(r,[],s)}else{try{s.call()}catch(P){d=P}r.call(s.prototype)}else{try{throw Error()}catch(P){d=P}r()}}catch(P){if(P&&d&&typeof P.stack=="string"){for(var p=P.stack.split(`
`),_=d.stack.split(`
`),g=p.length-1,R=_.length-1;1<=g&&0<=R&&p[g]!==_[R];)R--;for(;1<=g&&0<=R;g--,R--)if(p[g]!==_[R]){if(g!==1||R!==1)do if(g--,R--,0>R||p[g]!==_[R]){var I=`
`+p[g].replace(" at new "," at ");return r.displayName&&I.includes("<anonymous>")&&(I=I.replace("<anonymous>",r.displayName)),I}while(1<=g&&0<=R);break}}}finally{_R=!1,Error.prepareStackTrace=c}return(r=r?r.displayName||r.name:"")?Zp(r):""}function rJ(r){switch(r.tag){case 5:return Zp(r.type);case 16:return Zp("Lazy");case 13:return Zp("Suspense");case 19:return Zp("SuspenseList");case 0:case 2:case 15:return r=ER(r.type,!1),r;case 11:return r=ER(r.type.render,!1),r;case 1:return r=ER(r.type,!0),r;default:return""}}function oC(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case Nu:return"Fragment";case Ou:return"Portal";case iC:return"Profiler";case OI:return"StrictMode";case rC:return"Suspense";case sC:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case BU:return(r.displayName||"Context")+".Consumer";case jU:return(r._context.displayName||"Context")+".Provider";case NI:var s=r.render;return r=r.displayName,r||(r=s.displayName||s.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case PI:return s=r.displayName||null,s!==null?s:oC(r.type)||"Memo";case Vc:s=r._payload,r=r._init;try{return oC(r(s))}catch{}}return null}function sJ(r){var s=r.type;switch(r.tag){case 24:return"Cache";case 9:return(s.displayName||"Context")+".Consumer";case 10:return(s._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=s.render,r=r.displayName||r.name||"",s.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return s;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return oC(s);case 8:return s===OI?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s}return null}function el(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function WU(r){var s=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function oJ(r){var s=WU(r)?"checked":"value",c=Object.getOwnPropertyDescriptor(r.constructor.prototype,s),d=""+r[s];if(!r.hasOwnProperty(s)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var p=c.get,_=c.set;return Object.defineProperty(r,s,{configurable:!0,get:function(){return p.call(this)},set:function(g){d=""+g,_.call(this,g)}}),Object.defineProperty(r,s,{enumerable:c.enumerable}),{getValue:function(){return d},setValue:function(g){d=""+g},stopTracking:function(){r._valueTracker=null,delete r[s]}}}}function wE(r){r._valueTracker||(r._valueTracker=oJ(r))}function HU(r){if(!r)return!1;var s=r._valueTracker;if(!s)return!0;var c=s.getValue(),d="";return r&&(d=WU(r)?r.checked?"true":"false":r.value),r=d,r!==c?(s.setValue(r),!0):!1}function Ig(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function aC(r,s){var c=s.checked;return li({},s,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:c??r._wrapperState.initialChecked})}function o2(r,s){var c=s.defaultValue==null?"":s.defaultValue,d=s.checked!=null?s.checked:s.defaultChecked;c=el(s.value!=null?s.value:c),r._wrapperState={initialChecked:d,initialValue:c,controlled:s.type==="checkbox"||s.type==="radio"?s.checked!=null:s.value!=null}}function KU(r,s){s=s.checked,s!=null&&AI(r,"checked",s,!1)}function cC(r,s){KU(r,s);var c=el(s.value),d=s.type;if(c!=null)d==="number"?(c===0&&r.value===""||r.value!=c)&&(r.value=""+c):r.value!==""+c&&(r.value=""+c);else if(d==="submit"||d==="reset"){r.removeAttribute("value");return}s.hasOwnProperty("value")?lC(r,s.type,c):s.hasOwnProperty("defaultValue")&&lC(r,s.type,el(s.defaultValue)),s.checked==null&&s.defaultChecked!=null&&(r.defaultChecked=!!s.defaultChecked)}function a2(r,s,c){if(s.hasOwnProperty("value")||s.hasOwnProperty("defaultValue")){var d=s.type;if(!(d!=="submit"&&d!=="reset"||s.value!==void 0&&s.value!==null))return;s=""+r._wrapperState.initialValue,c||s===r.value||(r.value=s),r.defaultValue=s}c=r.name,c!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,c!==""&&(r.name=c)}function lC(r,s,c){(s!=="number"||Ig(r.ownerDocument)!==r)&&(c==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+c&&(r.defaultValue=""+c))}var ef=Array.isArray;function Hu(r,s,c,d){if(r=r.options,s){s={};for(var p=0;p<c.length;p++)s["$"+c[p]]=!0;for(c=0;c<r.length;c++)p=s.hasOwnProperty("$"+r[c].value),r[c].selected!==p&&(r[c].selected=p),p&&d&&(r[c].defaultSelected=!0)}else{for(c=""+el(c),s=null,p=0;p<r.length;p++){if(r[p].value===c){r[p].selected=!0,d&&(r[p].defaultSelected=!0);return}s!==null||r[p].disabled||(s=r[p])}s!==null&&(s.selected=!0)}}function dC(r,s){if(s.dangerouslySetInnerHTML!=null)throw Error(De(91));return li({},s,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function c2(r,s){var c=s.value;if(c==null){if(c=s.children,s=s.defaultValue,c!=null){if(s!=null)throw Error(De(92));if(ef(c)){if(1<c.length)throw Error(De(93));c=c[0]}s=c}s==null&&(s=""),c=s}r._wrapperState={initialValue:el(c)}}function zU(r,s){var c=el(s.value),d=el(s.defaultValue);c!=null&&(c=""+c,c!==r.value&&(r.value=c),s.defaultValue==null&&r.defaultValue!==c&&(r.defaultValue=c)),d!=null&&(r.defaultValue=""+d)}function l2(r){var s=r.textContent;s===r._wrapperState.initialValue&&s!==""&&s!==null&&(r.value=s)}function YU(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function uC(r,s){return r==null||r==="http://www.w3.org/1999/xhtml"?YU(s):r==="http://www.w3.org/2000/svg"&&s==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var bE,qU=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(s,c,d,p){MSApp.execUnsafeLocalFunction(function(){return r(s,c,d,p)})}:r}(function(r,s){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=s;else{for(bE=bE||document.createElement("div"),bE.innerHTML="<svg>"+s.valueOf().toString()+"</svg>",s=bE.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;s.firstChild;)r.appendChild(s.firstChild)}});function Sf(r,s){if(s){var c=r.firstChild;if(c&&c===r.lastChild&&c.nodeType===3){c.nodeValue=s;return}}r.textContent=s}var af={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},aJ=["Webkit","ms","Moz","O"];Object.keys(af).forEach(function(r){aJ.forEach(function(s){s=s+r.charAt(0).toUpperCase()+r.substring(1),af[s]=af[r]})});function JU(r,s,c){return s==null||typeof s=="boolean"||s===""?"":c||typeof s!="number"||s===0||af.hasOwnProperty(r)&&af[r]?(""+s).trim():s+"px"}function XU(r,s){r=r.style;for(var c in s)if(s.hasOwnProperty(c)){var d=c.indexOf("--")===0,p=JU(c,s[c],d);c==="float"&&(c="cssFloat"),d?r.setProperty(c,p):r[c]=p}}var cJ=li({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function hC(r,s){if(s){if(cJ[r]&&(s.children!=null||s.dangerouslySetInnerHTML!=null))throw Error(De(137,r));if(s.dangerouslySetInnerHTML!=null){if(s.children!=null)throw Error(De(60));if(typeof s.dangerouslySetInnerHTML!="object"||!("__html"in s.dangerouslySetInnerHTML))throw Error(De(61))}if(s.style!=null&&typeof s.style!="object")throw Error(De(62))}}function pC(r,s){if(r.indexOf("-")===-1)return typeof s.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var fC=null;function DI(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var mC=null,Ku=null,zu=null;function d2(r){if(r=Yf(r)){if(typeof mC!="function")throw Error(De(280));var s=r.stateNode;s&&(s=uv(s),mC(r.stateNode,r.type,s))}}function QU(r){Ku?zu?zu.push(r):zu=[r]:Ku=r}function $U(){if(Ku){var r=Ku,s=zu;if(zu=Ku=null,d2(r),s)for(r=0;r<s.length;r++)d2(s[r])}}function ZU(r,s){return r(s)}function eV(){}var gR=!1;function tV(r,s,c){if(gR)return r(s,c);gR=!0;try{return ZU(r,s,c)}finally{gR=!1,(Ku!==null||zu!==null)&&(eV(),$U())}}function Tf(r,s){var c=r.stateNode;if(c===null)return null;var d=uv(c);if(d===null)return null;c=d[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(r=r.type,d=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!d;break e;default:r=!1}if(r)return null;if(c&&typeof c!="function")throw Error(De(231,s,typeof c));return c}var _C=!1;if(Oa)try{var jp={};Object.defineProperty(jp,"passive",{get:function(){_C=!0}}),window.addEventListener("test",jp,jp),window.removeEventListener("test",jp,jp)}catch{_C=!1}function lJ(r,s,c,d,p,_,g,R,I){var P=Array.prototype.slice.call(arguments,3);try{s.apply(c,P)}catch(k){this.onError(k)}}var cf=!1,wg=null,bg=!1,EC=null,dJ={onError:function(r){cf=!0,wg=r}};function uJ(r,s,c,d,p,_,g,R,I){cf=!1,wg=null,lJ.apply(dJ,arguments)}function hJ(r,s,c,d,p,_,g,R,I){if(uJ.apply(this,arguments),cf){if(cf){var P=wg;cf=!1,wg=null}else throw Error(De(198));bg||(bg=!0,EC=P)}}function dd(r){var s=r,c=r;if(r.alternate)for(;s.return;)s=s.return;else{r=s;do s=r,s.flags&4098&&(c=s.return),r=s.return;while(r)}return s.tag===3?c:null}function nV(r){if(r.tag===13){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function u2(r){if(dd(r)!==r)throw Error(De(188))}function pJ(r){var s=r.alternate;if(!s){if(s=dd(r),s===null)throw Error(De(188));return s!==r?null:r}for(var c=r,d=s;;){var p=c.return;if(p===null)break;var _=p.alternate;if(_===null){if(d=p.return,d!==null){c=d;continue}break}if(p.child===_.child){for(_=p.child;_;){if(_===c)return u2(p),r;if(_===d)return u2(p),s;_=_.sibling}throw Error(De(188))}if(c.return!==d.return)c=p,d=_;else{for(var g=!1,R=p.child;R;){if(R===c){g=!0,c=p,d=_;break}if(R===d){g=!0,d=p,c=_;break}R=R.sibling}if(!g){for(R=_.child;R;){if(R===c){g=!0,c=_,d=p;break}if(R===d){g=!0,d=_,c=p;break}R=R.sibling}if(!g)throw Error(De(189))}}if(c.alternate!==d)throw Error(De(190))}if(c.tag!==3)throw Error(De(188));return c.stateNode.current===c?r:s}function iV(r){return r=pJ(r),r!==null?rV(r):null}function rV(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var s=rV(r);if(s!==null)return s;r=r.sibling}return null}var sV=ms.unstable_scheduleCallback,h2=ms.unstable_cancelCallback,fJ=ms.unstable_shouldYield,mJ=ms.unstable_requestPaint,yi=ms.unstable_now,_J=ms.unstable_getCurrentPriorityLevel,kI=ms.unstable_ImmediatePriority,oV=ms.unstable_UserBlockingPriority,Ag=ms.unstable_NormalPriority,EJ=ms.unstable_LowPriority,aV=ms.unstable_IdlePriority,av=null,Jo=null;function gJ(r){if(Jo&&typeof Jo.onCommitFiberRoot=="function")try{Jo.onCommitFiberRoot(av,r,void 0,(r.current.flags&128)===128)}catch{}}var So=Math.clz32?Math.clz32:TJ,vJ=Math.log,SJ=Math.LN2;function TJ(r){return r>>>=0,r===0?32:31-(vJ(r)/SJ|0)|0}var AE=64,OE=4194304;function tf(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function Og(r,s){var c=r.pendingLanes;if(c===0)return 0;var d=0,p=r.suspendedLanes,_=r.pingedLanes,g=c&268435455;if(g!==0){var R=g&~p;R!==0?d=tf(R):(_&=g,_!==0&&(d=tf(_)))}else g=c&~p,g!==0?d=tf(g):_!==0&&(d=tf(_));if(d===0)return 0;if(s!==0&&s!==d&&!(s&p)&&(p=d&-d,_=s&-s,p>=_||p===16&&(_&4194240)!==0))return s;if(d&4&&(d|=c&16),s=r.entangledLanes,s!==0)for(r=r.entanglements,s&=d;0<s;)c=31-So(s),p=1<<c,d|=r[c],s&=~p;return d}function yJ(r,s){switch(r){case 1:case 2:case 4:return s+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function RJ(r,s){for(var c=r.suspendedLanes,d=r.pingedLanes,p=r.expirationTimes,_=r.pendingLanes;0<_;){var g=31-So(_),R=1<<g,I=p[g];I===-1?(!(R&c)||R&d)&&(p[g]=yJ(R,s)):I<=s&&(r.expiredLanes|=R),_&=~R}}function gC(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function cV(){var r=AE;return AE<<=1,!(AE&4194240)&&(AE=64),r}function vR(r){for(var s=[],c=0;31>c;c++)s.push(r);return s}function Kf(r,s,c){r.pendingLanes|=s,s!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,s=31-So(s),r[s]=c}function CJ(r,s){var c=r.pendingLanes&~s;r.pendingLanes=s,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=s,r.mutableReadLanes&=s,r.entangledLanes&=s,s=r.entanglements;var d=r.eventTimes;for(r=r.expirationTimes;0<c;){var p=31-So(c),_=1<<p;s[p]=0,d[p]=-1,r[p]=-1,c&=~_}}function LI(r,s){var c=r.entangledLanes|=s;for(r=r.entanglements;c;){var d=31-So(c),p=1<<d;p&s|r[d]&s&&(r[d]|=s),c&=~p}}var _n=0;function lV(r){return r&=-r,1<r?4<r?r&268435455?16:536870912:4:1}var dV,MI,uV,hV,pV,vC=!1,NE=[],Kc=null,zc=null,Yc=null,yf=new Map,Rf=new Map,jc=[],IJ="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function p2(r,s){switch(r){case"focusin":case"focusout":Kc=null;break;case"dragenter":case"dragleave":zc=null;break;case"mouseover":case"mouseout":Yc=null;break;case"pointerover":case"pointerout":yf.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":Rf.delete(s.pointerId)}}function Bp(r,s,c,d,p,_){return r===null||r.nativeEvent!==_?(r={blockedOn:s,domEventName:c,eventSystemFlags:d,nativeEvent:_,targetContainers:[p]},s!==null&&(s=Yf(s),s!==null&&MI(s)),r):(r.eventSystemFlags|=d,s=r.targetContainers,p!==null&&s.indexOf(p)===-1&&s.push(p),r)}function wJ(r,s,c,d,p){switch(s){case"focusin":return Kc=Bp(Kc,r,s,c,d,p),!0;case"dragenter":return zc=Bp(zc,r,s,c,d,p),!0;case"mouseover":return Yc=Bp(Yc,r,s,c,d,p),!0;case"pointerover":var _=p.pointerId;return yf.set(_,Bp(yf.get(_)||null,r,s,c,d,p)),!0;case"gotpointercapture":return _=p.pointerId,Rf.set(_,Bp(Rf.get(_)||null,r,s,c,d,p)),!0}return!1}function fV(r){var s=Yl(r.target);if(s!==null){var c=dd(s);if(c!==null){if(s=c.tag,s===13){if(s=nV(c),s!==null){r.blockedOn=s,pV(r.priority,function(){uV(c)});return}}else if(s===3&&c.stateNode.current.memoizedState.isDehydrated){r.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}r.blockedOn=null}function og(r){if(r.blockedOn!==null)return!1;for(var s=r.targetContainers;0<s.length;){var c=SC(r.domEventName,r.eventSystemFlags,s[0],r.nativeEvent);if(c===null){c=r.nativeEvent;var d=new c.constructor(c.type,c);fC=d,c.target.dispatchEvent(d),fC=null}else return s=Yf(c),s!==null&&MI(s),r.blockedOn=c,!1;s.shift()}return!0}function f2(r,s,c){og(r)&&c.delete(s)}function bJ(){vC=!1,Kc!==null&&og(Kc)&&(Kc=null),zc!==null&&og(zc)&&(zc=null),Yc!==null&&og(Yc)&&(Yc=null),yf.forEach(f2),Rf.forEach(f2)}function Gp(r,s){r.blockedOn===s&&(r.blockedOn=null,vC||(vC=!0,ms.unstable_scheduleCallback(ms.unstable_NormalPriority,bJ)))}function Cf(r){function s(p){return Gp(p,r)}if(0<NE.length){Gp(NE[0],r);for(var c=1;c<NE.length;c++){var d=NE[c];d.blockedOn===r&&(d.blockedOn=null)}}for(Kc!==null&&Gp(Kc,r),zc!==null&&Gp(zc,r),Yc!==null&&Gp(Yc,r),yf.forEach(s),Rf.forEach(s),c=0;c<jc.length;c++)d=jc[c],d.blockedOn===r&&(d.blockedOn=null);for(;0<jc.length&&(c=jc[0],c.blockedOn===null);)fV(c),c.blockedOn===null&&jc.shift()}var Yu=xa.ReactCurrentBatchConfig,Ng=!0;function AJ(r,s,c,d){var p=_n,_=Yu.transition;Yu.transition=null;try{_n=1,xI(r,s,c,d)}finally{_n=p,Yu.transition=_}}function OJ(r,s,c,d){var p=_n,_=Yu.transition;Yu.transition=null;try{_n=4,xI(r,s,c,d)}finally{_n=p,Yu.transition=_}}function xI(r,s,c,d){if(Ng){var p=SC(r,s,c,d);if(p===null)OR(r,s,d,Pg,c),p2(r,d);else if(wJ(p,r,s,c,d))d.stopPropagation();else if(p2(r,d),s&4&&-1<IJ.indexOf(r)){for(;p!==null;){var _=Yf(p);if(_!==null&&dV(_),_=SC(r,s,c,d),_===null&&OR(r,s,d,Pg,c),_===p)break;p=_}p!==null&&d.stopPropagation()}else OR(r,s,d,null,c)}}var Pg=null;function SC(r,s,c,d){if(Pg=null,r=DI(d),r=Yl(r),r!==null)if(s=dd(r),s===null)r=null;else if(c=s.tag,c===13){if(r=nV(s),r!==null)return r;r=null}else if(c===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;r=null}else s!==r&&(r=null);return Pg=r,null}function mV(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(_J()){case kI:return 1;case oV:return 4;case Ag:case EJ:return 16;case aV:return 536870912;default:return 16}default:return 16}}var Gc=null,UI=null,ag=null;function _V(){if(ag)return ag;var r,s=UI,c=s.length,d,p="value"in Gc?Gc.value:Gc.textContent,_=p.length;for(r=0;r<c&&s[r]===p[r];r++);var g=c-r;for(d=1;d<=g&&s[c-d]===p[_-d];d++);return ag=p.slice(r,1<d?1-d:void 0)}function cg(r){var s=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&s===13&&(r=13)):r=s,r===10&&(r=13),32<=r||r===13?r:0}function PE(){return!0}function m2(){return!1}function Es(r){function s(c,d,p,_,g){this._reactName=c,this._targetInst=p,this.type=d,this.nativeEvent=_,this.target=g,this.currentTarget=null;for(var R in r)r.hasOwnProperty(R)&&(c=r[R],this[R]=c?c(_):_[R]);return this.isDefaultPrevented=(_.defaultPrevented!=null?_.defaultPrevented:_.returnValue===!1)?PE:m2,this.isPropagationStopped=m2,this}return li(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=PE)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=PE)},persist:function(){},isPersistent:PE}),s}var ch={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},VI=Es(ch),zf=li({},ch,{view:0,detail:0}),NJ=Es(zf),SR,TR,Wp,cv=li({},zf,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:FI,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Wp&&(Wp&&r.type==="mousemove"?(SR=r.screenX-Wp.screenX,TR=r.screenY-Wp.screenY):TR=SR=0,Wp=r),SR)},movementY:function(r){return"movementY"in r?r.movementY:TR}}),_2=Es(cv),PJ=li({},cv,{dataTransfer:0}),DJ=Es(PJ),kJ=li({},zf,{relatedTarget:0}),yR=Es(kJ),LJ=li({},ch,{animationName:0,elapsedTime:0,pseudoElement:0}),MJ=Es(LJ),xJ=li({},ch,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),UJ=Es(xJ),VJ=li({},ch,{data:0}),E2=Es(VJ),FJ={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},jJ={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},BJ={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function GJ(r){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(r):(r=BJ[r])?!!s[r]:!1}function FI(){return GJ}var WJ=li({},zf,{key:function(r){if(r.key){var s=FJ[r.key]||r.key;if(s!=="Unidentified")return s}return r.type==="keypress"?(r=cg(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?jJ[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:FI,charCode:function(r){return r.type==="keypress"?cg(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?cg(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),HJ=Es(WJ),KJ=li({},cv,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),g2=Es(KJ),zJ=li({},zf,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:FI}),YJ=Es(zJ),qJ=li({},ch,{propertyName:0,elapsedTime:0,pseudoElement:0}),JJ=Es(qJ),XJ=li({},cv,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),QJ=Es(XJ),$J=[9,13,27,32],jI=Oa&&"CompositionEvent"in window,lf=null;Oa&&"documentMode"in document&&(lf=document.documentMode);var ZJ=Oa&&"TextEvent"in window&&!lf,EV=Oa&&(!jI||lf&&8<lf&&11>=lf),v2=" ",S2=!1;function gV(r,s){switch(r){case"keyup":return $J.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function vV(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Pu=!1;function eX(r,s){switch(r){case"compositionend":return vV(s);case"keypress":return s.which!==32?null:(S2=!0,v2);case"textInput":return r=s.data,r===v2&&S2?null:r;default:return null}}function tX(r,s){if(Pu)return r==="compositionend"||!jI&&gV(r,s)?(r=_V(),ag=UI=Gc=null,Pu=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return EV&&s.locale!=="ko"?null:s.data;default:return null}}var nX={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function T2(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s==="input"?!!nX[r.type]:s==="textarea"}function SV(r,s,c,d){QU(d),s=Dg(s,"onChange"),0<s.length&&(c=new VI("onChange","change",null,c,d),r.push({event:c,listeners:s}))}var df=null,If=null;function iX(r){PV(r,0)}function lv(r){var s=Lu(r);if(HU(s))return r}function rX(r,s){if(r==="change")return s}var TV=!1;if(Oa){var RR;if(Oa){var CR="oninput"in document;if(!CR){var y2=document.createElement("div");y2.setAttribute("oninput","return;"),CR=typeof y2.oninput=="function"}RR=CR}else RR=!1;TV=RR&&(!document.documentMode||9<document.documentMode)}function R2(){df&&(df.detachEvent("onpropertychange",yV),If=df=null)}function yV(r){if(r.propertyName==="value"&&lv(If)){var s=[];SV(s,If,r,DI(r)),tV(iX,s)}}function sX(r,s,c){r==="focusin"?(R2(),df=s,If=c,df.attachEvent("onpropertychange",yV)):r==="focusout"&&R2()}function oX(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return lv(If)}function aX(r,s){if(r==="click")return lv(s)}function cX(r,s){if(r==="input"||r==="change")return lv(s)}function lX(r,s){return r===s&&(r!==0||1/r===1/s)||r!==r&&s!==s}var yo=typeof Object.is=="function"?Object.is:lX;function wf(r,s){if(yo(r,s))return!0;if(typeof r!="object"||r===null||typeof s!="object"||s===null)return!1;var c=Object.keys(r),d=Object.keys(s);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++){var p=c[d];if(!nC.call(s,p)||!yo(r[p],s[p]))return!1}return!0}function C2(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function I2(r,s){var c=C2(r);r=0;for(var d;c;){if(c.nodeType===3){if(d=r+c.textContent.length,r<=s&&d>=s)return{node:c,offset:s-r};r=d}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=C2(c)}}function RV(r,s){return r&&s?r===s?!0:r&&r.nodeType===3?!1:s&&s.nodeType===3?RV(r,s.parentNode):"contains"in r?r.contains(s):r.compareDocumentPosition?!!(r.compareDocumentPosition(s)&16):!1:!1}function CV(){for(var r=window,s=Ig();s instanceof r.HTMLIFrameElement;){try{var c=typeof s.contentWindow.location.href=="string"}catch{c=!1}if(c)r=s.contentWindow;else break;s=Ig(r.document)}return s}function BI(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s&&(s==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||s==="textarea"||r.contentEditable==="true")}function dX(r){var s=CV(),c=r.focusedElem,d=r.selectionRange;if(s!==c&&c&&c.ownerDocument&&RV(c.ownerDocument.documentElement,c)){if(d!==null&&BI(c)){if(s=d.start,r=d.end,r===void 0&&(r=s),"selectionStart"in c)c.selectionStart=s,c.selectionEnd=Math.min(r,c.value.length);else if(r=(s=c.ownerDocument||document)&&s.defaultView||window,r.getSelection){r=r.getSelection();var p=c.textContent.length,_=Math.min(d.start,p);d=d.end===void 0?_:Math.min(d.end,p),!r.extend&&_>d&&(p=d,d=_,_=p),p=I2(c,_);var g=I2(c,d);p&&g&&(r.rangeCount!==1||r.anchorNode!==p.node||r.anchorOffset!==p.offset||r.focusNode!==g.node||r.focusOffset!==g.offset)&&(s=s.createRange(),s.setStart(p.node,p.offset),r.removeAllRanges(),_>d?(r.addRange(s),r.extend(g.node,g.offset)):(s.setEnd(g.node,g.offset),r.addRange(s)))}}for(s=[],r=c;r=r.parentNode;)r.nodeType===1&&s.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof c.focus=="function"&&c.focus(),c=0;c<s.length;c++)r=s[c],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var uX=Oa&&"documentMode"in document&&11>=document.documentMode,Du=null,TC=null,uf=null,yC=!1;function w2(r,s,c){var d=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;yC||Du==null||Du!==Ig(d)||(d=Du,"selectionStart"in d&&BI(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),uf&&wf(uf,d)||(uf=d,d=Dg(TC,"onSelect"),0<d.length&&(s=new VI("onSelect","select",null,s,c),r.push({event:s,listeners:d}),s.target=Du)))}function DE(r,s){var c={};return c[r.toLowerCase()]=s.toLowerCase(),c["Webkit"+r]="webkit"+s,c["Moz"+r]="moz"+s,c}var ku={animationend:DE("Animation","AnimationEnd"),animationiteration:DE("Animation","AnimationIteration"),animationstart:DE("Animation","AnimationStart"),transitionend:DE("Transition","TransitionEnd")},IR={},IV={};Oa&&(IV=document.createElement("div").style,"AnimationEvent"in window||(delete ku.animationend.animation,delete ku.animationiteration.animation,delete ku.animationstart.animation),"TransitionEvent"in window||delete ku.transitionend.transition);function dv(r){if(IR[r])return IR[r];if(!ku[r])return r;var s=ku[r],c;for(c in s)if(s.hasOwnProperty(c)&&c in IV)return IR[r]=s[c];return r}var wV=dv("animationend"),bV=dv("animationiteration"),AV=dv("animationstart"),OV=dv("transitionend"),NV=new Map,b2="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ol(r,s){NV.set(r,s),ld(s,[r])}for(var wR=0;wR<b2.length;wR++){var bR=b2[wR],hX=bR.toLowerCase(),pX=bR[0].toUpperCase()+bR.slice(1);ol(hX,"on"+pX)}ol(wV,"onAnimationEnd");ol(bV,"onAnimationIteration");ol(AV,"onAnimationStart");ol("dblclick","onDoubleClick");ol("focusin","onFocus");ol("focusout","onBlur");ol(OV,"onTransitionEnd");$u("onMouseEnter",["mouseout","mouseover"]);$u("onMouseLeave",["mouseout","mouseover"]);$u("onPointerEnter",["pointerout","pointerover"]);$u("onPointerLeave",["pointerout","pointerover"]);ld("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ld("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ld("onBeforeInput",["compositionend","keypress","textInput","paste"]);ld("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ld("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ld("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var nf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),fX=new Set("cancel close invalid load scroll toggle".split(" ").concat(nf));function A2(r,s,c){var d=r.type||"unknown-event";r.currentTarget=c,hJ(d,s,void 0,r),r.currentTarget=null}function PV(r,s){s=(s&4)!==0;for(var c=0;c<r.length;c++){var d=r[c],p=d.event;d=d.listeners;e:{var _=void 0;if(s)for(var g=d.length-1;0<=g;g--){var R=d[g],I=R.instance,P=R.currentTarget;if(R=R.listener,I!==_&&p.isPropagationStopped())break e;A2(p,R,P),_=I}else for(g=0;g<d.length;g++){if(R=d[g],I=R.instance,P=R.currentTarget,R=R.listener,I!==_&&p.isPropagationStopped())break e;A2(p,R,P),_=I}}}if(bg)throw r=EC,bg=!1,EC=null,r}function Gn(r,s){var c=s[bC];c===void 0&&(c=s[bC]=new Set);var d=r+"__bubble";c.has(d)||(DV(s,r,2,!1),c.add(d))}function AR(r,s,c){var d=0;s&&(d|=4),DV(c,r,d,s)}var kE="_reactListening"+Math.random().toString(36).slice(2);function bf(r){if(!r[kE]){r[kE]=!0,FU.forEach(function(c){c!=="selectionchange"&&(fX.has(c)||AR(c,!1,r),AR(c,!0,r))});var s=r.nodeType===9?r:r.ownerDocument;s===null||s[kE]||(s[kE]=!0,AR("selectionchange",!1,s))}}function DV(r,s,c,d){switch(mV(s)){case 1:var p=AJ;break;case 4:p=OJ;break;default:p=xI}c=p.bind(null,s,c,r),p=void 0,!_C||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(p=!0),d?p!==void 0?r.addEventListener(s,c,{capture:!0,passive:p}):r.addEventListener(s,c,!0):p!==void 0?r.addEventListener(s,c,{passive:p}):r.addEventListener(s,c,!1)}function OR(r,s,c,d,p){var _=d;if(!(s&1)&&!(s&2)&&d!==null)e:for(;;){if(d===null)return;var g=d.tag;if(g===3||g===4){var R=d.stateNode.containerInfo;if(R===p||R.nodeType===8&&R.parentNode===p)break;if(g===4)for(g=d.return;g!==null;){var I=g.tag;if((I===3||I===4)&&(I=g.stateNode.containerInfo,I===p||I.nodeType===8&&I.parentNode===p))return;g=g.return}for(;R!==null;){if(g=Yl(R),g===null)return;if(I=g.tag,I===5||I===6){d=_=g;continue e}R=R.parentNode}}d=d.return}tV(function(){var P=_,k=DI(c),L=[];e:{var x=NV.get(r);if(x!==void 0){var H=VI,K=r;switch(r){case"keypress":if(cg(c)===0)break e;case"keydown":case"keyup":H=HJ;break;case"focusin":K="focus",H=yR;break;case"focusout":K="blur",H=yR;break;case"beforeblur":case"afterblur":H=yR;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":H=_2;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":H=DJ;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":H=YJ;break;case wV:case bV:case AV:H=MJ;break;case OV:H=JJ;break;case"scroll":H=NJ;break;case"wheel":H=QJ;break;case"copy":case"cut":case"paste":H=UJ;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":H=g2}var ee=(s&4)!==0,re=!ee&&r==="scroll",Y=ee?x!==null?x+"Capture":null:x;ee=[];for(var F=P,z;F!==null;){z=F;var le=z.stateNode;if(z.tag===5&&le!==null&&(z=le,Y!==null&&(le=Tf(F,Y),le!=null&&ee.push(Af(F,le,z)))),re)break;F=F.return}0<ee.length&&(x=new H(x,K,null,c,k),L.push({event:x,listeners:ee}))}}if(!(s&7)){e:{if(x=r==="mouseover"||r==="pointerover",H=r==="mouseout"||r==="pointerout",x&&c!==fC&&(K=c.relatedTarget||c.fromElement)&&(Yl(K)||K[Na]))break e;if((H||x)&&(x=k.window===k?k:(x=k.ownerDocument)?x.defaultView||x.parentWindow:window,H?(K=c.relatedTarget||c.toElement,H=P,K=K?Yl(K):null,K!==null&&(re=dd(K),K!==re||K.tag!==5&&K.tag!==6)&&(K=null)):(H=null,K=P),H!==K)){if(ee=_2,le="onMouseLeave",Y="onMouseEnter",F="mouse",(r==="pointerout"||r==="pointerover")&&(ee=g2,le="onPointerLeave",Y="onPointerEnter",F="pointer"),re=H==null?x:Lu(H),z=K==null?x:Lu(K),x=new ee(le,F+"leave",H,c,k),x.target=re,x.relatedTarget=z,le=null,Yl(k)===P&&(ee=new ee(Y,F+"enter",K,c,k),ee.target=z,ee.relatedTarget=re,le=ee),re=le,H&&K)t:{for(ee=H,Y=K,F=0,z=ee;z;z=Ru(z))F++;for(z=0,le=Y;le;le=Ru(le))z++;for(;0<F-z;)ee=Ru(ee),F--;for(;0<z-F;)Y=Ru(Y),z--;for(;F--;){if(ee===Y||Y!==null&&ee===Y.alternate)break t;ee=Ru(ee),Y=Ru(Y)}ee=null}else ee=null;H!==null&&O2(L,x,H,ee,!1),K!==null&&re!==null&&O2(L,re,K,ee,!0)}}e:{if(x=P?Lu(P):window,H=x.nodeName&&x.nodeName.toLowerCase(),H==="select"||H==="input"&&x.type==="file")var ge=rX;else if(T2(x))if(TV)ge=cX;else{ge=oX;var Z=sX}else(H=x.nodeName)&&H.toLowerCase()==="input"&&(x.type==="checkbox"||x.type==="radio")&&(ge=aX);if(ge&&(ge=ge(r,P))){SV(L,ge,c,k);break e}Z&&Z(r,x,P),r==="focusout"&&(Z=x._wrapperState)&&Z.controlled&&x.type==="number"&&lC(x,"number",x.value)}switch(Z=P?Lu(P):window,r){case"focusin":(T2(Z)||Z.contentEditable==="true")&&(Du=Z,TC=P,uf=null);break;case"focusout":uf=TC=Du=null;break;case"mousedown":yC=!0;break;case"contextmenu":case"mouseup":case"dragend":yC=!1,w2(L,c,k);break;case"selectionchange":if(uX)break;case"keydown":case"keyup":w2(L,c,k)}var fe;if(jI)e:{switch(r){case"compositionstart":var ae="onCompositionStart";break e;case"compositionend":ae="onCompositionEnd";break e;case"compositionupdate":ae="onCompositionUpdate";break e}ae=void 0}else Pu?gV(r,c)&&(ae="onCompositionEnd"):r==="keydown"&&c.keyCode===229&&(ae="onCompositionStart");ae&&(EV&&c.locale!=="ko"&&(Pu||ae!=="onCompositionStart"?ae==="onCompositionEnd"&&Pu&&(fe=_V()):(Gc=k,UI="value"in Gc?Gc.value:Gc.textContent,Pu=!0)),Z=Dg(P,ae),0<Z.length&&(ae=new E2(ae,r,null,c,k),L.push({event:ae,listeners:Z}),fe?ae.data=fe:(fe=vV(c),fe!==null&&(ae.data=fe)))),(fe=ZJ?eX(r,c):tX(r,c))&&(P=Dg(P,"onBeforeInput"),0<P.length&&(k=new E2("onBeforeInput","beforeinput",null,c,k),L.push({event:k,listeners:P}),k.data=fe))}PV(L,s)})}function Af(r,s,c){return{instance:r,listener:s,currentTarget:c}}function Dg(r,s){for(var c=s+"Capture",d=[];r!==null;){var p=r,_=p.stateNode;p.tag===5&&_!==null&&(p=_,_=Tf(r,c),_!=null&&d.unshift(Af(r,_,p)),_=Tf(r,s),_!=null&&d.push(Af(r,_,p))),r=r.return}return d}function Ru(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function O2(r,s,c,d,p){for(var _=s._reactName,g=[];c!==null&&c!==d;){var R=c,I=R.alternate,P=R.stateNode;if(I!==null&&I===d)break;R.tag===5&&P!==null&&(R=P,p?(I=Tf(c,_),I!=null&&g.unshift(Af(c,I,R))):p||(I=Tf(c,_),I!=null&&g.push(Af(c,I,R)))),c=c.return}g.length!==0&&r.push({event:s,listeners:g})}var mX=/\r\n?/g,_X=/\u0000|\uFFFD/g;function N2(r){return(typeof r=="string"?r:""+r).replace(mX,`
`).replace(_X,"")}function LE(r,s,c){if(s=N2(s),N2(r)!==s&&c)throw Error(De(425))}function kg(){}var RC=null,CC=null;function IC(r,s){return r==="textarea"||r==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var wC=typeof setTimeout=="function"?setTimeout:void 0,EX=typeof clearTimeout=="function"?clearTimeout:void 0,P2=typeof Promise=="function"?Promise:void 0,gX=typeof queueMicrotask=="function"?queueMicrotask:typeof P2<"u"?function(r){return P2.resolve(null).then(r).catch(vX)}:wC;function vX(r){setTimeout(function(){throw r})}function NR(r,s){var c=s,d=0;do{var p=c.nextSibling;if(r.removeChild(c),p&&p.nodeType===8)if(c=p.data,c==="/$"){if(d===0){r.removeChild(p),Cf(s);return}d--}else c!=="$"&&c!=="$?"&&c!=="$!"||d++;c=p}while(c);Cf(s)}function qc(r){for(;r!=null;r=r.nextSibling){var s=r.nodeType;if(s===1||s===3)break;if(s===8){if(s=r.data,s==="$"||s==="$!"||s==="$?")break;if(s==="/$")return null}}return r}function D2(r){r=r.previousSibling;for(var s=0;r;){if(r.nodeType===8){var c=r.data;if(c==="$"||c==="$!"||c==="$?"){if(s===0)return r;s--}else c==="/$"&&s++}r=r.previousSibling}return null}var lh=Math.random().toString(36).slice(2),Yo="__reactFiber$"+lh,Of="__reactProps$"+lh,Na="__reactContainer$"+lh,bC="__reactEvents$"+lh,SX="__reactListeners$"+lh,TX="__reactHandles$"+lh;function Yl(r){var s=r[Yo];if(s)return s;for(var c=r.parentNode;c;){if(s=c[Na]||c[Yo]){if(c=s.alternate,s.child!==null||c!==null&&c.child!==null)for(r=D2(r);r!==null;){if(c=r[Yo])return c;r=D2(r)}return s}r=c,c=r.parentNode}return null}function Yf(r){return r=r[Yo]||r[Na],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function Lu(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(De(33))}function uv(r){return r[Of]||null}var AC=[],Mu=-1;function al(r){return{current:r}}function Hn(r){0>Mu||(r.current=AC[Mu],AC[Mu]=null,Mu--)}function Vn(r,s){Mu++,AC[Mu]=r.current,r.current=s}var tl={},mr=al(tl),Jr=al(!1),nd=tl;function Zu(r,s){var c=r.type.contextTypes;if(!c)return tl;var d=r.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===s)return d.__reactInternalMemoizedMaskedChildContext;var p={},_;for(_ in c)p[_]=s[_];return d&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=s,r.__reactInternalMemoizedMaskedChildContext=p),p}function Xr(r){return r=r.childContextTypes,r!=null}function Lg(){Hn(Jr),Hn(mr)}function k2(r,s,c){if(mr.current!==tl)throw Error(De(168));Vn(mr,s),Vn(Jr,c)}function kV(r,s,c){var d=r.stateNode;if(s=s.childContextTypes,typeof d.getChildContext!="function")return c;d=d.getChildContext();for(var p in d)if(!(p in s))throw Error(De(108,sJ(r)||"Unknown",p));return li({},c,d)}function Mg(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||tl,nd=mr.current,Vn(mr,r),Vn(Jr,Jr.current),!0}function L2(r,s,c){var d=r.stateNode;if(!d)throw Error(De(169));c?(r=kV(r,s,nd),d.__reactInternalMemoizedMergedChildContext=r,Hn(Jr),Hn(mr),Vn(mr,r)):Hn(Jr),Vn(Jr,c)}var Ia=null,hv=!1,PR=!1;function LV(r){Ia===null?Ia=[r]:Ia.push(r)}function yX(r){hv=!0,LV(r)}function cl(){if(!PR&&Ia!==null){PR=!0;var r=0,s=_n;try{var c=Ia;for(_n=1;r<c.length;r++){var d=c[r];do d=d(!0);while(d!==null)}Ia=null,hv=!1}catch(p){throw Ia!==null&&(Ia=Ia.slice(r+1)),sV(kI,cl),p}finally{_n=s,PR=!1}}return null}var xu=[],Uu=0,xg=null,Ug=0,Hs=[],Ks=0,id=null,wa=1,ba="";function Wl(r,s){xu[Uu++]=Ug,xu[Uu++]=xg,xg=r,Ug=s}function MV(r,s,c){Hs[Ks++]=wa,Hs[Ks++]=ba,Hs[Ks++]=id,id=r;var d=wa;r=ba;var p=32-So(d)-1;d&=~(1<<p),c+=1;var _=32-So(s)+p;if(30<_){var g=p-p%5;_=(d&(1<<g)-1).toString(32),d>>=g,p-=g,wa=1<<32-So(s)+p|c<<p|d,ba=_+r}else wa=1<<_|c<<p|d,ba=r}function GI(r){r.return!==null&&(Wl(r,1),MV(r,1,0))}function WI(r){for(;r===xg;)xg=xu[--Uu],xu[Uu]=null,Ug=xu[--Uu],xu[Uu]=null;for(;r===id;)id=Hs[--Ks],Hs[Ks]=null,ba=Hs[--Ks],Hs[Ks]=null,wa=Hs[--Ks],Hs[Ks]=null}var fs=null,ps=null,ni=!1,go=null;function xV(r,s){var c=Ys(5,null,null,0);c.elementType="DELETED",c.stateNode=s,c.return=r,s=r.deletions,s===null?(r.deletions=[c],r.flags|=16):s.push(c)}function M2(r,s){switch(r.tag){case 5:var c=r.type;return s=s.nodeType!==1||c.toLowerCase()!==s.nodeName.toLowerCase()?null:s,s!==null?(r.stateNode=s,fs=r,ps=qc(s.firstChild),!0):!1;case 6:return s=r.pendingProps===""||s.nodeType!==3?null:s,s!==null?(r.stateNode=s,fs=r,ps=null,!0):!1;case 13:return s=s.nodeType!==8?null:s,s!==null?(c=id!==null?{id:wa,overflow:ba}:null,r.memoizedState={dehydrated:s,treeContext:c,retryLane:1073741824},c=Ys(18,null,null,0),c.stateNode=s,c.return=r,r.child=c,fs=r,ps=null,!0):!1;default:return!1}}function OC(r){return(r.mode&1)!==0&&(r.flags&128)===0}function NC(r){if(ni){var s=ps;if(s){var c=s;if(!M2(r,s)){if(OC(r))throw Error(De(418));s=qc(c.nextSibling);var d=fs;s&&M2(r,s)?xV(d,c):(r.flags=r.flags&-4097|2,ni=!1,fs=r)}}else{if(OC(r))throw Error(De(418));r.flags=r.flags&-4097|2,ni=!1,fs=r}}}function x2(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;fs=r}function ME(r){if(r!==fs)return!1;if(!ni)return x2(r),ni=!0,!1;var s;if((s=r.tag!==3)&&!(s=r.tag!==5)&&(s=r.type,s=s!=="head"&&s!=="body"&&!IC(r.type,r.memoizedProps)),s&&(s=ps)){if(OC(r))throw UV(),Error(De(418));for(;s;)xV(r,s),s=qc(s.nextSibling)}if(x2(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(De(317));e:{for(r=r.nextSibling,s=0;r;){if(r.nodeType===8){var c=r.data;if(c==="/$"){if(s===0){ps=qc(r.nextSibling);break e}s--}else c!=="$"&&c!=="$!"&&c!=="$?"||s++}r=r.nextSibling}ps=null}}else ps=fs?qc(r.stateNode.nextSibling):null;return!0}function UV(){for(var r=ps;r;)r=qc(r.nextSibling)}function eh(){ps=fs=null,ni=!1}function HI(r){go===null?go=[r]:go.push(r)}var RX=xa.ReactCurrentBatchConfig;function fo(r,s){if(r&&r.defaultProps){s=li({},s),r=r.defaultProps;for(var c in r)s[c]===void 0&&(s[c]=r[c]);return s}return s}var Vg=al(null),Fg=null,Vu=null,KI=null;function zI(){KI=Vu=Fg=null}function YI(r){var s=Vg.current;Hn(Vg),r._currentValue=s}function PC(r,s,c){for(;r!==null;){var d=r.alternate;if((r.childLanes&s)!==s?(r.childLanes|=s,d!==null&&(d.childLanes|=s)):d!==null&&(d.childLanes&s)!==s&&(d.childLanes|=s),r===c)break;r=r.return}}function qu(r,s){Fg=r,KI=Vu=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&s&&(qr=!0),r.firstContext=null)}function Js(r){var s=r._currentValue;if(KI!==r)if(r={context:r,memoizedValue:s,next:null},Vu===null){if(Fg===null)throw Error(De(308));Vu=r,Fg.dependencies={lanes:0,firstContext:r}}else Vu=Vu.next=r;return s}var ql=null;function qI(r){ql===null?ql=[r]:ql.push(r)}function VV(r,s,c,d){var p=s.interleaved;return p===null?(c.next=c,qI(s)):(c.next=p.next,p.next=c),s.interleaved=c,Pa(r,d)}function Pa(r,s){r.lanes|=s;var c=r.alternate;for(c!==null&&(c.lanes|=s),c=r,r=r.return;r!==null;)r.childLanes|=s,c=r.alternate,c!==null&&(c.childLanes|=s),c=r,r=r.return;return c.tag===3?c.stateNode:null}var Fc=!1;function JI(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function FV(r,s){r=r.updateQueue,s.updateQueue===r&&(s.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function Aa(r,s){return{eventTime:r,lane:s,tag:0,payload:null,callback:null,next:null}}function Jc(r,s,c){var d=r.updateQueue;if(d===null)return null;if(d=d.shared,nn&2){var p=d.pending;return p===null?s.next=s:(s.next=p.next,p.next=s),d.pending=s,Pa(r,c)}return p=d.interleaved,p===null?(s.next=s,qI(d)):(s.next=p.next,p.next=s),d.interleaved=s,Pa(r,c)}function lg(r,s,c){if(s=s.updateQueue,s!==null&&(s=s.shared,(c&4194240)!==0)){var d=s.lanes;d&=r.pendingLanes,c|=d,s.lanes=c,LI(r,c)}}function U2(r,s){var c=r.updateQueue,d=r.alternate;if(d!==null&&(d=d.updateQueue,c===d)){var p=null,_=null;if(c=c.firstBaseUpdate,c!==null){do{var g={eventTime:c.eventTime,lane:c.lane,tag:c.tag,payload:c.payload,callback:c.callback,next:null};_===null?p=_=g:_=_.next=g,c=c.next}while(c!==null);_===null?p=_=s:_=_.next=s}else p=_=s;c={baseState:d.baseState,firstBaseUpdate:p,lastBaseUpdate:_,shared:d.shared,effects:d.effects},r.updateQueue=c;return}r=c.lastBaseUpdate,r===null?c.firstBaseUpdate=s:r.next=s,c.lastBaseUpdate=s}function jg(r,s,c,d){var p=r.updateQueue;Fc=!1;var _=p.firstBaseUpdate,g=p.lastBaseUpdate,R=p.shared.pending;if(R!==null){p.shared.pending=null;var I=R,P=I.next;I.next=null,g===null?_=P:g.next=P,g=I;var k=r.alternate;k!==null&&(k=k.updateQueue,R=k.lastBaseUpdate,R!==g&&(R===null?k.firstBaseUpdate=P:R.next=P,k.lastBaseUpdate=I))}if(_!==null){var L=p.baseState;g=0,k=P=I=null,R=_;do{var x=R.lane,H=R.eventTime;if((d&x)===x){k!==null&&(k=k.next={eventTime:H,lane:0,tag:R.tag,payload:R.payload,callback:R.callback,next:null});e:{var K=r,ee=R;switch(x=s,H=c,ee.tag){case 1:if(K=ee.payload,typeof K=="function"){L=K.call(H,L,x);break e}L=K;break e;case 3:K.flags=K.flags&-65537|128;case 0:if(K=ee.payload,x=typeof K=="function"?K.call(H,L,x):K,x==null)break e;L=li({},L,x);break e;case 2:Fc=!0}}R.callback!==null&&R.lane!==0&&(r.flags|=64,x=p.effects,x===null?p.effects=[R]:x.push(R))}else H={eventTime:H,lane:x,tag:R.tag,payload:R.payload,callback:R.callback,next:null},k===null?(P=k=H,I=L):k=k.next=H,g|=x;if(R=R.next,R===null){if(R=p.shared.pending,R===null)break;x=R,R=x.next,x.next=null,p.lastBaseUpdate=x,p.shared.pending=null}}while(!0);if(k===null&&(I=L),p.baseState=I,p.firstBaseUpdate=P,p.lastBaseUpdate=k,s=p.shared.interleaved,s!==null){p=s;do g|=p.lane,p=p.next;while(p!==s)}else _===null&&(p.shared.lanes=0);sd|=g,r.lanes=g,r.memoizedState=L}}function V2(r,s,c){if(r=s.effects,s.effects=null,r!==null)for(s=0;s<r.length;s++){var d=r[s],p=d.callback;if(p!==null){if(d.callback=null,d=c,typeof p!="function")throw Error(De(191,p));p.call(d)}}}var jV=new VU.Component().refs;function DC(r,s,c,d){s=r.memoizedState,c=c(d,s),c=c==null?s:li({},s,c),r.memoizedState=c,r.lanes===0&&(r.updateQueue.baseState=c)}var pv={isMounted:function(r){return(r=r._reactInternals)?dd(r)===r:!1},enqueueSetState:function(r,s,c){r=r._reactInternals;var d=Ar(),p=Qc(r),_=Aa(d,p);_.payload=s,c!=null&&(_.callback=c),s=Jc(r,_,p),s!==null&&(To(s,r,p,d),lg(s,r,p))},enqueueReplaceState:function(r,s,c){r=r._reactInternals;var d=Ar(),p=Qc(r),_=Aa(d,p);_.tag=1,_.payload=s,c!=null&&(_.callback=c),s=Jc(r,_,p),s!==null&&(To(s,r,p,d),lg(s,r,p))},enqueueForceUpdate:function(r,s){r=r._reactInternals;var c=Ar(),d=Qc(r),p=Aa(c,d);p.tag=2,s!=null&&(p.callback=s),s=Jc(r,p,d),s!==null&&(To(s,r,d,c),lg(s,r,d))}};function F2(r,s,c,d,p,_,g){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(d,_,g):s.prototype&&s.prototype.isPureReactComponent?!wf(c,d)||!wf(p,_):!0}function BV(r,s,c){var d=!1,p=tl,_=s.contextType;return typeof _=="object"&&_!==null?_=Js(_):(p=Xr(s)?nd:mr.current,d=s.contextTypes,_=(d=d!=null)?Zu(r,p):tl),s=new s(c,_),r.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,s.updater=pv,r.stateNode=s,s._reactInternals=r,d&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=p,r.__reactInternalMemoizedMaskedChildContext=_),s}function j2(r,s,c,d){r=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(c,d),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(c,d),s.state!==r&&pv.enqueueReplaceState(s,s.state,null)}function kC(r,s,c,d){var p=r.stateNode;p.props=c,p.state=r.memoizedState,p.refs=jV,JI(r);var _=s.contextType;typeof _=="object"&&_!==null?p.context=Js(_):(_=Xr(s)?nd:mr.current,p.context=Zu(r,_)),p.state=r.memoizedState,_=s.getDerivedStateFromProps,typeof _=="function"&&(DC(r,s,_,c),p.state=r.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof p.getSnapshotBeforeUpdate=="function"||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(s=p.state,typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount(),s!==p.state&&pv.enqueueReplaceState(p,p.state,null),jg(r,c,p,d),p.state=r.memoizedState),typeof p.componentDidMount=="function"&&(r.flags|=4194308)}function Hp(r,s,c){if(r=c.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(c._owner){if(c=c._owner,c){if(c.tag!==1)throw Error(De(309));var d=c.stateNode}if(!d)throw Error(De(147,r));var p=d,_=""+r;return s!==null&&s.ref!==null&&typeof s.ref=="function"&&s.ref._stringRef===_?s.ref:(s=function(g){var R=p.refs;R===jV&&(R=p.refs={}),g===null?delete R[_]:R[_]=g},s._stringRef=_,s)}if(typeof r!="string")throw Error(De(284));if(!c._owner)throw Error(De(290,r))}return r}function xE(r,s){throw r=Object.prototype.toString.call(s),Error(De(31,r==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":r))}function B2(r){var s=r._init;return s(r._payload)}function GV(r){function s(Y,F){if(r){var z=Y.deletions;z===null?(Y.deletions=[F],Y.flags|=16):z.push(F)}}function c(Y,F){if(!r)return null;for(;F!==null;)s(Y,F),F=F.sibling;return null}function d(Y,F){for(Y=new Map;F!==null;)F.key!==null?Y.set(F.key,F):Y.set(F.index,F),F=F.sibling;return Y}function p(Y,F){return Y=$c(Y,F),Y.index=0,Y.sibling=null,Y}function _(Y,F,z){return Y.index=z,r?(z=Y.alternate,z!==null?(z=z.index,z<F?(Y.flags|=2,F):z):(Y.flags|=2,F)):(Y.flags|=1048576,F)}function g(Y){return r&&Y.alternate===null&&(Y.flags|=2),Y}function R(Y,F,z,le){return F===null||F.tag!==6?(F=VR(z,Y.mode,le),F.return=Y,F):(F=p(F,z),F.return=Y,F)}function I(Y,F,z,le){var ge=z.type;return ge===Nu?k(Y,F,z.props.children,le,z.key):F!==null&&(F.elementType===ge||typeof ge=="object"&&ge!==null&&ge.$$typeof===Vc&&B2(ge)===F.type)?(le=p(F,z.props),le.ref=Hp(Y,F,z),le.return=Y,le):(le=mg(z.type,z.key,z.props,null,Y.mode,le),le.ref=Hp(Y,F,z),le.return=Y,le)}function P(Y,F,z,le){return F===null||F.tag!==4||F.stateNode.containerInfo!==z.containerInfo||F.stateNode.implementation!==z.implementation?(F=FR(z,Y.mode,le),F.return=Y,F):(F=p(F,z.children||[]),F.return=Y,F)}function k(Y,F,z,le,ge){return F===null||F.tag!==7?(F=td(z,Y.mode,le,ge),F.return=Y,F):(F=p(F,z),F.return=Y,F)}function L(Y,F,z){if(typeof F=="string"&&F!==""||typeof F=="number")return F=VR(""+F,Y.mode,z),F.return=Y,F;if(typeof F=="object"&&F!==null){switch(F.$$typeof){case IE:return z=mg(F.type,F.key,F.props,null,Y.mode,z),z.ref=Hp(Y,null,F),z.return=Y,z;case Ou:return F=FR(F,Y.mode,z),F.return=Y,F;case Vc:var le=F._init;return L(Y,le(F._payload),z)}if(ef(F)||Fp(F))return F=td(F,Y.mode,z,null),F.return=Y,F;xE(Y,F)}return null}function x(Y,F,z,le){var ge=F!==null?F.key:null;if(typeof z=="string"&&z!==""||typeof z=="number")return ge!==null?null:R(Y,F,""+z,le);if(typeof z=="object"&&z!==null){switch(z.$$typeof){case IE:return z.key===ge?I(Y,F,z,le):null;case Ou:return z.key===ge?P(Y,F,z,le):null;case Vc:return ge=z._init,x(Y,F,ge(z._payload),le)}if(ef(z)||Fp(z))return ge!==null?null:k(Y,F,z,le,null);xE(Y,z)}return null}function H(Y,F,z,le,ge){if(typeof le=="string"&&le!==""||typeof le=="number")return Y=Y.get(z)||null,R(F,Y,""+le,ge);if(typeof le=="object"&&le!==null){switch(le.$$typeof){case IE:return Y=Y.get(le.key===null?z:le.key)||null,I(F,Y,le,ge);case Ou:return Y=Y.get(le.key===null?z:le.key)||null,P(F,Y,le,ge);case Vc:var Z=le._init;return H(Y,F,z,Z(le._payload),ge)}if(ef(le)||Fp(le))return Y=Y.get(z)||null,k(F,Y,le,ge,null);xE(F,le)}return null}function K(Y,F,z,le){for(var ge=null,Z=null,fe=F,ae=F=0,_e=null;fe!==null&&ae<z.length;ae++){fe.index>ae?(_e=fe,fe=null):_e=fe.sibling;var me=x(Y,fe,z[ae],le);if(me===null){fe===null&&(fe=_e);break}r&&fe&&me.alternate===null&&s(Y,fe),F=_(me,F,ae),Z===null?ge=me:Z.sibling=me,Z=me,fe=_e}if(ae===z.length)return c(Y,fe),ni&&Wl(Y,ae),ge;if(fe===null){for(;ae<z.length;ae++)fe=L(Y,z[ae],le),fe!==null&&(F=_(fe,F,ae),Z===null?ge=fe:Z.sibling=fe,Z=fe);return ni&&Wl(Y,ae),ge}for(fe=d(Y,fe);ae<z.length;ae++)_e=H(fe,Y,ae,z[ae],le),_e!==null&&(r&&_e.alternate!==null&&fe.delete(_e.key===null?ae:_e.key),F=_(_e,F,ae),Z===null?ge=_e:Z.sibling=_e,Z=_e);return r&&fe.forEach(function(Ue){return s(Y,Ue)}),ni&&Wl(Y,ae),ge}function ee(Y,F,z,le){var ge=Fp(z);if(typeof ge!="function")throw Error(De(150));if(z=ge.call(z),z==null)throw Error(De(151));for(var Z=ge=null,fe=F,ae=F=0,_e=null,me=z.next();fe!==null&&!me.done;ae++,me=z.next()){fe.index>ae?(_e=fe,fe=null):_e=fe.sibling;var Ue=x(Y,fe,me.value,le);if(Ue===null){fe===null&&(fe=_e);break}r&&fe&&Ue.alternate===null&&s(Y,fe),F=_(Ue,F,ae),Z===null?ge=Ue:Z.sibling=Ue,Z=Ue,fe=_e}if(me.done)return c(Y,fe),ni&&Wl(Y,ae),ge;if(fe===null){for(;!me.done;ae++,me=z.next())me=L(Y,me.value,le),me!==null&&(F=_(me,F,ae),Z===null?ge=me:Z.sibling=me,Z=me);return ni&&Wl(Y,ae),ge}for(fe=d(Y,fe);!me.done;ae++,me=z.next())me=H(fe,Y,ae,me.value,le),me!==null&&(r&&me.alternate!==null&&fe.delete(me.key===null?ae:me.key),F=_(me,F,ae),Z===null?ge=me:Z.sibling=me,Z=me);return r&&fe.forEach(function(Ve){return s(Y,Ve)}),ni&&Wl(Y,ae),ge}function re(Y,F,z,le){if(typeof z=="object"&&z!==null&&z.type===Nu&&z.key===null&&(z=z.props.children),typeof z=="object"&&z!==null){switch(z.$$typeof){case IE:e:{for(var ge=z.key,Z=F;Z!==null;){if(Z.key===ge){if(ge=z.type,ge===Nu){if(Z.tag===7){c(Y,Z.sibling),F=p(Z,z.props.children),F.return=Y,Y=F;break e}}else if(Z.elementType===ge||typeof ge=="object"&&ge!==null&&ge.$$typeof===Vc&&B2(ge)===Z.type){c(Y,Z.sibling),F=p(Z,z.props),F.ref=Hp(Y,Z,z),F.return=Y,Y=F;break e}c(Y,Z);break}else s(Y,Z);Z=Z.sibling}z.type===Nu?(F=td(z.props.children,Y.mode,le,z.key),F.return=Y,Y=F):(le=mg(z.type,z.key,z.props,null,Y.mode,le),le.ref=Hp(Y,F,z),le.return=Y,Y=le)}return g(Y);case Ou:e:{for(Z=z.key;F!==null;){if(F.key===Z)if(F.tag===4&&F.stateNode.containerInfo===z.containerInfo&&F.stateNode.implementation===z.implementation){c(Y,F.sibling),F=p(F,z.children||[]),F.return=Y,Y=F;break e}else{c(Y,F);break}else s(Y,F);F=F.sibling}F=FR(z,Y.mode,le),F.return=Y,Y=F}return g(Y);case Vc:return Z=z._init,re(Y,F,Z(z._payload),le)}if(ef(z))return K(Y,F,z,le);if(Fp(z))return ee(Y,F,z,le);xE(Y,z)}return typeof z=="string"&&z!==""||typeof z=="number"?(z=""+z,F!==null&&F.tag===6?(c(Y,F.sibling),F=p(F,z),F.return=Y,Y=F):(c(Y,F),F=VR(z,Y.mode,le),F.return=Y,Y=F),g(Y)):c(Y,F)}return re}var th=GV(!0),WV=GV(!1),qf={},Xo=al(qf),Nf=al(qf),Pf=al(qf);function Jl(r){if(r===qf)throw Error(De(174));return r}function XI(r,s){switch(Vn(Pf,s),Vn(Nf,r),Vn(Xo,qf),r=s.nodeType,r){case 9:case 11:s=(s=s.documentElement)?s.namespaceURI:uC(null,"");break;default:r=r===8?s.parentNode:s,s=r.namespaceURI||null,r=r.tagName,s=uC(s,r)}Hn(Xo),Vn(Xo,s)}function nh(){Hn(Xo),Hn(Nf),Hn(Pf)}function HV(r){Jl(Pf.current);var s=Jl(Xo.current),c=uC(s,r.type);s!==c&&(Vn(Nf,r),Vn(Xo,c))}function QI(r){Nf.current===r&&(Hn(Xo),Hn(Nf))}var ai=al(0);function Bg(r){for(var s=r;s!==null;){if(s.tag===13){var c=s.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||c.data==="$?"||c.data==="$!"))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if(s.flags&128)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var DR=[];function $I(){for(var r=0;r<DR.length;r++)DR[r]._workInProgressVersionPrimary=null;DR.length=0}var dg=xa.ReactCurrentDispatcher,kR=xa.ReactCurrentBatchConfig,rd=0,ci=null,Fi=null,zi=null,Gg=!1,hf=!1,Df=0,CX=0;function hr(){throw Error(De(321))}function ZI(r,s){if(s===null)return!1;for(var c=0;c<s.length&&c<r.length;c++)if(!yo(r[c],s[c]))return!1;return!0}function ew(r,s,c,d,p,_){if(rd=_,ci=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,dg.current=r===null||r.memoizedState===null?AX:OX,r=c(d,p),hf){_=0;do{if(hf=!1,Df=0,25<=_)throw Error(De(301));_+=1,zi=Fi=null,s.updateQueue=null,dg.current=NX,r=c(d,p)}while(hf)}if(dg.current=Wg,s=Fi!==null&&Fi.next!==null,rd=0,zi=Fi=ci=null,Gg=!1,s)throw Error(De(300));return r}function tw(){var r=Df!==0;return Df=0,r}function zo(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return zi===null?ci.memoizedState=zi=r:zi=zi.next=r,zi}function Xs(){if(Fi===null){var r=ci.alternate;r=r!==null?r.memoizedState:null}else r=Fi.next;var s=zi===null?ci.memoizedState:zi.next;if(s!==null)zi=s,Fi=r;else{if(r===null)throw Error(De(310));Fi=r,r={memoizedState:Fi.memoizedState,baseState:Fi.baseState,baseQueue:Fi.baseQueue,queue:Fi.queue,next:null},zi===null?ci.memoizedState=zi=r:zi=zi.next=r}return zi}function kf(r,s){return typeof s=="function"?s(r):s}function LR(r){var s=Xs(),c=s.queue;if(c===null)throw Error(De(311));c.lastRenderedReducer=r;var d=Fi,p=d.baseQueue,_=c.pending;if(_!==null){if(p!==null){var g=p.next;p.next=_.next,_.next=g}d.baseQueue=p=_,c.pending=null}if(p!==null){_=p.next,d=d.baseState;var R=g=null,I=null,P=_;do{var k=P.lane;if((rd&k)===k)I!==null&&(I=I.next={lane:0,action:P.action,hasEagerState:P.hasEagerState,eagerState:P.eagerState,next:null}),d=P.hasEagerState?P.eagerState:r(d,P.action);else{var L={lane:k,action:P.action,hasEagerState:P.hasEagerState,eagerState:P.eagerState,next:null};I===null?(R=I=L,g=d):I=I.next=L,ci.lanes|=k,sd|=k}P=P.next}while(P!==null&&P!==_);I===null?g=d:I.next=R,yo(d,s.memoizedState)||(qr=!0),s.memoizedState=d,s.baseState=g,s.baseQueue=I,c.lastRenderedState=d}if(r=c.interleaved,r!==null){p=r;do _=p.lane,ci.lanes|=_,sd|=_,p=p.next;while(p!==r)}else p===null&&(c.lanes=0);return[s.memoizedState,c.dispatch]}function MR(r){var s=Xs(),c=s.queue;if(c===null)throw Error(De(311));c.lastRenderedReducer=r;var d=c.dispatch,p=c.pending,_=s.memoizedState;if(p!==null){c.pending=null;var g=p=p.next;do _=r(_,g.action),g=g.next;while(g!==p);yo(_,s.memoizedState)||(qr=!0),s.memoizedState=_,s.baseQueue===null&&(s.baseState=_),c.lastRenderedState=_}return[_,d]}function KV(){}function zV(r,s){var c=ci,d=Xs(),p=s(),_=!yo(d.memoizedState,p);if(_&&(d.memoizedState=p,qr=!0),d=d.queue,nw(JV.bind(null,c,d,r),[r]),d.getSnapshot!==s||_||zi!==null&&zi.memoizedState.tag&1){if(c.flags|=2048,Lf(9,qV.bind(null,c,d,p,s),void 0,null),Yi===null)throw Error(De(349));rd&30||YV(c,s,p)}return p}function YV(r,s,c){r.flags|=16384,r={getSnapshot:s,value:c},s=ci.updateQueue,s===null?(s={lastEffect:null,stores:null},ci.updateQueue=s,s.stores=[r]):(c=s.stores,c===null?s.stores=[r]:c.push(r))}function qV(r,s,c,d){s.value=c,s.getSnapshot=d,XV(s)&&QV(r)}function JV(r,s,c){return c(function(){XV(s)&&QV(r)})}function XV(r){var s=r.getSnapshot;r=r.value;try{var c=s();return!yo(r,c)}catch{return!0}}function QV(r){var s=Pa(r,1);s!==null&&To(s,r,1,-1)}function G2(r){var s=zo();return typeof r=="function"&&(r=r()),s.memoizedState=s.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:kf,lastRenderedState:r},s.queue=r,r=r.dispatch=bX.bind(null,ci,r),[s.memoizedState,r]}function Lf(r,s,c,d){return r={tag:r,create:s,destroy:c,deps:d,next:null},s=ci.updateQueue,s===null?(s={lastEffect:null,stores:null},ci.updateQueue=s,s.lastEffect=r.next=r):(c=s.lastEffect,c===null?s.lastEffect=r.next=r:(d=c.next,c.next=r,r.next=d,s.lastEffect=r)),r}function $V(){return Xs().memoizedState}function ug(r,s,c,d){var p=zo();ci.flags|=r,p.memoizedState=Lf(1|s,c,void 0,d===void 0?null:d)}function fv(r,s,c,d){var p=Xs();d=d===void 0?null:d;var _=void 0;if(Fi!==null){var g=Fi.memoizedState;if(_=g.destroy,d!==null&&ZI(d,g.deps)){p.memoizedState=Lf(s,c,_,d);return}}ci.flags|=r,p.memoizedState=Lf(1|s,c,_,d)}function W2(r,s){return ug(8390656,8,r,s)}function nw(r,s){return fv(2048,8,r,s)}function ZV(r,s){return fv(4,2,r,s)}function eF(r,s){return fv(4,4,r,s)}function tF(r,s){if(typeof s=="function")return r=r(),s(r),function(){s(null)};if(s!=null)return r=r(),s.current=r,function(){s.current=null}}function nF(r,s,c){return c=c!=null?c.concat([r]):null,fv(4,4,tF.bind(null,s,r),c)}function iw(){}function iF(r,s){var c=Xs();s=s===void 0?null:s;var d=c.memoizedState;return d!==null&&s!==null&&ZI(s,d[1])?d[0]:(c.memoizedState=[r,s],r)}function rF(r,s){var c=Xs();s=s===void 0?null:s;var d=c.memoizedState;return d!==null&&s!==null&&ZI(s,d[1])?d[0]:(r=r(),c.memoizedState=[r,s],r)}function sF(r,s,c){return rd&21?(yo(c,s)||(c=cV(),ci.lanes|=c,sd|=c,r.baseState=!0),s):(r.baseState&&(r.baseState=!1,qr=!0),r.memoizedState=c)}function IX(r,s){var c=_n;_n=c!==0&&4>c?c:4,r(!0);var d=kR.transition;kR.transition={};try{r(!1),s()}finally{_n=c,kR.transition=d}}function oF(){return Xs().memoizedState}function wX(r,s,c){var d=Qc(r);if(c={lane:d,action:c,hasEagerState:!1,eagerState:null,next:null},aF(r))cF(s,c);else if(c=VV(r,s,c,d),c!==null){var p=Ar();To(c,r,d,p),lF(c,s,d)}}function bX(r,s,c){var d=Qc(r),p={lane:d,action:c,hasEagerState:!1,eagerState:null,next:null};if(aF(r))cF(s,p);else{var _=r.alternate;if(r.lanes===0&&(_===null||_.lanes===0)&&(_=s.lastRenderedReducer,_!==null))try{var g=s.lastRenderedState,R=_(g,c);if(p.hasEagerState=!0,p.eagerState=R,yo(R,g)){var I=s.interleaved;I===null?(p.next=p,qI(s)):(p.next=I.next,I.next=p),s.interleaved=p;return}}catch{}finally{}c=VV(r,s,p,d),c!==null&&(p=Ar(),To(c,r,d,p),lF(c,s,d))}}function aF(r){var s=r.alternate;return r===ci||s!==null&&s===ci}function cF(r,s){hf=Gg=!0;var c=r.pending;c===null?s.next=s:(s.next=c.next,c.next=s),r.pending=s}function lF(r,s,c){if(c&4194240){var d=s.lanes;d&=r.pendingLanes,c|=d,s.lanes=c,LI(r,c)}}var Wg={readContext:Js,useCallback:hr,useContext:hr,useEffect:hr,useImperativeHandle:hr,useInsertionEffect:hr,useLayoutEffect:hr,useMemo:hr,useReducer:hr,useRef:hr,useState:hr,useDebugValue:hr,useDeferredValue:hr,useTransition:hr,useMutableSource:hr,useSyncExternalStore:hr,useId:hr,unstable_isNewReconciler:!1},AX={readContext:Js,useCallback:function(r,s){return zo().memoizedState=[r,s===void 0?null:s],r},useContext:Js,useEffect:W2,useImperativeHandle:function(r,s,c){return c=c!=null?c.concat([r]):null,ug(4194308,4,tF.bind(null,s,r),c)},useLayoutEffect:function(r,s){return ug(4194308,4,r,s)},useInsertionEffect:function(r,s){return ug(4,2,r,s)},useMemo:function(r,s){var c=zo();return s=s===void 0?null:s,r=r(),c.memoizedState=[r,s],r},useReducer:function(r,s,c){var d=zo();return s=c!==void 0?c(s):s,d.memoizedState=d.baseState=s,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:s},d.queue=r,r=r.dispatch=wX.bind(null,ci,r),[d.memoizedState,r]},useRef:function(r){var s=zo();return r={current:r},s.memoizedState=r},useState:G2,useDebugValue:iw,useDeferredValue:function(r){return zo().memoizedState=r},useTransition:function(){var r=G2(!1),s=r[0];return r=IX.bind(null,r[1]),zo().memoizedState=r,[s,r]},useMutableSource:function(){},useSyncExternalStore:function(r,s,c){var d=ci,p=zo();if(ni){if(c===void 0)throw Error(De(407));c=c()}else{if(c=s(),Yi===null)throw Error(De(349));rd&30||YV(d,s,c)}p.memoizedState=c;var _={value:c,getSnapshot:s};return p.queue=_,W2(JV.bind(null,d,_,r),[r]),d.flags|=2048,Lf(9,qV.bind(null,d,_,c,s),void 0,null),c},useId:function(){var r=zo(),s=Yi.identifierPrefix;if(ni){var c=ba,d=wa;c=(d&~(1<<32-So(d)-1)).toString(32)+c,s=":"+s+"R"+c,c=Df++,0<c&&(s+="H"+c.toString(32)),s+=":"}else c=CX++,s=":"+s+"r"+c.toString(32)+":";return r.memoizedState=s},unstable_isNewReconciler:!1},OX={readContext:Js,useCallback:iF,useContext:Js,useEffect:nw,useImperativeHandle:nF,useInsertionEffect:ZV,useLayoutEffect:eF,useMemo:rF,useReducer:LR,useRef:$V,useState:function(){return LR(kf)},useDebugValue:iw,useDeferredValue:function(r){var s=Xs();return sF(s,Fi.memoizedState,r)},useTransition:function(){var r=LR(kf)[0],s=Xs().memoizedState;return[r,s]},useMutableSource:KV,useSyncExternalStore:zV,useId:oF,unstable_isNewReconciler:!1},NX={readContext:Js,useCallback:iF,useContext:Js,useEffect:nw,useImperativeHandle:nF,useInsertionEffect:ZV,useLayoutEffect:eF,useMemo:rF,useReducer:MR,useRef:$V,useState:function(){return MR(kf)},useDebugValue:iw,useDeferredValue:function(r){var s=Xs();return Fi===null?s.memoizedState=r:sF(s,Fi.memoizedState,r)},useTransition:function(){var r=MR(kf)[0],s=Xs().memoizedState;return[r,s]},useMutableSource:KV,useSyncExternalStore:zV,useId:oF,unstable_isNewReconciler:!1};function ih(r,s){try{var c="",d=s;do c+=rJ(d),d=d.return;while(d);var p=c}catch(_){p=`
Error generating stack: `+_.message+`
`+_.stack}return{value:r,source:s,stack:p,digest:null}}function xR(r,s,c){return{value:r,source:null,stack:c??null,digest:s??null}}function LC(r,s){try{console.error(s.value)}catch(c){setTimeout(function(){throw c})}}var PX=typeof WeakMap=="function"?WeakMap:Map;function dF(r,s,c){c=Aa(-1,c),c.tag=3,c.payload={element:null};var d=s.value;return c.callback=function(){Kg||(Kg=!0,HC=d),LC(r,s)},c}function uF(r,s,c){c=Aa(-1,c),c.tag=3;var d=r.type.getDerivedStateFromError;if(typeof d=="function"){var p=s.value;c.payload=function(){return d(p)},c.callback=function(){LC(r,s)}}var _=r.stateNode;return _!==null&&typeof _.componentDidCatch=="function"&&(c.callback=function(){LC(r,s),typeof d!="function"&&(Xc===null?Xc=new Set([this]):Xc.add(this));var g=s.stack;this.componentDidCatch(s.value,{componentStack:g!==null?g:""})}),c}function H2(r,s,c){var d=r.pingCache;if(d===null){d=r.pingCache=new PX;var p=new Set;d.set(s,p)}else p=d.get(s),p===void 0&&(p=new Set,d.set(s,p));p.has(c)||(p.add(c),r=KX.bind(null,r,s,c),s.then(r,r))}function K2(r){do{var s;if((s=r.tag===13)&&(s=r.memoizedState,s=s!==null?s.dehydrated!==null:!0),s)return r;r=r.return}while(r!==null);return null}function z2(r,s,c,d,p){return r.mode&1?(r.flags|=65536,r.lanes=p,r):(r===s?r.flags|=65536:(r.flags|=128,c.flags|=131072,c.flags&=-52805,c.tag===1&&(c.alternate===null?c.tag=17:(s=Aa(-1,1),s.tag=2,Jc(c,s,1))),c.lanes|=1),r)}var DX=xa.ReactCurrentOwner,qr=!1;function br(r,s,c,d){s.child=r===null?WV(s,null,c,d):th(s,r.child,c,d)}function Y2(r,s,c,d,p){c=c.render;var _=s.ref;return qu(s,p),d=ew(r,s,c,d,_,p),c=tw(),r!==null&&!qr?(s.updateQueue=r.updateQueue,s.flags&=-2053,r.lanes&=~p,Da(r,s,p)):(ni&&c&&GI(s),s.flags|=1,br(r,s,d,p),s.child)}function q2(r,s,c,d,p){if(r===null){var _=c.type;return typeof _=="function"&&!uw(_)&&_.defaultProps===void 0&&c.compare===null&&c.defaultProps===void 0?(s.tag=15,s.type=_,hF(r,s,_,d,p)):(r=mg(c.type,null,d,s,s.mode,p),r.ref=s.ref,r.return=s,s.child=r)}if(_=r.child,!(r.lanes&p)){var g=_.memoizedProps;if(c=c.compare,c=c!==null?c:wf,c(g,d)&&r.ref===s.ref)return Da(r,s,p)}return s.flags|=1,r=$c(_,d),r.ref=s.ref,r.return=s,s.child=r}function hF(r,s,c,d,p){if(r!==null){var _=r.memoizedProps;if(wf(_,d)&&r.ref===s.ref)if(qr=!1,s.pendingProps=d=_,(r.lanes&p)!==0)r.flags&131072&&(qr=!0);else return s.lanes=r.lanes,Da(r,s,p)}return MC(r,s,c,d,p)}function pF(r,s,c){var d=s.pendingProps,p=d.children,_=r!==null?r.memoizedState:null;if(d.mode==="hidden")if(!(s.mode&1))s.memoizedState={baseLanes:0,cachePool:null,transitions:null},Vn(ju,us),us|=c;else{if(!(c&1073741824))return r=_!==null?_.baseLanes|c:c,s.lanes=s.childLanes=1073741824,s.memoizedState={baseLanes:r,cachePool:null,transitions:null},s.updateQueue=null,Vn(ju,us),us|=r,null;s.memoizedState={baseLanes:0,cachePool:null,transitions:null},d=_!==null?_.baseLanes:c,Vn(ju,us),us|=d}else _!==null?(d=_.baseLanes|c,s.memoizedState=null):d=c,Vn(ju,us),us|=d;return br(r,s,p,c),s.child}function fF(r,s){var c=s.ref;(r===null&&c!==null||r!==null&&r.ref!==c)&&(s.flags|=512,s.flags|=2097152)}function MC(r,s,c,d,p){var _=Xr(c)?nd:mr.current;return _=Zu(s,_),qu(s,p),c=ew(r,s,c,d,_,p),d=tw(),r!==null&&!qr?(s.updateQueue=r.updateQueue,s.flags&=-2053,r.lanes&=~p,Da(r,s,p)):(ni&&d&&GI(s),s.flags|=1,br(r,s,c,p),s.child)}function J2(r,s,c,d,p){if(Xr(c)){var _=!0;Mg(s)}else _=!1;if(qu(s,p),s.stateNode===null)hg(r,s),BV(s,c,d),kC(s,c,d,p),d=!0;else if(r===null){var g=s.stateNode,R=s.memoizedProps;g.props=R;var I=g.context,P=c.contextType;typeof P=="object"&&P!==null?P=Js(P):(P=Xr(c)?nd:mr.current,P=Zu(s,P));var k=c.getDerivedStateFromProps,L=typeof k=="function"||typeof g.getSnapshotBeforeUpdate=="function";L||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(R!==d||I!==P)&&j2(s,g,d,P),Fc=!1;var x=s.memoizedState;g.state=x,jg(s,d,g,p),I=s.memoizedState,R!==d||x!==I||Jr.current||Fc?(typeof k=="function"&&(DC(s,c,k,d),I=s.memoizedState),(R=Fc||F2(s,c,R,d,x,I,P))?(L||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount()),typeof g.componentDidMount=="function"&&(s.flags|=4194308)):(typeof g.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=d,s.memoizedState=I),g.props=d,g.state=I,g.context=P,d=R):(typeof g.componentDidMount=="function"&&(s.flags|=4194308),d=!1)}else{g=s.stateNode,FV(r,s),R=s.memoizedProps,P=s.type===s.elementType?R:fo(s.type,R),g.props=P,L=s.pendingProps,x=g.context,I=c.contextType,typeof I=="object"&&I!==null?I=Js(I):(I=Xr(c)?nd:mr.current,I=Zu(s,I));var H=c.getDerivedStateFromProps;(k=typeof H=="function"||typeof g.getSnapshotBeforeUpdate=="function")||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(R!==L||x!==I)&&j2(s,g,d,I),Fc=!1,x=s.memoizedState,g.state=x,jg(s,d,g,p);var K=s.memoizedState;R!==L||x!==K||Jr.current||Fc?(typeof H=="function"&&(DC(s,c,H,d),K=s.memoizedState),(P=Fc||F2(s,c,P,d,x,K,I)||!1)?(k||typeof g.UNSAFE_componentWillUpdate!="function"&&typeof g.componentWillUpdate!="function"||(typeof g.componentWillUpdate=="function"&&g.componentWillUpdate(d,K,I),typeof g.UNSAFE_componentWillUpdate=="function"&&g.UNSAFE_componentWillUpdate(d,K,I)),typeof g.componentDidUpdate=="function"&&(s.flags|=4),typeof g.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof g.componentDidUpdate!="function"||R===r.memoizedProps&&x===r.memoizedState||(s.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||R===r.memoizedProps&&x===r.memoizedState||(s.flags|=1024),s.memoizedProps=d,s.memoizedState=K),g.props=d,g.state=K,g.context=I,d=P):(typeof g.componentDidUpdate!="function"||R===r.memoizedProps&&x===r.memoizedState||(s.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||R===r.memoizedProps&&x===r.memoizedState||(s.flags|=1024),d=!1)}return xC(r,s,c,d,_,p)}function xC(r,s,c,d,p,_){fF(r,s);var g=(s.flags&128)!==0;if(!d&&!g)return p&&L2(s,c,!1),Da(r,s,_);d=s.stateNode,DX.current=s;var R=g&&typeof c.getDerivedStateFromError!="function"?null:d.render();return s.flags|=1,r!==null&&g?(s.child=th(s,r.child,null,_),s.child=th(s,null,R,_)):br(r,s,R,_),s.memoizedState=d.state,p&&L2(s,c,!0),s.child}function mF(r){var s=r.stateNode;s.pendingContext?k2(r,s.pendingContext,s.pendingContext!==s.context):s.context&&k2(r,s.context,!1),XI(r,s.containerInfo)}function X2(r,s,c,d,p){return eh(),HI(p),s.flags|=256,br(r,s,c,d),s.child}var UC={dehydrated:null,treeContext:null,retryLane:0};function VC(r){return{baseLanes:r,cachePool:null,transitions:null}}function _F(r,s,c){var d=s.pendingProps,p=ai.current,_=!1,g=(s.flags&128)!==0,R;if((R=g)||(R=r!==null&&r.memoizedState===null?!1:(p&2)!==0),R?(_=!0,s.flags&=-129):(r===null||r.memoizedState!==null)&&(p|=1),Vn(ai,p&1),r===null)return NC(s),r=s.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?(s.mode&1?r.data==="$!"?s.lanes=8:s.lanes=1073741824:s.lanes=1,null):(g=d.children,r=d.fallback,_?(d=s.mode,_=s.child,g={mode:"hidden",children:g},!(d&1)&&_!==null?(_.childLanes=0,_.pendingProps=g):_=Ev(g,d,0,null),r=td(r,d,c,null),_.return=s,r.return=s,_.sibling=r,s.child=_,s.child.memoizedState=VC(c),s.memoizedState=UC,r):rw(s,g));if(p=r.memoizedState,p!==null&&(R=p.dehydrated,R!==null))return kX(r,s,g,d,R,p,c);if(_){_=d.fallback,g=s.mode,p=r.child,R=p.sibling;var I={mode:"hidden",children:d.children};return!(g&1)&&s.child!==p?(d=s.child,d.childLanes=0,d.pendingProps=I,s.deletions=null):(d=$c(p,I),d.subtreeFlags=p.subtreeFlags&14680064),R!==null?_=$c(R,_):(_=td(_,g,c,null),_.flags|=2),_.return=s,d.return=s,d.sibling=_,s.child=d,d=_,_=s.child,g=r.child.memoizedState,g=g===null?VC(c):{baseLanes:g.baseLanes|c,cachePool:null,transitions:g.transitions},_.memoizedState=g,_.childLanes=r.childLanes&~c,s.memoizedState=UC,d}return _=r.child,r=_.sibling,d=$c(_,{mode:"visible",children:d.children}),!(s.mode&1)&&(d.lanes=c),d.return=s,d.sibling=null,r!==null&&(c=s.deletions,c===null?(s.deletions=[r],s.flags|=16):c.push(r)),s.child=d,s.memoizedState=null,d}function rw(r,s){return s=Ev({mode:"visible",children:s},r.mode,0,null),s.return=r,r.child=s}function UE(r,s,c,d){return d!==null&&HI(d),th(s,r.child,null,c),r=rw(s,s.pendingProps.children),r.flags|=2,s.memoizedState=null,r}function kX(r,s,c,d,p,_,g){if(c)return s.flags&256?(s.flags&=-257,d=xR(Error(De(422))),UE(r,s,g,d)):s.memoizedState!==null?(s.child=r.child,s.flags|=128,null):(_=d.fallback,p=s.mode,d=Ev({mode:"visible",children:d.children},p,0,null),_=td(_,p,g,null),_.flags|=2,d.return=s,_.return=s,d.sibling=_,s.child=d,s.mode&1&&th(s,r.child,null,g),s.child.memoizedState=VC(g),s.memoizedState=UC,_);if(!(s.mode&1))return UE(r,s,g,null);if(p.data==="$!"){if(d=p.nextSibling&&p.nextSibling.dataset,d)var R=d.dgst;return d=R,_=Error(De(419)),d=xR(_,d,void 0),UE(r,s,g,d)}if(R=(g&r.childLanes)!==0,qr||R){if(d=Yi,d!==null){switch(g&-g){case 4:p=2;break;case 16:p=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:p=32;break;case 536870912:p=268435456;break;default:p=0}p=p&(d.suspendedLanes|g)?0:p,p!==0&&p!==_.retryLane&&(_.retryLane=p,Pa(r,p),To(d,r,p,-1))}return dw(),d=xR(Error(De(421))),UE(r,s,g,d)}return p.data==="$?"?(s.flags|=128,s.child=r.child,s=zX.bind(null,r),p._reactRetry=s,null):(r=_.treeContext,ps=qc(p.nextSibling),fs=s,ni=!0,go=null,r!==null&&(Hs[Ks++]=wa,Hs[Ks++]=ba,Hs[Ks++]=id,wa=r.id,ba=r.overflow,id=s),s=rw(s,d.children),s.flags|=4096,s)}function Q2(r,s,c){r.lanes|=s;var d=r.alternate;d!==null&&(d.lanes|=s),PC(r.return,s,c)}function UR(r,s,c,d,p){var _=r.memoizedState;_===null?r.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:d,tail:c,tailMode:p}:(_.isBackwards=s,_.rendering=null,_.renderingStartTime=0,_.last=d,_.tail=c,_.tailMode=p)}function EF(r,s,c){var d=s.pendingProps,p=d.revealOrder,_=d.tail;if(br(r,s,d.children,c),d=ai.current,d&2)d=d&1|2,s.flags|=128;else{if(r!==null&&r.flags&128)e:for(r=s.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&Q2(r,c,s);else if(r.tag===19)Q2(r,c,s);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break e;for(;r.sibling===null;){if(r.return===null||r.return===s)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}d&=1}if(Vn(ai,d),!(s.mode&1))s.memoizedState=null;else switch(p){case"forwards":for(c=s.child,p=null;c!==null;)r=c.alternate,r!==null&&Bg(r)===null&&(p=c),c=c.sibling;c=p,c===null?(p=s.child,s.child=null):(p=c.sibling,c.sibling=null),UR(s,!1,p,c,_);break;case"backwards":for(c=null,p=s.child,s.child=null;p!==null;){if(r=p.alternate,r!==null&&Bg(r)===null){s.child=p;break}r=p.sibling,p.sibling=c,c=p,p=r}UR(s,!0,c,null,_);break;case"together":UR(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function hg(r,s){!(s.mode&1)&&r!==null&&(r.alternate=null,s.alternate=null,s.flags|=2)}function Da(r,s,c){if(r!==null&&(s.dependencies=r.dependencies),sd|=s.lanes,!(c&s.childLanes))return null;if(r!==null&&s.child!==r.child)throw Error(De(153));if(s.child!==null){for(r=s.child,c=$c(r,r.pendingProps),s.child=c,c.return=s;r.sibling!==null;)r=r.sibling,c=c.sibling=$c(r,r.pendingProps),c.return=s;c.sibling=null}return s.child}function LX(r,s,c){switch(s.tag){case 3:mF(s),eh();break;case 5:HV(s);break;case 1:Xr(s.type)&&Mg(s);break;case 4:XI(s,s.stateNode.containerInfo);break;case 10:var d=s.type._context,p=s.memoizedProps.value;Vn(Vg,d._currentValue),d._currentValue=p;break;case 13:if(d=s.memoizedState,d!==null)return d.dehydrated!==null?(Vn(ai,ai.current&1),s.flags|=128,null):c&s.child.childLanes?_F(r,s,c):(Vn(ai,ai.current&1),r=Da(r,s,c),r!==null?r.sibling:null);Vn(ai,ai.current&1);break;case 19:if(d=(c&s.childLanes)!==0,r.flags&128){if(d)return EF(r,s,c);s.flags|=128}if(p=s.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),Vn(ai,ai.current),d)break;return null;case 22:case 23:return s.lanes=0,pF(r,s,c)}return Da(r,s,c)}var gF,FC,vF,SF;gF=function(r,s){for(var c=s.child;c!==null;){if(c.tag===5||c.tag===6)r.appendChild(c.stateNode);else if(c.tag!==4&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===s)break;for(;c.sibling===null;){if(c.return===null||c.return===s)return;c=c.return}c.sibling.return=c.return,c=c.sibling}};FC=function(){};vF=function(r,s,c,d){var p=r.memoizedProps;if(p!==d){r=s.stateNode,Jl(Xo.current);var _=null;switch(c){case"input":p=aC(r,p),d=aC(r,d),_=[];break;case"select":p=li({},p,{value:void 0}),d=li({},d,{value:void 0}),_=[];break;case"textarea":p=dC(r,p),d=dC(r,d),_=[];break;default:typeof p.onClick!="function"&&typeof d.onClick=="function"&&(r.onclick=kg)}hC(c,d);var g;c=null;for(P in p)if(!d.hasOwnProperty(P)&&p.hasOwnProperty(P)&&p[P]!=null)if(P==="style"){var R=p[P];for(g in R)R.hasOwnProperty(g)&&(c||(c={}),c[g]="")}else P!=="dangerouslySetInnerHTML"&&P!=="children"&&P!=="suppressContentEditableWarning"&&P!=="suppressHydrationWarning"&&P!=="autoFocus"&&(vf.hasOwnProperty(P)?_||(_=[]):(_=_||[]).push(P,null));for(P in d){var I=d[P];if(R=p!=null?p[P]:void 0,d.hasOwnProperty(P)&&I!==R&&(I!=null||R!=null))if(P==="style")if(R){for(g in R)!R.hasOwnProperty(g)||I&&I.hasOwnProperty(g)||(c||(c={}),c[g]="");for(g in I)I.hasOwnProperty(g)&&R[g]!==I[g]&&(c||(c={}),c[g]=I[g])}else c||(_||(_=[]),_.push(P,c)),c=I;else P==="dangerouslySetInnerHTML"?(I=I?I.__html:void 0,R=R?R.__html:void 0,I!=null&&R!==I&&(_=_||[]).push(P,I)):P==="children"?typeof I!="string"&&typeof I!="number"||(_=_||[]).push(P,""+I):P!=="suppressContentEditableWarning"&&P!=="suppressHydrationWarning"&&(vf.hasOwnProperty(P)?(I!=null&&P==="onScroll"&&Gn("scroll",r),_||R===I||(_=[])):(_=_||[]).push(P,I))}c&&(_=_||[]).push("style",c);var P=_;(s.updateQueue=P)&&(s.flags|=4)}};SF=function(r,s,c,d){c!==d&&(s.flags|=4)};function Kp(r,s){if(!ni)switch(r.tailMode){case"hidden":s=r.tail;for(var c=null;s!==null;)s.alternate!==null&&(c=s),s=s.sibling;c===null?r.tail=null:c.sibling=null;break;case"collapsed":c=r.tail;for(var d=null;c!==null;)c.alternate!==null&&(d=c),c=c.sibling;d===null?s||r.tail===null?r.tail=null:r.tail.sibling=null:d.sibling=null}}function pr(r){var s=r.alternate!==null&&r.alternate.child===r.child,c=0,d=0;if(s)for(var p=r.child;p!==null;)c|=p.lanes|p.childLanes,d|=p.subtreeFlags&14680064,d|=p.flags&14680064,p.return=r,p=p.sibling;else for(p=r.child;p!==null;)c|=p.lanes|p.childLanes,d|=p.subtreeFlags,d|=p.flags,p.return=r,p=p.sibling;return r.subtreeFlags|=d,r.childLanes=c,s}function MX(r,s,c){var d=s.pendingProps;switch(WI(s),s.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return pr(s),null;case 1:return Xr(s.type)&&Lg(),pr(s),null;case 3:return d=s.stateNode,nh(),Hn(Jr),Hn(mr),$I(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(r===null||r.child===null)&&(ME(s)?s.flags|=4:r===null||r.memoizedState.isDehydrated&&!(s.flags&256)||(s.flags|=1024,go!==null&&(YC(go),go=null))),FC(r,s),pr(s),null;case 5:QI(s);var p=Jl(Pf.current);if(c=s.type,r!==null&&s.stateNode!=null)vF(r,s,c,d,p),r.ref!==s.ref&&(s.flags|=512,s.flags|=2097152);else{if(!d){if(s.stateNode===null)throw Error(De(166));return pr(s),null}if(r=Jl(Xo.current),ME(s)){d=s.stateNode,c=s.type;var _=s.memoizedProps;switch(d[Yo]=s,d[Of]=_,r=(s.mode&1)!==0,c){case"dialog":Gn("cancel",d),Gn("close",d);break;case"iframe":case"object":case"embed":Gn("load",d);break;case"video":case"audio":for(p=0;p<nf.length;p++)Gn(nf[p],d);break;case"source":Gn("error",d);break;case"img":case"image":case"link":Gn("error",d),Gn("load",d);break;case"details":Gn("toggle",d);break;case"input":o2(d,_),Gn("invalid",d);break;case"select":d._wrapperState={wasMultiple:!!_.multiple},Gn("invalid",d);break;case"textarea":c2(d,_),Gn("invalid",d)}hC(c,_),p=null;for(var g in _)if(_.hasOwnProperty(g)){var R=_[g];g==="children"?typeof R=="string"?d.textContent!==R&&(_.suppressHydrationWarning!==!0&&LE(d.textContent,R,r),p=["children",R]):typeof R=="number"&&d.textContent!==""+R&&(_.suppressHydrationWarning!==!0&&LE(d.textContent,R,r),p=["children",""+R]):vf.hasOwnProperty(g)&&R!=null&&g==="onScroll"&&Gn("scroll",d)}switch(c){case"input":wE(d),a2(d,_,!0);break;case"textarea":wE(d),l2(d);break;case"select":case"option":break;default:typeof _.onClick=="function"&&(d.onclick=kg)}d=p,s.updateQueue=d,d!==null&&(s.flags|=4)}else{g=p.nodeType===9?p:p.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=YU(c)),r==="http://www.w3.org/1999/xhtml"?c==="script"?(r=g.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof d.is=="string"?r=g.createElement(c,{is:d.is}):(r=g.createElement(c),c==="select"&&(g=r,d.multiple?g.multiple=!0:d.size&&(g.size=d.size))):r=g.createElementNS(r,c),r[Yo]=s,r[Of]=d,gF(r,s,!1,!1),s.stateNode=r;e:{switch(g=pC(c,d),c){case"dialog":Gn("cancel",r),Gn("close",r),p=d;break;case"iframe":case"object":case"embed":Gn("load",r),p=d;break;case"video":case"audio":for(p=0;p<nf.length;p++)Gn(nf[p],r);p=d;break;case"source":Gn("error",r),p=d;break;case"img":case"image":case"link":Gn("error",r),Gn("load",r),p=d;break;case"details":Gn("toggle",r),p=d;break;case"input":o2(r,d),p=aC(r,d),Gn("invalid",r);break;case"option":p=d;break;case"select":r._wrapperState={wasMultiple:!!d.multiple},p=li({},d,{value:void 0}),Gn("invalid",r);break;case"textarea":c2(r,d),p=dC(r,d),Gn("invalid",r);break;default:p=d}hC(c,p),R=p;for(_ in R)if(R.hasOwnProperty(_)){var I=R[_];_==="style"?XU(r,I):_==="dangerouslySetInnerHTML"?(I=I?I.__html:void 0,I!=null&&qU(r,I)):_==="children"?typeof I=="string"?(c!=="textarea"||I!=="")&&Sf(r,I):typeof I=="number"&&Sf(r,""+I):_!=="suppressContentEditableWarning"&&_!=="suppressHydrationWarning"&&_!=="autoFocus"&&(vf.hasOwnProperty(_)?I!=null&&_==="onScroll"&&Gn("scroll",r):I!=null&&AI(r,_,I,g))}switch(c){case"input":wE(r),a2(r,d,!1);break;case"textarea":wE(r),l2(r);break;case"option":d.value!=null&&r.setAttribute("value",""+el(d.value));break;case"select":r.multiple=!!d.multiple,_=d.value,_!=null?Hu(r,!!d.multiple,_,!1):d.defaultValue!=null&&Hu(r,!!d.multiple,d.defaultValue,!0);break;default:typeof p.onClick=="function"&&(r.onclick=kg)}switch(c){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break e;case"img":d=!0;break e;default:d=!1}}d&&(s.flags|=4)}s.ref!==null&&(s.flags|=512,s.flags|=2097152)}return pr(s),null;case 6:if(r&&s.stateNode!=null)SF(r,s,r.memoizedProps,d);else{if(typeof d!="string"&&s.stateNode===null)throw Error(De(166));if(c=Jl(Pf.current),Jl(Xo.current),ME(s)){if(d=s.stateNode,c=s.memoizedProps,d[Yo]=s,(_=d.nodeValue!==c)&&(r=fs,r!==null))switch(r.tag){case 3:LE(d.nodeValue,c,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&LE(d.nodeValue,c,(r.mode&1)!==0)}_&&(s.flags|=4)}else d=(c.nodeType===9?c:c.ownerDocument).createTextNode(d),d[Yo]=s,s.stateNode=d}return pr(s),null;case 13:if(Hn(ai),d=s.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(ni&&ps!==null&&s.mode&1&&!(s.flags&128))UV(),eh(),s.flags|=98560,_=!1;else if(_=ME(s),d!==null&&d.dehydrated!==null){if(r===null){if(!_)throw Error(De(318));if(_=s.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(De(317));_[Yo]=s}else eh(),!(s.flags&128)&&(s.memoizedState=null),s.flags|=4;pr(s),_=!1}else go!==null&&(YC(go),go=null),_=!0;if(!_)return s.flags&65536?s:null}return s.flags&128?(s.lanes=c,s):(d=d!==null,d!==(r!==null&&r.memoizedState!==null)&&d&&(s.child.flags|=8192,s.mode&1&&(r===null||ai.current&1?ji===0&&(ji=3):dw())),s.updateQueue!==null&&(s.flags|=4),pr(s),null);case 4:return nh(),FC(r,s),r===null&&bf(s.stateNode.containerInfo),pr(s),null;case 10:return YI(s.type._context),pr(s),null;case 17:return Xr(s.type)&&Lg(),pr(s),null;case 19:if(Hn(ai),_=s.memoizedState,_===null)return pr(s),null;if(d=(s.flags&128)!==0,g=_.rendering,g===null)if(d)Kp(_,!1);else{if(ji!==0||r!==null&&r.flags&128)for(r=s.child;r!==null;){if(g=Bg(r),g!==null){for(s.flags|=128,Kp(_,!1),d=g.updateQueue,d!==null&&(s.updateQueue=d,s.flags|=4),s.subtreeFlags=0,d=c,c=s.child;c!==null;)_=c,r=d,_.flags&=14680066,g=_.alternate,g===null?(_.childLanes=0,_.lanes=r,_.child=null,_.subtreeFlags=0,_.memoizedProps=null,_.memoizedState=null,_.updateQueue=null,_.dependencies=null,_.stateNode=null):(_.childLanes=g.childLanes,_.lanes=g.lanes,_.child=g.child,_.subtreeFlags=0,_.deletions=null,_.memoizedProps=g.memoizedProps,_.memoizedState=g.memoizedState,_.updateQueue=g.updateQueue,_.type=g.type,r=g.dependencies,_.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),c=c.sibling;return Vn(ai,ai.current&1|2),s.child}r=r.sibling}_.tail!==null&&yi()>rh&&(s.flags|=128,d=!0,Kp(_,!1),s.lanes=4194304)}else{if(!d)if(r=Bg(g),r!==null){if(s.flags|=128,d=!0,c=r.updateQueue,c!==null&&(s.updateQueue=c,s.flags|=4),Kp(_,!0),_.tail===null&&_.tailMode==="hidden"&&!g.alternate&&!ni)return pr(s),null}else 2*yi()-_.renderingStartTime>rh&&c!==1073741824&&(s.flags|=128,d=!0,Kp(_,!1),s.lanes=4194304);_.isBackwards?(g.sibling=s.child,s.child=g):(c=_.last,c!==null?c.sibling=g:s.child=g,_.last=g)}return _.tail!==null?(s=_.tail,_.rendering=s,_.tail=s.sibling,_.renderingStartTime=yi(),s.sibling=null,c=ai.current,Vn(ai,d?c&1|2:c&1),s):(pr(s),null);case 22:case 23:return lw(),d=s.memoizedState!==null,r!==null&&r.memoizedState!==null!==d&&(s.flags|=8192),d&&s.mode&1?us&1073741824&&(pr(s),s.subtreeFlags&6&&(s.flags|=8192)):pr(s),null;case 24:return null;case 25:return null}throw Error(De(156,s.tag))}function xX(r,s){switch(WI(s),s.tag){case 1:return Xr(s.type)&&Lg(),r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 3:return nh(),Hn(Jr),Hn(mr),$I(),r=s.flags,r&65536&&!(r&128)?(s.flags=r&-65537|128,s):null;case 5:return QI(s),null;case 13:if(Hn(ai),r=s.memoizedState,r!==null&&r.dehydrated!==null){if(s.alternate===null)throw Error(De(340));eh()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 19:return Hn(ai),null;case 4:return nh(),null;case 10:return YI(s.type._context),null;case 22:case 23:return lw(),null;case 24:return null;default:return null}}var VE=!1,fr=!1,UX=typeof WeakSet=="function"?WeakSet:Set,Je=null;function Fu(r,s){var c=r.ref;if(c!==null)if(typeof c=="function")try{c(null)}catch(d){hi(r,s,d)}else c.current=null}function jC(r,s,c){try{c()}catch(d){hi(r,s,d)}}var $2=!1;function VX(r,s){if(RC=Ng,r=CV(),BI(r)){if("selectionStart"in r)var c={start:r.selectionStart,end:r.selectionEnd};else e:{c=(c=r.ownerDocument)&&c.defaultView||window;var d=c.getSelection&&c.getSelection();if(d&&d.rangeCount!==0){c=d.anchorNode;var p=d.anchorOffset,_=d.focusNode;d=d.focusOffset;try{c.nodeType,_.nodeType}catch{c=null;break e}var g=0,R=-1,I=-1,P=0,k=0,L=r,x=null;t:for(;;){for(var H;L!==c||p!==0&&L.nodeType!==3||(R=g+p),L!==_||d!==0&&L.nodeType!==3||(I=g+d),L.nodeType===3&&(g+=L.nodeValue.length),(H=L.firstChild)!==null;)x=L,L=H;for(;;){if(L===r)break t;if(x===c&&++P===p&&(R=g),x===_&&++k===d&&(I=g),(H=L.nextSibling)!==null)break;L=x,x=L.parentNode}L=H}c=R===-1||I===-1?null:{start:R,end:I}}else c=null}c=c||{start:0,end:0}}else c=null;for(CC={focusedElem:r,selectionRange:c},Ng=!1,Je=s;Je!==null;)if(s=Je,r=s.child,(s.subtreeFlags&1028)!==0&&r!==null)r.return=s,Je=r;else for(;Je!==null;){s=Je;try{var K=s.alternate;if(s.flags&1024)switch(s.tag){case 0:case 11:case 15:break;case 1:if(K!==null){var ee=K.memoizedProps,re=K.memoizedState,Y=s.stateNode,F=Y.getSnapshotBeforeUpdate(s.elementType===s.type?ee:fo(s.type,ee),re);Y.__reactInternalSnapshotBeforeUpdate=F}break;case 3:var z=s.stateNode.containerInfo;z.nodeType===1?z.textContent="":z.nodeType===9&&z.documentElement&&z.removeChild(z.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(De(163))}}catch(le){hi(s,s.return,le)}if(r=s.sibling,r!==null){r.return=s.return,Je=r;break}Je=s.return}return K=$2,$2=!1,K}function pf(r,s,c){var d=s.updateQueue;if(d=d!==null?d.lastEffect:null,d!==null){var p=d=d.next;do{if((p.tag&r)===r){var _=p.destroy;p.destroy=void 0,_!==void 0&&jC(s,c,_)}p=p.next}while(p!==d)}}function mv(r,s){if(s=s.updateQueue,s=s!==null?s.lastEffect:null,s!==null){var c=s=s.next;do{if((c.tag&r)===r){var d=c.create;c.destroy=d()}c=c.next}while(c!==s)}}function BC(r){var s=r.ref;if(s!==null){var c=r.stateNode;switch(r.tag){case 5:r=c;break;default:r=c}typeof s=="function"?s(r):s.current=r}}function TF(r){var s=r.alternate;s!==null&&(r.alternate=null,TF(s)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(s=r.stateNode,s!==null&&(delete s[Yo],delete s[Of],delete s[bC],delete s[SX],delete s[TX])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function yF(r){return r.tag===5||r.tag===3||r.tag===4}function Z2(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||yF(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function GC(r,s,c){var d=r.tag;if(d===5||d===6)r=r.stateNode,s?c.nodeType===8?c.parentNode.insertBefore(r,s):c.insertBefore(r,s):(c.nodeType===8?(s=c.parentNode,s.insertBefore(r,c)):(s=c,s.appendChild(r)),c=c._reactRootContainer,c!=null||s.onclick!==null||(s.onclick=kg));else if(d!==4&&(r=r.child,r!==null))for(GC(r,s,c),r=r.sibling;r!==null;)GC(r,s,c),r=r.sibling}function WC(r,s,c){var d=r.tag;if(d===5||d===6)r=r.stateNode,s?c.insertBefore(r,s):c.appendChild(r);else if(d!==4&&(r=r.child,r!==null))for(WC(r,s,c),r=r.sibling;r!==null;)WC(r,s,c),r=r.sibling}var Qi=null,mo=!1;function Mc(r,s,c){for(c=c.child;c!==null;)RF(r,s,c),c=c.sibling}function RF(r,s,c){if(Jo&&typeof Jo.onCommitFiberUnmount=="function")try{Jo.onCommitFiberUnmount(av,c)}catch{}switch(c.tag){case 5:fr||Fu(c,s);case 6:var d=Qi,p=mo;Qi=null,Mc(r,s,c),Qi=d,mo=p,Qi!==null&&(mo?(r=Qi,c=c.stateNode,r.nodeType===8?r.parentNode.removeChild(c):r.removeChild(c)):Qi.removeChild(c.stateNode));break;case 18:Qi!==null&&(mo?(r=Qi,c=c.stateNode,r.nodeType===8?NR(r.parentNode,c):r.nodeType===1&&NR(r,c),Cf(r)):NR(Qi,c.stateNode));break;case 4:d=Qi,p=mo,Qi=c.stateNode.containerInfo,mo=!0,Mc(r,s,c),Qi=d,mo=p;break;case 0:case 11:case 14:case 15:if(!fr&&(d=c.updateQueue,d!==null&&(d=d.lastEffect,d!==null))){p=d=d.next;do{var _=p,g=_.destroy;_=_.tag,g!==void 0&&(_&2||_&4)&&jC(c,s,g),p=p.next}while(p!==d)}Mc(r,s,c);break;case 1:if(!fr&&(Fu(c,s),d=c.stateNode,typeof d.componentWillUnmount=="function"))try{d.props=c.memoizedProps,d.state=c.memoizedState,d.componentWillUnmount()}catch(R){hi(c,s,R)}Mc(r,s,c);break;case 21:Mc(r,s,c);break;case 22:c.mode&1?(fr=(d=fr)||c.memoizedState!==null,Mc(r,s,c),fr=d):Mc(r,s,c);break;default:Mc(r,s,c)}}function ex(r){var s=r.updateQueue;if(s!==null){r.updateQueue=null;var c=r.stateNode;c===null&&(c=r.stateNode=new UX),s.forEach(function(d){var p=YX.bind(null,r,d);c.has(d)||(c.add(d),d.then(p,p))})}}function po(r,s){var c=s.deletions;if(c!==null)for(var d=0;d<c.length;d++){var p=c[d];try{var _=r,g=s,R=g;e:for(;R!==null;){switch(R.tag){case 5:Qi=R.stateNode,mo=!1;break e;case 3:Qi=R.stateNode.containerInfo,mo=!0;break e;case 4:Qi=R.stateNode.containerInfo,mo=!0;break e}R=R.return}if(Qi===null)throw Error(De(160));RF(_,g,p),Qi=null,mo=!1;var I=p.alternate;I!==null&&(I.return=null),p.return=null}catch(P){hi(p,s,P)}}if(s.subtreeFlags&12854)for(s=s.child;s!==null;)CF(s,r),s=s.sibling}function CF(r,s){var c=r.alternate,d=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(po(s,r),Ko(r),d&4){try{pf(3,r,r.return),mv(3,r)}catch(ee){hi(r,r.return,ee)}try{pf(5,r,r.return)}catch(ee){hi(r,r.return,ee)}}break;case 1:po(s,r),Ko(r),d&512&&c!==null&&Fu(c,c.return);break;case 5:if(po(s,r),Ko(r),d&512&&c!==null&&Fu(c,c.return),r.flags&32){var p=r.stateNode;try{Sf(p,"")}catch(ee){hi(r,r.return,ee)}}if(d&4&&(p=r.stateNode,p!=null)){var _=r.memoizedProps,g=c!==null?c.memoizedProps:_,R=r.type,I=r.updateQueue;if(r.updateQueue=null,I!==null)try{R==="input"&&_.type==="radio"&&_.name!=null&&KU(p,_),pC(R,g);var P=pC(R,_);for(g=0;g<I.length;g+=2){var k=I[g],L=I[g+1];k==="style"?XU(p,L):k==="dangerouslySetInnerHTML"?qU(p,L):k==="children"?Sf(p,L):AI(p,k,L,P)}switch(R){case"input":cC(p,_);break;case"textarea":zU(p,_);break;case"select":var x=p._wrapperState.wasMultiple;p._wrapperState.wasMultiple=!!_.multiple;var H=_.value;H!=null?Hu(p,!!_.multiple,H,!1):x!==!!_.multiple&&(_.defaultValue!=null?Hu(p,!!_.multiple,_.defaultValue,!0):Hu(p,!!_.multiple,_.multiple?[]:"",!1))}p[Of]=_}catch(ee){hi(r,r.return,ee)}}break;case 6:if(po(s,r),Ko(r),d&4){if(r.stateNode===null)throw Error(De(162));p=r.stateNode,_=r.memoizedProps;try{p.nodeValue=_}catch(ee){hi(r,r.return,ee)}}break;case 3:if(po(s,r),Ko(r),d&4&&c!==null&&c.memoizedState.isDehydrated)try{Cf(s.containerInfo)}catch(ee){hi(r,r.return,ee)}break;case 4:po(s,r),Ko(r);break;case 13:po(s,r),Ko(r),p=r.child,p.flags&8192&&(_=p.memoizedState!==null,p.stateNode.isHidden=_,!_||p.alternate!==null&&p.alternate.memoizedState!==null||(aw=yi())),d&4&&ex(r);break;case 22:if(k=c!==null&&c.memoizedState!==null,r.mode&1?(fr=(P=fr)||k,po(s,r),fr=P):po(s,r),Ko(r),d&8192){if(P=r.memoizedState!==null,(r.stateNode.isHidden=P)&&!k&&r.mode&1)for(Je=r,k=r.child;k!==null;){for(L=Je=k;Je!==null;){switch(x=Je,H=x.child,x.tag){case 0:case 11:case 14:case 15:pf(4,x,x.return);break;case 1:Fu(x,x.return);var K=x.stateNode;if(typeof K.componentWillUnmount=="function"){d=x,c=x.return;try{s=d,K.props=s.memoizedProps,K.state=s.memoizedState,K.componentWillUnmount()}catch(ee){hi(d,c,ee)}}break;case 5:Fu(x,x.return);break;case 22:if(x.memoizedState!==null){nx(L);continue}}H!==null?(H.return=x,Je=H):nx(L)}k=k.sibling}e:for(k=null,L=r;;){if(L.tag===5){if(k===null){k=L;try{p=L.stateNode,P?(_=p.style,typeof _.setProperty=="function"?_.setProperty("display","none","important"):_.display="none"):(R=L.stateNode,I=L.memoizedProps.style,g=I!=null&&I.hasOwnProperty("display")?I.display:null,R.style.display=JU("display",g))}catch(ee){hi(r,r.return,ee)}}}else if(L.tag===6){if(k===null)try{L.stateNode.nodeValue=P?"":L.memoizedProps}catch(ee){hi(r,r.return,ee)}}else if((L.tag!==22&&L.tag!==23||L.memoizedState===null||L===r)&&L.child!==null){L.child.return=L,L=L.child;continue}if(L===r)break e;for(;L.sibling===null;){if(L.return===null||L.return===r)break e;k===L&&(k=null),L=L.return}k===L&&(k=null),L.sibling.return=L.return,L=L.sibling}}break;case 19:po(s,r),Ko(r),d&4&&ex(r);break;case 21:break;default:po(s,r),Ko(r)}}function Ko(r){var s=r.flags;if(s&2){try{e:{for(var c=r.return;c!==null;){if(yF(c)){var d=c;break e}c=c.return}throw Error(De(160))}switch(d.tag){case 5:var p=d.stateNode;d.flags&32&&(Sf(p,""),d.flags&=-33);var _=Z2(r);WC(r,_,p);break;case 3:case 4:var g=d.stateNode.containerInfo,R=Z2(r);GC(r,R,g);break;default:throw Error(De(161))}}catch(I){hi(r,r.return,I)}r.flags&=-3}s&4096&&(r.flags&=-4097)}function FX(r,s,c){Je=r,IF(r)}function IF(r,s,c){for(var d=(r.mode&1)!==0;Je!==null;){var p=Je,_=p.child;if(p.tag===22&&d){var g=p.memoizedState!==null||VE;if(!g){var R=p.alternate,I=R!==null&&R.memoizedState!==null||fr;R=VE;var P=fr;if(VE=g,(fr=I)&&!P)for(Je=p;Je!==null;)g=Je,I=g.child,g.tag===22&&g.memoizedState!==null?ix(p):I!==null?(I.return=g,Je=I):ix(p);for(;_!==null;)Je=_,IF(_),_=_.sibling;Je=p,VE=R,fr=P}tx(r)}else p.subtreeFlags&8772&&_!==null?(_.return=p,Je=_):tx(r)}}function tx(r){for(;Je!==null;){var s=Je;if(s.flags&8772){var c=s.alternate;try{if(s.flags&8772)switch(s.tag){case 0:case 11:case 15:fr||mv(5,s);break;case 1:var d=s.stateNode;if(s.flags&4&&!fr)if(c===null)d.componentDidMount();else{var p=s.elementType===s.type?c.memoizedProps:fo(s.type,c.memoizedProps);d.componentDidUpdate(p,c.memoizedState,d.__reactInternalSnapshotBeforeUpdate)}var _=s.updateQueue;_!==null&&V2(s,_,d);break;case 3:var g=s.updateQueue;if(g!==null){if(c=null,s.child!==null)switch(s.child.tag){case 5:c=s.child.stateNode;break;case 1:c=s.child.stateNode}V2(s,g,c)}break;case 5:var R=s.stateNode;if(c===null&&s.flags&4){c=R;var I=s.memoizedProps;switch(s.type){case"button":case"input":case"select":case"textarea":I.autoFocus&&c.focus();break;case"img":I.src&&(c.src=I.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(s.memoizedState===null){var P=s.alternate;if(P!==null){var k=P.memoizedState;if(k!==null){var L=k.dehydrated;L!==null&&Cf(L)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(De(163))}fr||s.flags&512&&BC(s)}catch(x){hi(s,s.return,x)}}if(s===r){Je=null;break}if(c=s.sibling,c!==null){c.return=s.return,Je=c;break}Je=s.return}}function nx(r){for(;Je!==null;){var s=Je;if(s===r){Je=null;break}var c=s.sibling;if(c!==null){c.return=s.return,Je=c;break}Je=s.return}}function ix(r){for(;Je!==null;){var s=Je;try{switch(s.tag){case 0:case 11:case 15:var c=s.return;try{mv(4,s)}catch(I){hi(s,c,I)}break;case 1:var d=s.stateNode;if(typeof d.componentDidMount=="function"){var p=s.return;try{d.componentDidMount()}catch(I){hi(s,p,I)}}var _=s.return;try{BC(s)}catch(I){hi(s,_,I)}break;case 5:var g=s.return;try{BC(s)}catch(I){hi(s,g,I)}}}catch(I){hi(s,s.return,I)}if(s===r){Je=null;break}var R=s.sibling;if(R!==null){R.return=s.return,Je=R;break}Je=s.return}}var jX=Math.ceil,Hg=xa.ReactCurrentDispatcher,sw=xa.ReactCurrentOwner,qs=xa.ReactCurrentBatchConfig,nn=0,Yi=null,Pi=null,Zi=0,us=0,ju=al(0),ji=0,Mf=null,sd=0,_v=0,ow=0,ff=null,Yr=null,aw=0,rh=1/0,Ca=null,Kg=!1,HC=null,Xc=null,FE=!1,Wc=null,zg=0,mf=0,KC=null,pg=-1,fg=0;function Ar(){return nn&6?yi():pg!==-1?pg:pg=yi()}function Qc(r){return r.mode&1?nn&2&&Zi!==0?Zi&-Zi:RX.transition!==null?(fg===0&&(fg=cV()),fg):(r=_n,r!==0||(r=window.event,r=r===void 0?16:mV(r.type)),r):1}function To(r,s,c,d){if(50<mf)throw mf=0,KC=null,Error(De(185));Kf(r,c,d),(!(nn&2)||r!==Yi)&&(r===Yi&&(!(nn&2)&&(_v|=c),ji===4&&Bc(r,Zi)),Qr(r,d),c===1&&nn===0&&!(s.mode&1)&&(rh=yi()+500,hv&&cl()))}function Qr(r,s){var c=r.callbackNode;RJ(r,s);var d=Og(r,r===Yi?Zi:0);if(d===0)c!==null&&h2(c),r.callbackNode=null,r.callbackPriority=0;else if(s=d&-d,r.callbackPriority!==s){if(c!=null&&h2(c),s===1)r.tag===0?yX(rx.bind(null,r)):LV(rx.bind(null,r)),gX(function(){!(nn&6)&&cl()}),c=null;else{switch(lV(d)){case 1:c=kI;break;case 4:c=oV;break;case 16:c=Ag;break;case 536870912:c=aV;break;default:c=Ag}c=kF(c,wF.bind(null,r))}r.callbackPriority=s,r.callbackNode=c}}function wF(r,s){if(pg=-1,fg=0,nn&6)throw Error(De(327));var c=r.callbackNode;if(Ju()&&r.callbackNode!==c)return null;var d=Og(r,r===Yi?Zi:0);if(d===0)return null;if(d&30||d&r.expiredLanes||s)s=Yg(r,d);else{s=d;var p=nn;nn|=2;var _=AF();(Yi!==r||Zi!==s)&&(Ca=null,rh=yi()+500,ed(r,s));do try{WX();break}catch(R){bF(r,R)}while(!0);zI(),Hg.current=_,nn=p,Pi!==null?s=0:(Yi=null,Zi=0,s=ji)}if(s!==0){if(s===2&&(p=gC(r),p!==0&&(d=p,s=zC(r,p))),s===1)throw c=Mf,ed(r,0),Bc(r,d),Qr(r,yi()),c;if(s===6)Bc(r,d);else{if(p=r.current.alternate,!(d&30)&&!BX(p)&&(s=Yg(r,d),s===2&&(_=gC(r),_!==0&&(d=_,s=zC(r,_))),s===1))throw c=Mf,ed(r,0),Bc(r,d),Qr(r,yi()),c;switch(r.finishedWork=p,r.finishedLanes=d,s){case 0:case 1:throw Error(De(345));case 2:Hl(r,Yr,Ca);break;case 3:if(Bc(r,d),(d&130023424)===d&&(s=aw+500-yi(),10<s)){if(Og(r,0)!==0)break;if(p=r.suspendedLanes,(p&d)!==d){Ar(),r.pingedLanes|=r.suspendedLanes&p;break}r.timeoutHandle=wC(Hl.bind(null,r,Yr,Ca),s);break}Hl(r,Yr,Ca);break;case 4:if(Bc(r,d),(d&4194240)===d)break;for(s=r.eventTimes,p=-1;0<d;){var g=31-So(d);_=1<<g,g=s[g],g>p&&(p=g),d&=~_}if(d=p,d=yi()-d,d=(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3e3>d?3e3:4320>d?4320:1960*jX(d/1960))-d,10<d){r.timeoutHandle=wC(Hl.bind(null,r,Yr,Ca),d);break}Hl(r,Yr,Ca);break;case 5:Hl(r,Yr,Ca);break;default:throw Error(De(329))}}}return Qr(r,yi()),r.callbackNode===c?wF.bind(null,r):null}function zC(r,s){var c=ff;return r.current.memoizedState.isDehydrated&&(ed(r,s).flags|=256),r=Yg(r,s),r!==2&&(s=Yr,Yr=c,s!==null&&YC(s)),r}function YC(r){Yr===null?Yr=r:Yr.push.apply(Yr,r)}function BX(r){for(var s=r;;){if(s.flags&16384){var c=s.updateQueue;if(c!==null&&(c=c.stores,c!==null))for(var d=0;d<c.length;d++){var p=c[d],_=p.getSnapshot;p=p.value;try{if(!yo(_(),p))return!1}catch{return!1}}}if(c=s.child,s.subtreeFlags&16384&&c!==null)c.return=s,s=c;else{if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Bc(r,s){for(s&=~ow,s&=~_v,r.suspendedLanes|=s,r.pingedLanes&=~s,r=r.expirationTimes;0<s;){var c=31-So(s),d=1<<c;r[c]=-1,s&=~d}}function rx(r){if(nn&6)throw Error(De(327));Ju();var s=Og(r,0);if(!(s&1))return Qr(r,yi()),null;var c=Yg(r,s);if(r.tag!==0&&c===2){var d=gC(r);d!==0&&(s=d,c=zC(r,d))}if(c===1)throw c=Mf,ed(r,0),Bc(r,s),Qr(r,yi()),c;if(c===6)throw Error(De(345));return r.finishedWork=r.current.alternate,r.finishedLanes=s,Hl(r,Yr,Ca),Qr(r,yi()),null}function cw(r,s){var c=nn;nn|=1;try{return r(s)}finally{nn=c,nn===0&&(rh=yi()+500,hv&&cl())}}function od(r){Wc!==null&&Wc.tag===0&&!(nn&6)&&Ju();var s=nn;nn|=1;var c=qs.transition,d=_n;try{if(qs.transition=null,_n=1,r)return r()}finally{_n=d,qs.transition=c,nn=s,!(nn&6)&&cl()}}function lw(){us=ju.current,Hn(ju)}function ed(r,s){r.finishedWork=null,r.finishedLanes=0;var c=r.timeoutHandle;if(c!==-1&&(r.timeoutHandle=-1,EX(c)),Pi!==null)for(c=Pi.return;c!==null;){var d=c;switch(WI(d),d.tag){case 1:d=d.type.childContextTypes,d!=null&&Lg();break;case 3:nh(),Hn(Jr),Hn(mr),$I();break;case 5:QI(d);break;case 4:nh();break;case 13:Hn(ai);break;case 19:Hn(ai);break;case 10:YI(d.type._context);break;case 22:case 23:lw()}c=c.return}if(Yi=r,Pi=r=$c(r.current,null),Zi=us=s,ji=0,Mf=null,ow=_v=sd=0,Yr=ff=null,ql!==null){for(s=0;s<ql.length;s++)if(c=ql[s],d=c.interleaved,d!==null){c.interleaved=null;var p=d.next,_=c.pending;if(_!==null){var g=_.next;_.next=p,d.next=g}c.pending=d}ql=null}return r}function bF(r,s){do{var c=Pi;try{if(zI(),dg.current=Wg,Gg){for(var d=ci.memoizedState;d!==null;){var p=d.queue;p!==null&&(p.pending=null),d=d.next}Gg=!1}if(rd=0,zi=Fi=ci=null,hf=!1,Df=0,sw.current=null,c===null||c.return===null){ji=1,Mf=s,Pi=null;break}e:{var _=r,g=c.return,R=c,I=s;if(s=Zi,R.flags|=32768,I!==null&&typeof I=="object"&&typeof I.then=="function"){var P=I,k=R,L=k.tag;if(!(k.mode&1)&&(L===0||L===11||L===15)){var x=k.alternate;x?(k.updateQueue=x.updateQueue,k.memoizedState=x.memoizedState,k.lanes=x.lanes):(k.updateQueue=null,k.memoizedState=null)}var H=K2(g);if(H!==null){H.flags&=-257,z2(H,g,R,_,s),H.mode&1&&H2(_,P,s),s=H,I=P;var K=s.updateQueue;if(K===null){var ee=new Set;ee.add(I),s.updateQueue=ee}else K.add(I);break e}else{if(!(s&1)){H2(_,P,s),dw();break e}I=Error(De(426))}}else if(ni&&R.mode&1){var re=K2(g);if(re!==null){!(re.flags&65536)&&(re.flags|=256),z2(re,g,R,_,s),HI(ih(I,R));break e}}_=I=ih(I,R),ji!==4&&(ji=2),ff===null?ff=[_]:ff.push(_),_=g;do{switch(_.tag){case 3:_.flags|=65536,s&=-s,_.lanes|=s;var Y=dF(_,I,s);U2(_,Y);break e;case 1:R=I;var F=_.type,z=_.stateNode;if(!(_.flags&128)&&(typeof F.getDerivedStateFromError=="function"||z!==null&&typeof z.componentDidCatch=="function"&&(Xc===null||!Xc.has(z)))){_.flags|=65536,s&=-s,_.lanes|=s;var le=uF(_,R,s);U2(_,le);break e}}_=_.return}while(_!==null)}NF(c)}catch(ge){s=ge,Pi===c&&c!==null&&(Pi=c=c.return);continue}break}while(!0)}function AF(){var r=Hg.current;return Hg.current=Wg,r===null?Wg:r}function dw(){(ji===0||ji===3||ji===2)&&(ji=4),Yi===null||!(sd&268435455)&&!(_v&268435455)||Bc(Yi,Zi)}function Yg(r,s){var c=nn;nn|=2;var d=AF();(Yi!==r||Zi!==s)&&(Ca=null,ed(r,s));do try{GX();break}catch(p){bF(r,p)}while(!0);if(zI(),nn=c,Hg.current=d,Pi!==null)throw Error(De(261));return Yi=null,Zi=0,ji}function GX(){for(;Pi!==null;)OF(Pi)}function WX(){for(;Pi!==null&&!fJ();)OF(Pi)}function OF(r){var s=DF(r.alternate,r,us);r.memoizedProps=r.pendingProps,s===null?NF(r):Pi=s,sw.current=null}function NF(r){var s=r;do{var c=s.alternate;if(r=s.return,s.flags&32768){if(c=xX(c,s),c!==null){c.flags&=32767,Pi=c;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{ji=6,Pi=null;return}}else if(c=MX(c,s,us),c!==null){Pi=c;return}if(s=s.sibling,s!==null){Pi=s;return}Pi=s=r}while(s!==null);ji===0&&(ji=5)}function Hl(r,s,c){var d=_n,p=qs.transition;try{qs.transition=null,_n=1,HX(r,s,c,d)}finally{qs.transition=p,_n=d}return null}function HX(r,s,c,d){do Ju();while(Wc!==null);if(nn&6)throw Error(De(327));c=r.finishedWork;var p=r.finishedLanes;if(c===null)return null;if(r.finishedWork=null,r.finishedLanes=0,c===r.current)throw Error(De(177));r.callbackNode=null,r.callbackPriority=0;var _=c.lanes|c.childLanes;if(CJ(r,_),r===Yi&&(Pi=Yi=null,Zi=0),!(c.subtreeFlags&2064)&&!(c.flags&2064)||FE||(FE=!0,kF(Ag,function(){return Ju(),null})),_=(c.flags&15990)!==0,c.subtreeFlags&15990||_){_=qs.transition,qs.transition=null;var g=_n;_n=1;var R=nn;nn|=4,sw.current=null,VX(r,c),CF(c,r),dX(CC),Ng=!!RC,CC=RC=null,r.current=c,FX(c),mJ(),nn=R,_n=g,qs.transition=_}else r.current=c;if(FE&&(FE=!1,Wc=r,zg=p),_=r.pendingLanes,_===0&&(Xc=null),gJ(c.stateNode),Qr(r,yi()),s!==null)for(d=r.onRecoverableError,c=0;c<s.length;c++)p=s[c],d(p.value,{componentStack:p.stack,digest:p.digest});if(Kg)throw Kg=!1,r=HC,HC=null,r;return zg&1&&r.tag!==0&&Ju(),_=r.pendingLanes,_&1?r===KC?mf++:(mf=0,KC=r):mf=0,cl(),null}function Ju(){if(Wc!==null){var r=lV(zg),s=qs.transition,c=_n;try{if(qs.transition=null,_n=16>r?16:r,Wc===null)var d=!1;else{if(r=Wc,Wc=null,zg=0,nn&6)throw Error(De(331));var p=nn;for(nn|=4,Je=r.current;Je!==null;){var _=Je,g=_.child;if(Je.flags&16){var R=_.deletions;if(R!==null){for(var I=0;I<R.length;I++){var P=R[I];for(Je=P;Je!==null;){var k=Je;switch(k.tag){case 0:case 11:case 15:pf(8,k,_)}var L=k.child;if(L!==null)L.return=k,Je=L;else for(;Je!==null;){k=Je;var x=k.sibling,H=k.return;if(TF(k),k===P){Je=null;break}if(x!==null){x.return=H,Je=x;break}Je=H}}}var K=_.alternate;if(K!==null){var ee=K.child;if(ee!==null){K.child=null;do{var re=ee.sibling;ee.sibling=null,ee=re}while(ee!==null)}}Je=_}}if(_.subtreeFlags&2064&&g!==null)g.return=_,Je=g;else e:for(;Je!==null;){if(_=Je,_.flags&2048)switch(_.tag){case 0:case 11:case 15:pf(9,_,_.return)}var Y=_.sibling;if(Y!==null){Y.return=_.return,Je=Y;break e}Je=_.return}}var F=r.current;for(Je=F;Je!==null;){g=Je;var z=g.child;if(g.subtreeFlags&2064&&z!==null)z.return=g,Je=z;else e:for(g=F;Je!==null;){if(R=Je,R.flags&2048)try{switch(R.tag){case 0:case 11:case 15:mv(9,R)}}catch(ge){hi(R,R.return,ge)}if(R===g){Je=null;break e}var le=R.sibling;if(le!==null){le.return=R.return,Je=le;break e}Je=R.return}}if(nn=p,cl(),Jo&&typeof Jo.onPostCommitFiberRoot=="function")try{Jo.onPostCommitFiberRoot(av,r)}catch{}d=!0}return d}finally{_n=c,qs.transition=s}}return!1}function sx(r,s,c){s=ih(c,s),s=dF(r,s,1),r=Jc(r,s,1),s=Ar(),r!==null&&(Kf(r,1,s),Qr(r,s))}function hi(r,s,c){if(r.tag===3)sx(r,r,c);else for(;s!==null;){if(s.tag===3){sx(s,r,c);break}else if(s.tag===1){var d=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(Xc===null||!Xc.has(d))){r=ih(c,r),r=uF(s,r,1),s=Jc(s,r,1),r=Ar(),s!==null&&(Kf(s,1,r),Qr(s,r));break}}s=s.return}}function KX(r,s,c){var d=r.pingCache;d!==null&&d.delete(s),s=Ar(),r.pingedLanes|=r.suspendedLanes&c,Yi===r&&(Zi&c)===c&&(ji===4||ji===3&&(Zi&130023424)===Zi&&500>yi()-aw?ed(r,0):ow|=c),Qr(r,s)}function PF(r,s){s===0&&(r.mode&1?(s=OE,OE<<=1,!(OE&130023424)&&(OE=4194304)):s=1);var c=Ar();r=Pa(r,s),r!==null&&(Kf(r,s,c),Qr(r,c))}function zX(r){var s=r.memoizedState,c=0;s!==null&&(c=s.retryLane),PF(r,c)}function YX(r,s){var c=0;switch(r.tag){case 13:var d=r.stateNode,p=r.memoizedState;p!==null&&(c=p.retryLane);break;case 19:d=r.stateNode;break;default:throw Error(De(314))}d!==null&&d.delete(s),PF(r,c)}var DF;DF=function(r,s,c){if(r!==null)if(r.memoizedProps!==s.pendingProps||Jr.current)qr=!0;else{if(!(r.lanes&c)&&!(s.flags&128))return qr=!1,LX(r,s,c);qr=!!(r.flags&131072)}else qr=!1,ni&&s.flags&1048576&&MV(s,Ug,s.index);switch(s.lanes=0,s.tag){case 2:var d=s.type;hg(r,s),r=s.pendingProps;var p=Zu(s,mr.current);qu(s,c),p=ew(null,s,d,r,p,c);var _=tw();return s.flags|=1,typeof p=="object"&&p!==null&&typeof p.render=="function"&&p.$$typeof===void 0?(s.tag=1,s.memoizedState=null,s.updateQueue=null,Xr(d)?(_=!0,Mg(s)):_=!1,s.memoizedState=p.state!==null&&p.state!==void 0?p.state:null,JI(s),p.updater=pv,s.stateNode=p,p._reactInternals=s,kC(s,d,r,c),s=xC(null,s,d,!0,_,c)):(s.tag=0,ni&&_&&GI(s),br(null,s,p,c),s=s.child),s;case 16:d=s.elementType;e:{switch(hg(r,s),r=s.pendingProps,p=d._init,d=p(d._payload),s.type=d,p=s.tag=JX(d),r=fo(d,r),p){case 0:s=MC(null,s,d,r,c);break e;case 1:s=J2(null,s,d,r,c);break e;case 11:s=Y2(null,s,d,r,c);break e;case 14:s=q2(null,s,d,fo(d.type,r),c);break e}throw Error(De(306,d,""))}return s;case 0:return d=s.type,p=s.pendingProps,p=s.elementType===d?p:fo(d,p),MC(r,s,d,p,c);case 1:return d=s.type,p=s.pendingProps,p=s.elementType===d?p:fo(d,p),J2(r,s,d,p,c);case 3:e:{if(mF(s),r===null)throw Error(De(387));d=s.pendingProps,_=s.memoizedState,p=_.element,FV(r,s),jg(s,d,null,c);var g=s.memoizedState;if(d=g.element,_.isDehydrated)if(_={element:d,isDehydrated:!1,cache:g.cache,pendingSuspenseBoundaries:g.pendingSuspenseBoundaries,transitions:g.transitions},s.updateQueue.baseState=_,s.memoizedState=_,s.flags&256){p=ih(Error(De(423)),s),s=X2(r,s,d,c,p);break e}else if(d!==p){p=ih(Error(De(424)),s),s=X2(r,s,d,c,p);break e}else for(ps=qc(s.stateNode.containerInfo.firstChild),fs=s,ni=!0,go=null,c=WV(s,null,d,c),s.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(eh(),d===p){s=Da(r,s,c);break e}br(r,s,d,c)}s=s.child}return s;case 5:return HV(s),r===null&&NC(s),d=s.type,p=s.pendingProps,_=r!==null?r.memoizedProps:null,g=p.children,IC(d,p)?g=null:_!==null&&IC(d,_)&&(s.flags|=32),fF(r,s),br(r,s,g,c),s.child;case 6:return r===null&&NC(s),null;case 13:return _F(r,s,c);case 4:return XI(s,s.stateNode.containerInfo),d=s.pendingProps,r===null?s.child=th(s,null,d,c):br(r,s,d,c),s.child;case 11:return d=s.type,p=s.pendingProps,p=s.elementType===d?p:fo(d,p),Y2(r,s,d,p,c);case 7:return br(r,s,s.pendingProps,c),s.child;case 8:return br(r,s,s.pendingProps.children,c),s.child;case 12:return br(r,s,s.pendingProps.children,c),s.child;case 10:e:{if(d=s.type._context,p=s.pendingProps,_=s.memoizedProps,g=p.value,Vn(Vg,d._currentValue),d._currentValue=g,_!==null)if(yo(_.value,g)){if(_.children===p.children&&!Jr.current){s=Da(r,s,c);break e}}else for(_=s.child,_!==null&&(_.return=s);_!==null;){var R=_.dependencies;if(R!==null){g=_.child;for(var I=R.firstContext;I!==null;){if(I.context===d){if(_.tag===1){I=Aa(-1,c&-c),I.tag=2;var P=_.updateQueue;if(P!==null){P=P.shared;var k=P.pending;k===null?I.next=I:(I.next=k.next,k.next=I),P.pending=I}}_.lanes|=c,I=_.alternate,I!==null&&(I.lanes|=c),PC(_.return,c,s),R.lanes|=c;break}I=I.next}}else if(_.tag===10)g=_.type===s.type?null:_.child;else if(_.tag===18){if(g=_.return,g===null)throw Error(De(341));g.lanes|=c,R=g.alternate,R!==null&&(R.lanes|=c),PC(g,c,s),g=_.sibling}else g=_.child;if(g!==null)g.return=_;else for(g=_;g!==null;){if(g===s){g=null;break}if(_=g.sibling,_!==null){_.return=g.return,g=_;break}g=g.return}_=g}br(r,s,p.children,c),s=s.child}return s;case 9:return p=s.type,d=s.pendingProps.children,qu(s,c),p=Js(p),d=d(p),s.flags|=1,br(r,s,d,c),s.child;case 14:return d=s.type,p=fo(d,s.pendingProps),p=fo(d.type,p),q2(r,s,d,p,c);case 15:return hF(r,s,s.type,s.pendingProps,c);case 17:return d=s.type,p=s.pendingProps,p=s.elementType===d?p:fo(d,p),hg(r,s),s.tag=1,Xr(d)?(r=!0,Mg(s)):r=!1,qu(s,c),BV(s,d,p),kC(s,d,p,c),xC(null,s,d,!0,r,c);case 19:return EF(r,s,c);case 22:return pF(r,s,c)}throw Error(De(156,s.tag))};function kF(r,s){return sV(r,s)}function qX(r,s,c,d){this.tag=r,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ys(r,s,c,d){return new qX(r,s,c,d)}function uw(r){return r=r.prototype,!(!r||!r.isReactComponent)}function JX(r){if(typeof r=="function")return uw(r)?1:0;if(r!=null){if(r=r.$$typeof,r===NI)return 11;if(r===PI)return 14}return 2}function $c(r,s){var c=r.alternate;return c===null?(c=Ys(r.tag,s,r.key,r.mode),c.elementType=r.elementType,c.type=r.type,c.stateNode=r.stateNode,c.alternate=r,r.alternate=c):(c.pendingProps=s,c.type=r.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=r.flags&14680064,c.childLanes=r.childLanes,c.lanes=r.lanes,c.child=r.child,c.memoizedProps=r.memoizedProps,c.memoizedState=r.memoizedState,c.updateQueue=r.updateQueue,s=r.dependencies,c.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},c.sibling=r.sibling,c.index=r.index,c.ref=r.ref,c}function mg(r,s,c,d,p,_){var g=2;if(d=r,typeof r=="function")uw(r)&&(g=1);else if(typeof r=="string")g=5;else e:switch(r){case Nu:return td(c.children,p,_,s);case OI:g=8,p|=8;break;case iC:return r=Ys(12,c,s,p|2),r.elementType=iC,r.lanes=_,r;case rC:return r=Ys(13,c,s,p),r.elementType=rC,r.lanes=_,r;case sC:return r=Ys(19,c,s,p),r.elementType=sC,r.lanes=_,r;case GU:return Ev(c,p,_,s);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case jU:g=10;break e;case BU:g=9;break e;case NI:g=11;break e;case PI:g=14;break e;case Vc:g=16,d=null;break e}throw Error(De(130,r==null?r:typeof r,""))}return s=Ys(g,c,s,p),s.elementType=r,s.type=d,s.lanes=_,s}function td(r,s,c,d){return r=Ys(7,r,d,s),r.lanes=c,r}function Ev(r,s,c,d){return r=Ys(22,r,d,s),r.elementType=GU,r.lanes=c,r.stateNode={isHidden:!1},r}function VR(r,s,c){return r=Ys(6,r,null,s),r.lanes=c,r}function FR(r,s,c){return s=Ys(4,r.children!==null?r.children:[],r.key,s),s.lanes=c,s.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},s}function XX(r,s,c,d,p){this.tag=s,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=vR(0),this.expirationTimes=vR(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=vR(0),this.identifierPrefix=d,this.onRecoverableError=p,this.mutableSourceEagerHydrationData=null}function hw(r,s,c,d,p,_,g,R,I){return r=new XX(r,s,c,R,I),s===1?(s=1,_===!0&&(s|=8)):s=0,_=Ys(3,null,null,s),r.current=_,_.stateNode=r,_.memoizedState={element:d,isDehydrated:c,cache:null,transitions:null,pendingSuspenseBoundaries:null},JI(_),r}function QX(r,s,c){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ou,key:d==null?null:""+d,children:r,containerInfo:s,implementation:c}}function LF(r){if(!r)return tl;r=r._reactInternals;e:{if(dd(r)!==r||r.tag!==1)throw Error(De(170));var s=r;do{switch(s.tag){case 3:s=s.stateNode.context;break e;case 1:if(Xr(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break e}}s=s.return}while(s!==null);throw Error(De(171))}if(r.tag===1){var c=r.type;if(Xr(c))return kV(r,c,s)}return s}function MF(r,s,c,d,p,_,g,R,I){return r=hw(c,d,!0,r,p,_,g,R,I),r.context=LF(null),c=r.current,d=Ar(),p=Qc(c),_=Aa(d,p),_.callback=s??null,Jc(c,_,p),r.current.lanes=p,Kf(r,p,d),Qr(r,d),r}function gv(r,s,c,d){var p=s.current,_=Ar(),g=Qc(p);return c=LF(c),s.context===null?s.context=c:s.pendingContext=c,s=Aa(_,g),s.payload={element:r},d=d===void 0?null:d,d!==null&&(s.callback=d),r=Jc(p,s,g),r!==null&&(To(r,p,g,_),lg(r,p,g)),g}function qg(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function ox(r,s){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var c=r.retryLane;r.retryLane=c!==0&&c<s?c:s}}function pw(r,s){ox(r,s),(r=r.alternate)&&ox(r,s)}function $X(){return null}var xF=typeof reportError=="function"?reportError:function(r){console.error(r)};function fw(r){this._internalRoot=r}vv.prototype.render=fw.prototype.render=function(r){var s=this._internalRoot;if(s===null)throw Error(De(409));gv(r,s,null,null)};vv.prototype.unmount=fw.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var s=r.containerInfo;od(function(){gv(null,r,null,null)}),s[Na]=null}};function vv(r){this._internalRoot=r}vv.prototype.unstable_scheduleHydration=function(r){if(r){var s=hV();r={blockedOn:null,target:r,priority:s};for(var c=0;c<jc.length&&s!==0&&s<jc[c].priority;c++);jc.splice(c,0,r),c===0&&fV(r)}};function mw(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function Sv(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function ax(){}function ZX(r,s,c,d,p){if(p){if(typeof d=="function"){var _=d;d=function(){var P=qg(g);_.call(P)}}var g=MF(s,d,r,0,null,!1,!1,"",ax);return r._reactRootContainer=g,r[Na]=g.current,bf(r.nodeType===8?r.parentNode:r),od(),g}for(;p=r.lastChild;)r.removeChild(p);if(typeof d=="function"){var R=d;d=function(){var P=qg(I);R.call(P)}}var I=hw(r,0,!1,null,null,!1,!1,"",ax);return r._reactRootContainer=I,r[Na]=I.current,bf(r.nodeType===8?r.parentNode:r),od(function(){gv(s,I,c,d)}),I}function Tv(r,s,c,d,p){var _=c._reactRootContainer;if(_){var g=_;if(typeof p=="function"){var R=p;p=function(){var I=qg(g);R.call(I)}}gv(s,g,r,p)}else g=ZX(c,s,r,p,d);return qg(g)}dV=function(r){switch(r.tag){case 3:var s=r.stateNode;if(s.current.memoizedState.isDehydrated){var c=tf(s.pendingLanes);c!==0&&(LI(s,c|1),Qr(s,yi()),!(nn&6)&&(rh=yi()+500,cl()))}break;case 13:od(function(){var d=Pa(r,1);if(d!==null){var p=Ar();To(d,r,1,p)}}),pw(r,1)}};MI=function(r){if(r.tag===13){var s=Pa(r,134217728);if(s!==null){var c=Ar();To(s,r,134217728,c)}pw(r,134217728)}};uV=function(r){if(r.tag===13){var s=Qc(r),c=Pa(r,s);if(c!==null){var d=Ar();To(c,r,s,d)}pw(r,s)}};hV=function(){return _n};pV=function(r,s){var c=_n;try{return _n=r,s()}finally{_n=c}};mC=function(r,s,c){switch(s){case"input":if(cC(r,c),s=c.name,c.type==="radio"&&s!=null){for(c=r;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll("input[name="+JSON.stringify(""+s)+'][type="radio"]'),s=0;s<c.length;s++){var d=c[s];if(d!==r&&d.form===r.form){var p=uv(d);if(!p)throw Error(De(90));HU(d),cC(d,p)}}}break;case"textarea":zU(r,c);break;case"select":s=c.value,s!=null&&Hu(r,!!c.multiple,s,!1)}};ZU=cw;eV=od;var eQ={usingClientEntryPoint:!1,Events:[Yf,Lu,uv,QU,$U,cw]},zp={findFiberByHostInstance:Yl,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},tQ={bundleType:zp.bundleType,version:zp.version,rendererPackageName:zp.rendererPackageName,rendererConfig:zp.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:xa.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=iV(r),r===null?null:r.stateNode},findFiberByHostInstance:zp.findFiberByHostInstance||$X,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var jE=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!jE.isDisabled&&jE.supportsFiber)try{av=jE.inject(tQ),Jo=jE}catch{}}_s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eQ;_s.createPortal=function(r,s){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!mw(s))throw Error(De(200));return QX(r,s,null,c)};_s.createRoot=function(r,s){if(!mw(r))throw Error(De(299));var c=!1,d="",p=xF;return s!=null&&(s.unstable_strictMode===!0&&(c=!0),s.identifierPrefix!==void 0&&(d=s.identifierPrefix),s.onRecoverableError!==void 0&&(p=s.onRecoverableError)),s=hw(r,1,!1,null,null,c,!1,d,p),r[Na]=s.current,bf(r.nodeType===8?r.parentNode:r),new fw(s)};_s.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var s=r._reactInternals;if(s===void 0)throw typeof r.render=="function"?Error(De(188)):(r=Object.keys(r).join(","),Error(De(268,r)));return r=iV(s),r=r===null?null:r.stateNode,r};_s.flushSync=function(r){return od(r)};_s.hydrate=function(r,s,c){if(!Sv(s))throw Error(De(200));return Tv(null,r,s,!0,c)};_s.hydrateRoot=function(r,s,c){if(!mw(r))throw Error(De(405));var d=c!=null&&c.hydratedSources||null,p=!1,_="",g=xF;if(c!=null&&(c.unstable_strictMode===!0&&(p=!0),c.identifierPrefix!==void 0&&(_=c.identifierPrefix),c.onRecoverableError!==void 0&&(g=c.onRecoverableError)),s=MF(s,null,r,1,c??null,p,!1,_,g),r[Na]=s.current,bf(r),d)for(r=0;r<d.length;r++)c=d[r],p=c._getVersion,p=p(c._source),s.mutableSourceEagerHydrationData==null?s.mutableSourceEagerHydrationData=[c,p]:s.mutableSourceEagerHydrationData.push(c,p);return new vv(s)};_s.render=function(r,s,c){if(!Sv(s))throw Error(De(200));return Tv(null,r,s,!1,c)};_s.unmountComponentAtNode=function(r){if(!Sv(r))throw Error(De(40));return r._reactRootContainer?(od(function(){Tv(null,null,r,!1,function(){r._reactRootContainer=null,r[Na]=null})}),!0):!1};_s.unstable_batchedUpdates=cw;_s.unstable_renderSubtreeIntoContainer=function(r,s,c,d){if(!Sv(c))throw Error(De(200));if(r==null||r._reactInternals===void 0)throw Error(De(38));return Tv(r,s,c,!1,d)};_s.version="18.2.0-next-9e3b772b8-20220608";function UF(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(UF)}catch(r){console.error(r)}}UF(),MU.exports=_s;var _w=MU.exports;const nQ=sv(_w),iQ=CU({__proto__:null,default:nQ},[_w]);var cx=_w;tC.createRoot=cx.createRoot,tC.hydrateRoot=cx.hydrateRoot;/**
 * @remix-run/router v1.17.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function oi(){return oi=Object.assign?Object.assign.bind():function(r){for(var s=1;s<arguments.length;s++){var c=arguments[s];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(r[d]=c[d])}return r},oi.apply(this,arguments)}var Ti;(function(r){r.Pop="POP",r.Push="PUSH",r.Replace="REPLACE"})(Ti||(Ti={}));const lx="popstate";function rQ(r){r===void 0&&(r={});function s(d,p){let{pathname:_,search:g,hash:R}=d.location;return xf("",{pathname:_,search:g,hash:R},p.state&&p.state.usr||null,p.state&&p.state.key||"default")}function c(d,p){return typeof p=="string"?p:Jf(p)}return oQ(s,c,null,r)}function kt(r,s){if(r===!1||r===null||typeof r>"u")throw new Error(s)}function sh(r,s){if(!r){typeof console<"u"&&console.warn(s);try{throw new Error(s)}catch{}}}function sQ(){return Math.random().toString(36).substr(2,8)}function dx(r,s){return{usr:r.state,key:r.key,idx:s}}function xf(r,s,c,d){return c===void 0&&(c=null),oi({pathname:typeof r=="string"?r:r.pathname,search:"",hash:""},typeof s=="string"?Ua(s):s,{state:c,key:s&&s.key||d||sQ()})}function Jf(r){let{pathname:s="/",search:c="",hash:d=""}=r;return c&&c!=="?"&&(s+=c.charAt(0)==="?"?c:"?"+c),d&&d!=="#"&&(s+=d.charAt(0)==="#"?d:"#"+d),s}function Ua(r){let s={};if(r){let c=r.indexOf("#");c>=0&&(s.hash=r.substr(c),r=r.substr(0,c));let d=r.indexOf("?");d>=0&&(s.search=r.substr(d),r=r.substr(0,d)),r&&(s.pathname=r)}return s}function oQ(r,s,c,d){d===void 0&&(d={});let{window:p=document.defaultView,v5Compat:_=!1}=d,g=p.history,R=Ti.Pop,I=null,P=k();P==null&&(P=0,g.replaceState(oi({},g.state,{idx:P}),""));function k(){return(g.state||{idx:null}).idx}function L(){R=Ti.Pop;let re=k(),Y=re==null?null:re-P;P=re,I&&I({action:R,location:ee.location,delta:Y})}function x(re,Y){R=Ti.Push;let F=xf(ee.location,re,Y);c&&c(F,re),P=k()+1;let z=dx(F,P),le=ee.createHref(F);try{g.pushState(z,"",le)}catch(ge){if(ge instanceof DOMException&&ge.name==="DataCloneError")throw ge;p.location.assign(le)}_&&I&&I({action:R,location:ee.location,delta:1})}function H(re,Y){R=Ti.Replace;let F=xf(ee.location,re,Y);c&&c(F,re),P=k();let z=dx(F,P),le=ee.createHref(F);g.replaceState(z,"",le),_&&I&&I({action:R,location:ee.location,delta:0})}function K(re){let Y=p.location.origin!=="null"?p.location.origin:p.location.href,F=typeof re=="string"?re:Jf(re);return F=F.replace(/ $/,"%20"),kt(Y,"No window.location.(origin|href) available to create URL for href: "+F),new URL(F,Y)}let ee={get action(){return R},get location(){return r(p,g)},listen(re){if(I)throw new Error("A history only accepts one active listener");return p.addEventListener(lx,L),I=re,()=>{p.removeEventListener(lx,L),I=null}},createHref(re){return s(p,re)},createURL:K,encodeLocation(re){let Y=K(re);return{pathname:Y.pathname,search:Y.search,hash:Y.hash}},push:x,replace:H,go(re){return g.go(re)}};return ee}var Un;(function(r){r.data="data",r.deferred="deferred",r.redirect="redirect",r.error="error"})(Un||(Un={}));const aQ=new Set(["lazy","caseSensitive","path","id","index","children"]);function cQ(r){return r.index===!0}function Uf(r,s,c,d){return c===void 0&&(c=[]),d===void 0&&(d={}),r.map((p,_)=>{let g=[...c,String(_)],R=typeof p.id=="string"?p.id:g.join("-");if(kt(p.index!==!0||!p.children,"Cannot specify children on an index route"),kt(!d[R],'Found a route id collision on id "'+R+`".  Route id's must be globally unique within Data Router usages`),cQ(p)){let I=oi({},p,s(p),{id:R});return d[R]=I,I}else{let I=oi({},p,s(p),{id:R,children:void 0});return d[R]=I,p.children&&(I.children=Uf(p.children,s,g,d)),I}})}function zl(r,s,c){return c===void 0&&(c="/"),_g(r,s,c,!1)}function _g(r,s,c,d){let p=typeof s=="string"?Ua(s):s,_=Xf(p.pathname||"/",c);if(_==null)return null;let g=VF(r);dQ(g);let R=null;for(let I=0;R==null&&I<g.length;++I){let P=TQ(_);R=vQ(g[I],P,d)}return R}function lQ(r,s){let{route:c,pathname:d,params:p}=r;return{id:c.id,pathname:d,params:p,data:s[c.id],handle:c.handle}}function VF(r,s,c,d){s===void 0&&(s=[]),c===void 0&&(c=[]),d===void 0&&(d="");let p=(_,g,R)=>{let I={relativePath:R===void 0?_.path||"":R,caseSensitive:_.caseSensitive===!0,childrenIndex:g,route:_};I.relativePath.startsWith("/")&&(kt(I.relativePath.startsWith(d),'Absolute route path "'+I.relativePath+'" nested under path '+('"'+d+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),I.relativePath=I.relativePath.slice(d.length));let P=Zc([d,I.relativePath]),k=c.concat(I);_.children&&_.children.length>0&&(kt(_.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+P+'".')),VF(_.children,s,k,P)),!(_.path==null&&!_.index)&&s.push({path:P,score:EQ(P,_.index),routesMeta:k})};return r.forEach((_,g)=>{var R;if(_.path===""||!((R=_.path)!=null&&R.includes("?")))p(_,g);else for(let I of FF(_.path))p(_,g,I)}),s}function FF(r){let s=r.split("/");if(s.length===0)return[];let[c,...d]=s,p=c.endsWith("?"),_=c.replace(/\?$/,"");if(d.length===0)return p?[_,""]:[_];let g=FF(d.join("/")),R=[];return R.push(...g.map(I=>I===""?_:[_,I].join("/"))),p&&R.push(...g),R.map(I=>r.startsWith("/")&&I===""?"/":I)}function dQ(r){r.sort((s,c)=>s.score!==c.score?c.score-s.score:gQ(s.routesMeta.map(d=>d.childrenIndex),c.routesMeta.map(d=>d.childrenIndex)))}const uQ=/^:[\w-]+$/,hQ=3,pQ=2,fQ=1,mQ=10,_Q=-2,ux=r=>r==="*";function EQ(r,s){let c=r.split("/"),d=c.length;return c.some(ux)&&(d+=_Q),s&&(d+=pQ),c.filter(p=>!ux(p)).reduce((p,_)=>p+(uQ.test(_)?hQ:_===""?fQ:mQ),d)}function gQ(r,s){return r.length===s.length&&r.slice(0,-1).every((d,p)=>d===s[p])?r[r.length-1]-s[s.length-1]:0}function vQ(r,s,c){c===void 0&&(c=!1);let{routesMeta:d}=r,p={},_="/",g=[];for(let R=0;R<d.length;++R){let I=d[R],P=R===d.length-1,k=_==="/"?s:s.slice(_.length)||"/",L=hx({path:I.relativePath,caseSensitive:I.caseSensitive,end:P},k),x=I.route;if(!L&&P&&c&&!d[d.length-1].route.index&&(L=hx({path:I.relativePath,caseSensitive:I.caseSensitive,end:!1},k)),!L)return null;Object.assign(p,L.params),g.push({params:p,pathname:Zc([_,L.pathname]),pathnameBase:CQ(Zc([_,L.pathnameBase])),route:x}),L.pathnameBase!=="/"&&(_=Zc([_,L.pathnameBase]))}return g}function hx(r,s){typeof r=="string"&&(r={path:r,caseSensitive:!1,end:!0});let[c,d]=SQ(r.path,r.caseSensitive,r.end),p=s.match(c);if(!p)return null;let _=p[0],g=_.replace(/(.)\/+$/,"$1"),R=p.slice(1);return{params:d.reduce((P,k,L)=>{let{paramName:x,isOptional:H}=k;if(x==="*"){let ee=R[L]||"";g=_.slice(0,_.length-ee.length).replace(/(.)\/+$/,"$1")}const K=R[L];return H&&!K?P[x]=void 0:P[x]=(K||"").replace(/%2F/g,"/"),P},{}),pathname:_,pathnameBase:g,pattern:r}}function SQ(r,s,c){s===void 0&&(s=!1),c===void 0&&(c=!0),sh(r==="*"||!r.endsWith("*")||r.endsWith("/*"),'Route path "'+r+'" will be treated as if it were '+('"'+r.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+r.replace(/\*$/,"/*")+'".'));let d=[],p="^"+r.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(g,R,I)=>(d.push({paramName:R,isOptional:I!=null}),I?"/?([^\\/]+)?":"/([^\\/]+)"));return r.endsWith("*")?(d.push({paramName:"*"}),p+=r==="*"||r==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):c?p+="\\/*$":r!==""&&r!=="/"&&(p+="(?:(?=\\/|$))"),[new RegExp(p,s?void 0:"i"),d]}function TQ(r){try{return r.split("/").map(s=>decodeURIComponent(s).replace(/\//g,"%2F")).join("/")}catch(s){return sh(!1,'The URL path "'+r+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+s+").")),r}}function Xf(r,s){if(s==="/")return r;if(!r.toLowerCase().startsWith(s.toLowerCase()))return null;let c=s.endsWith("/")?s.length-1:s.length,d=r.charAt(c);return d&&d!=="/"?null:r.slice(c)||"/"}function yQ(r,s){s===void 0&&(s="/");let{pathname:c,search:d="",hash:p=""}=typeof r=="string"?Ua(r):r;return{pathname:c?c.startsWith("/")?c:RQ(c,s):s,search:IQ(d),hash:wQ(p)}}function RQ(r,s){let c=s.replace(/\/+$/,"").split("/");return r.split("/").forEach(p=>{p===".."?c.length>1&&c.pop():p!=="."&&c.push(p)}),c.length>1?c.join("/"):"/"}function jR(r,s,c,d){return"Cannot include a '"+r+"' character in a manually specified "+("`to."+s+"` field ["+JSON.stringify(d)+"].  Please separate it out to the ")+("`to."+c+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function jF(r){return r.filter((s,c)=>c===0||s.route.path&&s.route.path.length>0)}function BF(r,s){let c=jF(r);return s?c.map((d,p)=>p===r.length-1?d.pathname:d.pathnameBase):c.map(d=>d.pathnameBase)}function GF(r,s,c,d){d===void 0&&(d=!1);let p;typeof r=="string"?p=Ua(r):(p=oi({},r),kt(!p.pathname||!p.pathname.includes("?"),jR("?","pathname","search",p)),kt(!p.pathname||!p.pathname.includes("#"),jR("#","pathname","hash",p)),kt(!p.search||!p.search.includes("#"),jR("#","search","hash",p)));let _=r===""||p.pathname==="",g=_?"/":p.pathname,R;if(g==null)R=c;else{let L=s.length-1;if(!d&&g.startsWith("..")){let x=g.split("/");for(;x[0]==="..";)x.shift(),L-=1;p.pathname=x.join("/")}R=L>=0?s[L]:"/"}let I=yQ(p,R),P=g&&g!=="/"&&g.endsWith("/"),k=(_||g===".")&&c.endsWith("/");return!I.pathname.endsWith("/")&&(P||k)&&(I.pathname+="/"),I}const Zc=r=>r.join("/").replace(/\/\/+/g,"/"),CQ=r=>r.replace(/\/+$/,"").replace(/^\/*/,"/"),IQ=r=>!r||r==="?"?"":r.startsWith("?")?r:"?"+r,wQ=r=>!r||r==="#"?"":r.startsWith("#")?r:"#"+r;class Ew{constructor(s,c,d,p){p===void 0&&(p=!1),this.status=s,this.statusText=c||"",this.internal=p,d instanceof Error?(this.data=d.toString(),this.error=d):this.data=d}}function yv(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.internal=="boolean"&&"data"in r}const WF=["post","put","patch","delete"],bQ=new Set(WF),AQ=["get",...WF],OQ=new Set(AQ),NQ=new Set([301,302,303,307,308]),PQ=new Set([307,308]),BR={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},DQ={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},Yp={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},gw=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,kQ=r=>({hasErrorBoundary:!!r.hasErrorBoundary}),HF="remix-router-transitions";function LQ(r){const s=r.window?r.window:typeof window<"u"?window:void 0,c=typeof s<"u"&&typeof s.document<"u"&&typeof s.document.createElement<"u",d=!c;kt(r.routes.length>0,"You must provide a non-empty routes array to createRouter");let p;if(r.mapRouteProperties)p=r.mapRouteProperties;else if(r.detectErrorBoundary){let te=r.detectErrorBoundary;p=oe=>({hasErrorBoundary:te(oe)})}else p=kQ;let _={},g=Uf(r.routes,p,void 0,_),R,I=r.basename||"/",P=r.unstable_dataStrategy||FQ,k=r.unstable_patchRoutesOnMiss,L=oi({v7_fetcherPersist:!1,v7_normalizeFormMethod:!1,v7_partialHydration:!1,v7_prependBasename:!1,v7_relativeSplatPath:!1,unstable_skipActionErrorRevalidation:!1},r.future),x=null,H=new Set,K=null,ee=null,re=null,Y=r.hydrationData!=null,F=zl(g,r.history.location,I),z=null;if(F==null&&!k){let te=wr(404,{pathname:r.history.location.pathname}),{matches:oe,route:pe}=yx(g);F=oe,z={[pe.id]:te}}let le;if(!F)le=!1,F=[];else if(F.some(te=>te.route.lazy))le=!1;else if(!F.some(te=>te.route.loader))le=!0;else if(L.v7_partialHydration){let te=r.hydrationData?r.hydrationData.loaderData:null,oe=r.hydrationData?r.hydrationData.errors:null,pe=Re=>Re.route.loader?typeof Re.route.loader=="function"&&Re.route.loader.hydrate===!0?!1:te&&te[Re.route.id]!==void 0||oe&&oe[Re.route.id]!==void 0:!0;if(oe){let Re=F.findIndex(Be=>oe[Be.route.id]!==void 0);le=F.slice(0,Re+1).every(pe)}else le=F.every(pe)}else le=r.hydrationData!=null;let ge,Z={historyAction:r.history.action,location:r.history.location,matches:F,initialized:le,navigation:BR,restoreScrollPosition:r.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:r.hydrationData&&r.hydrationData.loaderData||{},actionData:r.hydrationData&&r.hydrationData.actionData||null,errors:r.hydrationData&&r.hydrationData.errors||z,fetchers:new Map,blockers:new Map},fe=Ti.Pop,ae=!1,_e,me=!1,Ue=new Map,Ve=null,lt=!1,Ge=!1,Mt=[],Zt=[],Ft=new Map,xe=0,We=-1,ct=new Map,gt=new Set,En=new Map,vs=new Map,An=new Set,tr=new Map,zn=new Map,Fa=new Map,ph=!1;function fh(){if(x=r.history.listen(te=>{let{action:oe,location:pe,delta:Re}=te;if(ph){ph=!1;return}sh(zn.size===0||Re!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let Be=Sh({currentLocation:Z.location,nextLocation:pe,historyAction:oe});if(Be&&Re!=null){ph=!0,r.history.go(Re*-1),$s(Be,{state:"blocked",location:pe,proceed(){$s(Be,{state:"proceeding",proceed:void 0,reset:void 0,location:pe}),r.history.go(Re)},reset(){let $e=new Map(Z.blockers);$e.set(Be,Yp),ki({blockers:$e})}});return}return $o(oe,pe)}),c){$Q(s,Ue);let te=()=>ZQ(s,Ue);s.addEventListener("pagehide",te),Ve=()=>s.removeEventListener("pagehide",te)}return Z.initialized||$o(Ti.Pop,Z.location,{initialHydration:!0}),ge}function kv(){x&&x(),Ve&&Ve(),H.clear(),_e&&_e.abort(),Z.fetchers.forEach((te,oe)=>ul(oe)),Z.blockers.forEach((te,oe)=>im(oe))}function ud(te){return H.add(te),()=>H.delete(te)}function ki(te,oe){oe===void 0&&(oe={}),Z=oi({},Z,te);let pe=[],Re=[];L.v7_fetcherPersist&&Z.fetchers.forEach((Be,$e)=>{Be.state==="idle"&&(An.has($e)?Re.push($e):pe.push($e))}),[...H].forEach(Be=>Be(Z,{deletedFetchers:Re,unstable_viewTransitionOpts:oe.viewTransitionOpts,unstable_flushSync:oe.flushSync===!0})),L.v7_fetcherPersist&&(pe.forEach(Be=>Z.fetchers.delete(Be)),Re.forEach(Be=>ul(Be)))}function ja(te,oe,pe){var Re,Be;let{flushSync:$e}=pe===void 0?{}:pe,dt=Z.actionData!=null&&Z.navigation.formMethod!=null&&_o(Z.navigation.formMethod)&&Z.navigation.state==="loading"&&((Re=te.state)==null?void 0:Re._isRedirect)!==!0,Fe;oe.actionData?Object.keys(oe.actionData).length>0?Fe=oe.actionData:Fe=null:dt?Fe=Z.actionData:Fe=null;let yt=oe.loaderData?Sx(Z.loaderData,oe.loaderData,oe.matches||[],oe.errors):Z.loaderData,Ze=Z.blockers;Ze.size>0&&(Ze=new Map(Ze),Ze.forEach((Jt,on)=>Ze.set(on,Yp)));let Ct=ae===!0||Z.navigation.formMethod!=null&&_o(Z.navigation.formMethod)&&((Be=te.state)==null?void 0:Be._isRedirect)!==!0;R&&(g=R,R=void 0),lt||fe===Ti.Pop||(fe===Ti.Push?r.history.push(te,te.state):fe===Ti.Replace&&r.history.replace(te,te.state));let ln;if(fe===Ti.Pop){let Jt=Ue.get(Z.location.pathname);Jt&&Jt.has(te.pathname)?ln={currentLocation:Z.location,nextLocation:te}:Ue.has(te.pathname)&&(ln={currentLocation:te,nextLocation:Z.location})}else if(me){let Jt=Ue.get(Z.location.pathname);Jt?Jt.add(te.pathname):(Jt=new Set([te.pathname]),Ue.set(Z.location.pathname,Jt)),ln={currentLocation:Z.location,nextLocation:te}}ki(oi({},oe,{actionData:Fe,loaderData:yt,historyAction:fe,location:te,initialized:!0,navigation:BR,revalidation:"idle",restoreScrollPosition:ta(te,oe.matches||Z.matches),preventScrollReset:Ct,blockers:Ze}),{viewTransitionOpts:ln,flushSync:$e===!0}),fe=Ti.Pop,ae=!1,me=!1,lt=!1,Ge=!1,Mt=[],Zt=[]}async function tm(te,oe){if(typeof te=="number"){r.history.go(te);return}let pe=qC(Z.location,Z.matches,I,L.v7_prependBasename,te,L.v7_relativeSplatPath,oe==null?void 0:oe.fromRouteId,oe==null?void 0:oe.relative),{path:Re,submission:Be,error:$e}=px(L.v7_normalizeFormMethod,!1,pe,oe),dt=Z.location,Fe=xf(Z.location,Re,oe&&oe.state);Fe=oi({},Fe,r.history.encodeLocation(Fe));let yt=oe&&oe.replace!=null?oe.replace:void 0,Ze=Ti.Push;yt===!0?Ze=Ti.Replace:yt===!1||Be!=null&&_o(Be.formMethod)&&Be.formAction===Z.location.pathname+Z.location.search&&(Ze=Ti.Replace);let Ct=oe&&"preventScrollReset"in oe?oe.preventScrollReset===!0:void 0,ln=(oe&&oe.unstable_flushSync)===!0,Jt=Sh({currentLocation:dt,nextLocation:Fe,historyAction:Ze});if(Jt){$s(Jt,{state:"blocked",location:Fe,proceed(){$s(Jt,{state:"proceeding",proceed:void 0,reset:void 0,location:Fe}),tm(te,oe)},reset(){let on=new Map(Z.blockers);on.set(Jt,Yp),ki({blockers:on})}});return}return await $o(Ze,Fe,{submission:Be,pendingError:$e,preventScrollReset:Ct,replace:oe&&oe.replace,enableViewTransition:oe&&oe.unstable_viewTransition,flushSync:ln})}function ll(){if(Li(),ki({revalidation:"loading"}),Z.navigation.state!=="submitting"){if(Z.navigation.state==="idle"){$o(Z.historyAction,Z.location,{startUninterruptedRevalidation:!0});return}$o(fe||Z.historyAction,Z.navigation.location,{overrideNavigation:Z.navigation})}}async function $o(te,oe,pe){_e&&_e.abort(),_e=null,fe=te,lt=(pe&&pe.startUninterruptedRevalidation)===!0,Vv(Z.location,Z.matches),ae=(pe&&pe.preventScrollReset)===!0,me=(pe&&pe.enableViewTransition)===!0;let Re=R||g,Be=pe&&pe.overrideNavigation,$e=zl(Re,oe,I),dt=(pe&&pe.flushSync)===!0,Fe=rm($e,Re,oe.pathname);if(Fe.active&&Fe.matches&&($e=Fe.matches),!$e){let{error:en,notFoundMatches:Yn,route:di}=Th(oe.pathname);ja(oe,{matches:Yn,loaderData:{},errors:{[di.id]:en}},{flushSync:dt});return}if(Z.initialized&&!Ge&&KQ(Z.location,oe)&&!(pe&&pe.submission&&_o(pe.submission.formMethod))){ja(oe,{matches:$e},{flushSync:dt});return}_e=new AbortController;let yt=Cu(r.history,oe,_e.signal,pe&&pe.submission),Ze;if(pe&&pe.pendingError)Ze=[_f($e).route.id,{type:Un.error,error:pe.pendingError}];else if(pe&&pe.submission&&_o(pe.submission.formMethod)){let en=await Lv(yt,oe,pe.submission,$e,Fe.active,{replace:pe.replace,flushSync:dt});if(en.shortCircuited)return;if(en.pendingActionResult){let[Yn,di]=en.pendingActionResult;if(hs(di)&&yv(di.error)&&di.error.status===404){_e=null,ja(oe,{matches:en.matches,loaderData:{},errors:{[Yn]:di.error}});return}}$e=en.matches||$e,Ze=en.pendingActionResult,Be=GR(oe,pe.submission),dt=!1,Fe.active=!1,yt=Cu(r.history,yt.url,yt.signal)}let{shortCircuited:Ct,matches:ln,loaderData:Jt,errors:on}=await Zo(yt,oe,$e,Fe.active,Be,pe&&pe.submission,pe&&pe.fetcherSubmission,pe&&pe.replace,pe&&pe.initialHydration===!0,dt,Ze);Ct||(_e=null,ja(oe,oi({matches:ln||$e},Tx(Ze),{loaderData:Jt,errors:on})))}async function Lv(te,oe,pe,Re,Be,$e){$e===void 0&&($e={}),Li();let dt=XQ(oe,pe);if(ki({navigation:dt},{flushSync:$e.flushSync===!0}),Be){let Ze=await fd(Re,oe.pathname,te.signal);if(Ze.type==="aborted")return{shortCircuited:!0};if(Ze.type==="error"){let{error:Ct,notFoundMatches:ln,route:Jt}=pd(oe.pathname,Ze);return{matches:ln,pendingActionResult:[Jt.id,{type:Un.error,error:Ct}]}}else if(Ze.matches)Re=Ze.matches;else{let{notFoundMatches:Ct,error:ln,route:Jt}=Th(oe.pathname);return{matches:Ct,pendingActionResult:[Jt.id,{type:Un.error,error:ln}]}}}let Fe,yt=rf(Re,oe);if(!yt.route.action&&!yt.route.lazy)Fe={type:Un.error,error:wr(405,{method:te.method,pathname:oe.pathname,routeId:yt.route.id})};else if(Fe=(await dl("action",te,[yt],Re))[0],te.signal.aborted)return{shortCircuited:!0};if(Ql(Fe)){let Ze;return $e&&$e.replace!=null?Ze=$e.replace:Ze=Ex(Fe.response.headers.get("Location"),new URL(te.url),I)===Z.location.pathname+Z.location.search,await ea(te,Fe,{submission:pe,replace:Ze}),{shortCircuited:!0}}if(Xl(Fe))throw wr(400,{type:"defer-action"});if(hs(Fe)){let Ze=_f(Re,yt.route.id);return($e&&$e.replace)!==!0&&(fe=Ti.Push),{matches:Re,pendingActionResult:[Ze.route.id,Fe]}}return{matches:Re,pendingActionResult:[yt.route.id,Fe]}}async function Zo(te,oe,pe,Re,Be,$e,dt,Fe,yt,Ze,Ct){let ln=Be||GR(oe,$e),Jt=$e||dt||Ix(ln),on=!lt&&(!L.v7_partialHydration||!yt);if(Re){if(on){let qn=mh(Ct);ki(oi({navigation:ln},qn!==void 0?{actionData:qn}:{}),{flushSync:Ze})}let It=await fd(pe,oe.pathname,te.signal);if(It.type==="aborted")return{shortCircuited:!0};if(It.type==="error"){let{error:qn,notFoundMatches:ir,route:gn}=pd(oe.pathname,It);return{matches:ir,loaderData:{},errors:{[gn.id]:qn}}}else if(It.matches)pe=It.matches;else{let{error:qn,notFoundMatches:ir,route:gn}=Th(oe.pathname);return{matches:ir,loaderData:{},errors:{[gn.id]:qn}}}}let en=R||g,[Yn,di]=fx(r.history,Z,pe,Jt,oe,L.v7_partialHydration&&yt===!0,L.unstable_skipActionErrorRevalidation,Ge,Mt,Zt,An,En,gt,en,I,Ct);if(yh(It=>!(pe&&pe.some(qn=>qn.route.id===It))||Yn&&Yn.some(qn=>qn.route.id===It)),We=++xe,Yn.length===0&&di.length===0){let It=Ro();return ja(oe,oi({matches:pe,loaderData:{},errors:Ct&&hs(Ct[1])?{[Ct[0]]:Ct[1].error}:null},Tx(Ct),It?{fetchers:new Map(Z.fetchers)}:{}),{flushSync:Ze}),{shortCircuited:!0}}if(on){let It={};if(!Re){It.navigation=ln;let qn=mh(Ct);qn!==void 0&&(It.actionData=qn)}di.length>0&&(It.fetchers=Mv(di)),ki(It,{flushSync:Ze})}di.forEach(It=>{Ft.has(It.key)&&Qs(It.key),It.controller&&Ft.set(It.key,It.controller)});let hl=()=>di.forEach(It=>Qs(It.key));_e&&_e.signal.addEventListener("abort",hl);let{loaderResults:Mi,fetcherResults:Ga}=await Eh(Z.matches,pe,Yn,di,te);if(te.signal.aborted)return{shortCircuited:!0};_e&&_e.signal.removeEventListener("abort",hl),di.forEach(It=>Ft.delete(It.key));let Wa=Rx([...Mi,...Ga]);if(Wa){if(Wa.idx>=Yn.length){let It=di[Wa.idx-Yn.length].key;gt.add(It)}return await ea(te,Wa.result,{replace:Fe}),{shortCircuited:!0}}let{loaderData:Fn,errors:ys}=vx(Z,pe,Yn,Mi,Ct,di,Ga,tr);tr.forEach((It,qn)=>{It.subscribe(ir=>{(ir||It.done)&&tr.delete(qn)})}),L.v7_partialHydration&&yt&&Z.errors&&Object.entries(Z.errors).filter(It=>{let[qn]=It;return!Yn.some(ir=>ir.route.id===qn)}).forEach(It=>{let[qn,ir]=It;ys=Object.assign(ys||{},{[qn]:ir})});let md=Ro(),_d=vh(We),Ed=md||_d||di.length>0;return oi({matches:pe,loaderData:Fn,errors:ys},Ed?{fetchers:new Map(Z.fetchers)}:{})}function mh(te){if(te&&!hs(te[1]))return{[te[0]]:te[1].data};if(Z.actionData)return Object.keys(Z.actionData).length===0?null:Z.actionData}function Mv(te){return te.forEach(oe=>{let pe=Z.fetchers.get(oe.key),Re=qp(void 0,pe?pe.data:void 0);Z.fetchers.set(oe.key,Re)}),new Map(Z.fetchers)}function _r(te,oe,pe,Re){if(d)throw new Error("router.fetch() was called during the server render, but it shouldn't be. You are likely calling a useFetcher() method in the body of your component. Try moving it to a useEffect or a callback.");Ft.has(te)&&Qs(te);let Be=(Re&&Re.unstable_flushSync)===!0,$e=R||g,dt=qC(Z.location,Z.matches,I,L.v7_prependBasename,pe,L.v7_relativeSplatPath,oe,Re==null?void 0:Re.relative),Fe=zl($e,dt,I),yt=rm(Fe,$e,dt);if(yt.active&&yt.matches&&(Fe=yt.matches),!Fe){Ts(te,oe,wr(404,{pathname:dt}),{flushSync:Be});return}let{path:Ze,submission:Ct,error:ln}=px(L.v7_normalizeFormMethod,!0,dt,Re);if(ln){Ts(te,oe,ln,{flushSync:Be});return}let Jt=rf(Fe,Ze);if(ae=(Re&&Re.preventScrollReset)===!0,Ct&&_o(Ct.formMethod)){Ss(te,oe,Ze,Jt,Fe,yt.active,Be,Ct);return}En.set(te,{routeId:oe,path:Ze}),_h(te,oe,Ze,Jt,Fe,yt.active,Be,Ct)}async function Ss(te,oe,pe,Re,Be,$e,dt,Fe){Li(),En.delete(te);function yt(gn){if(!gn.route.action&&!gn.route.lazy){let Zs=wr(405,{method:Fe.formMethod,pathname:pe,routeId:oe});return Ts(te,oe,Zs,{flushSync:dt}),!0}return!1}if(!$e&&yt(Re))return;let Ze=Z.fetchers.get(te);nr(te,QQ(Fe,Ze),{flushSync:dt});let Ct=new AbortController,ln=Cu(r.history,pe,Ct.signal,Fe);if($e){let gn=await fd(Be,pe,ln.signal);if(gn.type==="aborted")return;if(gn.type==="error"){let{error:Zs}=pd(pe,gn);Ts(te,oe,Zs,{flushSync:dt});return}else if(gn.matches){if(Be=gn.matches,Re=rf(Be,pe),yt(Re))return}else{Ts(te,oe,wr(404,{pathname:pe}),{flushSync:dt});return}}Ft.set(te,Ct);let Jt=xe,en=(await dl("action",ln,[Re],Be))[0];if(ln.signal.aborted){Ft.get(te)===Ct&&Ft.delete(te);return}if(L.v7_fetcherPersist&&An.has(te)){if(Ql(en)||hs(en)){nr(te,Uc(void 0));return}}else{if(Ql(en))if(Ft.delete(te),We>Jt){nr(te,Uc(void 0));return}else return gt.add(te),nr(te,qp(Fe)),ea(ln,en,{fetcherSubmission:Fe});if(hs(en)){Ts(te,oe,en.error);return}}if(Xl(en))throw wr(400,{type:"defer-action"});let Yn=Z.navigation.location||Z.location,di=Cu(r.history,Yn,Ct.signal),hl=R||g,Mi=Z.navigation.state!=="idle"?zl(hl,Z.navigation.location,I):Z.matches;kt(Mi,"Didn't find any matches after fetcher action");let Ga=++xe;ct.set(te,Ga);let Wa=qp(Fe,en.data);Z.fetchers.set(te,Wa);let[Fn,ys]=fx(r.history,Z,Mi,Fe,Yn,!1,L.unstable_skipActionErrorRevalidation,Ge,Mt,Zt,An,En,gt,hl,I,[Re.route.id,en]);ys.filter(gn=>gn.key!==te).forEach(gn=>{let Zs=gn.key,sm=Z.fetchers.get(Zs),Ha=qp(void 0,sm?sm.data:void 0);Z.fetchers.set(Zs,Ha),Ft.has(Zs)&&Qs(Zs),gn.controller&&Ft.set(Zs,gn.controller)}),ki({fetchers:new Map(Z.fetchers)});let md=()=>ys.forEach(gn=>Qs(gn.key));Ct.signal.addEventListener("abort",md);let{loaderResults:_d,fetcherResults:Ed}=await Eh(Z.matches,Mi,Fn,ys,di);if(Ct.signal.aborted)return;Ct.signal.removeEventListener("abort",md),ct.delete(te),Ft.delete(te),ys.forEach(gn=>Ft.delete(gn.key));let It=Rx([..._d,...Ed]);if(It){if(It.idx>=Fn.length){let gn=ys[It.idx-Fn.length].key;gt.add(gn)}return ea(di,It.result)}let{loaderData:qn,errors:ir}=vx(Z,Z.matches,Fn,_d,void 0,ys,Ed,tr);if(Z.fetchers.has(te)){let gn=Uc(en.data);Z.fetchers.set(te,gn)}vh(Ga),Z.navigation.state==="loading"&&Ga>We?(kt(fe,"Expected pending action"),_e&&_e.abort(),ja(Z.navigation.location,{matches:Mi,loaderData:qn,errors:ir,fetchers:new Map(Z.fetchers)})):(ki({errors:ir,loaderData:Sx(Z.loaderData,qn,Mi,ir),fetchers:new Map(Z.fetchers)}),Ge=!1)}async function _h(te,oe,pe,Re,Be,$e,dt,Fe){let yt=Z.fetchers.get(te);nr(te,qp(Fe,yt?yt.data:void 0),{flushSync:dt});let Ze=new AbortController,Ct=Cu(r.history,pe,Ze.signal);if($e){let en=await fd(Be,pe,Ct.signal);if(en.type==="aborted")return;if(en.type==="error"){let{error:Yn}=pd(pe,en);Ts(te,oe,Yn,{flushSync:dt});return}else if(en.matches)Be=en.matches,Re=rf(Be,pe);else{Ts(te,oe,wr(404,{pathname:pe}),{flushSync:dt});return}}Ft.set(te,Ze);let ln=xe,on=(await dl("loader",Ct,[Re],Be))[0];if(Xl(on)&&(on=await JF(on,Ct.signal,!0)||on),Ft.get(te)===Ze&&Ft.delete(te),!Ct.signal.aborted){if(An.has(te)){nr(te,Uc(void 0));return}if(Ql(on))if(We>ln){nr(te,Uc(void 0));return}else{gt.add(te),await ea(Ct,on);return}if(hs(on)){Ts(te,oe,on.error);return}kt(!Xl(on),"Unhandled fetcher deferred data"),nr(te,Uc(on.data))}}async function ea(te,oe,pe){let{submission:Re,fetcherSubmission:Be,replace:$e}=pe===void 0?{}:pe;oe.response.headers.has("X-Remix-Revalidate")&&(Ge=!0);let dt=oe.response.headers.get("Location");kt(dt,"Expected a Location header on the redirect Response"),dt=Ex(dt,new URL(te.url),I);let Fe=xf(Z.location,dt,{_isRedirect:!0});if(c){let on=!1;if(oe.response.headers.has("X-Remix-Reload-Document"))on=!0;else if(gw.test(dt)){const en=r.history.createURL(dt);on=en.origin!==s.location.origin||Xf(en.pathname,I)==null}if(on){$e?s.location.replace(dt):s.location.assign(dt);return}}_e=null;let yt=$e===!0?Ti.Replace:Ti.Push,{formMethod:Ze,formAction:Ct,formEncType:ln}=Z.navigation;!Re&&!Be&&Ze&&Ct&&ln&&(Re=Ix(Z.navigation));let Jt=Re||Be;if(PQ.has(oe.response.status)&&Jt&&_o(Jt.formMethod))await $o(yt,Fe,{submission:oi({},Jt,{formAction:dt}),preventScrollReset:ae});else{let on=GR(Fe,Re);await $o(yt,Fe,{overrideNavigation:on,fetcherSubmission:Be,preventScrollReset:ae})}}async function dl(te,oe,pe,Re){try{let Be=await jQ(P,te,oe,pe,Re,_,p);return await Promise.all(Be.map(($e,dt)=>{if(YQ($e)){let Fe=$e.result;return{type:Un.redirect,response:WQ(Fe,oe,pe[dt].route.id,Re,I,L.v7_relativeSplatPath)}}return GQ($e)}))}catch(Be){return pe.map(()=>({type:Un.error,error:Be}))}}async function Eh(te,oe,pe,Re,Be){let[$e,...dt]=await Promise.all([pe.length?dl("loader",Be,pe,oe):[],...Re.map(Fe=>{if(Fe.matches&&Fe.match&&Fe.controller){let yt=Cu(r.history,Fe.path,Fe.controller.signal);return dl("loader",yt,[Fe.match],Fe.matches).then(Ze=>Ze[0])}else return Promise.resolve({type:Un.error,error:wr(404,{pathname:Fe.path})})})]);return await Promise.all([Cx(te,pe,$e,$e.map(()=>Be.signal),!1,Z.loaderData),Cx(te,Re.map(Fe=>Fe.match),dt,Re.map(Fe=>Fe.controller?Fe.controller.signal:null),!0)]),{loaderResults:$e,fetcherResults:dt}}function Li(){Ge=!0,Mt.push(...yh()),En.forEach((te,oe)=>{Ft.has(oe)&&(Zt.push(oe),Qs(oe))})}function nr(te,oe,pe){pe===void 0&&(pe={}),Z.fetchers.set(te,oe),ki({fetchers:new Map(Z.fetchers)},{flushSync:(pe&&pe.flushSync)===!0})}function Ts(te,oe,pe,Re){Re===void 0&&(Re={});let Be=_f(Z.matches,oe);ul(te),ki({errors:{[Be.route.id]:pe},fetchers:new Map(Z.fetchers)},{flushSync:(Re&&Re.flushSync)===!0})}function hd(te){return L.v7_fetcherPersist&&(vs.set(te,(vs.get(te)||0)+1),An.has(te)&&An.delete(te)),Z.fetchers.get(te)||DQ}function ul(te){let oe=Z.fetchers.get(te);Ft.has(te)&&!(oe&&oe.state==="loading"&&ct.has(te))&&Qs(te),En.delete(te),ct.delete(te),gt.delete(te),An.delete(te),Z.fetchers.delete(te)}function nm(te){if(L.v7_fetcherPersist){let oe=(vs.get(te)||0)-1;oe<=0?(vs.delete(te),An.add(te)):vs.set(te,oe)}else ul(te);ki({fetchers:new Map(Z.fetchers)})}function Qs(te){let oe=Ft.get(te);kt(oe,"Expected fetch controller: "+te),oe.abort(),Ft.delete(te)}function gh(te){for(let oe of te){let pe=hd(oe),Re=Uc(pe.data);Z.fetchers.set(oe,Re)}}function Ro(){let te=[],oe=!1;for(let pe of gt){let Re=Z.fetchers.get(pe);kt(Re,"Expected fetcher: "+pe),Re.state==="loading"&&(gt.delete(pe),te.push(pe),oe=!0)}return gh(te),oe}function vh(te){let oe=[];for(let[pe,Re]of ct)if(Re<te){let Be=Z.fetchers.get(pe);kt(Be,"Expected fetcher: "+pe),Be.state==="loading"&&(Qs(pe),ct.delete(pe),oe.push(pe))}return gh(oe),oe.length>0}function xv(te,oe){let pe=Z.blockers.get(te)||Yp;return zn.get(te)!==oe&&zn.set(te,oe),pe}function im(te){Z.blockers.delete(te),zn.delete(te)}function $s(te,oe){let pe=Z.blockers.get(te)||Yp;kt(pe.state==="unblocked"&&oe.state==="blocked"||pe.state==="blocked"&&oe.state==="blocked"||pe.state==="blocked"&&oe.state==="proceeding"||pe.state==="blocked"&&oe.state==="unblocked"||pe.state==="proceeding"&&oe.state==="unblocked","Invalid blocker state transition: "+pe.state+" -> "+oe.state);let Re=new Map(Z.blockers);Re.set(te,oe),ki({blockers:Re})}function Sh(te){let{currentLocation:oe,nextLocation:pe,historyAction:Re}=te;if(zn.size===0)return;zn.size>1&&sh(!1,"A router only supports one blocker at a time");let Be=Array.from(zn.entries()),[$e,dt]=Be[Be.length-1],Fe=Z.blockers.get($e);if(!(Fe&&Fe.state==="proceeding")&&dt({currentLocation:oe,nextLocation:pe,historyAction:Re}))return $e}function Th(te){let oe=wr(404,{pathname:te}),pe=R||g,{matches:Re,route:Be}=yx(pe);return yh(),{notFoundMatches:Re,route:Be,error:oe}}function pd(te,oe){let pe=oe.partialMatches,Re=pe[pe.length-1].route,Be=wr(400,{type:"route-discovery",routeId:Re.id,pathname:te,message:oe.error!=null&&"message"in oe.error?oe.error:String(oe.error)});return{notFoundMatches:pe,route:Re,error:Be}}function yh(te){let oe=[];return tr.forEach((pe,Re)=>{(!te||te(Re))&&(pe.cancel(),oe.push(Re),tr.delete(Re))}),oe}function Uv(te,oe,pe){if(K=te,re=oe,ee=pe||null,!Y&&Z.navigation===BR){Y=!0;let Re=ta(Z.location,Z.matches);Re!=null&&ki({restoreScrollPosition:Re})}return()=>{K=null,re=null,ee=null}}function Ba(te,oe){return ee&&ee(te,oe.map(Re=>lQ(Re,Z.loaderData)))||te.key}function Vv(te,oe){if(K&&re){let pe=Ba(te,oe);K[pe]=re()}}function ta(te,oe){if(K){let pe=Ba(te,oe),Re=K[pe];if(typeof Re=="number")return Re}return null}function rm(te,oe,pe){if(k)if(te){if(te[te.length-1].route.path==="*")return{active:!0,matches:_g(oe,pe,I,!0)}}else return{active:!0,matches:_g(oe,pe,I,!0)||[]};return{active:!1,matches:null}}async function fd(te,oe,pe){let Re=te,Be=Re.length>0?Re[Re.length-1].route:null;for(;;){try{await VQ(k,oe,Re,g||R,_,p,Fa,pe)}catch(Ze){return{type:"error",error:Ze,partialMatches:Re}}if(pe.aborted)return{type:"aborted"};let $e=R||g,dt=zl($e,oe,I),Fe=!1;if(dt){let Ze=dt[dt.length-1].route;if(Ze.index)return{type:"success",matches:dt};if(Ze.path&&Ze.path.length>0)if(Ze.path==="*")Fe=!0;else return{type:"success",matches:dt}}let yt=_g($e,oe,I,!0);if(!yt||Re.map(Ze=>Ze.route.id).join("-")===yt.map(Ze=>Ze.route.id).join("-"))return{type:"success",matches:Fe?dt:null};if(Re=yt,Be=Re[Re.length-1].route,Be.path==="*")return{type:"success",matches:Re}}}function Fv(te){_={},R=Uf(te,p,void 0,_)}return ge={get basename(){return I},get future(){return L},get state(){return Z},get routes(){return g},get window(){return s},initialize:fh,subscribe:ud,enableScrollRestoration:Uv,navigate:tm,fetch:_r,revalidate:ll,createHref:te=>r.history.createHref(te),encodeLocation:te=>r.history.encodeLocation(te),getFetcher:hd,deleteFetcher:nm,dispose:kv,getBlocker:xv,deleteBlocker:im,patchRoutes(te,oe){return zF(te,oe,g||R,_,p)},_internalFetchControllers:Ft,_internalActiveDeferreds:tr,_internalSetRoutes:Fv},ge}function MQ(r){return r!=null&&("formData"in r&&r.formData!=null||"body"in r&&r.body!==void 0)}function qC(r,s,c,d,p,_,g,R){let I,P;if(g){I=[];for(let L of s)if(I.push(L),L.route.id===g){P=L;break}}else I=s,P=s[s.length-1];let k=GF(p||".",BF(I,_),Xf(r.pathname,c)||r.pathname,R==="path");return p==null&&(k.search=r.search,k.hash=r.hash),(p==null||p===""||p===".")&&P&&P.route.index&&!vw(k.search)&&(k.search=k.search?k.search.replace(/^\?/,"?index&"):"?index"),d&&c!=="/"&&(k.pathname=k.pathname==="/"?c:Zc([c,k.pathname])),Jf(k)}function px(r,s,c,d){if(!d||!MQ(d))return{path:c};if(d.formMethod&&!JQ(d.formMethod))return{path:c,error:wr(405,{method:d.formMethod})};let p=()=>({path:c,error:wr(400,{type:"invalid-body"})}),_=d.formMethod||"get",g=r?_.toUpperCase():_.toLowerCase(),R=YF(c);if(d.body!==void 0){if(d.formEncType==="text/plain"){if(!_o(g))return p();let x=typeof d.body=="string"?d.body:d.body instanceof FormData||d.body instanceof URLSearchParams?Array.from(d.body.entries()).reduce((H,K)=>{let[ee,re]=K;return""+H+ee+"="+re+`
`},""):String(d.body);return{path:c,submission:{formMethod:g,formAction:R,formEncType:d.formEncType,formData:void 0,json:void 0,text:x}}}else if(d.formEncType==="application/json"){if(!_o(g))return p();try{let x=typeof d.body=="string"?JSON.parse(d.body):d.body;return{path:c,submission:{formMethod:g,formAction:R,formEncType:d.formEncType,formData:void 0,json:x,text:void 0}}}catch{return p()}}}kt(typeof FormData=="function","FormData is not available in this environment");let I,P;if(d.formData)I=JC(d.formData),P=d.formData;else if(d.body instanceof FormData)I=JC(d.body),P=d.body;else if(d.body instanceof URLSearchParams)I=d.body,P=gx(I);else if(d.body==null)I=new URLSearchParams,P=new FormData;else try{I=new URLSearchParams(d.body),P=gx(I)}catch{return p()}let k={formMethod:g,formAction:R,formEncType:d&&d.formEncType||"application/x-www-form-urlencoded",formData:P,json:void 0,text:void 0};if(_o(k.formMethod))return{path:c,submission:k};let L=Ua(c);return s&&L.search&&vw(L.search)&&I.append("index",""),L.search="?"+I,{path:Jf(L),submission:k}}function xQ(r,s){let c=r;if(s){let d=r.findIndex(p=>p.route.id===s);d>=0&&(c=r.slice(0,d))}return c}function fx(r,s,c,d,p,_,g,R,I,P,k,L,x,H,K,ee){let re=ee?hs(ee[1])?ee[1].error:ee[1].data:void 0,Y=r.createURL(s.location),F=r.createURL(p),z=ee&&hs(ee[1])?ee[0]:void 0,le=z?xQ(c,z):c,ge=ee?ee[1].statusCode:void 0,Z=g&&ge&&ge>=400,fe=le.filter((_e,me)=>{let{route:Ue}=_e;if(Ue.lazy)return!0;if(Ue.loader==null)return!1;if(_)return typeof Ue.loader!="function"||Ue.loader.hydrate?!0:s.loaderData[Ue.id]===void 0&&(!s.errors||s.errors[Ue.id]===void 0);if(UQ(s.loaderData,s.matches[me],_e)||I.some(Ge=>Ge===_e.route.id))return!0;let Ve=s.matches[me],lt=_e;return mx(_e,oi({currentUrl:Y,currentParams:Ve.params,nextUrl:F,nextParams:lt.params},d,{actionResult:re,unstable_actionStatus:ge,defaultShouldRevalidate:Z?!1:R||Y.pathname+Y.search===F.pathname+F.search||Y.search!==F.search||KF(Ve,lt)}))}),ae=[];return L.forEach((_e,me)=>{if(_||!c.some(Mt=>Mt.route.id===_e.routeId)||k.has(me))return;let Ue=zl(H,_e.path,K);if(!Ue){ae.push({key:me,routeId:_e.routeId,path:_e.path,matches:null,match:null,controller:null});return}let Ve=s.fetchers.get(me),lt=rf(Ue,_e.path),Ge=!1;x.has(me)?Ge=!1:P.includes(me)?Ge=!0:Ve&&Ve.state!=="idle"&&Ve.data===void 0?Ge=R:Ge=mx(lt,oi({currentUrl:Y,currentParams:s.matches[s.matches.length-1].params,nextUrl:F,nextParams:c[c.length-1].params},d,{actionResult:re,unstable_actionStatus:ge,defaultShouldRevalidate:Z?!1:R})),Ge&&ae.push({key:me,routeId:_e.routeId,path:_e.path,matches:Ue,match:lt,controller:new AbortController})}),[fe,ae]}function UQ(r,s,c){let d=!s||c.route.id!==s.route.id,p=r[c.route.id]===void 0;return d||p}function KF(r,s){let c=r.route.path;return r.pathname!==s.pathname||c!=null&&c.endsWith("*")&&r.params["*"]!==s.params["*"]}function mx(r,s){if(r.route.shouldRevalidate){let c=r.route.shouldRevalidate(s);if(typeof c=="boolean")return c}return s.defaultShouldRevalidate}async function VQ(r,s,c,d,p,_,g,R){let I=[s,...c.map(P=>P.route.id)].join("-");try{let P=g.get(I);P||(P=r({path:s,matches:c,patch:(k,L)=>{R.aborted||zF(k,L,d,p,_)}}),g.set(I,P)),P&&zQ(P)&&await P}finally{g.delete(I)}}function zF(r,s,c,d,p){if(r){var _;let g=d[r];kt(g,"No route found to patch children into: routeId = "+r);let R=Uf(s,p,[r,"patch",String(((_=g.children)==null?void 0:_.length)||"0")],d);g.children?g.children.push(...R):g.children=R}else{let g=Uf(s,p,["patch",String(c.length||"0")],d);c.push(...g)}}async function _x(r,s,c){if(!r.lazy)return;let d=await r.lazy();if(!r.lazy)return;let p=c[r.id];kt(p,"No route found in manifest");let _={};for(let g in d){let I=p[g]!==void 0&&g!=="hasErrorBoundary";sh(!I,'Route "'+p.id+'" has a static property "'+g+'" defined but its lazy function is also returning a value for this property. '+('The lazy route property "'+g+'" will be ignored.')),!I&&!aQ.has(g)&&(_[g]=d[g])}Object.assign(p,_),Object.assign(p,oi({},s(p),{lazy:void 0}))}function FQ(r){return Promise.all(r.matches.map(s=>s.resolve()))}async function jQ(r,s,c,d,p,_,g,R){let I=d.reduce((L,x)=>L.add(x.route.id),new Set),P=new Set,k=await r({matches:p.map(L=>{let x=I.has(L.route.id);return oi({},L,{shouldLoad:x,resolve:K=>(P.add(L.route.id),x?BQ(s,c,L,_,g,K,R):Promise.resolve({type:Un.data,result:void 0}))})}),request:c,params:p[0].params,context:R});return p.forEach(L=>kt(P.has(L.route.id),'`match.resolve()` was not called for route id "'+L.route.id+'". You must call `match.resolve()` on every match passed to `dataStrategy` to ensure all routes are properly loaded.')),k.filter((L,x)=>I.has(p[x].route.id))}async function BQ(r,s,c,d,p,_,g){let R,I,P=k=>{let L,x=new Promise((ee,re)=>L=re);I=()=>L(),s.signal.addEventListener("abort",I);let H=ee=>typeof k!="function"?Promise.reject(new Error("You cannot call the handler for a route which defines a boolean "+('"'+r+'" [routeId: '+c.route.id+"]"))):k({request:s,params:c.params,context:g},...ee!==void 0?[ee]:[]),K;return _?K=_(ee=>H(ee)):K=(async()=>{try{return{type:"data",result:await H()}}catch(ee){return{type:"error",result:ee}}})(),Promise.race([K,x])};try{let k=c.route[r];if(c.route.lazy)if(k){let L,[x]=await Promise.all([P(k).catch(H=>{L=H}),_x(c.route,p,d)]);if(L!==void 0)throw L;R=x}else if(await _x(c.route,p,d),k=c.route[r],k)R=await P(k);else if(r==="action"){let L=new URL(s.url),x=L.pathname+L.search;throw wr(405,{method:s.method,pathname:x,routeId:c.route.id})}else return{type:Un.data,result:void 0};else if(k)R=await P(k);else{let L=new URL(s.url),x=L.pathname+L.search;throw wr(404,{pathname:x})}kt(R.result!==void 0,"You defined "+(r==="action"?"an action":"a loader")+" for route "+('"'+c.route.id+"\" but didn't return anything from your `"+r+"` ")+"function. Please return a value or `null`.")}catch(k){return{type:Un.error,result:k}}finally{I&&s.signal.removeEventListener("abort",I)}return R}async function GQ(r){let{result:s,type:c,status:d}=r;if(qF(s)){let g;try{let R=s.headers.get("Content-Type");R&&/\bapplication\/json\b/.test(R)?s.body==null?g=null:g=await s.json():g=await s.text()}catch(R){return{type:Un.error,error:R}}return c===Un.error?{type:Un.error,error:new Ew(s.status,s.statusText,g),statusCode:s.status,headers:s.headers}:{type:Un.data,data:g,statusCode:s.status,headers:s.headers}}if(c===Un.error)return{type:Un.error,error:s,statusCode:yv(s)?s.status:d};if(qQ(s)){var p,_;return{type:Un.deferred,deferredData:s,statusCode:(p=s.init)==null?void 0:p.status,headers:((_=s.init)==null?void 0:_.headers)&&new Headers(s.init.headers)}}return{type:Un.data,data:s,statusCode:d}}function WQ(r,s,c,d,p,_){let g=r.headers.get("Location");if(kt(g,"Redirects returned/thrown from loaders/actions must have a Location header"),!gw.test(g)){let R=d.slice(0,d.findIndex(I=>I.route.id===c)+1);g=qC(new URL(s.url),R,p,!0,g,_),r.headers.set("Location",g)}return r}function Ex(r,s,c){if(gw.test(r)){let d=r,p=d.startsWith("//")?new URL(s.protocol+d):new URL(d),_=Xf(p.pathname,c)!=null;if(p.origin===s.origin&&_)return p.pathname+p.search+p.hash}return r}function Cu(r,s,c,d){let p=r.createURL(YF(s)).toString(),_={signal:c};if(d&&_o(d.formMethod)){let{formMethod:g,formEncType:R}=d;_.method=g.toUpperCase(),R==="application/json"?(_.headers=new Headers({"Content-Type":R}),_.body=JSON.stringify(d.json)):R==="text/plain"?_.body=d.text:R==="application/x-www-form-urlencoded"&&d.formData?_.body=JC(d.formData):_.body=d.formData}return new Request(p,_)}function JC(r){let s=new URLSearchParams;for(let[c,d]of r.entries())s.append(c,typeof d=="string"?d:d.name);return s}function gx(r){let s=new FormData;for(let[c,d]of r.entries())s.append(c,d);return s}function HQ(r,s,c,d,p,_){let g={},R=null,I,P=!1,k={},L=d&&hs(d[1])?d[1].error:void 0;return c.forEach((x,H)=>{let K=s[H].route.id;if(kt(!Ql(x),"Cannot handle redirect results in processLoaderData"),hs(x)){let ee=x.error;if(L!==void 0&&(ee=L,L=void 0),R=R||{},_)R[K]=ee;else{let re=_f(r,K);R[re.route.id]==null&&(R[re.route.id]=ee)}g[K]=void 0,P||(P=!0,I=yv(x.error)?x.error.status:500),x.headers&&(k[K]=x.headers)}else Xl(x)?(p.set(K,x.deferredData),g[K]=x.deferredData.data,x.statusCode!=null&&x.statusCode!==200&&!P&&(I=x.statusCode),x.headers&&(k[K]=x.headers)):(g[K]=x.data,x.statusCode&&x.statusCode!==200&&!P&&(I=x.statusCode),x.headers&&(k[K]=x.headers))}),L!==void 0&&d&&(R={[d[0]]:L},g[d[0]]=void 0),{loaderData:g,errors:R,statusCode:I||200,loaderHeaders:k}}function vx(r,s,c,d,p,_,g,R){let{loaderData:I,errors:P}=HQ(s,c,d,p,R,!1);for(let k=0;k<_.length;k++){let{key:L,match:x,controller:H}=_[k];kt(g!==void 0&&g[k]!==void 0,"Did not find corresponding fetcher result");let K=g[k];if(!(H&&H.signal.aborted))if(hs(K)){let ee=_f(r.matches,x==null?void 0:x.route.id);P&&P[ee.route.id]||(P=oi({},P,{[ee.route.id]:K.error})),r.fetchers.delete(L)}else if(Ql(K))kt(!1,"Unhandled fetcher revalidation redirect");else if(Xl(K))kt(!1,"Unhandled fetcher deferred data");else{let ee=Uc(K.data);r.fetchers.set(L,ee)}}return{loaderData:I,errors:P}}function Sx(r,s,c,d){let p=oi({},s);for(let _ of c){let g=_.route.id;if(s.hasOwnProperty(g)?s[g]!==void 0&&(p[g]=s[g]):r[g]!==void 0&&_.route.loader&&(p[g]=r[g]),d&&d.hasOwnProperty(g))break}return p}function Tx(r){return r?hs(r[1])?{actionData:{}}:{actionData:{[r[0]]:r[1].data}}:{}}function _f(r,s){return(s?r.slice(0,r.findIndex(d=>d.route.id===s)+1):[...r]).reverse().find(d=>d.route.hasErrorBoundary===!0)||r[0]}function yx(r){let s=r.length===1?r[0]:r.find(c=>c.index||!c.path||c.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:s}],route:s}}function wr(r,s){let{pathname:c,routeId:d,method:p,type:_,message:g}=s===void 0?{}:s,R="Unknown Server Error",I="Unknown @remix-run/router error";return r===400?(R="Bad Request",_==="route-discovery"?I='Unable to match URL "'+c+'" - the `children()` function for '+("route `"+d+"` threw the following error:\n"+g):p&&c&&d?I="You made a "+p+' request to "'+c+'" but '+('did not provide a `loader` for route "'+d+'", ')+"so there is no way to handle the request.":_==="defer-action"?I="defer() is not supported in actions":_==="invalid-body"&&(I="Unable to encode submission body")):r===403?(R="Forbidden",I='Route "'+d+'" does not match URL "'+c+'"'):r===404?(R="Not Found",I='No route matches URL "'+c+'"'):r===405&&(R="Method Not Allowed",p&&c&&d?I="You made a "+p.toUpperCase()+' request to "'+c+'" but '+('did not provide an `action` for route "'+d+'", ')+"so there is no way to handle the request.":p&&(I='Invalid request method "'+p.toUpperCase()+'"')),new Ew(r||500,R,new Error(I),!0)}function Rx(r){for(let s=r.length-1;s>=0;s--){let c=r[s];if(Ql(c))return{result:c,idx:s}}}function YF(r){let s=typeof r=="string"?Ua(r):r;return Jf(oi({},s,{hash:""}))}function KQ(r,s){return r.pathname!==s.pathname||r.search!==s.search?!1:r.hash===""?s.hash!=="":r.hash===s.hash?!0:s.hash!==""}function zQ(r){return typeof r=="object"&&r!=null&&"then"in r}function YQ(r){return qF(r.result)&&NQ.has(r.result.status)}function Xl(r){return r.type===Un.deferred}function hs(r){return r.type===Un.error}function Ql(r){return(r&&r.type)===Un.redirect}function qQ(r){let s=r;return s&&typeof s=="object"&&typeof s.data=="object"&&typeof s.subscribe=="function"&&typeof s.cancel=="function"&&typeof s.resolveData=="function"}function qF(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.headers=="object"&&typeof r.body<"u"}function JQ(r){return OQ.has(r.toLowerCase())}function _o(r){return bQ.has(r.toLowerCase())}async function Cx(r,s,c,d,p,_){for(let g=0;g<c.length;g++){let R=c[g],I=s[g];if(!I)continue;let P=r.find(L=>L.route.id===I.route.id),k=P!=null&&!KF(P,I)&&(_&&_[I.route.id])!==void 0;if(Xl(R)&&(p||k)){let L=d[g];kt(L,"Expected an AbortSignal for revalidating fetcher deferred result"),await JF(R,L,p).then(x=>{x&&(c[g]=x||c[g])})}}}async function JF(r,s,c){if(c===void 0&&(c=!1),!await r.deferredData.resolveData(s)){if(c)try{return{type:Un.data,data:r.deferredData.unwrappedData}}catch(p){return{type:Un.error,error:p}}return{type:Un.data,data:r.deferredData.data}}}function vw(r){return new URLSearchParams(r).getAll("index").some(s=>s==="")}function rf(r,s){let c=typeof s=="string"?Ua(s).search:s.search;if(r[r.length-1].route.index&&vw(c||""))return r[r.length-1];let d=jF(r);return d[d.length-1]}function Ix(r){let{formMethod:s,formAction:c,formEncType:d,text:p,formData:_,json:g}=r;if(!(!s||!c||!d)){if(p!=null)return{formMethod:s,formAction:c,formEncType:d,formData:void 0,json:void 0,text:p};if(_!=null)return{formMethod:s,formAction:c,formEncType:d,formData:_,json:void 0,text:void 0};if(g!==void 0)return{formMethod:s,formAction:c,formEncType:d,formData:void 0,json:g,text:void 0}}}function GR(r,s){return s?{state:"loading",location:r,formMethod:s.formMethod,formAction:s.formAction,formEncType:s.formEncType,formData:s.formData,json:s.json,text:s.text}:{state:"loading",location:r,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function XQ(r,s){return{state:"submitting",location:r,formMethod:s.formMethod,formAction:s.formAction,formEncType:s.formEncType,formData:s.formData,json:s.json,text:s.text}}function qp(r,s){return r?{state:"loading",formMethod:r.formMethod,formAction:r.formAction,formEncType:r.formEncType,formData:r.formData,json:r.json,text:r.text,data:s}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:s}}function QQ(r,s){return{state:"submitting",formMethod:r.formMethod,formAction:r.formAction,formEncType:r.formEncType,formData:r.formData,json:r.json,text:r.text,data:s?s.data:void 0}}function Uc(r){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:r}}function $Q(r,s){try{let c=r.sessionStorage.getItem(HF);if(c){let d=JSON.parse(c);for(let[p,_]of Object.entries(d||{}))_&&Array.isArray(_)&&s.set(p,new Set(_||[]))}}catch{}}function ZQ(r,s){if(s.size>0){let c={};for(let[d,p]of s)c[d]=[...p];try{r.sessionStorage.setItem(HF,JSON.stringify(c))}catch(d){sh(!1,"Failed to save applied view transitions in sessionStorage ("+d+").")}}}/**
 * React Router v6.24.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Vf(){return Vf=Object.assign?Object.assign.bind():function(r){for(var s=1;s<arguments.length;s++){var c=arguments[s];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(r[d]=c[d])}return r},Vf.apply(this,arguments)}const Rv=Ce.createContext(null),XF=Ce.createContext(null),Cv=Ce.createContext(null),Iv=Ce.createContext(null),dh=Ce.createContext({outlet:null,matches:[],isDataRoute:!1}),QF=Ce.createContext(null);function wv(){return Ce.useContext(Iv)!=null}function $F(){return wv()||kt(!1),Ce.useContext(Iv).location}function ZF(r){Ce.useContext(Cv).static||Ce.useLayoutEffect(r)}function Sw(){let{isDataRoute:r}=Ce.useContext(dh);return r?u$():e$()}function e$(){wv()||kt(!1);let r=Ce.useContext(Rv),{basename:s,future:c,navigator:d}=Ce.useContext(Cv),{matches:p}=Ce.useContext(dh),{pathname:_}=$F(),g=JSON.stringify(BF(p,c.v7_relativeSplatPath)),R=Ce.useRef(!1);return ZF(()=>{R.current=!0}),Ce.useCallback(function(P,k){if(k===void 0&&(k={}),!R.current)return;if(typeof P=="number"){d.go(P);return}let L=GF(P,JSON.parse(g),_,k.relative==="path");r==null&&s!=="/"&&(L.pathname=L.pathname==="/"?s:Zc([s,L.pathname])),(k.replace?d.replace:d.push)(L,k.state,k)},[s,d,g,_,r])}function t$(r,s,c,d){wv()||kt(!1);let{navigator:p}=Ce.useContext(Cv),{matches:_}=Ce.useContext(dh),g=_[_.length-1],R=g?g.params:{};g&&g.pathname;let I=g?g.pathnameBase:"/";g&&g.route;let P=$F(),k;if(s){var L;let re=typeof s=="string"?Ua(s):s;I==="/"||(L=re.pathname)!=null&&L.startsWith(I)||kt(!1),k=re}else k=P;let x=k.pathname||"/",H=x;if(I!=="/"){let re=I.replace(/^\//,"").split("/");H="/"+x.replace(/^\//,"").split("/").slice(re.length).join("/")}let K=zl(r,{pathname:H}),ee=o$(K&&K.map(re=>Object.assign({},re,{params:Object.assign({},R,re.params),pathname:Zc([I,p.encodeLocation?p.encodeLocation(re.pathname).pathname:re.pathname]),pathnameBase:re.pathnameBase==="/"?I:Zc([I,p.encodeLocation?p.encodeLocation(re.pathnameBase).pathname:re.pathnameBase])})),_,c,d);return s&&ee?Ce.createElement(Iv.Provider,{value:{location:Vf({pathname:"/",search:"",hash:"",state:null,key:"default"},k),navigationType:Ti.Pop}},ee):ee}function n$(){let r=d$(),s=yv(r)?r.status+" "+r.statusText:r instanceof Error?r.message:JSON.stringify(r),c=r instanceof Error?r.stack:null,p={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return Ce.createElement(Ce.Fragment,null,Ce.createElement("h2",null,"Unexpected Application Error!"),Ce.createElement("h3",{style:{fontStyle:"italic"}},s),c?Ce.createElement("pre",{style:p},c):null,null)}const i$=Ce.createElement(n$,null);class r$ extends Ce.Component{constructor(s){super(s),this.state={location:s.location,revalidation:s.revalidation,error:s.error}}static getDerivedStateFromError(s){return{error:s}}static getDerivedStateFromProps(s,c){return c.location!==s.location||c.revalidation!=="idle"&&s.revalidation==="idle"?{error:s.error,location:s.location,revalidation:s.revalidation}:{error:s.error!==void 0?s.error:c.error,location:c.location,revalidation:s.revalidation||c.revalidation}}componentDidCatch(s,c){console.error("React Router caught the following error during render",s,c)}render(){return this.state.error!==void 0?Ce.createElement(dh.Provider,{value:this.props.routeContext},Ce.createElement(QF.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function s$(r){let{routeContext:s,match:c,children:d}=r,p=Ce.useContext(Rv);return p&&p.static&&p.staticContext&&(c.route.errorElement||c.route.ErrorBoundary)&&(p.staticContext._deepestRenderedBoundaryId=c.route.id),Ce.createElement(dh.Provider,{value:s},d)}function o$(r,s,c,d){var p;if(s===void 0&&(s=[]),c===void 0&&(c=null),d===void 0&&(d=null),r==null){var _;if((_=c)!=null&&_.errors)r=c.matches;else return null}let g=r,R=(p=c)==null?void 0:p.errors;if(R!=null){let k=g.findIndex(L=>L.route.id&&(R==null?void 0:R[L.route.id])!==void 0);k>=0||kt(!1),g=g.slice(0,Math.min(g.length,k+1))}let I=!1,P=-1;if(c&&d&&d.v7_partialHydration)for(let k=0;k<g.length;k++){let L=g[k];if((L.route.HydrateFallback||L.route.hydrateFallbackElement)&&(P=k),L.route.id){let{loaderData:x,errors:H}=c,K=L.route.loader&&x[L.route.id]===void 0&&(!H||H[L.route.id]===void 0);if(L.route.lazy||K){I=!0,P>=0?g=g.slice(0,P+1):g=[g[0]];break}}}return g.reduceRight((k,L,x)=>{let H,K=!1,ee=null,re=null;c&&(H=R&&L.route.id?R[L.route.id]:void 0,ee=L.route.errorElement||i$,I&&(P<0&&x===0?(h$("route-fallback",!1),K=!0,re=null):P===x&&(K=!0,re=L.route.hydrateFallbackElement||null)));let Y=s.concat(g.slice(0,x+1)),F=()=>{let z;return H?z=ee:K?z=re:L.route.Component?z=Ce.createElement(L.route.Component,null):L.route.element?z=L.route.element:z=k,Ce.createElement(s$,{match:L,routeContext:{outlet:k,matches:Y,isDataRoute:c!=null},children:z})};return c&&(L.route.ErrorBoundary||L.route.errorElement||x===0)?Ce.createElement(r$,{location:c.location,revalidation:c.revalidation,component:ee,error:H,children:F(),routeContext:{outlet:null,matches:Y,isDataRoute:!0}}):F()},null)}var e3=function(r){return r.UseBlocker="useBlocker",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r}(e3||{}),Jg=function(r){return r.UseBlocker="useBlocker",r.UseLoaderData="useLoaderData",r.UseActionData="useActionData",r.UseRouteError="useRouteError",r.UseNavigation="useNavigation",r.UseRouteLoaderData="useRouteLoaderData",r.UseMatches="useMatches",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r.UseRouteId="useRouteId",r}(Jg||{});function a$(r){let s=Ce.useContext(Rv);return s||kt(!1),s}function c$(r){let s=Ce.useContext(XF);return s||kt(!1),s}function l$(r){let s=Ce.useContext(dh);return s||kt(!1),s}function t3(r){let s=l$(),c=s.matches[s.matches.length-1];return c.route.id||kt(!1),c.route.id}function d$(){var r;let s=Ce.useContext(QF),c=c$(Jg.UseRouteError),d=t3(Jg.UseRouteError);return s!==void 0?s:(r=c.errors)==null?void 0:r[d]}function u$(){let{router:r}=a$(e3.UseNavigateStable),s=t3(Jg.UseNavigateStable),c=Ce.useRef(!1);return ZF(()=>{c.current=!0}),Ce.useCallback(function(p,_){_===void 0&&(_={}),c.current&&(typeof p=="number"?r.navigate(p):r.navigate(p,Vf({fromRouteId:s},_)))},[r,s])}const wx={};function h$(r,s,c){!s&&!wx[r]&&(wx[r]=!0)}function XC(r){kt(!1)}function p$(r){let{basename:s="/",children:c=null,location:d,navigationType:p=Ti.Pop,navigator:_,static:g=!1,future:R}=r;wv()&&kt(!1);let I=s.replace(/^\/*/,"/"),P=Ce.useMemo(()=>({basename:I,navigator:_,static:g,future:Vf({v7_relativeSplatPath:!1},R)}),[I,R,_,g]);typeof d=="string"&&(d=Ua(d));let{pathname:k="/",search:L="",hash:x="",state:H=null,key:K="default"}=d,ee=Ce.useMemo(()=>{let re=Xf(k,I);return re==null?null:{location:{pathname:re,search:L,hash:x,state:H,key:K},navigationType:p}},[I,k,L,x,H,K,p]);return ee==null?null:Ce.createElement(Cv.Provider,{value:P},Ce.createElement(Iv.Provider,{children:c,value:ee}))}new Promise(()=>{});function QC(r,s){s===void 0&&(s=[]);let c=[];return Ce.Children.forEach(r,(d,p)=>{if(!Ce.isValidElement(d))return;let _=[...s,p];if(d.type===Ce.Fragment){c.push.apply(c,QC(d.props.children,_));return}d.type!==XC&&kt(!1),!d.props.index||!d.props.children||kt(!1);let g={id:d.props.id||_.join("-"),caseSensitive:d.props.caseSensitive,element:d.props.element,Component:d.props.Component,index:d.props.index,path:d.props.path,loader:d.props.loader,action:d.props.action,errorElement:d.props.errorElement,ErrorBoundary:d.props.ErrorBoundary,hasErrorBoundary:d.props.ErrorBoundary!=null||d.props.errorElement!=null,shouldRevalidate:d.props.shouldRevalidate,handle:d.props.handle,lazy:d.props.lazy};d.props.children&&(g.children=QC(d.props.children,_)),c.push(g)}),c}function f$(r){let s={hasErrorBoundary:r.ErrorBoundary!=null||r.errorElement!=null};return r.Component&&Object.assign(s,{element:Ce.createElement(r.Component),Component:void 0}),r.HydrateFallback&&Object.assign(s,{hydrateFallbackElement:Ce.createElement(r.HydrateFallback),HydrateFallback:void 0}),r.ErrorBoundary&&Object.assign(s,{errorElement:Ce.createElement(r.ErrorBoundary),ErrorBoundary:void 0}),s}/**
 * React Router DOM v6.24.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Xg(){return Xg=Object.assign?Object.assign.bind():function(r){for(var s=1;s<arguments.length;s++){var c=arguments[s];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(r[d]=c[d])}return r},Xg.apply(this,arguments)}const m$="6";try{window.__reactRouterVersion=m$}catch{}function _$(r,s){return LQ({basename:s==null?void 0:s.basename,future:Xg({},s==null?void 0:s.future,{v7_prependBasename:!0}),history:rQ({window:s==null?void 0:s.window}),hydrationData:(s==null?void 0:s.hydrationData)||E$(),routes:r,mapRouteProperties:f$,unstable_dataStrategy:s==null?void 0:s.unstable_dataStrategy,unstable_patchRoutesOnMiss:s==null?void 0:s.unstable_patchRoutesOnMiss,window:s==null?void 0:s.window}).initialize()}function E$(){var r;let s=(r=window)==null?void 0:r.__staticRouterHydrationData;return s&&s.errors&&(s=Xg({},s,{errors:g$(s.errors)})),s}function g$(r){if(!r)return null;let s=Object.entries(r),c={};for(let[d,p]of s)if(p&&p.__type==="RouteErrorResponse")c[d]=new Ew(p.status,p.statusText,p.data,p.internal===!0);else if(p&&p.__type==="Error"){if(p.__subType){let _=window[p.__subType];if(typeof _=="function")try{let g=new _(p.message);g.stack="",c[d]=g}catch{}}if(c[d]==null){let _=new Error(p.message);_.stack="",c[d]=_}}else c[d]=p;return c}const v$=Ce.createContext({isTransitioning:!1}),S$=Ce.createContext(new Map),T$="startTransition",bx=zq[T$],y$="flushSync",Ax=iQ[y$];function R$(r){bx?bx(r):r()}function Jp(r){Ax?Ax(r):r()}class C${constructor(){this.status="pending",this.promise=new Promise((s,c)=>{this.resolve=d=>{this.status==="pending"&&(this.status="resolved",s(d))},this.reject=d=>{this.status==="pending"&&(this.status="rejected",c(d))}})}}function I$(r){let{fallbackElement:s,router:c,future:d}=r,[p,_]=Ce.useState(c.state),[g,R]=Ce.useState(),[I,P]=Ce.useState({isTransitioning:!1}),[k,L]=Ce.useState(),[x,H]=Ce.useState(),[K,ee]=Ce.useState(),re=Ce.useRef(new Map),{v7_startTransition:Y}=d||{},F=Ce.useCallback(fe=>{Y?R$(fe):fe()},[Y]),z=Ce.useCallback((fe,ae)=>{let{deletedFetchers:_e,unstable_flushSync:me,unstable_viewTransitionOpts:Ue}=ae;_e.forEach(lt=>re.current.delete(lt)),fe.fetchers.forEach((lt,Ge)=>{lt.data!==void 0&&re.current.set(Ge,lt.data)});let Ve=c.window==null||c.window.document==null||typeof c.window.document.startViewTransition!="function";if(!Ue||Ve){me?Jp(()=>_(fe)):F(()=>_(fe));return}if(me){Jp(()=>{x&&(k&&k.resolve(),x.skipTransition()),P({isTransitioning:!0,flushSync:!0,currentLocation:Ue.currentLocation,nextLocation:Ue.nextLocation})});let lt=c.window.document.startViewTransition(()=>{Jp(()=>_(fe))});lt.finished.finally(()=>{Jp(()=>{L(void 0),H(void 0),R(void 0),P({isTransitioning:!1})})}),Jp(()=>H(lt));return}x?(k&&k.resolve(),x.skipTransition(),ee({state:fe,currentLocation:Ue.currentLocation,nextLocation:Ue.nextLocation})):(R(fe),P({isTransitioning:!0,flushSync:!1,currentLocation:Ue.currentLocation,nextLocation:Ue.nextLocation}))},[c.window,x,k,re,F]);Ce.useLayoutEffect(()=>c.subscribe(z),[c,z]),Ce.useEffect(()=>{I.isTransitioning&&!I.flushSync&&L(new C$)},[I]),Ce.useEffect(()=>{if(k&&g&&c.window){let fe=g,ae=k.promise,_e=c.window.document.startViewTransition(async()=>{F(()=>_(fe)),await ae});_e.finished.finally(()=>{L(void 0),H(void 0),R(void 0),P({isTransitioning:!1})}),H(_e)}},[F,g,k,c.window]),Ce.useEffect(()=>{k&&g&&p.location.key===g.location.key&&k.resolve()},[k,x,p.location,g]),Ce.useEffect(()=>{!I.isTransitioning&&K&&(R(K.state),P({isTransitioning:!0,flushSync:!1,currentLocation:K.currentLocation,nextLocation:K.nextLocation}),ee(void 0))},[I.isTransitioning,K]),Ce.useEffect(()=>{},[]);let le=Ce.useMemo(()=>({createHref:c.createHref,encodeLocation:c.encodeLocation,go:fe=>c.navigate(fe),push:(fe,ae,_e)=>c.navigate(fe,{state:ae,preventScrollReset:_e==null?void 0:_e.preventScrollReset}),replace:(fe,ae,_e)=>c.navigate(fe,{replace:!0,state:ae,preventScrollReset:_e==null?void 0:_e.preventScrollReset})}),[c]),ge=c.basename||"/",Z=Ce.useMemo(()=>({router:c,navigator:le,static:!1,basename:ge}),[c,le,ge]);return Ce.createElement(Ce.Fragment,null,Ce.createElement(Rv.Provider,{value:Z},Ce.createElement(XF.Provider,{value:p},Ce.createElement(S$.Provider,{value:re.current},Ce.createElement(v$.Provider,{value:I},Ce.createElement(p$,{basename:ge,location:p.location,navigationType:p.historyAction,navigator:le,future:{v7_relativeSplatPath:c.future.v7_relativeSplatPath}},p.initialized||c.future.v7_partialHydration?Ce.createElement(w$,{routes:c.routes,future:c.future,state:p}):s))))),null)}function w$(r){let{routes:s,future:c,state:d}=r;return t$(s,void 0,d,c)}var Ox;(function(r){r.UseScrollRestoration="useScrollRestoration",r.UseSubmit="useSubmit",r.UseSubmitFetcher="useSubmitFetcher",r.UseFetcher="useFetcher",r.useViewTransitionState="useViewTransitionState"})(Ox||(Ox={}));var Nx;(function(r){r.UseFetcher="useFetcher",r.UseFetchers="useFetchers",r.UseScrollRestoration="useScrollRestoration"})(Nx||(Nx={}));var n3={exports:{}};(function(r,s){(function(c,d){r.exports=d()})(RE,function(){function c(n,e){return e.forEach(function(t){t&&typeof t!="string"&&!Array.isArray(t)&&Object.keys(t).forEach(function(i){if(i!=="default"&&!(i in n)){var o=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(n,i,o.get?o:{enumerable:!0,get:function(){return t[i]}})}})}),Object.freeze(n)}var d=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof RE<"u"?RE:typeof self<"u"?self:{};function p(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var _=function(n){try{return!!n()}catch{return!0}},g=!_(function(){var n=(function(){}).bind();return typeof n!="function"||n.hasOwnProperty("prototype")}),R=g,I=Function.prototype,P=I.call,k=R&&I.bind.bind(P,P),L=R?k:function(n){return function(){return P.apply(n,arguments)}},x=L({}.isPrototypeOf),H=function(n){return n&&n.Math==Math&&n},K=H(typeof globalThis=="object"&&globalThis)||H(typeof window=="object"&&window)||H(typeof self=="object"&&self)||H(typeof d=="object"&&d)||function(){return this}()||d||Function("return this")(),ee=g,re=Function.prototype,Y=re.apply,F=re.call,z=typeof Reflect=="object"&&Reflect.apply||(ee?F.bind(Y):function(){return F.apply(Y,arguments)}),le=L,ge=le({}.toString),Z=le("".slice),fe=function(n){return Z(ge(n),8,-1)},ae=fe,_e=L,me=function(n){if(ae(n)==="Function")return _e(n)},Ue=typeof document=="object"&&document.all,Ve={all:Ue,IS_HTMLDDA:Ue===void 0&&Ue!==void 0},lt=Ve.all,Ge=Ve.IS_HTMLDDA?function(n){return typeof n=="function"||n===lt}:function(n){return typeof n=="function"},Mt={},Zt=!_(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Ft=g,xe=Function.prototype.call,We=Ft?xe.bind(xe):function(){return xe.apply(xe,arguments)},ct={},gt={}.propertyIsEnumerable,En=Object.getOwnPropertyDescriptor,vs=En&&!gt.call({1:2},1);ct.f=vs?function(n){var e=En(this,n);return!!e&&e.enumerable}:gt;var An,tr,zn=function(n,e){return{enumerable:!(1&n),configurable:!(2&n),writable:!(4&n),value:e}},Fa=_,ph=fe,fh=Object,kv=L("".split),ud=Fa(function(){return!fh("z").propertyIsEnumerable(0)})?function(n){return ph(n)=="String"?kv(n,""):fh(n)}:fh,ki=function(n){return n==null},ja=ki,tm=TypeError,ll=function(n){if(ja(n))throw tm("Can't call method on "+n);return n},$o=ud,Lv=ll,Zo=function(n){return $o(Lv(n))},mh=Ge,Mv=Ve.all,_r=Ve.IS_HTMLDDA?function(n){return typeof n=="object"?n!==null:mh(n)||n===Mv}:function(n){return typeof n=="object"?n!==null:mh(n)},Ss={},_h=Ss,ea=K,dl=Ge,Eh=function(n){return dl(n)?n:void 0},Li=function(n,e){return arguments.length<2?Eh(_h[n])||Eh(ea[n]):_h[n]&&_h[n][e]||ea[n]&&ea[n][e]},nr=typeof navigator<"u"&&String(navigator.userAgent)||"",Ts=K,hd=nr,ul=Ts.process,nm=Ts.Deno,Qs=ul&&ul.versions||nm&&nm.version,gh=Qs&&Qs.v8;gh&&(tr=(An=gh.split("."))[0]>0&&An[0]<4?1:+(An[0]+An[1])),!tr&&hd&&(!(An=hd.match(/Edge\/(\d+)/))||An[1]>=74)&&(An=hd.match(/Chrome\/(\d+)/))&&(tr=+An[1]);var Ro=tr,vh=Ro,xv=_,im=K.String,$s=!!Object.getOwnPropertySymbols&&!xv(function(){var n=Symbol();return!im(n)||!(Object(n)instanceof Symbol)||!Symbol.sham&&vh&&vh<41}),Sh=$s&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Th=Li,pd=Ge,yh=x,Uv=Object,Ba=Sh?function(n){return typeof n=="symbol"}:function(n){var e=Th("Symbol");return pd(e)&&yh(e.prototype,Uv(n))},Vv=String,ta=function(n){try{return Vv(n)}catch{return"Object"}},rm=Ge,fd=ta,Fv=TypeError,te=function(n){if(rm(n))return n;throw Fv(fd(n)+" is not a function")},oe=te,pe=ki,Re=function(n,e){var t=n[e];return pe(t)?void 0:oe(t)},Be=We,$e=Ge,dt=_r,Fe=TypeError,yt={exports:{}},Ze=K,Ct=Object.defineProperty,ln=function(n,e){try{Ct(Ze,n,{value:e,configurable:!0,writable:!0})}catch{Ze[n]=e}return e},Jt="__core-js_shared__",on=K[Jt]||ln(Jt,{}),en=on;(yt.exports=function(n,e){return en[n]||(en[n]=e!==void 0?e:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Yn=yt.exports,di=ll,hl=Object,Mi=function(n){return hl(di(n))},Ga=Mi,Wa=L({}.hasOwnProperty),Fn=Object.hasOwn||function(n,e){return Wa(Ga(n),e)},ys=L,md=0,_d=Math.random(),Ed=ys(1 .toString),It=function(n){return"Symbol("+(n===void 0?"":n)+")_"+Ed(++md+_d,36)},qn=Yn,ir=Fn,gn=It,Zs=$s,sm=Sh,Ha=K.Symbol,jv=qn("wks"),ij=sm?Ha.for||Ha:Ha&&Ha.withoutSetter||gn,On=function(n){return ir(jv,n)||(jv[n]=Zs&&ir(Ha,n)?Ha[n]:ij("Symbol."+n)),jv[n]},rj=We,Gw=_r,Ww=Ba,sj=Re,oj=function(n,e){var t,i;if(e==="string"&&$e(t=n.toString)&&!dt(i=Be(t,n))||$e(t=n.valueOf)&&!dt(i=Be(t,n))||e!=="string"&&$e(t=n.toString)&&!dt(i=Be(t,n)))return i;throw Fe("Can't convert object to primitive value")},aj=TypeError,cj=On("toPrimitive"),lj=function(n,e){if(!Gw(n)||Ww(n))return n;var t,i=sj(n,cj);if(i){if(e===void 0&&(e="default"),t=rj(i,n,e),!Gw(t)||Ww(t))return t;throw aj("Can't convert object to primitive value")}return e===void 0&&(e="number"),oj(n,e)},dj=Ba,om=function(n){var e=lj(n,"string");return dj(e)?e:e+""},Hw=_r,Bv=K.document,uj=Hw(Bv)&&Hw(Bv.createElement),Gv=function(n){return uj?Bv.createElement(n):{}},hj=Gv,Kw=!Zt&&!_(function(){return Object.defineProperty(hj("div"),"a",{get:function(){return 7}}).a!=7}),pj=Zt,fj=We,mj=ct,_j=zn,Ej=Zo,gj=om,vj=Fn,Sj=Kw,zw=Object.getOwnPropertyDescriptor;Mt.f=pj?zw:function(n,e){if(n=Ej(n),e=gj(e),Sj)try{return zw(n,e)}catch{}if(vj(n,e))return _j(!fj(mj.f,n,e),n[e])};var Tj=_,yj=Ge,Rj=/#|\.prototype\./,Rh=function(n,e){var t=Ij[Cj(n)];return t==bj||t!=wj&&(yj(e)?Tj(e):!!e)},Cj=Rh.normalize=function(n){return String(n).replace(Rj,".").toLowerCase()},Ij=Rh.data={},wj=Rh.NATIVE="N",bj=Rh.POLYFILL="P",Yw=Rh,Aj=te,Oj=g,Nj=me(me.bind),Ka=function(n,e){return Aj(n),e===void 0?n:Oj?Nj(n,e):function(){return n.apply(e,arguments)}},Rs={},qw=Zt&&_(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),Pj=_r,Dj=String,kj=TypeError,$r=function(n){if(Pj(n))return n;throw kj(Dj(n)+" is not an object")},Lj=Zt,Mj=Kw,xj=qw,am=$r,Jw=om,Uj=TypeError,Wv=Object.defineProperty,Vj=Object.getOwnPropertyDescriptor,Hv="enumerable",Kv="configurable",zv="writable";Rs.f=Lj?xj?function(n,e,t){if(am(n),e=Jw(e),am(t),typeof n=="function"&&e==="prototype"&&"value"in t&&zv in t&&!t[zv]){var i=Vj(n,e);i&&i[zv]&&(n[e]=t.value,t={configurable:Kv in t?t[Kv]:i[Kv],enumerable:Hv in t?t[Hv]:i[Hv],writable:!1})}return Wv(n,e,t)}:Wv:function(n,e,t){if(am(n),e=Jw(e),am(t),Mj)try{return Wv(n,e,t)}catch{}if("get"in t||"set"in t)throw Uj("Accessors not supported");return"value"in t&&(n[e]=t.value),n};var Fj=Rs,jj=zn,za=Zt?function(n,e,t){return Fj.f(n,e,jj(1,t))}:function(n,e,t){return n[e]=t,n},cm=K,Bj=z,Gj=me,Wj=Ge,Hj=Mt.f,Kj=Yw,gd=Ss,zj=Ka,vd=za,Xw=Fn,Yj=function(n){var e=function(t,i,o){if(this instanceof e){switch(arguments.length){case 0:return new n;case 1:return new n(t);case 2:return new n(t,i)}return new n(t,i,o)}return Bj(n,this,arguments)};return e.prototype=n.prototype,e},Xt=function(n,e){var t,i,o,a,l,u,h,f,m,E=n.target,v=n.global,T=n.stat,A=n.proto,C=v?cm:T?cm[E]:(cm[E]||{}).prototype,b=v?gd:gd[E]||vd(gd,E,{})[E],D=b.prototype;for(a in e)i=!(t=Kj(v?a:E+(T?".":"#")+a,n.forced))&&C&&Xw(C,a),u=b[a],i&&(h=n.dontCallGetSet?(m=Hj(C,a))&&m.value:C[a]),l=i&&h?h:e[a],i&&typeof u==typeof l||(f=n.bind&&i?zj(l,cm):n.wrap&&i?Yj(l):A&&Wj(l)?Gj(l):l,(n.sham||l&&l.sham||u&&u.sham)&&vd(f,"sham",!0),vd(b,a,f),A&&(Xw(gd,o=E+"Prototype")||vd(gd,o,{}),vd(gd[o],a,l),n.real&&D&&(t||!D[a])&&vd(D,a,l)))},qj=Math.ceil,Jj=Math.floor,Xj=Math.trunc||function(n){var e=+n;return(e>0?Jj:qj)(e)},Yv=function(n){var e=+n;return e!=e||e===0?0:Xj(e)},Qj=Yv,$j=Math.max,Zj=Math.min,Qw=function(n,e){var t=Qj(n);return t<0?$j(t+e,0):Zj(t,e)},eB=Yv,tB=Math.min,nB=function(n){return n>0?tB(eB(n),9007199254740991):0},Ya=function(n){return nB(n.length)},iB=Zo,rB=Qw,sB=Ya,$w=function(n){return function(e,t,i){var o,a=iB(e),l=sB(a),u=rB(i,l);if(n&&t!=t){for(;l>u;)if((o=a[u++])!=o)return!0}else for(;l>u;u++)if((n||u in a)&&a[u]===t)return n||u||0;return!n&&-1}},qv={includes:$w(!0),indexOf:$w(!1)},oB=qv.includes;Xt({target:"Array",proto:!0,forced:_(function(){return!Array(1).includes()})},{includes:function(n){return oB(this,n,arguments.length>1?arguments[1]:void 0)}});var aB=Ss,qa=function(n){return aB[n+"Prototype"]},cB=qa("Array").includes,lB=_r,dB=fe,uB=On("match"),hB=function(n){var e;return lB(n)&&((e=n[uB])!==void 0?!!e:dB(n)=="RegExp")},pB=TypeError,Zw={};Zw[On("toStringTag")]="z";var Jv=String(Zw)==="[object z]",fB=Jv,mB=Ge,lm=fe,_B=On("toStringTag"),EB=Object,gB=lm(function(){return arguments}())=="Arguments",Ja=fB?lm:function(n){var e,t,i;return n===void 0?"Undefined":n===null?"Null":typeof(t=function(o,a){try{return o[a]}catch{}}(e=EB(n),_B))=="string"?t:gB?lm(e):(i=lm(e))=="Object"&&mB(e.callee)?"Arguments":i},vB=Ja,SB=String,Cs=function(n){if(vB(n)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return SB(n)},TB=On("match"),yB=Xt,RB=function(n){if(hB(n))throw pB("The method doesn't accept regular expressions");return n},CB=ll,eb=Cs,IB=function(n){var e=/./;try{"/./"[n](e)}catch{try{return e[TB]=!1,"/./"[n](e)}catch{}}return!1},wB=L("".indexOf);yB({target:"String",proto:!0,forced:!IB("includes")},{includes:function(n){return!!~wB(eb(CB(this)),eb(RB(n)),arguments.length>1?arguments[1]:void 0)}});var bB=qa("String").includes,tb=x,AB=cB,OB=bB,Xv=Array.prototype,Qv=String.prototype,Ie=p(function(n){var e=n.includes;return n===Xv||tb(Xv,n)&&e===Xv.includes?AB:typeof n=="string"||n===Qv||tb(Qv,n)&&e===Qv.includes?OB:e});let nb=!0,ib=!0;function dm(n,e,t){const i=n.match(e);return i&&i.length>=t&&parseInt(i[t],10)}function pl(n,e,t){if(!n.RTCPeerConnection)return;const i=n.RTCPeerConnection.prototype,o=i.addEventListener;i.addEventListener=function(l,u){if(l!==e)return o.apply(this,arguments);const h=f=>{const m=t(f);m&&(u.handleEvent?u.handleEvent(m):u(m))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(u,h),o.apply(this,[l,h])};const a=i.removeEventListener;i.removeEventListener=function(l,u){if(l!==e||!this._eventMap||!this._eventMap[e])return a.apply(this,arguments);if(!this._eventMap[e].has(u))return a.apply(this,arguments);const h=this._eventMap[e].get(u);return this._eventMap[e].delete(u),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,a.apply(this,[l,h])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(l){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),l&&this.addEventListener(e,this["_on"+e]=l)},enumerable:!0,configurable:!0})}function NB(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(nb=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function PB(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(ib=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function rb(){if(typeof window=="object"){if(nb)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function $v(n,e){ib&&console.warn(n+" is deprecated, please use "+e+" instead.")}function sb(n){return Object.prototype.toString.call(n)==="[object Object]"}function ob(n){return sb(n)?Object.keys(n).reduce(function(e,t){const i=sb(n[t]),o=i?ob(n[t]):n[t],a=i&&!Object.keys(o).length;return o===void 0||a?e:Object.assign(e,{[t]:o})},{}):n}function Zv(n,e,t){e&&!t.has(e.id)&&(t.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?Zv(n,n.get(e[i]),t):i.endsWith("Ids")&&e[i].forEach(o=>{Zv(n,n.get(o),t)})}))}function ab(n,e,t){const i=t?"outbound-rtp":"inbound-rtp",o=new Map;if(e===null)return o;const a=[];return n.forEach(l=>{l.type==="track"&&l.trackIdentifier===e.id&&a.push(l)}),a.forEach(l=>{n.forEach(u=>{u.type===i&&u.trackId===l.id&&Zv(n,u,o)})}),o}const cb=rb;function lb(n,e){const t=n&&n.navigator;if(!t.mediaDevices)return;const i=function(l){if(typeof l!="object"||l.mandatory||l.optional)return l;const u={};return Object.keys(l).forEach(h=>{if(h==="require"||h==="advanced"||h==="mediaSource")return;const f=typeof l[h]=="object"?l[h]:{ideal:l[h]};f.exact!==void 0&&typeof f.exact=="number"&&(f.min=f.max=f.exact);const m=function(E,v){return E?E+v.charAt(0).toUpperCase()+v.slice(1):v==="deviceId"?"sourceId":v};if(f.ideal!==void 0){u.optional=u.optional||[];let E={};typeof f.ideal=="number"?(E[m("min",h)]=f.ideal,u.optional.push(E),E={},E[m("max",h)]=f.ideal,u.optional.push(E)):(E[m("",h)]=f.ideal,u.optional.push(E))}f.exact!==void 0&&typeof f.exact!="number"?(u.mandatory=u.mandatory||{},u.mandatory[m("",h)]=f.exact):["min","max"].forEach(E=>{f[E]!==void 0&&(u.mandatory=u.mandatory||{},u.mandatory[m(E,h)]=f[E])})}),l.advanced&&(u.optional=(u.optional||[]).concat(l.advanced)),u},o=function(l,u){if(e.version>=61)return u(l);if((l=JSON.parse(JSON.stringify(l)))&&typeof l.audio=="object"){const h=function(f,m,E){m in f&&!(E in f)&&(f[E]=f[m],delete f[m])};h((l=JSON.parse(JSON.stringify(l))).audio,"autoGainControl","googAutoGainControl"),h(l.audio,"noiseSuppression","googNoiseSuppression"),l.audio=i(l.audio)}if(l&&typeof l.video=="object"){let h=l.video.facingMode;h=h&&(typeof h=="object"?h:{ideal:h});const f=e.version<66;if(h&&(h.exact==="user"||h.exact==="environment"||h.ideal==="user"||h.ideal==="environment")&&(!t.mediaDevices.getSupportedConstraints||!t.mediaDevices.getSupportedConstraints().facingMode||f)){let m;if(delete l.video.facingMode,h.exact==="environment"||h.ideal==="environment"?m=["back","rear"]:h.exact!=="user"&&h.ideal!=="user"||(m=["front"]),m)return t.mediaDevices.enumerateDevices().then(E=>{let v=(E=E.filter(T=>T.kind==="videoinput")).find(T=>m.some(A=>T.label.toLowerCase().includes(A)));return!v&&E.length&&m.includes("back")&&(v=E[E.length-1]),v&&(l.video.deviceId=h.exact?{exact:v.deviceId}:{ideal:v.deviceId}),l.video=i(l.video),cb("chrome: "+JSON.stringify(l)),u(l)})}l.video=i(l.video)}return cb("chrome: "+JSON.stringify(l)),u(l)},a=function(l){return e.version>=64?l:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[l.name]||l.name,message:l.message,constraint:l.constraint||l.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(t.getUserMedia=(function(l,u,h){o(l,f=>{t.webkitGetUserMedia(f,u,m=>{h&&h(a(m))})})}).bind(t),t.mediaDevices.getUserMedia){const l=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(u){return o(u,h=>l(h).then(f=>{if(h.audio&&!f.getAudioTracks().length||h.video&&!f.getVideoTracks().length)throw f.getTracks().forEach(m=>{m.stop()}),new DOMException("","NotFoundError");return f},f=>Promise.reject(a(f))))}}}function db(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function ub(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",i=>{let o;o=n.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(l=>l.track&&l.track.id===i.track.id):{track:i.track};const a=new Event("track");a.track=i.track,a.receiver=o,a.transceiver={receiver:o},a.streams=[t.stream],this.dispatchEvent(a)}),t.stream.getTracks().forEach(i=>{let o;o=n.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(l=>l.track&&l.track.id===i.id):{track:i};const a=new Event("track");a.track=i,a.receiver=o,a.transceiver={receiver:o},a.streams=[t.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else pl(n,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function hb(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){const e=function(o,a){return{track:a,get dtmf(){return this._dtmf===void 0&&(a.kind==="audio"?this._dtmf=o.createDTMFSender(a):this._dtmf=null),this._dtmf},_pc:o}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const o=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(l,u){let h=o.apply(this,arguments);return h||(h=e(this,l),this._senders.push(h)),h};const a=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(l){a.apply(this,arguments);const u=this._senders.indexOf(l);u!==-1&&this._senders.splice(u,1)}}const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],t.apply(this,[o]),o.getTracks().forEach(a=>{this._senders.push(e(this,a))})};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],i.apply(this,[o]),o.getTracks().forEach(a=>{const l=this._senders.find(u=>u.track===a);l&&this._senders.splice(this._senders.indexOf(l),1)})}}else if(typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){const e=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){const t=e.apply(this,[]);return t.forEach(i=>i._pc=this),t},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function pb(n){if(!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[t,i,o]=arguments;if(arguments.length>0&&typeof t=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof t!="function"))return e.apply(this,[]);const a=function(u){const h={};return u.result().forEach(f=>{const m={id:f.id,timestamp:f.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[f.type]||f.type};f.names().forEach(E=>{m[E]=f.stat(E)}),h[m.id]=m}),h},l=function(u){return new Map(Object.keys(u).map(h=>[h,u[h]]))};if(arguments.length>=2){const u=function(h){i(l(a(h)))};return e.apply(this,[u,t])}return new Promise((u,h)=>{e.apply(this,[function(f){u(l(a(f)))},h])}).then(i,o)}}function fb(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){const t=n.RTCPeerConnection.prototype.getSenders;t&&(n.RTCPeerConnection.prototype.getSenders=function(){const o=t.apply(this,[]);return o.forEach(a=>a._pc=this),o});const i=n.RTCPeerConnection.prototype.addTrack;i&&(n.RTCPeerConnection.prototype.addTrack=function(){const o=i.apply(this,arguments);return o._pc=this,o}),n.RTCRtpSender.prototype.getStats=function(){const o=this;return this._pc.getStats().then(a=>ab(a,o.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){const t=n.RTCPeerConnection.prototype.getReceivers;t&&(n.RTCPeerConnection.prototype.getReceivers=function(){const i=t.apply(this,[]);return i.forEach(o=>o._pc=this),i}),pl(n,"track",i=>(i.receiver._pc=i.srcElement,i)),n.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(o=>ab(o,i.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype)||!("getStats"in n.RTCRtpReceiver.prototype))return;const e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){const t=arguments[0];let i,o,a;return this.getSenders().forEach(l=>{l.track===t&&(i?a=!0:i=l)}),this.getReceivers().forEach(l=>(l.track===t&&(o?a=!0:o=l),l.track===t)),a||i&&o?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():o?o.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function mb(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(a,l){if(!l)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const u=e.apply(this,arguments);return this._shimmedLocalStreams[l.id]?this._shimmedLocalStreams[l.id].indexOf(u)===-1&&this._shimmedLocalStreams[l.id].push(u):this._shimmedLocalStreams[l.id]=[l,u],u};const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(h=>{if(this.getSenders().find(f=>f.track===h))throw new DOMException("Track already exists.","InvalidAccessError")});const l=this.getSenders();t.apply(this,arguments);const u=this.getSenders().filter(h=>l.indexOf(h)===-1);this._shimmedLocalStreams[a.id]=[a].concat(u)};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],i.apply(this,arguments)};const o=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(l=>{const u=this._shimmedLocalStreams[l].indexOf(a);u!==-1&&this._shimmedLocalStreams[l].splice(u,1),this._shimmedLocalStreams[l].length===1&&delete this._shimmedLocalStreams[l]}),o.apply(this,arguments)}}function _b(n,e){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&e.version>=65)return mb(n);const t=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){const h=t.apply(this);return this._reverseStreams=this._reverseStreams||{},h.map(f=>this._reverseStreams[f.id])};const i=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(h){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},h.getTracks().forEach(f=>{if(this.getSenders().find(m=>m.track===f))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[h.id]){const f=new n.MediaStream(h.getTracks());this._streams[h.id]=f,this._reverseStreams[f.id]=h,h=f}i.apply(this,[h])};const o=n.RTCPeerConnection.prototype.removeStream;function a(h,f){let m=f.sdp;return Object.keys(h._reverseStreams||[]).forEach(E=>{const v=h._reverseStreams[E],T=h._streams[v.id];m=m.replace(new RegExp(T.id,"g"),v.id)}),new RTCSessionDescription({type:f.type,sdp:m})}n.RTCPeerConnection.prototype.removeStream=function(h){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[h.id]||h]),delete this._reverseStreams[this._streams[h.id]?this._streams[h.id].id:h.id],delete this._streams[h.id]},n.RTCPeerConnection.prototype.addTrack=function(h,f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const m=[].slice.call(arguments,1);if(m.length!==1||!m[0].getTracks().find(v=>v===h))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(v=>v.track===h))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const E=this._streams[f.id];if(E)E.addTrack(h),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const v=new n.MediaStream([h]);this._streams[f.id]=v,this._reverseStreams[v.id]=f,this.addStream(v)}return this.getSenders().find(v=>v.track===h)},["createOffer","createAnswer"].forEach(function(h){const f=n.RTCPeerConnection.prototype[h],m={[h](){const E=arguments;return arguments.length&&typeof arguments[0]=="function"?f.apply(this,[v=>{const T=a(this,v);E[0].apply(null,[T])},v=>{E[1]&&E[1].apply(null,v)},arguments[2]]):f.apply(this,arguments).then(v=>a(this,v))}};n.RTCPeerConnection.prototype[h]=m[h]});const l=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(h,f){let m=f.sdp;return Object.keys(h._reverseStreams||[]).forEach(E=>{const v=h._reverseStreams[E],T=h._streams[v.id];m=m.replace(new RegExp(v.id,"g"),T.id)}),new RTCSessionDescription({type:f.type,sdp:m})}(this,arguments[0]),l.apply(this,arguments)):l.apply(this,arguments)};const u=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){const h=u.get.apply(this);return h.type===""?h:a(this,h)}}),n.RTCPeerConnection.prototype.removeTrack=function(h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!h._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(h._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let f;this._streams=this._streams||{},Object.keys(this._streams).forEach(m=>{this._streams[m].getTracks().find(E=>h.track===E)&&(f=this._streams[m])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(h.track),this.dispatchEvent(new Event("negotiationneeded")))}}function eS(n,e){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const i=n.RTCPeerConnection.prototype[t],o={[t](){return arguments[0]=new(t==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};n.RTCPeerConnection.prototype[t]=o[t]})}function Eb(n,e){pl(n,"negotiationneeded",t=>{const i=t.target;if(!(e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")||i.signalingState==="stable")return t})}var gb=Object.freeze({__proto__:null,fixNegotiationNeeded:Eb,shimAddTrackRemoveTrack:_b,shimAddTrackRemoveTrackWithNative:mb,shimGetDisplayMedia:function(n,e){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(typeof e=="function"?n.navigator.mediaDevices.getDisplayMedia=function(t){return e(t).then(i=>{const o=t.video&&t.video.width,a=t.video&&t.video.height,l=t.video&&t.video.frameRate;return t.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:l||3}},o&&(t.video.mandatory.maxWidth=o),a&&(t.video.mandatory.maxHeight=a),n.navigator.mediaDevices.getUserMedia(t)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:hb,shimGetStats:pb,shimGetUserMedia:lb,shimMediaStream:db,shimOnTrack:ub,shimPeerConnection:eS,shimSenderReceiverGetStats:fb});function vb(n,e){const t=n&&n.navigator,i=n&&n.MediaStreamTrack;if(t.getUserMedia=function(o,a,l){$v("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),t.mediaDevices.getUserMedia(o).then(a,l)},!(e.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints())){const o=function(l,u,h){u in l&&!(h in l)&&(l[h]=l[u],delete l[u])},a=t.mediaDevices.getUserMedia.bind(t.mediaDevices);if(t.mediaDevices.getUserMedia=function(l){return typeof l=="object"&&typeof l.audio=="object"&&(l=JSON.parse(JSON.stringify(l)),o(l.audio,"autoGainControl","mozAutoGainControl"),o(l.audio,"noiseSuppression","mozNoiseSuppression")),a(l)},i&&i.prototype.getSettings){const l=i.prototype.getSettings;i.prototype.getSettings=function(){const u=l.apply(this,arguments);return o(u,"mozAutoGainControl","autoGainControl"),o(u,"mozNoiseSuppression","noiseSuppression"),u}}if(i&&i.prototype.applyConstraints){const l=i.prototype.applyConstraints;i.prototype.applyConstraints=function(u){return this.kind==="audio"&&typeof u=="object"&&(u=JSON.parse(JSON.stringify(u)),o(u,"autoGainControl","mozAutoGainControl"),o(u,"noiseSuppression","mozNoiseSuppression")),l.apply(this,[u])}}}}function Sb(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function tS(n,e){if(typeof n!="object"||!n.RTCPeerConnection&&!n.mozRTCPeerConnection)return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(o){const a=n.RTCPeerConnection.prototype[o],l={[o](){return arguments[0]=new(o==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};n.RTCPeerConnection.prototype[o]=l[o]});const t={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[o,a,l]=arguments;return i.apply(this,[o||null]).then(u=>{if(e.version<53&&!a)try{u.forEach(h=>{h.type=t[h.type]||h.type})}catch(h){if(h.name!=="TypeError")throw h;u.forEach((f,m)=>{u.set(m,Object.assign({},f,{type:t[f.type]||f.type}))})}return u}).then(a,l)}}function Tb(n){if(typeof n!="object"||!n.RTCPeerConnection||!n.RTCRtpSender||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;const e=n.RTCPeerConnection.prototype.getSenders;e&&(n.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(o=>o._pc=this),i});const t=n.RTCPeerConnection.prototype.addTrack;t&&(n.RTCPeerConnection.prototype.addTrack=function(){const i=t.apply(this,arguments);return i._pc=this,i}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function yb(n){if(typeof n!="object"||!n.RTCPeerConnection||!n.RTCRtpSender||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;const e=n.RTCPeerConnection.prototype.getReceivers;e&&(n.RTCPeerConnection.prototype.getReceivers=function(){const t=e.apply(this,[]);return t.forEach(i=>i._pc=this),t}),pl(n,"track",t=>(t.receiver._pc=t.srcElement,t)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Rb(n){n.RTCPeerConnection&&!("removeStream"in n.RTCPeerConnection.prototype)&&(n.RTCPeerConnection.prototype.removeStream=function(e){$v("removeStream","removeTrack"),this.getSenders().forEach(t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)})})}function Cb(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function Ib(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype.addTransceiver;e&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let t=arguments[1]&&arguments[1].sendEncodings;t===void 0&&(t=[]),t=[...t];const i=t.length>0;i&&t.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const o=e.apply(this,arguments);if(i){const{sender:a}=o,l=a.getParameters();(!("encodings"in l)||l.encodings.length===1&&Object.keys(l.encodings[0]).length===0)&&(l.encodings=t,a.sendEncodings=t,this.setParametersPromises.push(a.setParameters(l).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return o})}function wb(n){if(typeof n!="object"||!n.RTCRtpSender)return;const e=n.RTCRtpSender.prototype.getParameters;e&&(n.RTCRtpSender.prototype.getParameters=function(){const t=e.apply(this,arguments);return"encodings"in t||(t.encodings=[].concat(this.sendEncodings||[{}])),t})}function bb(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function Ab(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var Ob=Object.freeze({__proto__:null,shimAddTransceiver:Ib,shimCreateAnswer:Ab,shimCreateOffer:bb,shimGetDisplayMedia:function(n,e){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(t){if(!t||!t.video){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return t.video===!0?t.video={mediaSource:e}:t.video.mediaSource=e,n.navigator.mediaDevices.getUserMedia(t)})},shimGetParameters:wb,shimGetUserMedia:vb,shimOnTrack:Sb,shimPeerConnection:tS,shimRTCDataChannel:Cb,shimReceiverGetStats:yb,shimRemoveStream:Rb,shimSenderGetStats:Tb});function Nb(n){if(typeof n=="object"&&n.RTCPeerConnection){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(t){this._localStreams||(this._localStreams=[]),this._localStreams.includes(t)||this._localStreams.push(t),t.getAudioTracks().forEach(i=>e.call(this,i,t)),t.getVideoTracks().forEach(i=>e.call(this,i,t))},n.RTCPeerConnection.prototype.addTrack=function(t,...i){return i&&i.forEach(o=>{this._localStreams?this._localStreams.includes(o)||this._localStreams.push(o):this._localStreams=[o]}),e.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(t===-1)return;this._localStreams.splice(t,1);const i=e.getTracks();this.getSenders().forEach(o=>{i.includes(o.track)&&this.removeTrack(o)})})}}function Pb(n){if(typeof n=="object"&&n.RTCPeerConnection&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(o=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(o))return;this._remoteStreams.push(o);const a=new Event("addstream");a.stream=o,this.dispatchEvent(a)})})}});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){const t=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(o=>{if(t._remoteStreams||(t._remoteStreams=[]),t._remoteStreams.indexOf(o)>=0)return;t._remoteStreams.push(o);const a=new Event("addstream");a.stream=o,t.dispatchEvent(a)})}),e.apply(t,arguments)}}}function Db(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype,t=e.createOffer,i=e.createAnswer,o=e.setLocalDescription,a=e.setRemoteDescription,l=e.addIceCandidate;e.createOffer=function(h,f){const m=arguments.length>=2?arguments[2]:arguments[0],E=t.apply(this,[m]);return f?(E.then(h,f),Promise.resolve()):E},e.createAnswer=function(h,f){const m=arguments.length>=2?arguments[2]:arguments[0],E=i.apply(this,[m]);return f?(E.then(h,f),Promise.resolve()):E};let u=function(h,f,m){const E=o.apply(this,[h]);return m?(E.then(f,m),Promise.resolve()):E};e.setLocalDescription=u,u=function(h,f,m){const E=a.apply(this,[h]);return m?(E.then(f,m),Promise.resolve()):E},e.setRemoteDescription=u,u=function(h,f,m){const E=l.apply(this,[h]);return m?(E.then(f,m),Promise.resolve()):E},e.addIceCandidate=u}function kb(n){const e=n&&n.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const t=e.mediaDevices,i=t.getUserMedia.bind(t);e.mediaDevices.getUserMedia=o=>i(Lb(o))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(t,i,o){e.mediaDevices.getUserMedia(t).then(i,o)}).bind(e))}function Lb(n){return n&&n.video!==void 0?Object.assign({},n,{video:ob(n.video)}):n}function Mb(n){if(!n.RTCPeerConnection)return;const e=n.RTCPeerConnection;n.RTCPeerConnection=function(t,i){if(t&&t.iceServers){const o=[];for(let a=0;a<t.iceServers.length;a++){let l=t.iceServers[a];!l.hasOwnProperty("urls")&&l.hasOwnProperty("url")?($v("RTCIceServer.url","RTCIceServer.urls"),l=JSON.parse(JSON.stringify(l)),l.urls=l.url,delete l.url,o.push(l)):o.push(t.iceServers[a])}t.iceServers=o}return new e(t,i)},n.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get:()=>e.generateCertificate})}function xb(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Ub(n){const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(t){if(t){t.offerToReceiveAudio!==void 0&&(t.offerToReceiveAudio=!!t.offerToReceiveAudio);const i=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");t.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):t.offerToReceiveAudio!==!0||i||this.addTransceiver("audio",{direction:"recvonly"}),t.offerToReceiveVideo!==void 0&&(t.offerToReceiveVideo=!!t.offerToReceiveVideo);const o=this.getTransceivers().find(a=>a.receiver.track.kind==="video");t.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):t.offerToReceiveVideo!==!0||o||this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function Vb(n){typeof n!="object"||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}var Fb=Object.freeze({__proto__:null,shimAudioContext:Vb,shimCallbacksAPI:Db,shimConstraints:Lb,shimCreateOfferLegacy:Ub,shimGetUserMedia:kb,shimLocalStreamsAPI:Nb,shimRTCIceServerUrls:Mb,shimRemoteStreamsAPI:Pb,shimTrackEventTransceiver:xb}),jb={exports:{}};(function(n){const e={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};e.localCName=e.generateIdentifier(),e.splitLines=function(t){return t.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(t){return t.split(`
m=`).map((i,o)=>(o>0?"m="+i:i).trim()+`\r
`)},e.getDescription=function(t){const i=e.splitSections(t);return i&&i[0]},e.getMediaSections=function(t){const i=e.splitSections(t);return i.shift(),i},e.matchPrefix=function(t,i){return e.splitLines(t).filter(o=>o.indexOf(i)===0)},e.parseCandidate=function(t){let i;i=t.indexOf("a=candidate:")===0?t.substring(12).split(" "):t.substring(10).split(" ");const o={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let a=8;a<i.length;a+=2)switch(i[a]){case"raddr":o.relatedAddress=i[a+1];break;case"rport":o.relatedPort=parseInt(i[a+1],10);break;case"tcptype":o.tcpType=i[a+1];break;case"ufrag":o.ufrag=i[a+1],o.usernameFragment=i[a+1];break;default:o[i[a]]===void 0&&(o[i[a]]=i[a+1])}return o},e.writeCandidate=function(t){const i=[];i.push(t.foundation);const o=t.component;o==="rtp"?i.push(1):o==="rtcp"?i.push(2):i.push(o),i.push(t.protocol.toUpperCase()),i.push(t.priority),i.push(t.address||t.ip),i.push(t.port);const a=t.type;return i.push("typ"),i.push(a),a!=="host"&&t.relatedAddress&&t.relatedPort&&(i.push("raddr"),i.push(t.relatedAddress),i.push("rport"),i.push(t.relatedPort)),t.tcpType&&t.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(i.push("ufrag"),i.push(t.usernameFragment||t.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(t){return t.substring(14).split(" ")},e.parseRtpMap=function(t){let i=t.substring(9).split(" ");const o={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),o.name=i[0],o.clockRate=parseInt(i[1],10),o.channels=i.length===3?parseInt(i[2],10):1,o.numChannels=o.channels,o},e.writeRtpMap=function(t){let i=t.payloadType;t.preferredPayloadType!==void 0&&(i=t.preferredPayloadType);const o=t.channels||t.numChannels||1;return"a=rtpmap:"+i+" "+t.name+"/"+t.clockRate+(o!==1?"/"+o:"")+`\r
`},e.parseExtmap=function(t){const i=t.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&t.direction!=="sendrecv"?"/"+t.direction:"")+" "+t.uri+(t.attributes?" "+t.attributes:"")+`\r
`},e.parseFmtp=function(t){const i={};let o;const a=t.substring(t.indexOf(" ")+1).split(";");for(let l=0;l<a.length;l++)o=a[l].trim().split("="),i[o[0].trim()]=o[1];return i},e.writeFmtp=function(t){let i="",o=t.payloadType;if(t.preferredPayloadType!==void 0&&(o=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){const a=[];Object.keys(t.parameters).forEach(l=>{t.parameters[l]!==void 0?a.push(l+"="+t.parameters[l]):a.push(l)}),i+="a=fmtp:"+o+" "+a.join(";")+`\r
`}return i},e.parseRtcpFb=function(t){const i=t.substring(t.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(t){let i="",o=t.payloadType;return t.preferredPayloadType!==void 0&&(o=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(a=>{i+="a=rtcp-fb:"+o+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(t){const i=t.indexOf(" "),o={ssrc:parseInt(t.substring(7,i),10)},a=t.indexOf(":",i);return a>-1?(o.attribute=t.substring(i+1,a),o.value=t.substring(a+1)):o.attribute=t.substring(i+1),o},e.parseSsrcGroup=function(t){const i=t.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(o=>parseInt(o,10))}},e.getMid=function(t){const i=e.matchPrefix(t,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(t){const i=t.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(t,i){return{role:"auto",fingerprints:e.matchPrefix(t+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(t,i){let o="a=setup:"+i+`\r
`;return t.fingerprints.forEach(a=>{o+="a=fingerprint:"+a.algorithm+" "+a.value+`\r
`}),o},e.parseCryptoLine=function(t){const i=t.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+(typeof t.keyParams=="object"?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(t){if(t.indexOf("inline:")!==0)return null;const i=t.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},e.getCryptoParameters=function(t,i){return e.matchPrefix(t+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(t,i){const o=e.matchPrefix(t+i,"a=ice-ufrag:")[0],a=e.matchPrefix(t+i,"a=ice-pwd:")[0];return o&&a?{usernameFragment:o.substring(12),password:a.substring(10)}:null},e.writeIceParameters=function(t){let i="a=ice-ufrag:"+t.usernameFragment+`\r
a=ice-pwd:`+t.password+`\r
`;return t.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(t){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},o=e.splitLines(t)[0].split(" ");i.profile=o[2];for(let l=3;l<o.length;l++){const u=o[l],h=e.matchPrefix(t,"a=rtpmap:"+u+" ")[0];if(h){const f=e.parseRtpMap(h),m=e.matchPrefix(t,"a=fmtp:"+u+" ");switch(f.parameters=m.length?e.parseFmtp(m[0]):{},f.rtcpFeedback=e.matchPrefix(t,"a=rtcp-fb:"+u+" ").map(e.parseRtcpFb),i.codecs.push(f),f.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(f.name.toUpperCase())}}}e.matchPrefix(t,"a=extmap:").forEach(l=>{i.headerExtensions.push(e.parseExtmap(l))});const a=e.matchPrefix(t,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(l=>{a.forEach(u=>{l.rtcpFeedback.find(h=>h.type===u.type&&h.parameter===u.parameter)||l.rtcpFeedback.push(u)})}),i},e.writeRtpDescription=function(t,i){let o="";o+="m="+t+" ",o+=i.codecs.length>0?"9":"0",o+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",o+=i.codecs.map(l=>l.preferredPayloadType!==void 0?l.preferredPayloadType:l.payloadType).join(" ")+`\r
`,o+=`c=IN IP4 0.0.0.0\r
`,o+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(l=>{o+=e.writeRtpMap(l),o+=e.writeFmtp(l),o+=e.writeRtcpFb(l)});let a=0;return i.codecs.forEach(l=>{l.maxptime>a&&(a=l.maxptime)}),a>0&&(o+="a=maxptime:"+a+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(l=>{o+=e.writeExtmap(l)}),o},e.parseRtpEncodingParameters=function(t){const i=[],o=e.parseRtpParameters(t),a=o.fecMechanisms.indexOf("RED")!==-1,l=o.fecMechanisms.indexOf("ULPFEC")!==-1,u=e.matchPrefix(t,"a=ssrc:").map(v=>e.parseSsrcMedia(v)).filter(v=>v.attribute==="cname"),h=u.length>0&&u[0].ssrc;let f;const m=e.matchPrefix(t,"a=ssrc-group:FID").map(v=>v.substring(17).split(" ").map(T=>parseInt(T,10)));m.length>0&&m[0].length>1&&m[0][0]===h&&(f=m[0][1]),o.codecs.forEach(v=>{if(v.name.toUpperCase()==="RTX"&&v.parameters.apt){let T={ssrc:h,codecPayloadType:parseInt(v.parameters.apt,10)};h&&f&&(T.rtx={ssrc:f}),i.push(T),a&&(T=JSON.parse(JSON.stringify(T)),T.fec={ssrc:h,mechanism:l?"red+ulpfec":"red"},i.push(T))}}),i.length===0&&h&&i.push({ssrc:h});let E=e.matchPrefix(t,"b=");return E.length&&(E=E[0].indexOf("b=TIAS:")===0?parseInt(E[0].substring(7),10):E[0].indexOf("b=AS:")===0?1e3*parseInt(E[0].substring(5),10)*.95-16e3:void 0,i.forEach(v=>{v.maxBitrate=E})),i},e.parseRtcpParameters=function(t){const i={},o=e.matchPrefix(t,"a=ssrc:").map(u=>e.parseSsrcMedia(u)).filter(u=>u.attribute==="cname")[0];o&&(i.cname=o.value,i.ssrc=o.ssrc);const a=e.matchPrefix(t,"a=rtcp-rsize");i.reducedSize=a.length>0,i.compound=a.length===0;const l=e.matchPrefix(t,"a=rtcp-mux");return i.mux=l.length>0,i},e.writeRtcpParameters=function(t){let i="";return t.reducedSize&&(i+=`a=rtcp-rsize\r
`),t.mux&&(i+=`a=rtcp-mux\r
`),t.ssrc!==void 0&&t.cname&&(i+="a=ssrc:"+t.ssrc+" cname:"+t.cname+`\r
`),i},e.parseMsid=function(t){let i;const o=e.matchPrefix(t,"a=msid:");if(o.length===1)return i=o[0].substring(7).split(" "),{stream:i[0],track:i[1]};const a=e.matchPrefix(t,"a=ssrc:").map(l=>e.parseSsrcMedia(l)).filter(l=>l.attribute==="msid");return a.length>0?(i=a[0].value.split(" "),{stream:i[0],track:i[1]}):void 0},e.parseSctpDescription=function(t){const i=e.parseMLine(t),o=e.matchPrefix(t,"a=max-message-size:");let a;o.length>0&&(a=parseInt(o[0].substring(19),10)),isNaN(a)&&(a=65536);const l=e.matchPrefix(t,"a=sctp-port:");if(l.length>0)return{port:parseInt(l[0].substring(12),10),protocol:i.fmt,maxMessageSize:a};const u=e.matchPrefix(t,"a=sctpmap:");if(u.length>0){const h=u[0].substring(10).split(" ");return{port:parseInt(h[0],10),protocol:h[1],maxMessageSize:a}}},e.writeSctpDescription=function(t,i){let o=[];return o=t.protocol!=="DTLS/SCTP"?["m="+t.kind+" 9 "+t.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:["m="+t.kind+" 9 "+t.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&o.push("a=max-message-size:"+i.maxMessageSize+`\r
`),o.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(t,i,o){let a;const l=i!==void 0?i:2;return a=t||e.generateSessionId(),`v=0\r
o=`+(o||"thisisadapterortc")+" "+a+" "+l+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(t,i){const o=e.splitLines(t);for(let a=0;a<o.length;a++)switch(o[a]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return o[a].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(t){return e.splitLines(t)[0].split(" ")[0].substring(2)},e.isRejected=function(t){return t.split(" ",2)[1]==="0"},e.parseMLine=function(t){const i=e.splitLines(t)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},e.parseOLine=function(t){const i=e.matchPrefix(t,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},e.isValidSDP=function(t){if(typeof t!="string"||t.length===0)return!1;const i=e.splitLines(t);for(let o=0;o<i.length;o++)if(i[o].length<2||i[o].charAt(1)!=="=")return!1;return!0},n.exports=e})(jb);var Bb=jb.exports,Sd=p(Bb),DB=c({__proto__:null,default:Sd},[Bb]);function um(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;const e=n.RTCIceCandidate;n.RTCIceCandidate=function(t){if(typeof t=="object"&&t.candidate&&t.candidate.indexOf("a=")===0&&((t=JSON.parse(JSON.stringify(t))).candidate=t.candidate.substr(2)),t.candidate&&t.candidate.length){const i=new e(t),o=Sd.parseCandidate(t.candidate),a=Object.assign(i,o);return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new e(t)},n.RTCIceCandidate.prototype=e.prototype,pl(n,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new n.RTCIceCandidate(t.candidate),writable:"false"}),t))}function nS(n){!n.RTCIceCandidate||n.RTCIceCandidate&&"relayProtocol"in n.RTCIceCandidate.prototype||pl(n,"icecandidate",e=>{if(e.candidate){const t=Sd.parseCandidate(e.candidate.candidate);t.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function hm(n,e){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const t=function(u){if(!u||!u.sdp)return!1;const h=Sd.splitSections(u.sdp);return h.shift(),h.some(f=>{const m=Sd.parseMLine(f);return m&&m.kind==="application"&&m.protocol.indexOf("SCTP")!==-1})},i=function(u){const h=u.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(h===null||h.length<2)return-1;const f=parseInt(h[1],10);return f!=f?-1:f},o=function(u){let h=65536;return e.browser==="firefox"&&(h=e.version<57?u===-1?16384:2147483637:e.version<60?e.version===57?65535:65536:2147483637),h},a=function(u,h){let f=65536;e.browser==="firefox"&&e.version===57&&(f=65535);const m=Sd.matchPrefix(u.sdp,"a=max-message-size:");return m.length>0?f=parseInt(m[0].substr(19),10):e.browser==="firefox"&&h!==-1&&(f=2147483637),f},l=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:u}=this.getConfiguration();u==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(t(arguments[0])){const u=i(arguments[0]),h=o(u),f=a(arguments[0],u);let m;m=h===0&&f===0?Number.POSITIVE_INFINITY:h===0||f===0?Math.max(h,f):Math.min(h,f);const E={};Object.defineProperty(E,"maxMessageSize",{get:()=>m}),this._sctp=E}return l.apply(this,arguments)}}function pm(n){if(!n.RTCPeerConnection||!("createDataChannel"in n.RTCPeerConnection.prototype))return;function e(i,o){const a=i.send;i.send=function(){const l=arguments[0],u=l.length||l.size||l.byteLength;if(i.readyState==="open"&&o.sctp&&u>o.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+o.sctp.maxMessageSize+" bytes)");return a.apply(i,arguments)}}const t=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){const i=t.apply(this,arguments);return e(i,this),i},pl(n,"datachannel",i=>(e(i.channel,i.target),i))}function iS(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;const e=n.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(t=>{const i=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=o=>{const a=o.target;if(a._lastConnectionState!==a.connectionState){a._lastConnectionState=a.connectionState;const l=new Event("connectionstatechange",o);a.dispatchEvent(l)}return o},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function rS(n,e){if(!n.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const o=i.sdp.split(`
`).filter(a=>a.trim()!=="a=extmap-allow-mixed").join(`
`);n.RTCSessionDescription&&i instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:i.type,sdp:o}):i.sdp=o}return t.apply(this,arguments)}}function fm(n,e){if(!n.RTCPeerConnection||!n.RTCPeerConnection.prototype)return;const t=n.RTCPeerConnection.prototype.addIceCandidate;t&&t.length!==0&&(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function mm(n,e){if(!n.RTCPeerConnection||!n.RTCPeerConnection.prototype)return;const t=n.RTCPeerConnection.prototype.setLocalDescription;t&&t.length!==0&&(n.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return t.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer"}return i.sdp||i.type!=="offer"&&i.type!=="answer"?t.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>t.apply(this,[o]))})}var kB=Object.freeze({__proto__:null,removeExtmapAllowMixed:rS,shimAddIceCandidateNullOrEmpty:fm,shimConnectionState:iS,shimMaxMessageSize:hm,shimParameterlessSetLocalDescription:mm,shimRTCIceCandidate:um,shimRTCIceCandidateRelayProtocol:nS,shimSendThrowTypeError:pm});(function({window:n}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const t=rb,i=function(a){const l={browser:null,version:null};if(a===void 0||!a.navigator)return l.browser="Not a browser.",l;const{navigator:u}=a;if(u.mozGetUserMedia)l.browser="firefox",l.version=dm(u.userAgent,/Firefox\/(\d+)\./,1);else if(u.webkitGetUserMedia||a.isSecureContext===!1&&a.webkitRTCPeerConnection)l.browser="chrome",l.version=dm(u.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!a.RTCPeerConnection||!u.userAgent.match(/AppleWebKit\/(\d+)\./))return l.browser="Not a supported browser.",l;l.browser="safari",l.version=dm(u.userAgent,/AppleWebKit\/(\d+)\./,1),l.supportsUnifiedPlan=a.RTCRtpTransceiver&&"currentDirection"in a.RTCRtpTransceiver.prototype}return l}(n),o={browserDetails:i,commonShim:kB,extractVersion:dm,disableLog:NB,disableWarnings:PB,sdp:DB};switch(i.browser){case"chrome":if(!gb||!eS||!e.shimChrome)return t("Chrome shim is not included in this adapter release."),o;if(i.version===null)return t("Chrome shim can not determine version, not shimming."),o;t("adapter.js shimming chrome."),o.browserShim=gb,fm(n,i),mm(n),lb(n,i),db(n),eS(n,i),ub(n),_b(n,i),hb(n),pb(n),fb(n),Eb(n,i),um(n),nS(n),iS(n),hm(n,i),pm(n),rS(n,i);break;case"firefox":if(!Ob||!tS||!e.shimFirefox)return t("Firefox shim is not included in this adapter release."),o;t("adapter.js shimming firefox."),o.browserShim=Ob,fm(n,i),mm(n),vb(n,i),tS(n,i),Sb(n),Rb(n),Tb(n),yb(n),Cb(n),Ib(n),wb(n),bb(n),Ab(n),um(n),iS(n),hm(n,i),pm(n);break;case"safari":if(!Fb||!e.shimSafari)return t("Safari shim is not included in this adapter release."),o;t("adapter.js shimming safari."),o.browserShim=Fb,fm(n,i),mm(n),Mb(n),Ub(n),Db(n),Nb(n),Pb(n),xb(n),kb(n),Vb(n),um(n),nS(n),hm(n,i),pm(n),rS(n,i);break;default:t("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var Gb={exports:{}},LB=Xt,MB=Zt,Wb=Rs.f;LB({target:"Object",stat:!0,forced:Object.defineProperty!==Wb,sham:!MB},{defineProperty:Wb});var Hb=Ss.Object,xB=Gb.exports=function(n,e,t){return Hb.defineProperty(n,e,t)};Hb.defineProperty.sham&&(xB.sham=!0);var UB=p(Gb.exports),VB=fe,sS=Array.isArray||function(n){return VB(n)=="Array"},FB=TypeError,jB=om,BB=Rs,GB=zn,oS=function(n,e,t){var i=jB(e);i in n?BB.f(n,i,GB(0,t)):n[i]=t},WB=Ge,aS=on,HB=L(Function.toString);WB(aS.inspectSource)||(aS.inspectSource=function(n){return HB(n)});var Kb=aS.inspectSource,KB=L,zB=_,zb=Ge,YB=Ja,qB=Kb,Yb=function(){},JB=[],qb=Li("Reflect","construct"),cS=/^\s*(?:class|function)\b/,XB=KB(cS.exec),QB=!cS.exec(Yb),Ch=function(n){if(!zb(n))return!1;try{return qb(Yb,JB,n),!0}catch{return!1}},Jb=function(n){if(!zb(n))return!1;switch(YB(n)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return QB||!!XB(cS,qB(n))}catch{return!0}};Jb.sham=!0;var lS=!qb||zB(function(){var n;return Ch(Ch.call)||!Ch(Object)||!Ch(function(){n=!0})||n})?Jb:Ch,Xb=sS,$B=lS,ZB=_r,e4=On("species"),Qb=Array,t4=function(n){var e;return Xb(n)&&(e=n.constructor,($B(e)&&(e===Qb||Xb(e.prototype))||ZB(e)&&(e=e[e4])===null)&&(e=void 0)),e===void 0?Qb:e},$b=function(n,e){return new(t4(n))(e===0?0:e)},n4=_,i4=Ro,r4=On("species"),s4=Xt,o4=_,a4=sS,c4=_r,l4=Mi,d4=Ya,Zb=function(n){if(n>9007199254740991)throw FB("Maximum allowed index exceeded");return n},eA=oS,u4=$b,h4=function(n){return i4>=51||!n4(function(){var e=[];return(e.constructor={})[r4]=function(){return{foo:1}},e[n](Boolean).foo!==1})},p4=Ro,tA=On("isConcatSpreadable"),f4=p4>=51||!o4(function(){var n=[];return n[tA]=!1,n.concat()[0]!==n}),m4=function(n){if(!c4(n))return!1;var e=n[tA];return e!==void 0?!!e:a4(n)};s4({target:"Array",proto:!0,arity:1,forced:!f4||!h4("concat")},{concat:function(n){var e,t,i,o,a,l=l4(this),u=u4(l,0),h=0;for(e=-1,i=arguments.length;e<i;e++)if(m4(a=e===-1?l:arguments[e]))for(o=d4(a),Zb(h+o),t=0;t<o;t++,h++)t in a&&eA(u,h,a[t]);else Zb(h+1),eA(u,h++,a);return u.length=h,u}});var dS={},_m={},uS=Fn,_4=Zo,E4=qv.indexOf,g4=_m,nA=L([].push),iA=function(n,e){var t,i=_4(n),o=0,a=[];for(t in i)!uS(g4,t)&&uS(i,t)&&nA(a,t);for(;e.length>o;)uS(i,t=e[o++])&&(~E4(a,t)||nA(a,t));return a},hS=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],v4=iA,S4=hS,Em=Object.keys||function(n){return v4(n,S4)},T4=Zt,y4=qw,R4=Rs,C4=$r,I4=Zo,w4=Em;dS.f=T4&&!y4?Object.defineProperties:function(n,e){C4(n);for(var t,i=I4(e),o=w4(e),a=o.length,l=0;a>l;)R4.f(n,t=o[l++],i[t]);return n};var gm,rA=Li("document","documentElement"),b4=It,sA=Yn("keys"),vm=function(n){return sA[n]||(sA[n]=b4(n))},A4=$r,O4=dS,oA=hS,N4=_m,P4=rA,D4=Gv,pS="prototype",fS="script",aA=vm("IE_PROTO"),mS=function(){},cA=function(n){return"<"+fS+">"+n+"</"+fS+">"},lA=function(n){n.write(cA("")),n.close();var e=n.parentWindow.Object;return n=null,e},Sm=function(){try{gm=new ActiveXObject("htmlfile")}catch{}var n,e,t;Sm=typeof document<"u"?document.domain&&gm?lA(gm):(e=D4("iframe"),t="java"+fS+":",e.style.display="none",P4.appendChild(e),e.src=String(t),(n=e.contentWindow.document).open(),n.write(cA("document.F=Object")),n.close(),n.F):lA(gm);for(var i=oA.length;i--;)delete Sm[pS][oA[i]];return Sm()};N4[aA]=!0;var Ih=Object.create||function(n,e){var t;return n!==null?(mS[pS]=A4(n),t=new mS,mS[pS]=null,t[aA]=n):t=Sm(),e===void 0?t:O4.f(t,e)},Tm={},k4=iA,L4=hS.concat("length","prototype");Tm.f=Object.getOwnPropertyNames||function(n){return k4(n,L4)};var dA={},uA=Qw,M4=Ya,x4=oS,U4=Array,V4=Math.max,_S=function(n,e,t){for(var i=M4(n),o=uA(e,i),a=uA(t===void 0?i:t,i),l=U4(V4(a-o,0)),u=0;o<a;o++,u++)x4(l,u,n[o]);return l.length=u,l},F4=fe,j4=Zo,hA=Tm.f,B4=_S,pA=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];dA.f=function(n){return pA&&F4(n)=="Window"?function(e){try{return hA(e)}catch{return B4(pA)}}(n):hA(j4(n))};var wh={};wh.f=Object.getOwnPropertySymbols;var G4=za,Xa=function(n,e,t,i){return i&&i.enumerable?n[e]=t:G4(n,e,t),n},W4=Rs,ym=function(n,e,t){return W4.f(n,e,t)},Td={},H4=On;Td.f=H4;var Rm,bh,Cm,fA=Ss,K4=Fn,z4=Td,Y4=Rs.f,ui=function(n){var e=fA.Symbol||(fA.Symbol={});K4(e,n)||Y4(e,n,{value:z4.f(n)})},q4=We,J4=Li,X4=On,Q4=Xa,mA=function(){var n=J4("Symbol"),e=n&&n.prototype,t=e&&e.valueOf,i=X4("toPrimitive");e&&!e[i]&&Q4(e,i,function(o){return q4(t,this)},{arity:1})},$4=Ja,Z4=Jv?{}.toString:function(){return"[object "+$4(this)+"]"},e5=Jv,t5=Rs.f,n5=za,i5=Fn,r5=Z4,_A=On("toStringTag"),Qa=function(n,e,t,i){if(n){var o=t?n:n.prototype;i5(o,_A)||t5(o,_A,{configurable:!0,value:e}),i&&!e5&&n5(o,"toString",r5)}},s5=Ge,EA=K.WeakMap,o5=s5(EA)&&/native code/.test(String(EA)),gA=K,a5=_r,c5=za,ES=Fn,gS=on,l5=vm,d5=_m,vA="Object already initialized",vS=gA.TypeError,u5=gA.WeakMap;if(o5||gS.state){var Co=gS.state||(gS.state=new u5);Co.get=Co.get,Co.has=Co.has,Co.set=Co.set,Rm=function(n,e){if(Co.has(n))throw vS(vA);return e.facade=n,Co.set(n,e),e},bh=function(n){return Co.get(n)||{}},Cm=function(n){return Co.has(n)}}else{var yd=l5("state");d5[yd]=!0,Rm=function(n,e){if(ES(n,yd))throw vS(vA);return e.facade=n,c5(n,yd,e),e},bh=function(n){return ES(n,yd)?n[yd]:{}},Cm=function(n){return ES(n,yd)}}var Rd={set:Rm,get:bh,has:Cm,enforce:function(n){return Cm(n)?bh(n):Rm(n,{})},getterFor:function(n){return function(e){var t;if(!a5(e)||(t=bh(e)).type!==n)throw vS("Incompatible receiver, "+n+" required");return t}}},h5=Ka,p5=ud,f5=Mi,m5=Ya,_5=$b,SA=L([].push),$a=function(n){var e=n==1,t=n==2,i=n==3,o=n==4,a=n==6,l=n==7,u=n==5||a;return function(h,f,m,E){for(var v,T,A=f5(h),C=p5(A),b=h5(f,m),D=m5(C),M=0,B=E||_5,J=e?B(h,D):t||l?B(h,0):void 0;D>M;M++)if((u||M in C)&&(T=b(v=C[M],M,A),n))if(e)J[M]=T;else if(T)switch(n){case 3:return!0;case 5:return v;case 6:return M;case 2:SA(J,v)}else switch(n){case 4:return!1;case 7:SA(J,v)}return a?-1:i||o?o:J}},E5={forEach:$a(0),map:$a(1),filter:$a(2),some:$a(3),every:$a(4),find:$a(5),findIndex:$a(6),filterReject:$a(7)},Im=Xt,SS=K,TS=We,g5=L,Cd=Zt,Id=$s,v5=_,Gi=Fn,S5=x,yS=$r,wm=Zo,RS=om,T5=Cs,CS=zn,Ah=Ih,TA=Em,y5=Tm,yA=dA,R5=wh,RA=Mt,CA=Rs,C5=dS,IA=ct,wA=Xa,I5=ym,IS=Yn,bA=_m,AA=It,w5=On,b5=Td,A5=ui,O5=mA,N5=Qa,OA=Rd,bm=E5.forEach,Pr=vm("hidden"),Am="Symbol",Oh="prototype",P5=OA.set,NA=OA.getterFor(Am),eo=Object[Oh],fl=SS.Symbol,Om=fl&&fl[Oh],D5=SS.TypeError,wS=SS.QObject,PA=RA.f,ml=CA.f,DA=yA.f,k5=IA.f,kA=g5([].push),na=IS("symbols"),Nh=IS("op-symbols"),L5=IS("wks"),bS=!wS||!wS[Oh]||!wS[Oh].findChild,AS=Cd&&v5(function(){return Ah(ml({},"a",{get:function(){return ml(this,"a",{value:7}).a}})).a!=7})?function(n,e,t){var i=PA(eo,e);i&&delete eo[e],ml(n,e,t),i&&n!==eo&&ml(eo,e,i)}:ml,OS=function(n,e){var t=na[n]=Ah(Om);return P5(t,{type:Am,tag:n,description:e}),Cd||(t.description=e),t},Nm=function(n,e,t){n===eo&&Nm(Nh,e,t),yS(n);var i=RS(e);return yS(t),Gi(na,i)?(t.enumerable?(Gi(n,Pr)&&n[Pr][i]&&(n[Pr][i]=!1),t=Ah(t,{enumerable:CS(0,!1)})):(Gi(n,Pr)||ml(n,Pr,CS(1,{})),n[Pr][i]=!0),AS(n,i,t)):ml(n,i,t)},NS=function(n,e){yS(n);var t=wm(e),i=TA(t).concat(UA(t));return bm(i,function(o){Cd&&!TS(LA,t,o)||Nm(n,o,t[o])}),n},LA=function(n){var e=RS(n),t=TS(k5,this,e);return!(this===eo&&Gi(na,e)&&!Gi(Nh,e))&&(!(t||!Gi(this,e)||!Gi(na,e)||Gi(this,Pr)&&this[Pr][e])||t)},MA=function(n,e){var t=wm(n),i=RS(e);if(t!==eo||!Gi(na,i)||Gi(Nh,i)){var o=PA(t,i);return!o||!Gi(na,i)||Gi(t,Pr)&&t[Pr][i]||(o.enumerable=!0),o}},xA=function(n){var e=DA(wm(n)),t=[];return bm(e,function(i){Gi(na,i)||Gi(bA,i)||kA(t,i)}),t},UA=function(n){var e=n===eo,t=DA(e?Nh:wm(n)),i=[];return bm(t,function(o){!Gi(na,o)||e&&!Gi(eo,o)||kA(i,na[o])}),i};Id||(fl=function(){if(S5(Om,this))throw D5("Symbol is not a constructor");var n=arguments.length&&arguments[0]!==void 0?T5(arguments[0]):void 0,e=AA(n),t=function(i){this===eo&&TS(t,Nh,i),Gi(this,Pr)&&Gi(this[Pr],e)&&(this[Pr][e]=!1),AS(this,e,CS(1,i))};return Cd&&bS&&AS(eo,e,{configurable:!0,set:t}),OS(e,n)},wA(Om=fl[Oh],"toString",function(){return NA(this).tag}),wA(fl,"withoutSetter",function(n){return OS(AA(n),n)}),IA.f=LA,CA.f=Nm,C5.f=NS,RA.f=MA,y5.f=yA.f=xA,R5.f=UA,b5.f=function(n){return OS(w5(n),n)},Cd&&I5(Om,"description",{configurable:!0,get:function(){return NA(this).description}})),Im({global:!0,constructor:!0,wrap:!0,forced:!Id,sham:!Id},{Symbol:fl}),bm(TA(L5),function(n){A5(n)}),Im({target:Am,stat:!0,forced:!Id},{useSetter:function(){bS=!0},useSimple:function(){bS=!1}}),Im({target:"Object",stat:!0,forced:!Id,sham:!Cd},{create:function(n,e){return e===void 0?Ah(n):NS(Ah(n),e)},defineProperty:Nm,defineProperties:NS,getOwnPropertyDescriptor:MA}),Im({target:"Object",stat:!0,forced:!Id},{getOwnPropertyNames:xA}),O5(),N5(fl,Am),bA[Pr]=!0;var VA=$s&&!!Symbol.for&&!!Symbol.keyFor,M5=Xt,x5=Li,U5=Fn,V5=Cs,FA=Yn,F5=VA,PS=FA("string-to-symbol-registry"),j5=FA("symbol-to-string-registry");M5({target:"Symbol",stat:!0,forced:!F5},{for:function(n){var e=V5(n);if(U5(PS,e))return PS[e];var t=x5("Symbol")(e);return PS[e]=t,j5[t]=e,t}});var B5=Xt,G5=Fn,W5=Ba,H5=ta,K5=VA,jA=Yn("symbol-to-string-registry");B5({target:"Symbol",stat:!0,forced:!K5},{keyFor:function(n){if(!W5(n))throw TypeError(H5(n)+" is not a symbol");if(G5(jA,n))return jA[n]}});var BA=L([].slice),GA=sS,z5=Ge,WA=fe,Y5=Cs,HA=L([].push),q5=Xt,KA=Li,zA=z,J5=We,Ph=L,YA=_,qA=Ge,JA=Ba,XA=BA,X5=function(n){if(z5(n))return n;if(GA(n)){for(var e=n.length,t=[],i=0;i<e;i++){var o=n[i];typeof o=="string"?HA(t,o):typeof o!="number"&&WA(o)!="Number"&&WA(o)!="String"||HA(t,Y5(o))}var a=t.length,l=!0;return function(u,h){if(l)return l=!1,h;if(GA(this))return h;for(var f=0;f<a;f++)if(t[f]===u)return h}}},Q5=$s,$5=String,Za=KA("JSON","stringify"),Pm=Ph(/./.exec),QA=Ph("".charAt),Z5=Ph("".charCodeAt),e6=Ph("".replace),t6=Ph(1 .toString),n6=/[\uD800-\uDFFF]/g,$A=/^[\uD800-\uDBFF]$/,ZA=/^[\uDC00-\uDFFF]$/,eO=!Q5||YA(function(){var n=KA("Symbol")();return Za([n])!="[null]"||Za({a:n})!="{}"||Za(Object(n))!="{}"}),tO=YA(function(){return Za("\uDF06\uD834")!=='"\\udf06\\ud834"'||Za("\uDEAD")!=='"\\udead"'}),i6=function(n,e){var t=XA(arguments),i=X5(e);if(qA(i)||n!==void 0&&!JA(n))return t[1]=function(o,a){if(qA(i)&&(a=J5(i,this,$5(o),a)),!JA(a))return a},zA(Za,null,t)},r6=function(n,e,t){var i=QA(t,e-1),o=QA(t,e+1);return Pm($A,n)&&!Pm(ZA,o)||Pm(ZA,n)&&!Pm($A,i)?"\\u"+t6(Z5(n,0),16):n};Za&&q5({target:"JSON",stat:!0,arity:3,forced:eO||tO},{stringify:function(n,e,t){var i=XA(arguments),o=zA(eO?i6:Za,null,i);return tO&&typeof o=="string"?e6(o,n6,r6):o}});var nO=wh,s6=Mi;Xt({target:"Object",stat:!0,forced:!$s||_(function(){nO.f(1)})},{getOwnPropertySymbols:function(n){var e=nO.f;return e?e(s6(n)):[]}}),ui("asyncIterator"),ui("hasInstance"),ui("isConcatSpreadable"),ui("iterator"),ui("match"),ui("matchAll"),ui("replace"),ui("search"),ui("species"),ui("split");var o6=mA;ui("toPrimitive"),o6();var a6=Li,c6=Qa;ui("toStringTag"),c6(a6("Symbol"),"Symbol"),ui("unscopables"),Qa(K.JSON,"JSON",!0);var _l,iO,rO,l6=Ss.Symbol,wd={},DS=Zt,d6=Fn,sO=Function.prototype,u6=DS&&Object.getOwnPropertyDescriptor,kS=d6(sO,"name"),oO={EXISTS:kS,PROPER:kS&&(function(){}).name==="something",CONFIGURABLE:kS&&(!DS||DS&&u6(sO,"name").configurable)},h6=!_(function(){function n(){}return n.prototype.constructor=null,Object.getPrototypeOf(new n)!==n.prototype}),p6=Fn,f6=Ge,m6=Mi,_6=h6,aO=vm("IE_PROTO"),LS=Object,E6=LS.prototype,MS=_6?LS.getPrototypeOf:function(n){var e=m6(n);if(p6(e,aO))return e[aO];var t=e.constructor;return f6(t)&&e instanceof t?t.prototype:e instanceof LS?E6:null},g6=_,v6=Ge,S6=_r,T6=Ih,cO=MS,y6=Xa,xS=On("iterator"),lO=!1;[].keys&&("next"in(rO=[].keys())?(iO=cO(cO(rO)))!==Object.prototype&&(_l=iO):lO=!0);var R6=!S6(_l)||g6(function(){var n={};return _l[xS].call(n)!==n});v6((_l=R6?{}:T6(_l))[xS])||y6(_l,xS,function(){return this});var dO={IteratorPrototype:_l,BUGGY_SAFARI_ITERATORS:lO},C6=dO.IteratorPrototype,I6=Ih,w6=zn,b6=Qa,A6=wd,O6=function(){return this},uO=function(n,e,t,i){var o=e+" Iterator";return n.prototype=I6(C6,{next:w6(+!i,t)}),b6(n,o,!1,!0),A6[o]=O6,n},N6=L,P6=te,D6=Ge,k6=String,L6=TypeError,M6=function(n,e,t){try{return N6(P6(Object.getOwnPropertyDescriptor(n,e)[t]))}catch{}},x6=$r,U6=function(n){if(typeof n=="object"||D6(n))return n;throw L6("Can't set "+k6(n)+" as a prototype")},V6=Object.setPrototypeOf||("__proto__"in{}?function(){var n,e=!1,t={};try{(n=M6(Object.prototype,"__proto__","set"))(t,[]),e=t instanceof Array}catch{}return function(i,o){return x6(i),U6(o),e?n(i,o):i.__proto__=o,i}}():void 0),F6=Xt,j6=We,B6=oO,G6=uO,W6=MS,H6=Qa,hO=Xa,pO=wd,K6=dO,z6=B6.PROPER,Dm=K6.BUGGY_SAFARI_ITERATORS,US=On("iterator"),fO="keys",km="values",mO="entries",Y6=function(){return this},_O=function(n,e,t,i,o,a,l){G6(t,e,i);var u,h,f,m=function(D){if(D===o&&C)return C;if(!Dm&&D in T)return T[D];switch(D){case fO:case km:case mO:return function(){return new t(this,D)}}return function(){return new t(this)}},E=e+" Iterator",v=!1,T=n.prototype,A=T[US]||T["@@iterator"]||o&&T[o],C=!Dm&&A||m(o),b=e=="Array"&&T.entries||A;if(b&&(u=W6(b.call(new n)))!==Object.prototype&&u.next&&(H6(u,E,!0,!0),pO[E]=Y6),z6&&o==km&&A&&A.name!==km&&(v=!0,C=function(){return j6(A,this)}),o)if(h={values:m(km),keys:a?C:m(fO),entries:m(mO)},l)for(f in h)(Dm||v||!(f in T))&&hO(T,f,h[f]);else F6({target:e,proto:!0,forced:Dm||v},h);return l&&T[US]!==C&&hO(T,US,C,{name:o}),pO[e]=C,h},EO=function(n,e){return{value:n,done:e}},q6=Zo,gO=wd,vO=Rd;Rs.f;var J6=_O,SO=EO,TO="Array Iterator",X6=vO.set,Q6=vO.getterFor(TO);J6(Array,"Array",function(n,e){X6(this,{type:TO,target:q6(n),index:0,kind:e})},function(){var n=Q6(this),e=n.target,t=n.kind,i=n.index++;return!e||i>=e.length?(n.target=void 0,SO(void 0,!0)):SO(t=="keys"?i:t=="values"?e[i]:[i,e[i]],!1)},"values"),gO.Arguments=gO.Array;var $6={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Z6=K,eG=Ja,tG=za,yO=wd,RO=On("toStringTag");for(var VS in $6){var CO=Z6[VS],FS=CO&&CO.prototype;FS&&eG(FS)!==RO&&tG(FS,RO,VS),yO[VS]=yO.Array}var nG=l6,iG=On,rG=Rs.f,IO=iG("metadata"),wO=Function.prototype;wO[IO]===void 0&&rG(wO,IO,{value:null}),ui("dispose"),ui("metadata");var sG=nG;ui("asyncDispose");var oG=L,jS=Li("Symbol"),aG=jS.keyFor,cG=oG(jS.prototype.valueOf),bO=jS.isRegisteredSymbol||function(n){try{return aG(cG(n))!==void 0}catch{return!1}};Xt({target:"Symbol",stat:!0},{isRegisteredSymbol:bO});for(var lG=Yn,AO=Li,dG=L,uG=Ba,hG=On,Lm=AO("Symbol"),OO=Lm.isWellKnownSymbol,NO=AO("Object","getOwnPropertyNames"),pG=dG(Lm.prototype.valueOf),PO=lG("wks"),BS=0,DO=NO(Lm),fG=DO.length;BS<fG;BS++)try{var kO=DO[BS];uG(Lm[kO])&&hG(kO)}catch{}var LO=function(n){if(OO&&OO(n))return!0;try{for(var e=pG(n),t=0,i=NO(PO),o=i.length;t<o;t++)if(PO[i[t]]==e)return!0}catch{}return!1};Xt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:LO}),ui("matcher"),ui("observable"),Xt({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:bO}),Xt({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:LO}),ui("metadataKey"),ui("patternMatch"),ui("replaceAll");var bd=p(sG),GS=L,mG=Yv,_G=Cs,EG=ll,gG=GS("".charAt),MO=GS("".charCodeAt),vG=GS("".slice),xO=function(n){return function(e,t){var i,o,a=_G(EG(e)),l=mG(t),u=a.length;return l<0||l>=u?n?"":void 0:(i=MO(a,l))<55296||i>56319||l+1===u||(o=MO(a,l+1))<56320||o>57343?n?gG(a,l):i:n?vG(a,l,l+2):o-56320+(i-55296<<10)+65536}},UO={codeAt:xO(!1),charAt:xO(!0)},SG=UO.charAt,TG=Cs,VO=Rd,yG=_O,FO=EO,jO="String Iterator",RG=VO.set,CG=VO.getterFor(jO);yG(String,"String",function(n){RG(this,{type:jO,string:TG(n),index:0})},function(){var n,e=CG(this),t=e.string,i=e.index;return i>=t.length?FO(void 0,!0):(n=SG(t,i),e.index+=n.length,FO(n,!1))});var BO=p(Td.f("iterator"));function Dh(n){return Dh=typeof bd=="function"&&typeof BO=="symbol"?function(e){return typeof e}:function(e){return e&&typeof bd=="function"&&e.constructor===bd&&e!==bd.prototype?"symbol":typeof e},Dh(n)}var IG=p(Td.f("toPrimitive"));function wG(n){var e=function(t,i){if(Dh(t)!=="object"||t===null)return t;var o=t[IG];if(o!==void 0){var a=o.call(t,i||"default");if(Dh(a)!=="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(t)}(n,"string");return Dh(e)==="symbol"?e:String(e)}function S(n,e,t){return(e=wG(e))in n?UB(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}var bG=qa("Array").keys,AG=Ja,OG=Fn,NG=x,PG=bG,WS=Array.prototype,DG={DOMTokenList:!0,NodeList:!0},Dr=p(function(n){var e=n.keys;return n===WS||NG(WS,n)&&e===WS.keys||OG(DG,AG(n))?PG:e}),GO=ta,kG=TypeError,WO=_S,LG=Math.floor,HS=function(n,e){var t=n.length,i=LG(t/2);return t<8?MG(n,e):xG(n,HS(WO(n,0,i),e),HS(WO(n,i),e),e)},MG=function(n,e){for(var t,i,o=n.length,a=1;a<o;){for(i=a,t=n[a];i&&e(n[i-1],t)>0;)n[i]=n[--i];i!==a++&&(n[i]=t)}return n},xG=function(n,e,t,i){for(var o=e.length,a=t.length,l=0,u=0;l<o||u<a;)n[l+u]=l<o&&u<a?i(e[l],t[u])<=0?e[l++]:t[u++]:l<o?e[l++]:t[u++];return n},HO=HS,UG=_,KS=function(n,e){var t=[][n];return!!t&&UG(function(){t.call(null,e||function(){return 1},1)})},KO=nr.match(/firefox\/(\d+)/i),VG=!!KO&&+KO[1],FG=/MSIE|Trident/.test(nr),zO=nr.match(/AppleWebKit\/(\d+)\./),jG=!!zO&&+zO[1],BG=Xt,YO=L,GG=te,WG=Mi,qO=Ya,HG=function(n,e){if(!delete n[e])throw kG("Cannot delete property "+GO(e)+" of "+GO(n))},JO=Cs,zS=_,KG=HO,zG=KS,XO=VG,YG=FG,QO=Ro,$O=jG,ec=[],ZO=YO(ec.sort),qG=YO(ec.push),JG=zS(function(){ec.sort(void 0)}),XG=zS(function(){ec.sort(null)}),QG=zG("sort"),eN=!zS(function(){if(QO)return QO<70;if(!(XO&&XO>3)){if(YG)return!0;if($O)return $O<603;var n,e,t,i,o="";for(n=65;n<76;n++){switch(e=String.fromCharCode(n),n){case 66:case 69:case 70:case 72:t=3;break;case 68:case 71:t=4;break;default:t=2}for(i=0;i<47;i++)ec.push({k:e+i,v:t})}for(ec.sort(function(a,l){return l.v-a.v}),i=0;i<ec.length;i++)e=ec[i].k.charAt(0),o.charAt(o.length-1)!==e&&(o+=e);return o!=="DGBEFHACIJK"}});BG({target:"Array",proto:!0,forced:JG||!XG||!QG||!eN},{sort:function(n){n!==void 0&&GG(n);var e=WG(this);if(eN)return n===void 0?ZO(e):ZO(e,n);var t,i,o=[],a=qO(e);for(i=0;i<a;i++)i in e&&qG(o,e[i]);for(KG(o,function(l){return function(u,h){return h===void 0?-1:u===void 0?1:l!==void 0?+l(u,h)||0:JO(u)>JO(h)?1:-1}}(n)),t=qO(o),i=0;i<t;)e[i]=o[i++];for(;i<a;)HG(e,i++);return e}});var $G=qa("Array").sort,ZG=x,eW=$G,YS=Array.prototype,kh=p(function(n){var e=n.sort;return n===YS||ZG(YS,n)&&e===YS.sort?eW:e}),tW=Li,nW=Tm,iW=wh,rW=$r,sW=L([].concat),oW=tW("Reflect","ownKeys")||function(n){var e=nW.f(rW(n)),t=iW.f;return t?sW(e,t(n)):e},tN=Fn,aW=oW,cW=Mt,lW=Rs,dW=_r,uW=za,nN=Error,hW=L("".replace),pW=String(nN("zxcasd").stack),iN=/\n\s*at [^:]*:[^\n]*/,fW=iN.test(pW),mW=zn,_W=!_(function(){var n=Error("a");return!("stack"in n)||(Object.defineProperty(n,"stack",mW(1,7)),n.stack!==7)}),EW=za,gW=function(n,e){if(fW&&typeof n=="string"&&!nN.prepareStackTrace)for(;e--;)n=hW(n,iN,"");return n},vW=_W,rN=Error.captureStackTrace,SW=wd,TW=On("iterator"),yW=Array.prototype,sN=function(n){return n!==void 0&&(SW.Array===n||yW[TW]===n)},RW=Ja,oN=Re,CW=ki,IW=wd,wW=On("iterator"),Mm=function(n){if(!CW(n))return oN(n,wW)||oN(n,"@@iterator")||IW[RW(n)]},bW=We,AW=te,OW=$r,NW=ta,PW=Mm,DW=TypeError,qS=function(n,e){var t=arguments.length<2?PW(n):e;if(AW(t))return OW(bW(t,n));throw DW(NW(n)+" is not iterable")},kW=We,aN=$r,LW=Re,cN=function(n,e,t){var i,o;aN(n);try{if(!(i=LW(n,"return"))){if(e==="throw")throw t;return t}i=kW(i,n)}catch(a){o=!0,i=a}if(e==="throw")throw t;if(o)throw i;return aN(i),t},MW=Ka,xW=We,UW=$r,VW=ta,FW=sN,jW=Ya,lN=x,BW=qS,GW=Mm,dN=cN,WW=TypeError,xm=function(n,e){this.stopped=n,this.result=e},uN=xm.prototype,Lh=function(n,e,t){var i,o,a,l,u,h,f,m=t&&t.that,E=!(!t||!t.AS_ENTRIES),v=!(!t||!t.IS_RECORD),T=!(!t||!t.IS_ITERATOR),A=!(!t||!t.INTERRUPTED),C=MW(e,m),b=function(M){return i&&dN(i,"normal",M),new xm(!0,M)},D=function(M){return E?(UW(M),A?C(M[0],M[1],b):C(M[0],M[1])):A?C(M,b):C(M)};if(v)i=n.iterator;else if(T)i=n;else{if(!(o=GW(n)))throw WW(VW(n)+" is not iterable");if(FW(o)){for(a=0,l=jW(n);l>a;a++)if((u=D(n[a]))&&lN(uN,u))return u;return new xm(!1)}i=BW(n,o)}for(h=v?n.next:i.next;!(f=xW(h,i)).done;){try{u=D(f.value)}catch(M){dN(i,"throw",M)}if(typeof u=="object"&&u&&lN(uN,u))return u}return new xm(!1)},HW=Cs,KW=Xt,zW=x,YW=MS,Um=V6,qW=function(n,e,t){for(var i=aW(e),o=lW.f,a=cW.f,l=0;l<i.length;l++){var u=i[l];tN(n,u)||t&&tN(t,u)||o(n,u,a(e,u))}},hN=Ih,JS=za,XS=zn,JW=function(n,e){dW(e)&&"cause"in e&&uW(n,"cause",e.cause)},XW=function(n,e,t,i){vW&&(rN?rN(n,e):EW(n,"stack",gW(t,i)))},QW=Lh,$W=function(n,e){return n===void 0?arguments.length<2?"":e:HW(n)},ZW=On("toStringTag"),Vm=Error,e8=[].push,Ad=function(n,e){var t,i=zW(QS,this);Um?t=Um(Vm(),i?YW(this):QS):(t=i?this:hN(QS),JS(t,ZW,"Error")),e!==void 0&&JS(t,"message",$W(e)),XW(t,Ad,t.stack,1),arguments.length>2&&JW(t,arguments[2]);var o=[];return QW(n,e8,{that:o}),JS(t,"errors",o),t};Um?Um(Ad,Vm):qW(Ad,Vm,{name:!0});var QS=Ad.prototype=hN(Vm.prototype,{constructor:XS(1,Ad),message:XS(1,""),name:XS(1,"AggregateError")});KW({global:!0,constructor:!0,arity:2},{AggregateError:Ad});var Mh,Od,pN,$S,xh=typeof process<"u"&&fe(process)=="process",t8=Li,n8=ym,i8=Zt,fN=On("species"),r8=x,s8=TypeError,ZS=function(n,e){if(r8(e,n))return n;throw s8("Incorrect invocation")},o8=lS,a8=ta,c8=TypeError,mN=$r,l8=function(n){if(o8(n))return n;throw c8(a8(n)+" is not a constructor")},d8=ki,u8=On("species"),_N=function(n,e){var t,i=mN(n).constructor;return i===void 0||d8(t=mN(i)[u8])?e:l8(t)},h8=TypeError,Fm=function(n,e){if(n<e)throw h8("Not enough arguments");return n},EN=/(?:ipad|iphone|ipod).*applewebkit/i.test(nr),Zr=K,p8=z,f8=Ka,gN=Ge,m8=Fn,vN=_,SN=rA,_8=BA,TN=Gv,E8=Fm,g8=EN,v8=xh,eT=Zr.setImmediate,tT=Zr.clearImmediate,S8=Zr.process,nT=Zr.Dispatch,T8=Zr.Function,yN=Zr.MessageChannel,y8=Zr.String,iT=0,Uh={},RN="onreadystatechange";vN(function(){Mh=Zr.location});var rT=function(n){if(m8(Uh,n)){var e=Uh[n];delete Uh[n],e()}},sT=function(n){return function(){rT(n)}},CN=function(n){rT(n.data)},IN=function(n){Zr.postMessage(y8(n),Mh.protocol+"//"+Mh.host)};eT&&tT||(eT=function(n){E8(arguments.length,1);var e=gN(n)?n:T8(n),t=_8(arguments,1);return Uh[++iT]=function(){p8(e,void 0,t)},Od(iT),iT},tT=function(n){delete Uh[n]},v8?Od=function(n){S8.nextTick(sT(n))}:nT&&nT.now?Od=function(n){nT.now(sT(n))}:yN&&!g8?($S=(pN=new yN).port2,pN.port1.onmessage=CN,Od=f8($S.postMessage,$S)):Zr.addEventListener&&gN(Zr.postMessage)&&!Zr.importScripts&&Mh&&Mh.protocol!=="file:"&&!vN(IN)?(Od=IN,Zr.addEventListener("message",CN,!1)):Od=RN in TN("script")?function(n){SN.appendChild(TN("script"))[RN]=function(){SN.removeChild(this),rT(n)}}:function(n){setTimeout(sT(n),0)});var wN={set:eT,clear:tT},bN=function(){this.head=null,this.tail=null};bN.prototype={add:function(n){var e={item:n,next:null},t=this.tail;t?t.next=e:this.head=e,this.tail=e},get:function(){var n=this.head;if(n)return(this.head=n.next)===null&&(this.tail=null),n.item}};var Nd,oT,aT,cT,AN,ON=bN,R8=/ipad|iphone|ipod/i.test(nr)&&typeof Pebble<"u",C8=/web0s(?!.*chrome)/i.test(nr),El=K,NN=Ka,I8=Mt.f,lT=wN.set,w8=ON,b8=EN,A8=R8,O8=C8,dT=xh,PN=El.MutationObserver||El.WebKitMutationObserver,DN=El.document,kN=El.process,jm=El.Promise,LN=I8(El,"queueMicrotask"),uT=LN&&LN.value;if(!uT){var Bm=new w8,Gm=function(){var n,e;for(dT&&(n=kN.domain)&&n.exit();e=Bm.get();)try{e()}catch(t){throw Bm.head&&Nd(),t}n&&n.enter()};b8||dT||O8||!PN||!DN?!A8&&jm&&jm.resolve?((cT=jm.resolve(void 0)).constructor=jm,AN=NN(cT.then,cT),Nd=function(){AN(Gm)}):dT?Nd=function(){kN.nextTick(Gm)}:(lT=NN(lT,El),Nd=function(){lT(Gm)}):(oT=!0,aT=DN.createTextNode(""),new PN(Gm).observe(aT,{characterData:!0}),Nd=function(){aT.data=oT=!oT}),uT=function(n){Bm.head||Nd(),Bm.add(n)}}var N8=uT,Pd=function(n){try{return{error:!1,value:n()}}catch(e){return{error:!0,value:e}}},gl=K.Promise,MN=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",P8=!MN&&!xh&&typeof window=="object"&&typeof document=="object",D8=K,Vh=gl,k8=Ge,L8=Yw,M8=Kb,x8=On,U8=P8,V8=MN,hT=Ro,xN=Vh&&Vh.prototype,F8=x8("species"),UN=!1,VN=k8(D8.PromiseRejectionEvent),j8=L8("Promise",function(){var n=M8(Vh),e=n!==String(Vh);if(!e&&hT===66||!xN.catch||!xN.finally)return!0;if(!hT||hT<51||!/native code/.test(n)){var t=new Vh(function(o){o(1)}),i=function(o){o(function(){},function(){})};if((t.constructor={})[F8]=i,!(UN=t.then(function(){})instanceof i))return!0}return!e&&(U8||V8)&&!VN}),Fh={CONSTRUCTOR:j8,REJECTION_EVENT:VN,SUBCLASSING:UN},Io={},FN=te,B8=TypeError,G8=function(n){var e,t;this.promise=new n(function(i,o){if(e!==void 0||t!==void 0)throw B8("Bad Promise constructor");e=i,t=o}),this.resolve=FN(e),this.reject=FN(t)};Io.f=function(n){return new G8(n)};var pT,jN,W8=Xt,Wm=xh,tc=K,jh=We,H8=Xa,K8=Qa,z8=function(n){var e=t8(n);i8&&e&&!e[fN]&&n8(e,fN,{configurable:!0,get:function(){return this}})},Y8=te,fT=Ge,q8=_r,J8=ZS,X8=_N,BN=wN.set,mT=N8,Q8=function(n,e){try{arguments.length==1?console.error(n):console.error(n,e)}catch{}},$8=Pd,Z8=ON,GN=Rd,_T=gl,WN=Fh,HN=Io,Hm="Promise",KN=WN.CONSTRUCTOR,eH=WN.REJECTION_EVENT,ET=GN.getterFor(Hm),tH=GN.set,nH=_T&&_T.prototype,Bh=_T,gT=nH,zN=tc.TypeError,vT=tc.document,ST=tc.process,TT=HN.f,iH=TT,rH=!!(vT&&vT.createEvent&&tc.dispatchEvent),YN="unhandledrejection",qN=function(n){var e;return!(!q8(n)||!fT(e=n.then))&&e},JN=function(n,e){var t,i,o,a=e.value,l=e.state==1,u=l?n.ok:n.fail,h=n.resolve,f=n.reject,m=n.domain;try{u?(l||(e.rejection===2&&oH(e),e.rejection=1),u===!0?t=a:(m&&m.enter(),t=u(a),m&&(m.exit(),o=!0)),t===n.promise?f(zN("Promise-chain cycle")):(i=qN(t))?jh(i,t,h,f):h(t)):f(a)}catch(E){m&&!o&&m.exit(),f(E)}},XN=function(n,e){n.notified||(n.notified=!0,mT(function(){for(var t,i=n.reactions;t=i.get();)JN(t,n);n.notified=!1,e&&!n.rejection&&sH(n)}))},QN=function(n,e,t){var i,o;rH?((i=vT.createEvent("Event")).promise=e,i.reason=t,i.initEvent(n,!1,!0),tc.dispatchEvent(i)):i={promise:e,reason:t},!eH&&(o=tc["on"+n])?o(i):n===YN&&Q8("Unhandled promise rejection",t)},sH=function(n){jh(BN,tc,function(){var e,t=n.facade,i=n.value;if($N(n)&&(e=$8(function(){Wm?ST.emit("unhandledRejection",i,t):QN(YN,t,i)}),n.rejection=Wm||$N(n)?2:1,e.error))throw e.value})},$N=function(n){return n.rejection!==1&&!n.parent},oH=function(n){jh(BN,tc,function(){var e=n.facade;Wm?ST.emit("rejectionHandled",e):QN("rejectionhandled",e,n.value)})},Dd=function(n,e,t){return function(i){n(e,i,t)}},kd=function(n,e,t){n.done||(n.done=!0,t&&(n=t),n.value=e,n.state=2,XN(n,!0))},yT=function(n,e,t){if(!n.done){n.done=!0,t&&(n=t);try{if(n.facade===e)throw zN("Promise can't be resolved itself");var i=qN(e);i?mT(function(){var o={done:!1};try{jh(i,e,Dd(yT,o,n),Dd(kd,o,n))}catch(a){kd(o,a,n)}}):(n.value=e,n.state=1,XN(n,!1))}catch(o){kd({done:!1},o,n)}}};KN&&(gT=(Bh=function(n){J8(this,gT),Y8(n),jh(pT,this);var e=ET(this);try{n(Dd(yT,e),Dd(kd,e))}catch(t){kd(e,t)}}).prototype,(pT=function(n){tH(this,{type:Hm,done:!1,notified:!1,parent:!1,reactions:new Z8,rejection:!1,state:0,value:void 0})}).prototype=H8(gT,"then",function(n,e){var t=ET(this),i=TT(X8(this,Bh));return t.parent=!0,i.ok=!fT(n)||n,i.fail=fT(e)&&e,i.domain=Wm?ST.domain:void 0,t.state==0?t.reactions.add(i):mT(function(){JN(i,t)}),i.promise}),jN=function(){var n=new pT,e=ET(n);this.promise=n,this.resolve=Dd(yT,e),this.reject=Dd(kd,e)},HN.f=TT=function(n){return n===Bh||n===void 0?new jN(n):iH(n)}),W8({global:!0,constructor:!0,wrap:!0,forced:KN},{Promise:Bh}),K8(Bh,Hm,!1,!0),z8(Hm);var ZN=On("iterator"),eP=!1;try{var aH=0,tP={next:function(){return{done:!!aH++}},return:function(){eP=!0}};tP[ZN]=function(){return this},Array.from(tP,function(){throw 2})}catch{}var cH=gl,lH=function(n,e){if(!e&&!eP)return!1;var t=!1;try{var i={};i[ZN]=function(){return{next:function(){return{done:t=!0}}}},n(i)}catch{}return t},Km=Fh.CONSTRUCTOR||!lH(function(n){cH.all(n).then(void 0,function(){})}),dH=We,uH=te,hH=Io,pH=Pd,fH=Lh;Xt({target:"Promise",stat:!0,forced:Km},{all:function(n){var e=this,t=hH.f(e),i=t.resolve,o=t.reject,a=pH(function(){var l=uH(e.resolve),u=[],h=0,f=1;fH(n,function(m){var E=h++,v=!1;f++,dH(l,e,m).then(function(T){v||(v=!0,u[E]=T,--f||i(u))},o)}),--f||i(u)});return a.error&&o(a.value),t.promise}});var mH=Xt,_H=Fh.CONSTRUCTOR;gl&&gl.prototype,mH({target:"Promise",proto:!0,forced:_H,real:!0},{catch:function(n){return this.then(void 0,n)}});var EH=We,gH=te,vH=Io,SH=Pd,TH=Lh;Xt({target:"Promise",stat:!0,forced:Km},{race:function(n){var e=this,t=vH.f(e),i=t.reject,o=SH(function(){var a=gH(e.resolve);TH(n,function(l){EH(a,e,l).then(t.resolve,i)})});return o.error&&i(o.value),t.promise}});var yH=We,RH=Io;Xt({target:"Promise",stat:!0,forced:Fh.CONSTRUCTOR},{reject:function(n){var e=RH.f(this);return yH(e.reject,void 0,n),e.promise}});var CH=$r,IH=_r,wH=Io,nP=function(n,e){if(CH(n),IH(e)&&e.constructor===n)return e;var t=wH.f(n);return(0,t.resolve)(e),t.promise},bH=Xt,AH=gl,OH=Fh.CONSTRUCTOR,NH=nP,PH=Li("Promise"),DH=!OH;bH({target:"Promise",stat:!0,forced:!0},{resolve:function(n){return NH(DH&&this===PH?AH:this,n)}});var kH=We,LH=te,MH=Io,xH=Pd,UH=Lh;Xt({target:"Promise",stat:!0,forced:Km},{allSettled:function(n){var e=this,t=MH.f(e),i=t.resolve,o=t.reject,a=xH(function(){var l=LH(e.resolve),u=[],h=0,f=1;UH(n,function(m){var E=h++,v=!1;f++,kH(l,e,m).then(function(T){v||(v=!0,u[E]={status:"fulfilled",value:T},--f||i(u))},function(T){v||(v=!0,u[E]={status:"rejected",reason:T},--f||i(u))})}),--f||i(u)});return a.error&&o(a.value),t.promise}});var VH=We,FH=te,jH=Li,BH=Io,GH=Pd,WH=Lh,iP="No one promise resolved";Xt({target:"Promise",stat:!0,forced:Km},{any:function(n){var e=this,t=jH("AggregateError"),i=BH.f(e),o=i.resolve,a=i.reject,l=GH(function(){var u=FH(e.resolve),h=[],f=0,m=1,E=!1;WH(n,function(v){var T=f++,A=!1;m++,VH(u,e,v).then(function(C){A||E||(E=!0,o(C))},function(C){A||E||(A=!0,h[T]=C,--m||a(new t(h,iP)))})}),--m||a(new t(h,iP))});return l.error&&a(l.value),i.promise}});var HH=Xt,RT=gl,KH=_,zH=Li,YH=Ge,qH=_N,rP=nP,JH=RT&&RT.prototype;HH({target:"Promise",proto:!0,real:!0,forced:!!RT&&KH(function(){JH.finally.call({then:function(){}},function(){})})},{finally:function(n){var e=qH(this,zH("Promise")),t=YH(n);return this.then(t?function(i){return rP(e,n()).then(function(){return i})}:n,t?function(i){return rP(e,n()).then(function(){throw i})}:n)}});var sP=Ss.Promise,X=p(sP);const XH=()=>{};function Gh(){const n={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:XH};return n.promise=new X((e,t)=>{n.resolve=i=>{n.isFinished||(n.isResolved=!0,n.isFinished=!0,e(i),n.value=i)},n.reject=i=>{n.isFinished||(n.isRejected=!0,n.isFinished=!0,t(i))}}),n}const zm=new Map,Ym=new Map,wo=new Map;var Nn,St;(function(n){n.WIN_10="Windows 10",n.WIN_81="Windows 8.1",n.WIN_8="Windows 8",n.WIN_7="Windows 7",n.WIN_VISTA="Windows Vista",n.WIN_SERVER_2003="Windows Server 2003",n.WIN_XP="Windows XP",n.WIN_2000="Windows 2000",n.ANDROID="Android",n.HARMONY_OS="HarmonyOS",n.OPEN_BSD="Open BSD",n.SUN_OS="Sun OS",n.LINUX="Linux",n.IOS="iOS",n.MAC_OS="Mac OS",n.CHROMIUM_OS="Chromium OS",n.QNX="QNX",n.UNIX="UNIX",n.BEOS="BeOS",n.OS_2="OS/2",n.SEARCH_BOT="Search Bot"})(Nn||(Nn={})),function(n){n.CHROME="Chrome",n.SAFARI="Safari",n.EDGE="Edge",n.FIREFOX="Firefox",n.OPERA="OPR",n.QQ="QQBrowser",n.WECHAT="MicroMessenger"}(St||(St={}));var CT={exports:{}};(function(n,e){(function(t,i){var o="function",a="undefined",l="object",u="string",h="major",f="model",m="name",E="type",v="vendor",T="version",A="architecture",C="console",b="mobile",D="tablet",M="smarttv",B="wearable",J="embedded",G="Amazon",q="Apple",Q="ASUS",$="BlackBerry",ue="Browser",Ee="Chrome",Ye="Firefox",st="Google",Vt="Huawei",wn="LG",Wt="Microsoft",Rr="Motorola",se="Opera",he="Samsung",Ae="Sharp",Ke="Sony",_t="Xiaomi",ve="Zebra",w="Facebook",U="Chromium OS",j="Mac OS",de=function(hn){for(var bn={},Ht=0;Ht<hn.length;Ht++)bn[hn[Ht].toUpperCase()]=hn[Ht];return bn},qe=function(hn,bn){return typeof hn===u&&jt(bn).indexOf(jt(hn))!==-1},jt=function(hn){return hn.toLowerCase()},Si=function(hn,bn){if(typeof hn===u)return hn=hn.replace(/^\s\s*/,""),typeof bn===a?hn:hn.substring(0,350)},Cr=function(hn,bn){for(var Ht,Ir,Ho,pn,Et,ur,Lc=0;Lc<bn.length&&!Et;){var ho=bn[Lc],ZM=bn[Lc+1];for(Ht=Ir=0;Ht<ho.length&&!Et&&ho[Ht];)if(Et=ho[Ht++].exec(hn))for(Ho=0;Ho<ZM.length;Ho++)ur=Et[++Ir],typeof(pn=ZM[Ho])===l&&pn.length>0?pn.length===2?typeof pn[1]==o?this[pn[0]]=pn[1].call(this,ur):this[pn[0]]=pn[1]:pn.length===3?typeof pn[1]!==o||pn[1].exec&&pn[1].test?this[pn[0]]=ur?ur.replace(pn[1],pn[2]):i:this[pn[0]]=ur?pn[1].call(this,ur,pn[2]):i:pn.length===4&&(this[pn[0]]=ur?pn[3].call(this,ur.replace(pn[1],pn[2])):i):this[pn]=ur||i;Lc+=2}},Ra=function(hn,bn){for(var Ht in bn)if(typeof bn[Ht]===l&&bn[Ht].length>0){for(var Ir=0;Ir<bn[Ht].length;Ir++)if(qe(bn[Ht][Ir],hn))return Ht==="?"?i:Ht}else if(qe(bn[Ht],hn))return Ht==="?"?i:Ht;return hn},TE={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},yE={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[T,[m,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[T,[m,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[m,T],[/opios[\/ ]+([\w\.]+)/i],[T,[m,se+" Mini"]],[/\bopr\/([\w\.]+)/i],[T,[m,se]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[m,T],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[T,[m,"UC"+ue]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[T,[m,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[T,[m,"WeChat"]],[/konqueror\/([\w\.]+)/i],[T,[m,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[T,[m,"IE"]],[/yabrowser\/([\w\.]+)/i],[T,[m,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[m,/(.+)/,"$1 Secure "+ue],T],[/\bfocus\/([\w\.]+)/i],[T,[m,Ye+" Focus"]],[/\bopt\/([\w\.]+)/i],[T,[m,se+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[T,[m,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[T,[m,"Dolphin"]],[/coast\/([\w\.]+)/i],[T,[m,se+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[T,[m,"MIUI "+ue]],[/fxios\/([-\w\.]+)/i],[T,[m,Ye]],[/\bqihu|(qi?ho?o?|360)browser/i],[[m,"360 "+ue]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[m,/(.+)/,"$1 "+ue],T],[/(comodo_dragon)\/([\w\.]+)/i],[[m,/_/g," "],T],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[m,T],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[m],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[m,w],T],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[m,T],[/\bgsa\/([\w\.]+) .*safari\//i],[T,[m,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[T,[m,Ee+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[m,Ee+" WebView"],T],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[T,[m,"Android "+ue]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[m,T],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[T,[m,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[T,m],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[m,[T,Ra,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[m,T],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[m,"Netscape"],T],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[T,[m,Ye+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[m,T],[/(cobalt)\/([\w\.]+)/i],[m,[T,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[A,"amd64"]],[/(ia32(?=;))/i],[[A,jt]],[/((?:i[346]|x)86)[;\)]/i],[[A,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[A,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[A,"armhf"]],[/windows (ce|mobile); ppc;/i],[[A,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[A,/ower/,"",jt]],[/(sun4\w)[;\)]/i],[[A,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[A,jt]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[f,[v,he],[E,D]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[f,[v,he],[E,b]],[/\((ip(?:hone|od)[\w ]*);/i],[f,[v,q],[E,b]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[f,[v,q],[E,D]],[/(macintosh);/i],[f,[v,q]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[f,[v,Ae],[E,b]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[f,[v,Vt],[E,D]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[f,[v,Vt],[E,b]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[f,/_/g," "],[v,_t],[E,b]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[f,/_/g," "],[v,_t],[E,D]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[f,[v,"OPPO"],[E,b]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[f,[v,"Vivo"],[E,b]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[f,[v,"Realme"],[E,b]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[f,[v,Rr],[E,b]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[f,[v,Rr],[E,D]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[f,[v,wn],[E,D]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[f,[v,wn],[E,b]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[f,[v,"Lenovo"],[E,D]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[f,/_/g," "],[v,"Nokia"],[E,b]],[/(pixel c)\b/i],[f,[v,st],[E,D]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[f,[v,st],[E,b]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[f,[v,Ke],[E,b]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[f,"Xperia Tablet"],[v,Ke],[E,D]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[f,[v,"OnePlus"],[E,b]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[f,[v,G],[E,D]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[f,/(.+)/g,"Fire Phone $1"],[v,G],[E,b]],[/(playbook);[-\w\),; ]+(rim)/i],[f,v,[E,D]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[f,[v,$],[E,b]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[f,[v,Q],[E,D]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[f,[v,Q],[E,b]],[/(nexus 9)/i],[f,[v,"HTC"],[E,D]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[v,[f,/_/g," "],[E,b]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[f,[v,"Acer"],[E,D]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[f,[v,"Meizu"],[E,b]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[v,f,[E,b]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[v,f,[E,D]],[/(surface duo)/i],[f,[v,Wt],[E,D]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[f,[v,"Fairphone"],[E,b]],[/(u304aa)/i],[f,[v,"AT&T"],[E,b]],[/\bsie-(\w*)/i],[f,[v,"Siemens"],[E,b]],[/\b(rct\w+) b/i],[f,[v,"RCA"],[E,D]],[/\b(venue[\d ]{2,7}) b/i],[f,[v,"Dell"],[E,D]],[/\b(q(?:mv|ta)\w+) b/i],[f,[v,"Verizon"],[E,D]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[f,[v,"Barnes & Noble"],[E,D]],[/\b(tm\d{3}\w+) b/i],[f,[v,"NuVision"],[E,D]],[/\b(k88) b/i],[f,[v,"ZTE"],[E,D]],[/\b(nx\d{3}j) b/i],[f,[v,"ZTE"],[E,b]],[/\b(gen\d{3}) b.+49h/i],[f,[v,"Swiss"],[E,b]],[/\b(zur\d{3}) b/i],[f,[v,"Swiss"],[E,D]],[/\b((zeki)?tb.*\b) b/i],[f,[v,"Zeki"],[E,D]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[v,"Dragon Touch"],f,[E,D]],[/\b(ns-?\w{0,9}) b/i],[f,[v,"Insignia"],[E,D]],[/\b((nxa|next)-?\w{0,9}) b/i],[f,[v,"NextBook"],[E,D]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[v,"Voice"],f,[E,b]],[/\b(lvtel\-)?(v1[12]) b/i],[[v,"LvTel"],f,[E,b]],[/\b(ph-1) /i],[f,[v,"Essential"],[E,b]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[f,[v,"Envizen"],[E,D]],[/\b(trio[-\w\. ]+) b/i],[f,[v,"MachSpeed"],[E,D]],[/\btu_(1491) b/i],[f,[v,"Rotor"],[E,D]],[/(shield[\w ]+) b/i],[f,[v,"Nvidia"],[E,D]],[/(sprint) (\w+)/i],[v,f,[E,b]],[/(kin\.[onetw]{3})/i],[[f,/\./g," "],[v,Wt],[E,b]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[f,[v,ve],[E,D]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[f,[v,ve],[E,b]],[/smart-tv.+(samsung)/i],[v,[E,M]],[/hbbtv.+maple;(\d+)/i],[[f,/^/,"SmartTV"],[v,he],[E,M]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[v,wn],[E,M]],[/(apple) ?tv/i],[v,[f,q+" TV"],[E,M]],[/crkey/i],[[f,Ee+"cast"],[v,st],[E,M]],[/droid.+aft(\w)( bui|\))/i],[f,[v,G],[E,M]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[f,[v,Ae],[E,M]],[/(bravia[\w ]+)( bui|\))/i],[f,[v,Ke],[E,M]],[/(mitv-\w{5}) bui/i],[f,[v,_t],[E,M]],[/Hbbtv.*(technisat) (.*);/i],[v,f,[E,M]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[v,Si],[f,Si],[E,M]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[E,M]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[v,f,[E,C]],[/droid.+; (shield) bui/i],[f,[v,"Nvidia"],[E,C]],[/(playstation [345portablevi]+)/i],[f,[v,Ke],[E,C]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[f,[v,Wt],[E,C]],[/((pebble))app/i],[v,f,[E,B]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[f,[v,q],[E,B]],[/droid.+; (glass) \d/i],[f,[v,st],[E,B]],[/droid.+; (wt63?0{2,3})\)/i],[f,[v,ve],[E,B]],[/(quest( 2| pro)?)/i],[f,[v,w],[E,B]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[v,[E,J]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[f,[E,b]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[f,[E,D]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[E,D]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[E,b]],[/(android[-\w\. ]{0,9});.+buil/i],[f,[v,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[T,[m,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[T,[m,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[m,T],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[T,m]],os:[[/microsoft (windows) (vista|xp)/i],[m,T],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[m,[T,Ra,TE]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[m,"Windows"],[T,Ra,TE]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[T,/_/g,"."],[m,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[m,j],[T,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[T,m],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[m,T],[/\(bb(10);/i],[T,[m,$]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[T,[m,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[T,[m,Ye+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[T,[m,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[T,[m,"watchOS"]],[/crkey\/([\d\.]+)/i],[T,[m,Ee+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[m,U],T],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[m,T],[/(sunos) ?([\w\.\d]*)/i],[[m,"Solaris"],T],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[m,T]]},ls=function(hn,bn){if(typeof hn===l&&(bn=hn,hn=i),!(this instanceof ls))return new ls(hn,bn).getResult();var Ht=typeof t!==a&&t.navigator?t.navigator:i,Ir=hn||(Ht&&Ht.userAgent?Ht.userAgent:""),Ho=Ht&&Ht.userAgentData?Ht.userAgentData:i,pn=bn?function(Et,ur){var Lc={};for(var ho in Et)ur[ho]&&ur[ho].length%2==0?Lc[ho]=ur[ho].concat(Et[ho]):Lc[ho]=Et[ho];return Lc}(yE,bn):yE;return this.getBrowser=function(){var Et={};return Et[m]=i,Et[T]=i,Cr.call(Et,Ir,pn.browser),Et[h]=function(ur){return typeof ur===u?ur.replace(/[^\d\.]/g,"").split(".")[0]:i}(Et[T]),Ht&&Ht.brave&&typeof Ht.brave.isBrave==o&&(Et[m]="Brave"),Et},this.getCPU=function(){var Et={};return Et[A]=i,Cr.call(Et,Ir,pn.cpu),Et},this.getDevice=function(){var Et={};return Et[v]=i,Et[f]=i,Et[E]=i,Cr.call(Et,Ir,pn.device),!Et[E]&&Ho&&Ho.mobile&&(Et[E]=b),Et[f]=="Macintosh"&&Ht&&typeof Ht.standalone!==a&&Ht.maxTouchPoints&&Ht.maxTouchPoints>2&&(Et[f]="iPad",Et[E]=D),Et},this.getEngine=function(){var Et={};return Et[m]=i,Et[T]=i,Cr.call(Et,Ir,pn.engine),Et},this.getOS=function(){var Et={};return Et[m]=i,Et[T]=i,Cr.call(Et,Ir,pn.os),!Et[m]&&Ho&&Ho.platform!="Unknown"&&(Et[m]=Ho.platform.replace(/chrome os/i,U).replace(/macos/i,j)),Et},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Ir},this.setUA=function(Et){return Ir=typeof Et===u&&Et.length>350?Si(Et,350):Et,this},this.setUA(Ir),this};ls.VERSION="0.7.34",ls.BROWSER=de([m,T,h]),ls.CPU=de([A]),ls.DEVICE=de([f,v,E,C,b,M,D,B,J]),ls.ENGINE=ls.OS=de([m,T]),n.exports&&(e=n.exports=ls),e.UAParser=ls;var kc=typeof t!==a&&(t.jQuery||t.Zepto);if(kc&&!kc.ua){var yu=new ls;kc.ua=yu.getResult(),kc.ua.get=function(){return yu.getUA()},kc.ua.set=function(hn){yu.setUA(hn);var bn=yu.getResult();for(var Ht in bn)kc.ua[Ht]=bn[Ht]}}})(typeof window=="object"?window:d)})(CT,CT.exports);const IT=new(p(CT.exports));let ia=IT.getResult(),wT=null;function ft(n){if(!wT){n&&IT.setUA(n),ia=IT.getResult();const e=function(a){if(a.engine.name==="Blink"&&a.browser.name!=="WeChat")return St.CHROME;switch(a.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return St.CHROME;case"Safari":case"Mobile Safari":return St.SAFARI;case"Edge":return St.EDGE;case"Firefox":return St.FIREFOX;case"QQBrowser":return St.QQ;case"Opera":return St.OPERA;case"WeChat":return St.WECHAT;default:return a.browser.name||""}}(ia),t=function(a){let l;return l=a.engine.name==="Blink"?a.engine.version||"":a.browser.version||"",l.split(".")[0]}(ia),i=function(a){return a.os.name==="Windows"?a.os.version?a.os.name+" "+a.os.version:a.os.name:a.os.name||""}(ia),o=ia.os.version;if(!(e&&t&&i&&o))return{name:e,version:t,os:i,osVersion:o};wT={name:e,version:t,os:i,osVersion:o}}return wT}function qm(){return ft().os}function oP(){const n=ft();return"".concat(n.os," ").concat(n.osVersion)}function Jm(){const n=ft();return!!(ia.engine.name==="WebKit"&&n.os===Nn.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&n.name!==St.SAFARI||xi()&&n.name!==St.SAFARI)}function QH(){const n=ft();if(Jm()){if(n.os===Nn.MAC_OS)return!0;if(n.os===Nn.IOS){const e=ia.os.version&&ia.os.version.split(".");if(e&&Number(e[0])===14&&e[1]&&Number(e[1])>=3||e&&Number(e[0])>14)return!0}}return!1}function $H(){return ia.engine.name==="WebKit"}function ra(){return ft().name===St.CHROME}function ii(){return ft().name===St.SAFARI}function Pt(){return ft().name===St.FIREFOX}function xi(){return ft().os===Nn.IOS}function bT(n){const e=ft();return!(e.name!==St.CHROME||!e.osVersion)&&Number(e.version)>=n}function aP(n){const e=ft();return!(e.name!==St.EDGE||!e.osVersion)&&Number(e.version)>=n}function cP(n){const e=ft();return!(e.name!==St.OPERA||!e.osVersion)&&Number(e.version)>=n}function lP(){const n=ft();return!(n.name!==St.CHROME||!n.osVersion)&&Number(n.version)<=90}function dP(){const n=ft();if(n.os!==Nn.IOS||!n.osVersion)return!1;const e=n.osVersion.split(".");return Number(e[0])<14||Number(e[0])===14&&Number(e[1])<=6}function Ld(){const n=ft();if(n.os!==Nn.IOS||!n.osVersion)return!1;const e=n.osVersion.split(".");return Number(e[0])===15}function AT(){const n=ft();if(n.os!==Nn.IOS||!n.osVersion)return!1;const e=n.osVersion.split(".");return Number(e[0])===16}function uP(){const n=ft();if(n.os!==Nn.IOS||!n.osVersion)return!1;const e=n.osVersion.split(".");return Number(e[0])===15&&Number(e[1])>=1}function bo(){return ii()&&navigator.maxTouchPoints>0}function hP(){return ft().name===St.WECHAT}function pP(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function nc(){const n=ft();return n.name===St.EDGE||n.name===St.SAFARI?!1:!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Xm(){return qm()===Nn.ANDROID}function Wh(){const n=ft();return Xm()&&(n.name===St.CHROME||n.name===St.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}var N;(function(n){n.UNEXPECTED_ERROR="UNEXPECTED_ERROR",n.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",n.TIMEOUT="TIMEOUT",n.INVALID_PARAMS="INVALID_PARAMS",n.NOT_READABLE="NOT_READABLE",n.NOT_SUPPORTED="NOT_SUPPORTED",n.INVALID_OPERATION="INVALID_OPERATION",n.OPERATION_ABORTED="OPERATION_ABORTED",n.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",n.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",n.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",n.DATACHANNEL_FAILED="DATACHANNEL_FAILED",n.NETWORK_ERROR="NETWORK_ERROR",n.NETWORK_TIMEOUT="NETWORK_TIMEOUT",n.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",n.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",n.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",n.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",n.ELECTRON_IS_NULL="ELECTRON_IS_NULL",n.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",n.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",n.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",n.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",n.PERMISSION_DENIED="PERMISSION_DENIED",n.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",n.TRACK_IS_DISABLED="TRACK_IS_DISABLED",n.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",n.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",n.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",n.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",n.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",n.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",n.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",n.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",n.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",n.UID_CONFLICT="UID_CONFLICT",n.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",n.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",n.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",n.INVALID_TRACK="INVALID_TRACK",n.SENDER_NOT_FOUND="SENDER_NOT_FOUND",n.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",n.SET_ANSWER_FAILED="SET_ANSWER_FAILED",n.ICE_FAILED="ICE_FAILED",n.PC_CLOSED="PC_CLOSED",n.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",n.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",n.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",n.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",n.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",n.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",n.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",n.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",n.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",n.INVALID_REMOTE_USER="INVALID_REMOTE_USER",n.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",n.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",n.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",n.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",n.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",n.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",n.WS_ABORT="WS_ABORT",n.WS_DISCONNECT="WS_DISCONNECT",n.WS_ERR="WS_ERR",n.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",n.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",n.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",n.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",n.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",n.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",n.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",n.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",n.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",n.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",n.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",n.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",n.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",n.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",n.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",n.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",n.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",n.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",n.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",n.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",n.INVALID_PLUGIN="INVALID_PLUGIN",n.DISCONNECT_P2P="DISCONNECT_P2P",n.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",n.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",n.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",n.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",n.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",n.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",n.PROHIBITED_OPERATION="PROHIBITED_OPERATION",n.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",n.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED"})(N||(N={}));let ne=class extends Error{constructor(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",t=arguments.length>2?arguments[2]:void 0;super(e),S(this,"code",void 0),S(this,"message",void 0),S(this,"data",void 0),S(this,"name","AgoraRTCException"),this.code=n,this.message="AgoraRTCError ".concat(this.code,": ").concat(e),this.data=t}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),`
`).concat(this.stack):"".concat(this.stack)}print(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",e=arguments.length>1?arguments[1]:void 0;return n==="error"&&(e||console).error(this.toString()),n==="warning"&&(e||console).warn(this.toString()),this}throw(n){throw this.print("error",n),this}};function sa(n,e){if(typeof n!="boolean")throw new ne(N.INVALID_PARAMS,"Invalid ".concat(e,": The value is of the boolean type."))}function Pn(n,e,t){if(!Ie(t).call(t,n))throw new ne(N.INVALID_PARAMS,"".concat(e," can only be set as ").concat(JSON.stringify(t)))}function Ot(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(n<t||n>i||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(o){return typeof o=="number"&&o%1==0}(n))throw new ne(N.INVALID_PARAMS,"invalid ".concat(e,": the value range is [").concat(t,", ").concat(i,"]. integer only"))}function OT(n,e){if(typeof n!="number"){if(!(n.min||n.max||n.ideal||n.exact))throw new ne(N.INVALID_PARAMS,"".concat(e," is not a valid ConstrainLong"));n.min!==void 0&&Ot(n.min,"".concat(e,".min"),0,1/0),n.max!==void 0&&Ot(n.max,"".concat(e,".max"),1,1/0),n.exact!==void 0&&Ot(n.exact,"".concat(e,".exact"),1,1/0),n.ideal!==void 0&&Ot(n.ideal,"".concat(e,".ideal"),1,1/0)}else Ot(n,e,1,1/0)}function fi(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,o=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(n==null)throw new ne(N.INVALID_PARAMS,"".concat(e||"param"," cannot be empty"));if(!fP(n,t,i,o))throw new ne(N.INVALID_PARAMS,"Invalid ".concat(e||"string param",": Length of the string: [").concat(t,",").concat(i,"].").concat(o?" ASCII characters only.":""))}function oa(n,e){if(!Array.isArray(n))throw new ne(N.INVALID_PARAMS,"".concat(e," should be an array"))}function tn(n){return n==null}function fP(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof n=="string"&&n.length<=t&&n.length>=e&&(!i||function(o){if(typeof o!="string")return!1;for(let a=0;a<o.length;a+=1){const l=o.charCodeAt(a);if(l<0||l>255)return!1}return!0}(n))}function mP(n,e,t){if("getBigUint64"in DataView.prototype)return n.getBigUint64(e,t);const i=n.getUint32(e,t),o=n.getUint32(e+4,t),a=+!!t,l=+!t;return BigInt(i*l+o*a)<<BigInt(32)|BigInt(i*a+o*l)}function _P(n,e,t,i){if("setBigUint64"in DataView.prototype)return n.setBigUint64(e,t,i);const o=Number(t>>BigInt(32)),a=Number(t&BigInt(4294967295));i?(n.setUint32(e+4,o,i),n.setUint32(e,a,i)):(n.setUint32(e,o,i),n.setUint32(e+4,a,i))}var Md,Qm;(function(n){n.COVERED="COVERED",n.POSITION="POSITION",n.SIZE="SIZE",n.STYLE="STYLE"})(Md||(Md={})),function(n){n.UNMOUNTED="UNMOUNTED",n.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT"}(Qm||(Qm={}));const EP=new class{constructor(){S(this,"_clientSize",null),S(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),S(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),S(this,"getStyle",n=>window.getComputedStyle(n,null)),S(this,"checkCssVisibleProperty",n=>{var e;let t=!0;const i=this.getStyle(n),{display:o,visibility:a,opacity:l,filter:u}=i;return(o==="none"||Ie(e=["hidden","collapse"]).call(e,a)||Number(l)<.1)&&(t=!1),t?(u&&u.split(" ").filter(h=>{var f;const m=h.split("(")[0];return Ie(f=["brightness","blur","opacity"]).call(f,m)}).map(h=>{const[f,m]=h.split(/\(|\)/);return[f,Number(m.match(/^[0-9\.]+/))]}).forEach(h=>{const[f,m]=h;switch(f){case"brightness":(m<.1||m>3)&&(t=!1);break;case"blur":m>3&&(t=!1);break;case"opacity":m<.1&&(t=!1)}}),t):!1}),S(this,"checkPropertyUpToAllParentNodes",(n,e)=>{let t=!0,i=!0;const o=l=>e(l);let a=n;for(;a&&i;)o(a)||(t=!1,i=!1),a=a.parentElement,a||(i=!1);return t}),S(this,"checkActualCssVisibleIncludeInherit",n=>this.checkPropertyUpToAllParentNodes(n,this.checkCssVisibleProperty)),S(this,"getSizeAboutClient",n=>{const{width:e,height:t,left:i,right:o,top:a,bottom:l}=n.getBoundingClientRect(),u=this.getClientWidth(),h=this.getClientHeight();return{width:e,height:t,left:i,right:o,top:a,bottom:l,clientWidth:u,clientHeight:h,clientMin:Math.min(u,h)}}),S(this,"checkActualSize",()=>{const{width:n,height:e,clientMin:t}=this._clientSize;return this.checkSizeIsVisible(n,e,t)}),S(this,"elementFromPoint",(n,e)=>document.elementFromPoint?document.elementFromPoint(n,e):null),S(this,"checkCoverForAPoint",(n,e,t)=>{const i=this.elementFromPoint(n,e);return i!==null&&i!==t}),S(this,"getPointPositionList",()=>{const{width:n,height:e,left:t,top:i}=this._clientSize,o=n/6,a=e/6,l=[],u=10**6;for(let h=0;h<5;h++)for(let f=0;f<5;f++){const m=(t*u+(h===0?.1:h===4?(o*h*u-1e5)/u:o*h)*u)/u,E=(i*u+(f===0?.1:f===4?(a*f*u-1e5)/u:a*f)*u)/u;l.push({x:m,y:E})}return[...l]}),S(this,"checkElementCover",n=>this.getPointPositionList().map(e=>this.checkCoverForAPoint(e.x,e.y,n)).filter(e=>!!e).length>6),S(this,"checkSizeIsVisible",(n,e,t)=>(n>50||t/n<=10)&&(e>50||t/e<=10)),S(this,"checkSizeOfPartInClient",()=>{const{left:n,right:e,top:t,bottom:i,clientHeight:o,clientWidth:a,clientMin:l}=this._clientSize;let u,h,f,m;if(n<0)u=0;else{if(!(n<a))return!1;u=n}if(e<0)return!1;if(h=e<a?e:a,t<0)f=0;else{if(!(t<o))return!1;f=t}if(i<0)return!1;m=i<o?i:o;const E=h-u,v=m-f;return this.checkSizeIsVisible(E,v,l)}),S(this,"returnHiddenResult",n=>(this._clientSize=null,{visible:!1,reason:n})),S(this,"checkOneElementVisible",n=>{if(n instanceof HTMLElement){if(this.checkElementIsMountedOnDom(n)){if(this.checkActualCssVisibleIncludeInherit(n)){if(this._clientSize=this.getSizeAboutClient(n),this.checkElementCover(n))return this.returnHiddenResult(Md.COVERED);{const e=this.checkActualSize(),t=this.checkSizeOfPartInClient();return e&&!t?this.returnHiddenResult(Md.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Md.SIZE)}}return this.returnHiddenResult(Md.STYLE)}return this.returnHiddenResult(Qm.UNMOUNTED)}return this.returnHiddenResult(Qm.INVALID_HTML_ELEMENT)}),S(this,"checkElementIsMountedOnDom",n=>this.checkPropertyUpToAllParentNodes(n,e=>e.nodeName.toUpperCase()!=="HTML"?e.parentElement!==null:!!document.documentElement))}};function NT(n){return new TextEncoder().encode(n)}const gP=function(n,e){const t=new Uint8Array(n.byteLength+e.byteLength);return t.set(new Uint8Array(n),0),t.set(new Uint8Array(e),n.byteLength),t},ZH=async n=>{const e=function(a){const l=window.atob(a),u=new Uint8Array(new ArrayBuffer(l.length));for(let h=0;h<l.length;h+=1)u[h]=l.charCodeAt(h);return u}(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),t=await window.crypto.subtle.importKey("spki",e,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),i=NT(n),o=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},t,i);return function(a){let l="";for(let u=0;u<a.length;u+=1)l+=String.fromCharCode(a[u]);return window.btoa(l)}(new Uint8Array(o))},PT=async n=>function(e,t){let i="";return new Uint8Array(e).forEach(o=>{i+=o.toString(t).padStart(2,"0")}),i}(await crypto.subtle.digest("SHA-256",NT(n)),16);class zt{constructor(){S(this,"_events",{}),S(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(t=>t.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);const i=this._events[e];this._indexOfListener(i,t)===-1&&i.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);const i=this._events[e];this._indexOfListener(i,t)===-1&&i.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;const i=this._events[e],o=this._indexOfListener(i,t);o!==-1&&i.splice(o,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const t=this._events[e].map(l=>l);for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];for(let l=0;l<t.length;l+=1){const u=t[l];u.once&&this.off(e,u.listener),u.listener.apply(this,o||[])}}safeEmit(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),o=1;o<t;o++)i[o-1]=arguments[o];[...this._events[e]||[]].forEach(a=>{a.once&&this.off(e,a.listener);try{a.listener.apply(this,i)}catch(l){console.error("safeEmit event:".concat(e," error ").concat(l==null?void 0:l.toString()))}})}_indexOfListener(e,t){let i=e.length;for(;i--;)if(e[i].listener===t)return i;return-1}}let Hh=null;function vP(){if(Hh)return Hh;if(window.electron)return Hh=window.electron;if(!window.require)return null;try{return Hh=window.require("electron"),Hh}catch{return null}}var vn,Qt,DT,ot,at,Jn,Ui,aa;function SP(n){return Ot(n.timeout,"config.timeout",0,1e5),Ot(n.timeoutFactor,"config.timeoutFactor",0,100,!1),Ot(n.maxRetryCount,"config.maxRetryConfig",0,1/0),Ot(n.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function xd(n){if(!Array.isArray(n)||n.length<1)return!1;try{n.forEach(e=>{if(!e.urls)throw Error()})}catch{return!1}return!0}function TP(n){return fi(n.turnServerURL,"turnServerURL"),fi(n.username,"username"),fi(n.password,"password"),n.udpport&&Ot(n.udpport,"udpport",1,99999,!0),n.forceturn&&sa(n.forceturn,"forceturn"),n.security&&sa(n.security,"security"),n.tcpport&&Ot(n.tcpport,"tcpport",1,99999,!0),!0}function yP(n){return n.level!==void 0&&Pn(n.level,"level",[1,2,3]),n.delay!==void 0&&Ot(n.delay,"delay",0,3e3,!0),!0}function Sn(n,e){for(var t=arguments.length,i=new Array(t>2?t-2:0),o=2;o<t;o++)i[o-2]=arguments[o];return n.getListeners(e).length===0?X.reject(new ne(N.UNEXPECTED_ERROR,"can not emit promise")):new X((a,l)=>{n.emit(e,...i,a,l)})}function Dt(n,e){if(n.getListeners(e).length===0)return X.resolve();for(var t=arguments.length,i=new Array(t>2?t-2:0),o=2;o<t;o++)i[o-2]=arguments[o];return Sn(n,e,...i)}function Er(n,e){if(n.getListeners(e).length===0)return null;for(var t=arguments.length,i=new Array(t>2?t-2:0),o=2;o<t;o++)i[o-2]=arguments[o];return vl(n,e,...i)}function vl(n,e){let t=null,i=null;for(var o=arguments.length,a=new Array(o>2?o-2:0),l=2;l<o;l++)a[l-2]=arguments[l];if(n.emit(e,...a,u=>{t=u},u=>{i=u}),i!==null)throw i;if(t===null)throw new ne(N.UNEXPECTED_ERROR,"handler is not sync");return t}(function(n){n.CREATE_CLIENT="createClient",n.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",n.SET_AREA="setArea",n.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",n.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",n.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",n.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",n.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",n.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",n.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",n.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",n.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",n.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",n.START_PROXY_SERVER="Client.startProxyServer",n.STOP_PROXY_SERVER="Client.stopProxyServer",n.SET_PROXY_SERVER="Client.setProxyServer",n.SET_TURN_SERVER="Client.setTurnServer",n.SET_CLIENT_ROLE="Client.setClientRole",n.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",n.ENABLE_DUAL_STREAM="Client.enableDualStream",n.DISABLE_DUAL_STREAM="Client.disableDualStream",n.JOIN="Client.join",n.LEAVE="Client.leave",n.PUBLISH="Client.publish",n.UNPUBLISH="Client.unpublish",n.SUBSCRIBE="Client.subscribe",n.MASS_SUBSCRIBE="Client.massSubscribe",n.MASS_UNSUBSCRIBE="Client.massUnsubscribe",n.UNSUBSCRIBE="Client.unsubscribe",n.RENEW_TOKEN="Client.renewToken",n.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",n.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",n.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",n.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",n.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",n.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",n.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",n.DATACHANNEL_FAILBACK="Client._datachannelFailback",n.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",n.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",n.START_LIVE_STREAMING="Client.startLiveStreaming",n.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",n.STOP_LIVE_STREAMING="Client.stopLiveStreaming",n.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",n.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",n.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",n.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",n.SET_CONFIG_DISTRIBUTE="_configDistribute",n.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",n.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",n.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",n.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",n.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",n.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",n.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",n.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",n.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",n.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",n.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",n.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",n.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",n.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",n.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",n.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",n.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",n.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",n.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",n.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",n.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",n.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",n.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",n.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",n.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",n.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",n.STREAM_TYPE_CHANGE="streamTypeChange",n.CONNECTION_STATE_CHANGE="connectionStateChange",n.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",n.IMAGE_MODERATION_UPLOAD="imageModerationUpload"})(vn||(vn={})),function(n){n.TRACER="tracer"}(Qt||(Qt={})),function(n){n[n.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",n[n.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",n[n.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY"}(DT||(DT={})),function(n){n.LEAVE="LEAVE",n.NETWORK_ERROR="NETWORK_ERROR",n.SERVER_ERROR="SERVER_ERROR",n.UID_BANNED="UID_BANNED",n.IP_BANNED="IP_BANNED",n.CHANNEL_BANNED="CHANNEL_BANNED",n.FALLBACK="FALLBACK",n.LICENSE_MISSING="LICENSE_MISSING",n.LICENSE_EXPIRED="LICENSE_EXPIRED",n.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",n.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",n.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",n.LICENSE_ILLEGAL="LICENSE_ILLEGAL",n.TOKEN_EXPIRE="TOKEN_EXPIRE"}(ot||(ot={})),function(n){n.CONNECTION_STATE_CHANGE="connection-state-change",n.MEDIA_RECONNECT_START="media-reconnect-start",n.MEDIA_RECONNECT_END="media-reconnect-end",n.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",n.USER_JOINED="user-joined",n.USER_LEAVED="user-left",n.USER_PUBLISHED="user-published",n.USER_UNPUBLISHED="user-unpublished",n.USER_INFO_UPDATED="user-info-updated",n.CLIENT_BANNED="client-banned",n.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",n.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",n.VOLUME_INDICATOR="volume-indicator",n.CRYPT_ERROR="crypt-error",n.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",n.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",n.NETWORK_QUALITY="network-quality",n.STREAM_TYPE_CHANGED="stream-type-changed",n.STREAM_FALLBACK="stream-fallback",n.RECEIVE_METADATA="receive-metadata",n.STREAM_MESSAGE="stream-message",n.LIVE_STREAMING_ERROR="live-streaming-error",n.LIVE_STREAMING_WARNING="live-streaming-warning",n.INJECT_STREAM_STATUS="stream-inject-status",n.EXCEPTION="exception",n.ERROR="error",n.P2P_LOST="p2p_lost",n.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",n.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",n.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",n.PUBLISHED_USER_LIST="published-user-list",n.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",n.CONTENT_INSPECT_ERROR="content-inspect-error",n.CONTENT_INSPECT_RESULT="content-inspect-result",n.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change"}(at||(at={})),function(n){n.NETWORK_ERROR="NETWORK_ERROR",n.SERVER_ERROR="SERVER_ERROR",n.MULTI_IP="MULTI_IP",n.TIMEOUT="TIMEOUT",n.OFFLINE="OFFLINE",n.LEAVE="LEAVE",n.P2P_FAILED="P2P_FAILED",n.FALLBACK="FALLBACK"}(Jn||(Jn={})),function(n){n.ONLINE="ONLINE",n.OFFLINE="OFFLINE"}(Ui||(Ui={})),function(n){n.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",n.ONLINE="ONLINE",n.OFFLINE="OFFLINE"}(aa||(aa={}));const Tn=new class extends zt{set networkState(n){this.emit(aa.NETWORK_STATE_CHANGE,n,this._networkState),n===Ui.ONLINE?this.emit(aa.ONLINE):n===Ui.OFFLINE&&(this.onlineWaiter=new X(e=>{this.once(aa.ONLINE,()=>{this.onlineWaiter=void 0,e(Ui.ONLINE)})}),this.emit(aa.OFFLINE)),this._networkState=n}get networkState(){return this._networkState}get isOnline(){return this._networkState===Ui.ONLINE}constructor(){super(),S(this,"_moduleName","network-indicator"),S(this,"_networkState",Ui.ONLINE),S(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Ui.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Ui.OFFLINE})}};var eK=te,tK=Mi,nK=ud,iK=Ya,rK=TypeError,RP=function(n){return function(e,t,i,o){eK(t);var a=tK(e),l=nK(a),u=iK(a),h=n?u-1:0,f=n?-1:1;if(i<2)for(;;){if(h in l){o=l[h],h+=f;break}if(h+=f,n?h<0:u<=h)throw rK("Reduce of empty array with no initial value")}for(;n?h>=0:u>h;h+=f)h in l&&(o=t(o,l[h],h,a));return o}},sK={left:RP(!1),right:RP(!0)}.left;Xt({target:"Array",proto:!0,forced:!xh&&Ro>79&&Ro<83||!KS("reduce")},{reduce:function(n){var e=arguments.length;return sK(this,n,e,e>1?arguments[1]:void 0)}});var oK=qa("Array").reduce,aK=x,cK=oK,kT=Array.prototype,ca=p(function(n){var e=n.reduce;return n===kT||aK(kT,n)&&e===kT.reduce?cK:e});function CP(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}function Sl(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?CP(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):CP(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function $m(n,e){const t=n.indexOf(e);t!==-1&&n.splice(t,1)}function Ud(n){const e=[];return n.forEach(t=>{e.indexOf(t)===-1&&e.push(t)}),e}function Zm(n){X!==void 0?X.resolve().then(n):setTimeout(n,0)}function xt(n){return JSON.parse(JSON.stringify(n))}function Tl(n){try{return xt(n)}catch{return n}}const IP={};function Vd(n,e){IP[e]||(IP[e]=!0,n())}function Kh(n){const e=window.atob(n),t=new Uint8Array(new ArrayBuffer(e.length));for(let i=0;i<e.length;i+=1)t[i]=e.charCodeAt(i);return t}function Fd(n){let e="";for(let t=0;t<n.length;t+=1)e+=String.fromCharCode(n[t]);return window.btoa(e)}function wP(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];const i=ca(e).call(e,(l,u)=>l+u.length,0),o=new Uint8Array(new ArrayBuffer(i));let a=0;return e.forEach(l=>{o.set(l,a),a+=l.length}),o}function Ao(n){return window.TextEncoder?new TextEncoder().encode(n).length:n.length}function bP(n){let e=0;return/DingTalk/i.test(navigator.userAgent)&&n.realFormData&&(n=n.realFormData),n.forEach(t=>{e+=typeof t=="string"?Ao(t):t.size}),e+138}function lK(n){const e=new ne(N.TIMEOUT,"timeout");return new X((t,i)=>{window.setTimeout(()=>i(e),n)})}function Xn(n){return new X(e=>{window.setTimeout(e,n)})}function Lt(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,e=arguments.length>1?arguments[1]:void 0;const t=Math.random().toString(16).substr(2,n).toLowerCase();return t.length===n?"".concat(e).concat(t):"".concat(e).concat(t)+Lt(n-t.length,"")}function LT(){return Lt(32,"").toUpperCase()}const e_=()=>{},AP=new class{constructor(){S(this,"fnMap",new Map)}throttleByKey(n,e,t,i){for(var o=arguments.length,a=new Array(o>4?o-4:0),l=4;l<o;l++)a[l-4]=arguments[l];if(this.fnMap.has(e)){const u=this.fnMap.get(e);if(u.threshold!==t){u.fn(...u.args),clearTimeout(u.timer);const h=window.setTimeout(()=>{const f=this.fnMap.get(e);f&&f.fn(...f.args),this.fnMap.delete(e)},t);this.fnMap.set(e,{fn:n,threshold:t,timer:h,args:a,skipFn:i})}else u.skipFn&&u.skipFn(...u.args),this.fnMap.set(e,Sl(Sl({},u),{},{fn:n,args:a,skipFn:i}))}else{const u=window.setTimeout(()=>{const h=this.fnMap.get(e);h&&h.fn(...h.args),this.fnMap.delete(e)},t);this.fnMap.set(e,{fn:n,threshold:t,timer:u,args:a,skipFn:i})}}},OP=AP.throttleByKey.bind(AP);function NP(n){return typeof n=="object"&&n!==null&&!(n instanceof RegExp)}function MT(n,e){if(!NP(n)||!NP(e)||Array.isArray(n)&&!Array.isArray(e)||!Array.isArray(n)&&Array.isArray(e))return e;if(Array.isArray(e)&&Array.isArray(n)){const t=[...n];for(let i=0;i<e.length;i++)t[i]=MT(n[i],e[i]);return t}{const t=Sl({},n);for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(Object.prototype.hasOwnProperty.call(n,i)?t[i]=MT(n[i],e[i]):t[i]=e[i]);return t}}function PP(n,e){let t=[0];if(e&&(t=new Array(e).fill(0)),n===0)return t;let i=0;for(;n>0&&(t[i]=255&n,n>>=8,i++,!e||i!==e););return t}let dK=1,t_=console;class Qn{static setLogger(e){t_=e}constructor(e){S(this,"lockingPromise",X.resolve()),S(this,"locks",0),S(this,"name",""),S(this,"lockId",void 0),this.lockId=dK++,e&&(this.name=e),t_.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,t_.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat(typeof e=="string"?e:""));const i=new X(a=>{t=()=>{this.locks-=1,t_.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat(typeof e=="string"?e:"")),a()}}),o=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>i),o}}function jd(n,e){return function(t,i,o){const a=o.value;if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){const l=this[e];if(!l)throw new Error("mutex property key ".concat(e," doesn't exist on ").concat(n));const u=await l.lock("From ".concat(n,".").concat(i));try{for(var h=arguments.length,f=new Array(h),m=0;m<h;m++)f[m]=arguments[m];return await a.apply(this,f)}finally{u()}},o}}const yn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function n_(n,e){const t=Math.floor(e.timeout*Math.pow(e.timeoutFactor,n));return Math.min(e.maxRetryTimeout,t)}function to(n,e,t,i){const o=Object.assign({},yn,i);let a=o.timeout;const l=async()=>{await function(f){return new X(m=>{window.setTimeout(m,f)})}(a),a*=o.timeoutFactor,a=Math.min(o.maxRetryTimeout,a)};let u=!1;const h=new X(async(f,m)=>{e=e||(()=>!1),t=t||(()=>!0);for(let E=0;E<o.maxRetryCount;E+=1){if(u)return m(new ne(N.OPERATION_ABORTED));try{const v=await n();if(!e(v,E)||E+1===o.maxRetryCount)return f(v);await l()}catch(v){if(!t(v,E)||E+1===o.maxRetryCount)return m(v);await l()}}});return h.cancel=()=>u=!0,h}let xT=class{constructor(n){S(this,"input",[]),S(this,"size",void 0),this.size=n}add(n){this.input.push(n),this.input.length>this.size&&this.input.splice(0,1)}mean(){var n;return this.input.length===0?0:ca(n=this.input).call(n,(e,t)=>e+t)/this.input.length}};function DP(n,e){return function(){return n.apply(e,arguments)}}const{toString:uK}=Object.prototype,{getPrototypeOf:UT}=Object,i_=(VT=Object.create(null),n=>{const e=uK.call(n);return VT[e]||(VT[e]=e.slice(8,-1).toLowerCase())});var VT;const Oo=n=>(n=n.toLowerCase(),e=>i_(e)===n),r_=n=>e=>typeof e===n,{isArray:Bd}=Array,zh=r_("undefined"),kP=Oo("ArrayBuffer"),hK=r_("string"),Is=r_("function"),LP=r_("number"),s_=n=>n!==null&&typeof n=="object",o_=n=>{if(i_(n)!=="object")return!1;const e=UT(n);return!(e!==null&&e!==Object.prototype&&Object.getPrototypeOf(e)!==null||Symbol.toStringTag in n||Symbol.iterator in n)},pK=Oo("Date"),fK=Oo("File"),mK=Oo("Blob"),_K=Oo("FileList"),EK=Oo("URLSearchParams");function Yh(n,e,{allOwnKeys:t=!1}={}){if(n==null)return;let i,o;if(typeof n!="object"&&(n=[n]),Bd(n))for(i=0,o=n.length;i<o;i++)e.call(null,n[i],i,n);else{const a=t?Object.getOwnPropertyNames(n):Object.keys(n),l=a.length;let u;for(i=0;i<l;i++)u=a[i],e.call(null,n[u],u,n)}}function MP(n,e){e=e.toLowerCase();const t=Object.keys(n);let i,o=t.length;for(;o-- >0;)if(i=t[o],e===i.toLowerCase())return i;return null}const xP=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:RE,UP=n=>!zh(n)&&n!==xP,gK=(FT=typeof Uint8Array<"u"&&UT(Uint8Array),n=>FT&&n instanceof FT);var FT;const vK=Oo("HTMLFormElement"),VP=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),SK=Oo("RegExp"),FP=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),i={};Yh(t,(o,a)=>{let l;(l=e(o,a,n))!==!1&&(i[a]=l||o)}),Object.defineProperties(n,i)},jT="abcdefghijklmnopqrstuvwxyz",jP="0123456789",BP={DIGIT:jP,ALPHA:jT,ALPHA_DIGIT:jT+jT.toUpperCase()+jP},TK=Oo("AsyncFunction");var we={isArray:Bd,isArrayBuffer:kP,isBuffer:function(n){return n!==null&&!zh(n)&&n.constructor!==null&&!zh(n.constructor)&&Is(n.constructor.isBuffer)&&n.constructor.isBuffer(n)},isFormData:n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||Is(n.append)&&((e=i_(n))==="formdata"||e==="object"&&Is(n.toString)&&n.toString()==="[object FormData]"))},isArrayBufferView:function(n){let e;return e=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(n):n&&n.buffer&&kP(n.buffer),e},isString:hK,isNumber:LP,isBoolean:n=>n===!0||n===!1,isObject:s_,isPlainObject:o_,isUndefined:zh,isDate:pK,isFile:fK,isBlob:mK,isRegExp:SK,isFunction:Is,isStream:n=>s_(n)&&Is(n.pipe),isURLSearchParams:EK,isTypedArray:gK,isFileList:_K,forEach:Yh,merge:function n(){const{caseless:e}=UP(this)&&this||{},t={},i=(o,a)=>{const l=e&&MP(t,a)||a;o_(t[l])&&o_(o)?t[l]=n(t[l],o):o_(o)?t[l]=n({},o):Bd(o)?t[l]=o.slice():t[l]=o};for(let o=0,a=arguments.length;o<a;o++)arguments[o]&&Yh(arguments[o],i);return t},extend:(n,e,t,{allOwnKeys:i}={})=>(Yh(e,(o,a)=>{t&&Is(o)?n[a]=DP(o,t):n[a]=o},{allOwnKeys:i}),n),trim:n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),inherits:(n,e,t,i)=>{n.prototype=Object.create(e.prototype,i),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},toFlatObject:(n,e,t,i)=>{let o,a,l;const u={};if(e=e||{},n==null)return e;do{for(o=Object.getOwnPropertyNames(n),a=o.length;a-- >0;)l=o[a],i&&!i(l,n,e)||u[l]||(e[l]=n[l],u[l]=!0);n=t!==!1&&UT(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},kindOf:i_,kindOfTest:Oo,endsWith:(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const i=n.indexOf(e,t);return i!==-1&&i===t},toArray:n=>{if(!n)return null;if(Bd(n))return n;let e=n.length;if(!LP(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},forEachEntry:(n,e)=>{const t=(n&&n[Symbol.iterator]).call(n);let i;for(;(i=t.next())&&!i.done;){const o=i.value;e.call(n,o[0],o[1])}},matchAll:(n,e)=>{let t;const i=[];for(;(t=n.exec(e))!==null;)i.push(t);return i},isHTMLForm:vK,hasOwnProperty:VP,hasOwnProp:VP,reduceDescriptors:FP,freezeMethods:n=>{FP(n,(e,t)=>{if(Is(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const i=n[t];Is(i)&&(e.enumerable=!1,"writable"in e?e.writable=!1:e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")}))})},toObjectSet:(n,e)=>{const t={},i=o=>{o.forEach(a=>{t[a]=!0})};return Bd(n)?i(n):i(String(n).split(e)),t},toCamelCase:n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,i){return t.toUpperCase()+i}),noop:()=>{},toFiniteNumber:(n,e)=>(n=+n,Number.isFinite(n)?n:e),findKey:MP,global:xP,isContextDefined:UP,ALPHABET:BP,generateString:(n=16,e=BP.ALPHA_DIGIT)=>{let t="";const{length:i}=e;for(;n--;)t+=e[Math.random()*i|0];return t},isSpecCompliantForm:function(n){return!!(n&&Is(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])},toJSONObject:n=>{const e=new Array(10),t=(i,o)=>{if(s_(i)){if(e.indexOf(i)>=0)return;if(!("toJSON"in i)){e[o]=i;const a=Bd(i)?[]:{};return Yh(i,(l,u)=>{const h=t(l,o+1);!zh(h)&&(a[u]=h)}),e[o]=void 0,a}}return i};return t(n,0)},isAsyncFn:TK,isThenable:n=>n&&(s_(n)||Is(n))&&Is(n.then)&&Is(n.catch)};function $t(n,e,t,i,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),i&&(this.request=i),o&&(this.response=o)}we.inherits($t,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:we.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const GP=$t.prototype,WP={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{WP[n]={value:n}}),Object.defineProperties($t,WP),Object.defineProperty(GP,"isAxiosError",{value:!0}),$t.from=(n,e,t,i,o,a)=>{const l=Object.create(GP);return we.toFlatObject(n,l,function(u){return u!==Error.prototype},u=>u!=="isAxiosError"),$t.call(l,n.message,e,t,i,o),l.cause=n,l.name=n.name,a&&Object.assign(l,a),l};function BT(n){return we.isPlainObject(n)||we.isArray(n)}function HP(n){return we.endsWith(n,"[]")?n.slice(0,-2):n}function KP(n,e,t){return n?n.concat(e).map(function(i,o){return i=HP(i),!t&&o?"["+i+"]":i}).join(t?".":""):e}const yK=we.toFlatObject(we,{},null,function(n){return/^is[A-Z]/.test(n)});function a_(n,e,t){if(!we.isObject(n))throw new TypeError("target must be an object");e=e||new FormData;const i=(t=we.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(v,T){return!we.isUndefined(T[v])})).metaTokens,o=t.visitor||f,a=t.dots,l=t.indexes,u=(t.Blob||typeof Blob<"u"&&Blob)&&we.isSpecCompliantForm(e);if(!we.isFunction(o))throw new TypeError("visitor must be a function");function h(v){if(v===null)return"";if(we.isDate(v))return v.toISOString();if(!u&&we.isBlob(v))throw new $t("Blob is not supported. Use a Buffer instead.");return we.isArrayBuffer(v)||we.isTypedArray(v)?u&&typeof Blob=="function"?new Blob([v]):Buffer.from(v):v}function f(v,T,A){let C=v;if(v&&!A&&typeof v=="object"){if(we.endsWith(T,"{}"))T=i?T:T.slice(0,-2),v=JSON.stringify(v);else if(we.isArray(v)&&function(b){return we.isArray(b)&&!b.some(BT)}(v)||(we.isFileList(v)||we.endsWith(T,"[]"))&&(C=we.toArray(v)))return T=HP(T),C.forEach(function(b,D){!we.isUndefined(b)&&b!==null&&e.append(l===!0?KP([T],D,a):l===null?T:T+"[]",h(b))}),!1}return!!BT(v)||(e.append(KP(A,T,a),h(v)),!1)}const m=[],E=Object.assign(yK,{defaultVisitor:f,convertValue:h,isVisitable:BT});if(!we.isObject(n))throw new TypeError("data must be an object");return function v(T,A){if(!we.isUndefined(T)){if(m.indexOf(T)!==-1)throw Error("Circular reference detected in "+A.join("."));m.push(T),we.forEach(T,function(C,b){(!(we.isUndefined(C)||C===null)&&o.call(e,C,we.isString(b)?b.trim():b,A,E))===!0&&v(C,A?A.concat(b):[b])}),m.pop()}}(n),e}function zP(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(t){return e[t]})}function GT(n,e){this._pairs=[],n&&a_(n,this,e)}const YP=GT.prototype;function RK(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function qP(n,e,t){if(!e)return n;const i=t&&t.encode||RK,o=t&&t.serialize;let a;if(a=o?o(e,t):we.isURLSearchParams(e)?e.toString():new GT(e,t).toString(i),a){const l=n.indexOf("#");l!==-1&&(n=n.slice(0,l)),n+=(n.indexOf("?")===-1?"?":"&")+a}return n}YP.append=function(n,e){this._pairs.push([n,e])},YP.toString=function(n){const e=n?function(t){return n.call(this,t,zP)}:zP;return this._pairs.map(function(t){return e(t[0])+"="+e(t[1])},"").join("&")};var JP=class{constructor(){this.handlers=[]}use(n,e,t){return this.handlers.push({fulfilled:n,rejected:e,synchronous:!!t&&t.synchronous,runWhen:t?t.runWhen:null}),this.handlers.length-1}eject(n){this.handlers[n]&&(this.handlers[n]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(n){we.forEach(this.handlers,function(e){e!==null&&n(e)})}},XP={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},CK={isBrowser:!0,classes:{URLSearchParams:typeof URLSearchParams<"u"?URLSearchParams:GT,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const QP=typeof window<"u"&&typeof document<"u",IK=($P=typeof navigator<"u"&&navigator.product,QP&&["ReactNative","NativeScript","NS"].indexOf($P)<0);var $P;const wK=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function";var No={...Object.freeze({__proto__:null,hasBrowserEnv:QP,hasStandardBrowserEnv:IK,hasStandardBrowserWebWorkerEnv:wK}),...CK};function ZP(n){function e(t,i,o,a){let l=t[a++];if(l==="__proto__")return!0;const u=Number.isFinite(+l),h=a>=t.length;return l=!l&&we.isArray(o)?o.length:l,h?(we.hasOwnProp(o,l)?o[l]=[o[l],i]:o[l]=i,!u):(o[l]&&we.isObject(o[l])||(o[l]=[]),e(t,i,o[l],a)&&we.isArray(o[l])&&(o[l]=function(f){const m={},E=Object.keys(f);let v;const T=E.length;let A;for(v=0;v<T;v++)A=E[v],m[A]=f[A];return m}(o[l])),!u)}if(we.isFormData(n)&&we.isFunction(n.entries)){const t={};return we.forEachEntry(n,(i,o)=>{e(function(a){return we.matchAll(/\w+|\[(\w*)]/g,a).map(l=>l[0]==="[]"?"":l[1]||l[0])}(i),o,t,0)}),t}return null}const WT={transitional:XP,adapter:["xhr","http"],transformRequest:[function(n,e){const t=e.getContentType()||"",i=t.indexOf("application/json")>-1,o=we.isObject(n);if(o&&we.isHTMLForm(n)&&(n=new FormData(n)),we.isFormData(n))return i?JSON.stringify(ZP(n)):n;if(we.isArrayBuffer(n)||we.isBuffer(n)||we.isStream(n)||we.isFile(n)||we.isBlob(n))return n;if(we.isArrayBufferView(n))return n.buffer;if(we.isURLSearchParams(n))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),n.toString();let a;if(o){if(t.indexOf("application/x-www-form-urlencoded")>-1)return function(l,u){return a_(l,new No.classes.URLSearchParams,Object.assign({visitor:function(h,f,m,E){return No.isNode&&we.isBuffer(h)?(this.append(f,h.toString("base64")),!1):E.defaultVisitor.apply(this,arguments)}},u))}(n,this.formSerializer).toString();if((a=we.isFileList(n))||t.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return a_(a?{"files[]":n}:n,l&&new l,this.formSerializer)}}return o||i?(e.setContentType("application/json",!1),function(l,u,h){if(we.isString(l))try{return(u||JSON.parse)(l),we.trim(l)}catch(f){if(f.name!=="SyntaxError")throw f}return(h||JSON.stringify)(l)}(n)):n}],transformResponse:[function(n){const e=this.transitional||WT.transitional,t=e&&e.forcedJSONParsing,i=this.responseType==="json";if(n&&we.isString(n)&&(t&&!this.responseType||i)){const o=!(e&&e.silentJSONParsing)&&i;try{return JSON.parse(n)}catch(a){if(o)throw a.name==="SyntaxError"?$t.from(a,$t.ERR_BAD_RESPONSE,this,null,this.response):a}}return n}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:No.classes.FormData,Blob:No.classes.Blob},validateStatus:function(n){return n>=200&&n<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};we.forEach(["delete","get","head","post","put","patch"],n=>{WT.headers[n]={}});var HT=WT;const bK=we.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),e1=Symbol("internals");function qh(n){return n&&String(n).trim().toLowerCase()}function c_(n){return n===!1||n==null?n:we.isArray(n)?n.map(c_):String(n)}function KT(n,e,t,i,o){return we.isFunction(i)?i.call(this,e,t):(o&&(e=t),we.isString(e)?we.isString(i)?e.indexOf(i)!==-1:we.isRegExp(i)?i.test(e):void 0:void 0)}class l_{constructor(e){e&&this.set(e)}set(e,t,i){const o=this;function a(u,h,f){const m=qh(h);if(!m)throw new Error("header name must be a non-empty string");const E=we.findKey(o,m);(!E||o[E]===void 0||f===!0||f===void 0&&o[E]!==!1)&&(o[E||h]=c_(u))}const l=(u,h)=>we.forEach(u,(f,m)=>a(f,m,h));return we.isPlainObject(e)||e instanceof this.constructor?l(e,t):we.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim())?l((u=>{const h={};let f,m,E;return u&&u.split(`
`).forEach(function(v){E=v.indexOf(":"),f=v.substring(0,E).trim().toLowerCase(),m=v.substring(E+1).trim(),!f||h[f]&&bK[f]||(f==="set-cookie"?h[f]?h[f].push(m):h[f]=[m]:h[f]=h[f]?h[f]+", "+m:m)}),h})(e),t):e!=null&&a(t,e,i),this}get(e,t){if(e=qh(e)){const i=we.findKey(this,e);if(i){const o=this[i];if(!t)return o;if(t===!0)return function(a){const l=Object.create(null),u=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let h;for(;h=u.exec(a);)l[h[1]]=h[2];return l}(o);if(we.isFunction(t))return t.call(this,o,i);if(we.isRegExp(t))return t.exec(o);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=qh(e)){const i=we.findKey(this,e);return!(!i||this[i]===void 0||t&&!KT(0,this[i],i,t))}return!1}delete(e,t){const i=this;let o=!1;function a(l){if(l=qh(l)){const u=we.findKey(i,l);!u||t&&!KT(0,i[u],u,t)||(delete i[u],o=!0)}}return we.isArray(e)?e.forEach(a):a(e),o}clear(e){const t=Object.keys(this);let i=t.length,o=!1;for(;i--;){const a=t[i];e&&!KT(0,this[a],a,e,!0)||(delete this[a],o=!0)}return o}normalize(e){const t=this,i={};return we.forEach(this,(o,a)=>{const l=we.findKey(i,a);if(l)return t[l]=c_(o),void delete t[a];const u=e?function(h){return h.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(f,m,E)=>m.toUpperCase()+E)}(a):String(a).trim();u!==a&&delete t[a],t[u]=c_(o),i[u]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return we.forEach(this,(i,o)=>{i!=null&&i!==!1&&(t[o]=e&&we.isArray(i)?i.join(", "):i)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const i=new this(e);return t.forEach(o=>i.set(o)),i}static accessor(e){const t=(this[e1]=this[e1]={accessors:{}}).accessors,i=this.prototype;function o(a){const l=qh(a);t[l]||(function(u,h){const f=we.toCamelCase(" "+h);["get","set","has"].forEach(m=>{Object.defineProperty(u,m+f,{value:function(E,v,T){return this[m].call(this,h,E,v,T)},configurable:!0})})}(i,a),t[l]=!0)}return we.isArray(e)?e.forEach(o):o(e),this}}l_.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),we.reduceDescriptors(l_.prototype,({value:n},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(i){this[t]=i}}}),we.freezeMethods(l_);var la=l_;function zT(n,e){const t=this||HT,i=e||t,o=la.from(i.headers);let a=i.data;return we.forEach(n,function(l){a=l.call(t,a,o.normalize(),e?e.status:void 0)}),o.normalize(),a}function t1(n){return!(!n||!n.__CANCEL__)}function Jh(n,e,t){$t.call(this,n??"canceled",$t.ERR_CANCELED,e,t),this.name="CanceledError"}we.inherits(Jh,$t,{__CANCEL__:!0});var AK=No.hasStandardBrowserEnv?{write(n,e,t,i,o,a){const l=[n+"="+encodeURIComponent(e)];we.isNumber(t)&&l.push("expires="+new Date(t).toGMTString()),we.isString(i)&&l.push("path="+i),we.isString(o)&&l.push("domain="+o),a===!0&&l.push("secure"),document.cookie=l.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function n1(n,e){return n&&!function(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}(e)?function(t,i){return i?t.replace(/\/?\/$/,"")+"/"+i.replace(/^\/+/,""):t}(n,e):e}var OK=No.hasStandardBrowserEnv?function(){const n=/(msie|trident)/i.test(navigator.userAgent),e=document.createElement("a");let t;function i(o){let a=o;return n&&(e.setAttribute("href",a),a=e.href),e.setAttribute("href",a),{href:e.href,protocol:e.protocol?e.protocol.replace(/:$/,""):"",host:e.host,search:e.search?e.search.replace(/^\?/,""):"",hash:e.hash?e.hash.replace(/^#/,""):"",hostname:e.hostname,port:e.port,pathname:e.pathname.charAt(0)==="/"?e.pathname:"/"+e.pathname}}return t=i(window.location.href),function(o){const a=we.isString(o)?i(o):o;return a.protocol===t.protocol&&a.host===t.host}}():function(){return!0};function i1(n,e){let t=0;const i=function(o,a){o=o||10;const l=new Array(o),u=new Array(o);let h,f=0,m=0;return a=a!==void 0?a:1e3,function(E){const v=Date.now(),T=u[m];h||(h=v),l[f]=E,u[f]=v;let A=m,C=0;for(;A!==f;)C+=l[A++],A%=o;if(f=(f+1)%o,f===m&&(m=(m+1)%o),v-h<a)return;const b=T&&v-T;return b?Math.round(1e3*C/b):void 0}}(50,250);return o=>{const a=o.loaded,l=o.lengthComputable?o.total:void 0,u=a-t,h=i(u);t=a;const f={loaded:a,total:l,progress:l?a/l:void 0,bytes:u,rate:h||void 0,estimated:h&&l&&a<=l?(l-a)/h:void 0,event:o};f[e?"download":"upload"]=!0,n(f)}}var NK=typeof XMLHttpRequest<"u"&&function(n){return new Promise(function(e,t){let i=n.data;const o=la.from(n.headers).normalize();let a,l,{responseType:u,withXSRFToken:h}=n;function f(){n.cancelToken&&n.cancelToken.unsubscribe(a),n.signal&&n.signal.removeEventListener("abort",a)}if(we.isFormData(i)){if(No.hasStandardBrowserEnv||No.hasStandardBrowserWebWorkerEnv)o.setContentType(!1);else if((l=o.getContentType())!==!1){const[A,...C]=l?l.split(";").map(b=>b.trim()).filter(Boolean):[];o.setContentType([A||"multipart/form-data",...C].join("; "))}}let m=new XMLHttpRequest;if(n.auth){const A=n.auth.username||"",C=n.auth.password?unescape(encodeURIComponent(n.auth.password)):"";o.set("Authorization","Basic "+btoa(A+":"+C))}const E=n1(n.baseURL,n.url);function v(){if(!m)return;const A=la.from("getAllResponseHeaders"in m&&m.getAllResponseHeaders());(function(C,b,D){const M=D.config.validateStatus;D.status&&M&&!M(D.status)?b(new $t("Request failed with status code "+D.status,[$t.ERR_BAD_REQUEST,$t.ERR_BAD_RESPONSE][Math.floor(D.status/100)-4],D.config,D.request,D)):C(D)})(function(C){e(C),f()},function(C){t(C),f()},{data:u&&u!=="text"&&u!=="json"?m.response:m.responseText,status:m.status,statusText:m.statusText,headers:A,config:n,request:m}),m=null}if(m.open(n.method.toUpperCase(),qP(E,n.params,n.paramsSerializer),!0),m.timeout=n.timeout,"onloadend"in m?m.onloadend=v:m.onreadystatechange=function(){m&&m.readyState===4&&(m.status!==0||m.responseURL&&m.responseURL.indexOf("file:")===0)&&setTimeout(v)},m.onabort=function(){m&&(t(new $t("Request aborted",$t.ECONNABORTED,n,m)),m=null)},m.onerror=function(){t(new $t("Network Error",$t.ERR_NETWORK,n,m)),m=null},m.ontimeout=function(){let A=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const C=n.transitional||XP;n.timeoutErrorMessage&&(A=n.timeoutErrorMessage),t(new $t(A,C.clarifyTimeoutError?$t.ETIMEDOUT:$t.ECONNABORTED,n,m)),m=null},No.hasStandardBrowserEnv&&(h&&we.isFunction(h)&&(h=h(n)),h||h!==!1&&OK(E))){const A=n.xsrfHeaderName&&n.xsrfCookieName&&AK.read(n.xsrfCookieName);A&&o.set(n.xsrfHeaderName,A)}i===void 0&&o.setContentType(null),"setRequestHeader"in m&&we.forEach(o.toJSON(),function(A,C){m.setRequestHeader(C,A)}),we.isUndefined(n.withCredentials)||(m.withCredentials=!!n.withCredentials),u&&u!=="json"&&(m.responseType=n.responseType),typeof n.onDownloadProgress=="function"&&m.addEventListener("progress",i1(n.onDownloadProgress,!0)),typeof n.onUploadProgress=="function"&&m.upload&&m.upload.addEventListener("progress",i1(n.onUploadProgress)),(n.cancelToken||n.signal)&&(a=A=>{m&&(t(!A||A.type?new Jh(null,n,m):A),m.abort(),m=null)},n.cancelToken&&n.cancelToken.subscribe(a),n.signal&&(n.signal.aborted?a():n.signal.addEventListener("abort",a)));const T=function(A){const C=/^([-+\w]{1,25})(:?\/\/|:)/.exec(A);return C&&C[1]||""}(E);T&&No.protocols.indexOf(T)===-1?t(new $t("Unsupported protocol "+T+":",$t.ERR_BAD_REQUEST,n)):m.send(i||null)})};const YT={http:null,xhr:NK};we.forEach(YT,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const r1=n=>`- ${n}`,PK=n=>we.isFunction(n)||n===null||n===!1;var s1={getAdapter:n=>{n=we.isArray(n)?n:[n];const{length:e}=n;let t,i;const o={};for(let a=0;a<e;a++){let l;if(t=n[a],i=t,!PK(t)&&(i=YT[(l=String(t)).toLowerCase()],i===void 0))throw new $t(`Unknown adapter '${l}'`);if(i)break;o[l||"#"+a]=i}if(!i){const a=Object.entries(o).map(([l,u])=>`adapter ${l} `+(u===!1?"is not supported by the environment":"is not available in the build"));throw new $t("There is no suitable adapter to dispatch the request "+(e?a.length>1?`since :
`+a.map(r1).join(`
`):" "+r1(a[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return i},adapters:YT};function qT(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new Jh(null,n)}function o1(n){return qT(n),n.headers=la.from(n.headers),n.data=zT.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),s1.getAdapter(n.adapter||HT.adapter)(n).then(function(e){return qT(n),e.data=zT.call(n,n.transformResponse,e),e.headers=la.from(e.headers),e},function(e){return t1(e)||(qT(n),e&&e.response&&(e.response.data=zT.call(n,n.transformResponse,e.response),e.response.headers=la.from(e.response.headers))),Promise.reject(e)})}const a1=n=>n instanceof la?n.toJSON():n;function Gd(n,e){e=e||{};const t={};function i(f,m,E){return we.isPlainObject(f)&&we.isPlainObject(m)?we.merge.call({caseless:E},f,m):we.isPlainObject(m)?we.merge({},m):we.isArray(m)?m.slice():m}function o(f,m,E){return we.isUndefined(m)?we.isUndefined(f)?void 0:i(void 0,f,E):i(f,m,E)}function a(f,m){if(!we.isUndefined(m))return i(void 0,m)}function l(f,m){return we.isUndefined(m)?we.isUndefined(f)?void 0:i(void 0,f):i(void 0,m)}function u(f,m,E){return E in e?i(f,m):E in n?i(void 0,f):void 0}const h={url:a,method:a,data:a,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,withXSRFToken:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,beforeRedirect:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:u,headers:(f,m)=>o(a1(f),a1(m),!0)};return we.forEach(Object.keys(Object.assign({},n,e)),function(f){const m=h[f]||o,E=m(n[f],e[f],f);we.isUndefined(E)&&m!==u||(t[f]=E)}),t}const c1="1.6.7",JT={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{JT[n]=function(t){return typeof t===n||"a"+(e<1?"n ":" ")+n}});const l1={};JT.transitional=function(n,e,t){function i(o,a){return"[Axios v"+c1+"] Transitional option '"+o+"'"+a+(t?". "+t:"")}return(o,a,l)=>{if(n===!1)throw new $t(i(a," has been removed"+(e?" in "+e:"")),$t.ERR_DEPRECATED);return e&&!l1[a]&&(l1[a]=!0,console.warn(i(a," has been deprecated since v"+e+" and will be removed in the near future"))),!n||n(o,a,l)}};var XT={assertOptions:function(n,e,t){if(typeof n!="object")throw new $t("options must be an object",$t.ERR_BAD_OPTION_VALUE);const i=Object.keys(n);let o=i.length;for(;o-- >0;){const a=i[o],l=e[a];if(l){const u=n[a],h=u===void 0||l(u,a,n);if(h!==!0)throw new $t("option "+a+" must be "+h,$t.ERR_BAD_OPTION_VALUE)}else if(t!==!0)throw new $t("Unknown option "+a,$t.ERR_BAD_OPTION)}},validators:JT};const ic=XT.validators;let d_=class{constructor(n){this.defaults=n,this.interceptors={request:new JP,response:new JP}}async request(n,e){try{return await this._request(n,e)}catch(t){if(t instanceof Error){let i;Error.captureStackTrace?Error.captureStackTrace(i={}):i=new Error;const o=i.stack?i.stack.replace(/^.+\n/,""):"";t.stack?o&&!String(t.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(t.stack+=`
`+o):t.stack=o}throw t}}_request(n,e){typeof n=="string"?(e=e||{}).url=n:e=n||{},e=Gd(this.defaults,e);const{transitional:t,paramsSerializer:i,headers:o}=e;t!==void 0&&XT.assertOptions(t,{silentJSONParsing:ic.transitional(ic.boolean),forcedJSONParsing:ic.transitional(ic.boolean),clarifyTimeoutError:ic.transitional(ic.boolean)},!1),i!=null&&(we.isFunction(i)?e.paramsSerializer={serialize:i}:XT.assertOptions(i,{encode:ic.function,serialize:ic.function},!0)),e.method=(e.method||this.defaults.method||"get").toLowerCase();let a=o&&we.merge(o.common,o[e.method]);o&&we.forEach(["delete","get","head","post","put","patch","common"],T=>{delete o[T]}),e.headers=la.concat(a,o);const l=[];let u=!0;this.interceptors.request.forEach(function(T){typeof T.runWhen=="function"&&T.runWhen(e)===!1||(u=u&&T.synchronous,l.unshift(T.fulfilled,T.rejected))});const h=[];let f;this.interceptors.response.forEach(function(T){h.push(T.fulfilled,T.rejected)});let m,E=0;if(!u){const T=[o1.bind(this),void 0];for(T.unshift.apply(T,l),T.push.apply(T,h),m=T.length,f=Promise.resolve(e);E<m;)f=f.then(T[E++],T[E++]);return f}m=l.length;let v=e;for(E=0;E<m;){const T=l[E++],A=l[E++];try{v=T(v)}catch(C){A.call(this,C);break}}try{f=o1.call(this,v)}catch(T){return Promise.reject(T)}for(E=0,m=h.length;E<m;)f=f.then(h[E++],h[E++]);return f}getUri(n){return qP(n1((n=Gd(this.defaults,n)).baseURL,n.url),n.params,n.paramsSerializer)}};we.forEach(["delete","get","head","options"],function(n){d_.prototype[n]=function(e,t){return this.request(Gd(t||{},{method:n,url:e,data:(t||{}).data}))}}),we.forEach(["post","put","patch"],function(n){function e(t){return function(i,o,a){return this.request(Gd(a||{},{method:n,headers:t?{"Content-Type":"multipart/form-data"}:{},url:i,data:o}))}}d_.prototype[n]=e(),d_.prototype[n+"Form"]=e(!0)});var u_=d_;class QT{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(o){t=o});const i=this;this.promise.then(o=>{if(!i._listeners)return;let a=i._listeners.length;for(;a-- >0;)i._listeners[a](o);i._listeners=null}),this.promise.then=o=>{let a;const l=new Promise(u=>{i.subscribe(u),a=u}).then(o);return l.cancel=function(){i.unsubscribe(a)},l},e(function(o,a,l){i.reason||(i.reason=new Jh(o,a,l),t(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}static source(){let e;return{token:new QT(function(t){e=t}),cancel:e}}}var DK=QT;const $T={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries($T).forEach(([n,e])=>{$T[e]=n});var kK=$T;const Ri=function n(e){const t=new u_(e),i=DP(u_.prototype.request,t);return we.extend(i,u_.prototype,t,{allOwnKeys:!0}),we.extend(i,t,null,{allOwnKeys:!0}),i.create=function(o){return n(Gd(e,o))},i}(HT);Ri.Axios=u_,Ri.CanceledError=Jh,Ri.CancelToken=DK,Ri.isCancel=t1,Ri.VERSION=c1,Ri.toFormData=a_,Ri.AxiosError=$t,Ri.Cancel=Ri.CanceledError,Ri.all=function(n){return Promise.all(n)},Ri.spread=function(n){return function(e){return n.apply(null,e)}},Ri.isAxiosError=function(n){return we.isObject(n)&&n.isAxiosError===!0},Ri.mergeConfig=Gd,Ri.AxiosHeaders=la,Ri.formToJSON=n=>ZP(we.isHTMLForm(n)?new FormData(n):n),Ri.getAdapter=s1.getAdapter,Ri.HttpStatusCode=kK,Ri.default=Ri;var rr=Ri;function d1(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}function u1(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?d1(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):d1(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}let h_,p_=0,ZT=0;function ey(n,e,t,i){return new X((o,a)=>{e.responseType=e.responseType||"json",e.data&&!t?(e.data=JSON.stringify(e.data),p_+=Ao(e.data)):t&&(e.data.size?p_+=e.data.size:e.data instanceof FormData?p_+=bP(e.data):p_+=Ao(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=n,rr.request(e).then(l=>{typeof l.data=="string"?ZT+=Ao(l.data):l.data instanceof ArrayBuffer||l.data instanceof Uint8Array?ZT+=l.data.byteLength:ZT+=Ao(JSON.stringify(l.data)),i&&o({data:l.data,headers:l.headers}),o(l.data)}).catch(l=>{rr.isCancel(l)?a(new ne(N.OPERATION_ABORTED,"cancel token canceled")):l.code==="ECONNABORTED"?a(new ne(N.NETWORK_TIMEOUT,l.message)):l.response?a(new ne(N.NETWORK_RESPONSE_ERROR,l.response.status)):a(new ne(N.NETWORK_ERROR,l.message))})})}async function LK(n,e){const t=new Blob([e.data],{type:"buffer"});return await ey(n,u1(u1({},e),{},{data:t,headers:{"Content-Type":"application/octet-stream"}}),!0)}const MK=()=>(h_||h_||(h_=(window.location.protocol.split(":")[0]||"").toUpperCase(),h_))==="HTTPS",h1=()=>window.isSecureContext!==void 0,es=function(n){if(n.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return n;const e=n.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(e&&e[1]&&e[2]){const i=e[1],o=e[2];return"".concat(i,".").concat(o)}const t=n.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(t&&t[1]&&t[2]){const i=t[1],o=t[2];return"".concat(i,".").concat(100*(Number(o)+1))}return"4.0.0.999"}("4.20.2"),ty=function(){try{return JSON.parse("true")===!0}catch{return!0}}();var da;(function(n){n.Default="default",n.Auto="auto",n.Relay="relay",n.SdRtn="sd-rtn"})(da||(da={}));const ny="v4.20.2-0-g8ae7fdad(3/20/2024, 4:48:46 PM)",Vi={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!1,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_PUB_RTX:!1,USE_SUB_RTX:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:100,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,DISABLE_FEC:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,SVC:[],ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,ENABLE_DATASTREAM_2:!1,DATASTREAM_MAX_RETRANSMITS:10,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_INSTANT_VIDEO:!1,ENABLE_NTP_REPORT:!1,USE_XR:!1,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],PLUGIN_INFO:[]};function Nt(n,e,t){var i,o;Ie(i=Object.keys(Vi)).call(i,n)&&(!t&&Ie(o=Object.keys(rc)).call(o,n)||(Vi[n]=e,n==="ENABLE_VIDEO_SEI"&&e===!0&&(Vi.ENABLE_ENCODED_TRANSFORM=!0)))}function V(n){return Vi[n]}const rc={};function p1(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}function Pe(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?p1(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):p1(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}var it;(function(n){n.SET_SESSION_ID="SET_SESSION_ID",n.SET_P2P_ID="SET_P2P_id",n.SET_DC_ID="SET_DC_id",n.SET_UID="SET_UID",n.SET_INT_UID="SET_INT_UID",n.SET_PUB_ID="SET_PUB_ID",n.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",n.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",n.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",n.AVOID_JOIN_START="AVOID_JOIN_START",n.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",n.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",n.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",n.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",n.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",n.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",n.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",n.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",n.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",n.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",n.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",n.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",n.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",n.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",n.RESET_KEY_METRICS="RESET_KEY_METRICS",n.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL",n.SET_USE_P2P="SET_USE_P2P",n.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE"})(it||(it={}));class xK{constructor(e,t,i,o){S(this,"state",void 0),this.state={codec:e,audioCodec:t,mode:i,clientId:o,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1,useP2P:!1,p2pTransport:da.Default}}dispatch(e){this.state=function(t,i){switch(i.type){case it.SET_SESSION_ID:return Pe(Pe({},t),{},{sessionId:i.sessionId});case it.SET_P2P_ID:return Pe(Pe({},t),{},{p2pId:i.p2pId});case it.SET_UID:return Pe(Pe({},t),{},{uid:i.uid});case it.SET_INT_UID:return Pe(Pe({},t),{},{intUid:i.intUid});case it.SET_PUB_ID:return Pe(Pe({},t),{},{pubId:i.pubId});case it.KEY_METRIC_CLIENT_CREATED:return Pe(Pe({},t),{},{keyMetrics:Pe(Pe({},t.keyMetrics),{},{clientCreated:i.metric})});case it.KEY_METRIC_JOIN_START:return Pe(Pe({},t),{},{keyMetrics:Pe(Pe({},t.keyMetrics),{},{joinStart:i.metric})});case it.AVOID_JOIN_START:return Pe(Pe({},t),{},{avoidJoinStart:i.avoidJoinStart});case it.KEY_METRIC_JOIN_END:return Pe(Pe({},t),{},{keyMetrics:Pe(Pe({},t.keyMetrics),{},{joinEnd:i.metric})});case it.KEY_METRIC_REQUEST_AP_START:return Pe(Pe({},t),{},{keyMetrics:Pe(Pe({},t.keyMetrics),{},{requestAPStart:i.metric})});case it.KEY_METRIC_REQUEST_AP_END:return Pe(Pe({},t),{},{keyMetrics:Pe(Pe({},t.keyMetrics),{},{requestAPEnd:i.metric})});case it.KEY_METRIC_JOIN_GATEWAY_START:return Pe(Pe({},t),{},{keyMetrics:Pe(Pe({},t.keyMetrics),{},{joinGatewayStart:i.metric})});case it.KEY_METRIC_JOIN_GATEWAY_END:return Pe(Pe({},t),{},{keyMetrics:Pe(Pe({},t.keyMetrics),{},{joinGatewayEnd:i.metric})});case it.KEY_METRIC_PEER_CONNECTION_START:return Pe(Pe({},t),{},{keyMetrics:Pe(Pe({},t.keyMetrics),{},{peerConnectionStart:i.metric})});case it.KEY_METRIC_PEER_CONNECTION_END:return Pe(Pe({},t),{},{keyMetrics:Pe(Pe({},t.keyMetrics),{},{peerConnectionEnd:i.metric})});case it.KEY_METRIC_DESCRIPTION_START:return Pe(Pe({},t),{},{keyMetrics:Pe(Pe({},t.keyMetrics),{},{descriptionStart:i.metric})});case it.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Pe(Pe({},t),{},{keyMetrics:Pe(Pe({},t.keyMetrics),{},{signalChannelOpen:i.metric})});case it.KEY_METRIC_ICE_CONNECTION_END:return Pe(Pe({},t),{},{keyMetrics:Pe(Pe({},t.keyMetrics),{},{iceConnectionEnd:i.metric})});case it.KEY_METRIC_PUBLISH:{const o=t.keyMetrics.publish,a=o.findIndex(l=>l.trackId===i.metric.trackId);return a!==-1?(o[a]=Pe(Pe({},o[a]),i.metric),Pe(Pe({},t),{},{keyMetrics:Pe(Pe({},t.keyMetrics),{},{publish:[...o]})})):Pe(Pe({},t),{},{keyMetrics:Pe(Pe({},t.keyMetrics),{},{publish:[...t.keyMetrics.publish,i.metric]})})}case it.KEY_METRIC_SUBSCRIBE:{const o=t.keyMetrics.subscribe,a=o.findIndex(l=>l.userId===i.metric.userId&&l.type===i.metric.type);return a!==-1?(o[a]=Pe(Pe({},o[a]),i.metric),Pe(Pe({},t),{},{keyMetrics:Pe(Pe({},t.keyMetrics),{},{subscribe:[...o]})})):Pe(Pe({},t),{},{keyMetrics:Pe(Pe({},t.keyMetrics),{},{subscribe:[...t.keyMetrics.subscribe,i.metric]})})}case it.SET_CLOUD_PROXY_SERVER_MODE:return t.cloudProxyServerMode=i.mode,t;case it.RECORD_JOIN_CHANNEL_SERVICE:return typeof i.index!="number"?t.joinChannelServiceRecords=[...t.joinChannelServiceRecords,i.record]:(t.joinChannelServiceRecords[i.index]=Pe(Pe({},t.joinChannelServiceRecords[i.index]),i.record),t.joinChannelServiceRecords=[...t.joinChannelServiceRecords]),t;case it.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return t.joinChannelServiceRecords=[],t;case it.RESET_KEY_METRICS:return t.keyMetrics={publish:[],subscribe:[]},t;case it.SET_USE_DATACHANNEL:return Pe(Pe({},t),{},{useDataChannel:i.val});case it.SET_USE_P2P:return Pe(Pe({},t),{},{useP2P:i.val});case it.SET_TRANSPORT_TYPE:return Pe(Pe({},t),{},{p2pTransport:i.val});default:return t}}(this.state,e)}set sessionId(e){this.dispatch({type:it.SET_SESSION_ID,sessionId:e})}get sessionId(){return this.state.sessionId}set codec(e){this.state.codec=e}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(e){this.dispatch({type:it.SET_P2P_ID,p2pId:e})}get p2pId(){return this.state.p2pId}set dcId(e){this.dispatch({type:it.SET_DC_ID,dcId:e})}get dcId(){return this.state.dcId}set uid(e){this.dispatch({type:it.SET_UID,uid:e})}get uid(){return this.state.uid}set intUid(e){this.dispatch({type:it.SET_INT_UID,intUid:e})}get intUid(){return this.state.intUid}set pubId(e){this.dispatch({type:it.SET_PUB_ID,pubId:e})}get pubId(){return this.state.pubId}set cloudProxyServerMode(e){this.dispatch({type:it.SET_CLOUD_PROXY_SERVER_MODE,mode:e})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(e){this.dispatch({type:it.SET_USE_DATACHANNEL,val:e})}get useDataChannel(){return this.state.useDataChannel}set useP2P(e){this.dispatch({type:it.SET_USE_P2P,val:e})}get useP2P(){return this.state.useP2P}set p2pTransport(e){this.dispatch({type:it.SET_TRANSPORT_TYPE,val:e})}get p2pTransport(){return this.state.p2pTransport}clientCreated(){this.dispatch({type:it.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:it.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:it.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:it.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:it.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:it.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:it.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:it.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:it.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:it.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:it.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:it.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(e,t,i,o){this.dispatch({type:it.KEY_METRIC_PUBLISH,metric:Pe(Pe({trackId:e,type:t},i&&{publishStart:i}),o&&{publishEnd:o})})}subscribe(e,t,i,o,a,l,u){this.dispatch({type:it.KEY_METRIC_SUBSCRIBE,metric:Pe(Pe(Pe(Pe(Pe({userId:e,type:t},i&&{subscribeStart:i}),o&&{subscribeEnd:o}),a&&{firstFrame:a}),l&&{streamAdded:l}),u&&{firstDecoded:u})})}massSubscribe(e,t,i,o){e.forEach(a=>{this.dispatch({type:it.KEY_METRIC_SUBSCRIBE,metric:Pe(Pe(Pe({userId:a.userId,type:a.type},t&&{subscribeStart:t}),i&&{subscribeEnd:i}),o&&{firstFrame:o})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(e,t){e.service==="gateway"&&Array.isArray(e.urls)&&(e.urls=e.urls.map(i=>i.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof t!="number"?(this.dispatch({type:it.RECORD_JOIN_CHANNEL_SERVICE,record:Pe(Pe({},e),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(t<0||t>=this.state.joinChannelServiceRecords.length||this.dispatch({type:it.RECORD_JOIN_CHANNEL_SERVICE,record:e,index:t}),t)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:it.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:it.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(e){this.dispatch({type:it.AVOID_JOIN_START,avoidJoinStart:e})}}var sc,f1;(function(n){n.h264="h264",n.h265="h265",n.vp8="vp8",n.vp9="vp9",n.av1="av1"})(sc||(sc={})),function(n){n.opus="opus",n.pcma="pcma",n.pcmu="pcmu",n.g722="g722"}(f1||(f1={}));const m1=128,UK=96,_1=1e3,Wd=10;let VK=0;const f_=new class extends zt{reportLogUploadError(n){this.emit("REPORT_LOG_UPLOAD",n)}};class FK{constructor(e){S(this,"logger",void 0),S(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.logger.debug(...this.prefixLists,...t)}info(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.logger.info(...this.prefixLists,...t)}warning(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.logger.warning(...this.prefixLists,...t)}error(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.logger.error(...this.prefixLists,...t)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}}function iy(){const n=new Date;return n.toTimeString().split(" ")[0]+":"+n.getMilliseconds()}function E1(){const n=new Date,e=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return e?(e==null?void 0:e[0])+":"+n.getUTCMilliseconds():n.toTimeString().split(" ")[0]+":"+n.getMilliseconds()}const ts={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},m_=Date.now(),Xh=n=>{for(const e in ts)if(Object.prototype.hasOwnProperty.call(ts,e)&&ts[e]===n)return e;return"DEFAULT"},y=new class{constructor(){S(this,"proxyServerURL",void 0),S(this,"logLevel",ts.DEBUG),S(this,"uploadState","collecting"),S(this,"uploadLogWaitingList",[]),S(this,"uploadLogUploadingList",[]),S(this,"uploadErrorCount",0),S(this,"currentLogID",0),S(this,"url",void 0),S(this,"extLog",(n,e)=>{this.appendLogToWaitingList(n,...e)})}debug(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];const i=[ts.DEBUG].concat(e);this.log.apply(this,i)}info(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];const i=[ts.INFO].concat(e);this.log.apply(this,i)}warning(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];const i=[ts.WARNING].concat(e);this.log.apply(this,i)}warn(){this.warning(...arguments)}error(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];const i=[ts.ERROR].concat(e);this.log.apply(this,i)}upload(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];const i=[ts.DEBUG].concat(e);this.uploadLog.apply(this,i)}setLogLevel(n){n=Math.min(Math.max(0,n),4),this.logLevel=n}enableLogUpload(){Nt("UPLOAD_LOG",!0)}disableLogUpload(){Nt("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(n){this.proxyServerURL=n}prefix(n){return new FK(this).prefix(n)}log(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];if(Date.now()-m_<100)return void setTimeout(()=>{this.log(...e)},Date.now()-m_);const i=Math.max(0,Math.min(4,e[0]));if(e[0]=iy()+" Agora-SDK [".concat(Xh(i),"]:"),this.appendLogToWaitingList(i,...e),i<this.logLevel)return;const o=iy()+" %cAgora-SDK [".concat(Xh(i),"]:");let a=[];if(!V("USE_NEW_LOG"))switch(i){case ts.DEBUG:a=[o,"color: #64B5F6;"].concat(e.slice(1)),console.log.apply(console,a);break;case ts.INFO:a=[o,"color: #1E88E5; font-weight: bold;"].concat(e.slice(1)),console.log.apply(console,a);break;case ts.WARNING:a=[o,"color: #FB8C00; font-weight: bold;"].concat(e.slice(1)),console.warn.apply(console,a);break;case ts.ERROR:a=[o,"color: #B00020; font-weight: bold;"].concat(e.slice(1)),console.error.apply(console,a)}}uploadLog(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];if(Date.now()-m_<100)return void setTimeout(()=>{this.uploadLog(...e)},Date.now()-m_);const i=Math.max(0,Math.min(4,e[0]));e[0]=iy()+" Agora-SDK [".concat(Xh(i),"]:"),this.appendLogToWaitingList(i,...e)}appendLogToWaitingList(n){if(!V("UPLOAD_LOG"))return;for(var e=arguments.length,t=new Array(e>1?e-1:0),i=1;i<e;i++)t[i-1]=arguments[i];Array.isArray(t[0])?t[0][0]=E1()+" Agora-SDK [".concat(Xh(n),"]:"):t[0]=E1()+" Agora-SDK [".concat(Xh(n),"]:");let o="";t.forEach(a=>{typeof a=="object"&&(a=JSON.stringify(a)),o+="".concat(a," ")}),this.uploadLogWaitingList.push({payload_str:o,log_level:n,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const n=this.uploadLogUploadingList,e={sdk_version:es,process_id:V("PROCESS_ID"),payload:JSON.stringify(n)};return to(async()=>{const t=await rr.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(V("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(V("LOG_UPLOAD_SERVER"),"/upload/v1")),e,{responseType:"text"});if(t.data!=="OK"){const i=new Error("unexpected upload log response");throw i.response=t,i}},()=>(this.uploadLogUploadingList=[],!1),t=>(t.response?f_.reportLogUploadError({status:t.response.status,data:t.response.data,headers:t.response.headers,message:t.message}):t.request?f_.reportLogUploadError({status:t.request.status,message:t.message}):f_.reportLogUploadError({status:-1,message:t.message}),!0),{timeout:V("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:V("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,V("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),V("UPLOAD_LOG_INTERVAL"))}).catch(n=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),V("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),V("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var g1,v1;function jK(n){return fi(n.reportId,"params.reportId",0,100,!1),fi(n.category,"params.category",0,100,!1),fi(n.event,"params.event",0,100,!1),fi(n.label,"params.label",0,100,!1),Ot(n.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(function(n){n.FREE="free",n.UPLOADING="uploading"})(g1||(g1={})),function(n){n[n.MISC=0]="MISC",n[n.INTERNAL_EVENT=1]="INTERNAL_EVENT",n[n.PUBLIC_EVENT=2]="PUBLIC_EVENT",n[n.WEB_EVENT=3]="WEB_EVENT",n[n.INTERNAL_API=4]="INTERNAL_API",n[n.WEB_API=5]="WEB_API",n[n.PUBLIC_API=6]="PUBLIC_API"}(v1||(v1={}));const BK={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};var Dn,Gt,S1,T1;function y1(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}function Xe(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?y1(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):y1(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}(function(n){n.PUBLISH="publish",n.SUBSCRIBE="subscribe",n.WS_COMPRESSOR_INIT="ws_compressor_init",n.SESSION_INIT="session_init",n.JOIN_CHOOSE_SERVER="join_choose_server",n.REQ_USER_ACCOUNT="req_user_account",n.JOIN_GATEWAY="join_gateway",n.REJOIN_GATEWAY="rejoin_gateway",n.STREAM_SWITCH="stream_switch",n.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",n.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",n.FIRST_VIDEO_RECEIVED="first_video_received",n.FIRST_AUDIO_RECEIVED="first_audio_received",n.FIRST_VIDEO_DECODE="first_video_decode",n.FIRST_AUDIO_DECODE="first_audio_decode",n.ON_ADD_AUDIO_STREAM="on_add_audio_stream",n.ON_ADD_VIDEO_STREAM="on_add_video_stream",n.ON_UPDATE_STREAM="on_update_stream",n.ON_REMOVE_STREAM="on_remove_stream",n.USER_ANALYTICS="req_user_analytics",n.PC_STATS="pc_stats",n.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities"})(Dn||(Dn={})),function(n){n.SESSION="io.agora.pb.Wrtc.Session",n.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",n.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",n.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",n.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",n.PUBLISH="io.agora.pb.Wrtc.Publish",n.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",n.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",n.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",n.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",n.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",n.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",n.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",n.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",n.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",n.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",n.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",n.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",n.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",n.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",n.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",n.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",n.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",n.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",n.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",n.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",n.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",n.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",n.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",n.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",n.PC_STATS="io.agora.pb.Wrtc.PCStats",n.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities"}(Gt||(Gt={})),function(n){n[n.WORKER_EVENT=156]="WORKER_EVENT",n[n.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(S1||(S1={})),function(n){n[n.SESSION=26]="SESSION",n[n.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",n[n.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",n[n.JOIN_GATEWAY=28]="JOIN_GATEWAY",n[n.PUBLISH=30]="PUBLISH",n[n.SUBSCRIBE=29]="SUBSCRIBE",n[n.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",n[n.STREAM_SWITCH=32]="STREAM_SWITCH",n[n.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",n[n.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",n[n.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",n[n.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",n[n.API_INVOKE=41]="API_INVOKE",n[n.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",n[n.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",n[n.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",n[n.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",n[n.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",n[n.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",n[n.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",n[n.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",n[n.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",n[n.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",n[n.WORKER_EVENT=156]="WORKER_EVENT",n[n.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",n[n.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",n[n.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",n[n.USER_ANALYTICS=1e4]="USER_ANALYTICS",n[n.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}(T1||(T1={}));class Qh{constructor(){S(this,"baseInfoMap",new Map),S(this,"proxyServer",void 0),S(this,"eventUploadTimer",void 0),S(this,"setSessionIdTimer",void 0),S(this,"url",void 0),S(this,"backupUrl",void 0),S(this,"_appId",void 0),S(this,"keyEventUploadPendingItems",[]),S(this,"normalEventUploadPendingItems",[]),S(this,"apiInvokeUploadPendingItems",[]),S(this,"apiInvokeCount",0),S(this,"ltsList",[]),S(this,"lastSendNormalEventTime",Date.now()),S(this,"customReportCounterTimer",void 0),S(this,"customReportCount",0),S(this,"extApiInvoke",async e=>{for(const t of e){const i=Xe(Xe({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Qt.TRACER});this.sendApiInvoke(i)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),V("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),V("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}adjustSessionStartTime(e){if(!this.baseInfoMap.has(e)&&!this.baseInfoMap.get(e))return void y.error("adjust session ".concat(e," start time, sid is not exist or info is undefined"));const t=this.baseInfoMap.get(e),i=Date.now(),o=t.startTime;t.startTime=i,y.debug("rewrite session ".concat(e," startTime: ").concat(i," , ").concat(i-o,"ms")),this.baseInfoMap.set(e,t)}setAppId(e){this._appId=e}reportApiInvoke(e,t,i){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const o=Date.now();this.apiInvokeCount+=1;const a=this.apiInvokeCount,l=()=>({tag:t.tag,invokeId:a,sid:e,name:t.name,apiInvokeTime:o,options:t.options,states:t.states||null}),u=!!V("SHOW_REPORT_INVOKER_LOG");u&&y.info("".concat(t.name," start"),t.options);let h=!1;Xn(t.timeout).then(()=>{h||(this.sendApiInvoke(Xe(Xe({},l()),{},{error:N.API_INVOKE_TIMEOUT,success:!1})),y.debug("".concat(t.name," timeout")))});const f=new ne(N.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:m=>{const E=()=>{if(h)throw f;return h=!0,this.sendApiInvoke(Xe(Xe({},l()),{},{success:!0},t.reportResult&&{result:m})),u&&y.info("".concat(t.name," onSuccess")),m};return i?OP(E,t.name+"Success",i,()=>h=!0):E()},onError:m=>{const E=()=>{if(h)throw m;h=!0,this.sendApiInvoke(Xe(Xe({},l()),{},{success:!1,error:m})),u&&y.info("".concat(t.name," onFailure"),m.toString())};return i?OP(E,t.name+"Error",i,()=>h=!0):E()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const i=Date.now(),o=this.createBaseInfo(e,i);o.cname=t.cname;const a=Object.assign({},{willUploadConsoleLog:V("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:ty?"global":"oversea",areas:V("AREAS")&&V("AREAS").join(",")},t.extend),{stringUid:l,channelProfile:u,channelMode:h,isABTestSuccess:f,lsid:m,clientRole:E}=t,v=Date.now(),T=Xe(Xe({},o),{},{eventType:Dn.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,build:ny,lts:v,elapse:v-i,extend:JSON.stringify(a),mode:t.mode,process:V("PROCESS_ID"),appType:V("APP_TYPE"),success:!0,version:es,stringUid:l,channelProfile:u,channelMode:h,isABTestSuccess:f,lsid:m,clientType:20,clientRole:E,serviceId:V("PROCESS_ID"),extensionID:V("PLUGIN_INFO").join(",")||""});this.send({type:Gt.SESSION,data:T},!0)}joinChooseServer(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,a=Date.now(),l=Xe(Xe({},o),{},{eventType:Dn.JOIN_CHOOSE_SERVER,lts:a,eventElapse:a-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:a-i.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3});this.send({type:Gt.JOIN_CHOOSE_SERVER,data:l},!0)}reqUserAccount(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,a=Date.now(),l=Xe(Xe({},o),{},{eventType:Dn.REQ_USER_ACCOUNT,lts:a,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:a-i.startTime,eventElapse:a-t.lts,extend:JSON.stringify(t.extend)});this.send({type:Gt.REQ_USER_ACCOUNT,data:l},!0)}joinGateway(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info;t.vid&&(o.vid=t.vid),o.uid=t.uid,o.cid=t.cid;const a=Date.now(),{firstSuccess:l,avoidJoinStartTime:u,isProxy:h,addr:f}=t,m=a-(l&&u?u:i.startTime),E=Xe(Xe({},o),{},{eventType:Dn.JOIN_GATEWAY,lts:a,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,elapse:m,eventElapse:a-t.lts,firstSuccess:l,signalChannel:t.signalChannel}),v=E.success?1:0;if(t.succ&&(i.lastJoinSuccessTime=a),l)this.send({type:Gt.JOIN_GATEWAY,data:E},!0);else{let T;if(f)if(h){const C=f.match(/h=(\d{1,3}-){3}\d{1,3}/g),b=f.match(/p=[0-9]{1,6}/g);T={isSuccess:v,gatewayIp:C&&C.length?C[0].split("=")[1].replace(/-/g,"."):"",port:b&&b.length?b[0].split("=")[1]:"",isProxy:h?1:0}}else{const C=f.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),b=f.match(/(:|p=)[0-9]{1,6}/g);T={isSuccess:v,gatewayIp:C&&C.length?C[0].split("//")[1].replace(/-/g,"."):"",port:b&&b.length?b[0].split(/:|p=/g)[1]:"",isProxy:h?1:0}}else T={isSuccess:v,gatewayIp:"",port:"",isProxy:h?1:0};delete E.success,delete E.eventType,delete E.firstSuccess,E.vid=Number(E.vid);const A=Object.assign({},E,T,{eventType:Dn.REJOIN_GATEWAY});this.send({type:Gt.RE_JOIN_GATEWAY,data:A},!0)}}joinChannelTimeout(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const o=Date.now(),a=Xe(Xe({},i.info),{},{lts:o,timeout:t,elapse:o-i.startTime});this.send({type:Gt.JOIN_CHANNEL_TIMEOUT,data:a},!0)}publish(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,a=Date.now(),l=Xe(Xe({},o),{},{eventType:Dn.PUBLISH,lts:a,eventElapse:t.eventElapse,elapse:a-i.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:Gt.PUBLISH,data:l},!0)}subscribe(e,t,i){const o=this.baseInfoMap.get(e);if(!o)return;const a=o.info,l=Date.now(),u=Xe(Xe({},a),{},{eventType:Dn.SUBSCRIBE,lts:l,eventElapse:t.eventElapse,elapse:l-o.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid},i&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?u.peerSuid=t.peerid:u.peer=t.peerid,this.send({type:Gt.SUBSCRIBE,data:u},!0)}wsCompressorInit(e){var t;const i=[...Dr(t=this.baseInfoMap).call(t)],o=i.length?i[0]:"UnableToGetSid",a=this.baseInfoMap.get(o);if(!a)return;const l=a.info,u=Date.now(),h=Xe(Xe({},l),{},{eventType:Dn.WS_COMPRESSOR_INIT,lts:u,eventElapse:e.eventElapse,elapse:u-a.startTime,status:e.status?1:2});this.send({type:Gt.WS_COMPRESSOR_INIT,data:h},!0)}firstRemoteVideoDecode(e,t,i,o){const a=this.baseInfoMap.get(e);if(!a)return;const l=a.info,u=Date.now(),h=Xe(Xe(Xe({},l),o),{},{elapse:u-a.startTime,eventType:t,lts:u,firstDecodeFrame:Math.max(u-a.startTime,0),apEnd:Math.max(o.apEnd-a.startTime,0),apStart:Math.max(o.apStart-a.startTime,0),joinGwEnd:Math.max(o.joinGwEnd-a.startTime,0),joinGwStart:Math.max(o.joinGwStart-a.startTime,0),pcEnd:Math.max(o.pcEnd-a.startTime,0),pcStart:Math.max(o.pcStart-a.startTime,0),subscriberEnd:Math.max(o.subscriberEnd-a.startTime,0),subscriberStart:Math.max(o.subscriberStart-a.startTime,0),videoAddNotify:Math.max(o.videoAddNotify-a.startTime,0)});this.send({type:i,data:h},!0)}firstRemoteFrame(e,t,i,o){const a=this.baseInfoMap.get(e);if(!a)return;const l=a.info,u=Date.now(),h=Xe(Xe(Xe({},l),o),{},{elapse:u-a.startTime,eventType:t,lts:u});this.send({type:i,data:h},!0)}pcStats(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,a=Date.now(),l=Xe(Xe(Xe({},o),t),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:a-i.startTime,eventType:Dn.PC_STATS,lts:a});this.send({type:Gt.PC_STATS,data:l},!0)}updateRemoteRTPCapabilities(e,t){if(e){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,a=Date.now(),l=Xe(Xe(Xe({},o),t),{},{vid:o.vid===void 0?0:Number(o.vid),eventType:Dn.UPDATE_REMOTE_RTPCAPABILITIES,lts:a});this.send({type:Gt.UPDATE_REMOTE_RTPCAPABILITIES,data:l},!0)}}onGatewayStream(e,t,i,o){const a=this.baseInfoMap.get(e);if(!a)return;const l=a.info,u=Date.now(),h=Xe(Xe(Xe({},l),o),{},{eventType:t,lts:u});this.send({type:i,data:h},!0)}streamSwitch(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,a=Date.now(),l=Xe(Xe({},o),{},{eventType:Dn.STREAM_SWITCH,lts:a,isDual:t.isdual,elapse:a-i.startTime,success:t.succ});this.send({type:Gt.STREAM_SWITCH,data:l},!0)}requestProxyAppCenter(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,a=Date.now(),l=Xe(Xe({},o),{},{eventType:Dn.REQUEST_PROXY_APPCENTER,lts:a,eventElapse:a-t.lts,elapse:a-i.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Gt.REQUEST_PROXY_APPCENTER,data:l},!0)}requestProxyWorkerManager(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,a=Date.now(),l=Xe(Xe({},o),{},{eventType:Dn.REQUEST_PROXY_WORKER_MANAGER,lts:a,eventElapse:a-t.lts,elapse:a-i.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Gt.REQUEST_PROXY_WORKER_MANAGER,data:l},!0)}setProxyServer(e){this.proxyServer=e,e?y.debug("reportProxyServerurl: ".concat(e)):y.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,a=Date.now(),l=Xe(Xe({},o),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:a,elapse:a-i.startTime,joinChannelSuccessElapse:a-(i.lastJoinSuccessTime||a),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:Gt.PEER_PUBLISH_STATUS,data:l},!0)}workerEvent(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,a=Date.now();(function(u,h,f){const m=u[h];if(!m||typeof m!="string")return[u];u[h]="";const E=Ao(JSON.stringify(u));let v=0;const T=[];let A=0;for(let C=0;C<m.length;C++)A+=m.charCodeAt(C)<=127?1:3,A<=f-E||(T[T.length]=Sl(Sl({},u),{},{[h]:m.substring(v,C)}),v=C,A=m.charCodeAt(C)<=127?1:3);return v!==m.length-1&&(T[T.length]=Sl(Sl({},u),{},{[h]:m.substring(v)})),T})(Xe(Xe(Xe({},o),t),{},{elapse:a-i.startTime,lts:a,productType:"WebRTC"}),"payload",1300).forEach(u=>this.send({type:Gt.WORKER_EVENT,data:u},!0))}apworkerEvent(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,a=Date.now(),l=Xe(Xe(Xe({},o),t),{},{elapse:a-i.startTime,lts:a});this.send({type:Gt.AP_WORKER_EVENT,data:l},!0)}joinWebProxyAP(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,a=Date.now(),l=Xe(Xe(Xe({},o),t),{},{elapse:a-i.startTime,lts:a,extend:t.extend||void 0});this.send({type:Gt.JOIN_WEB_PROXY_AP,data:l},!0)}WebSocketQuit(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,a=Date.now(),l=Xe(Xe(Xe({},o),t),{},{elapse:a-i.startTime,lts:a});this.send({type:Gt.WEBSOCKET_QUIT,data:l},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>V("CUSTOM_REPORT_LIMIT"))throw new ne(N.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const i=Date.now(),o=t.map(a=>({type:Gt.USER_ANALYTICS,data:Xe(Xe({sid:e},a),{},{lts:i})}));try{V("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(o):await this.postDataToStatsCollector(o)}catch(a){throw y.error("send custom report message failed",a.toString()),new ne(N.CUSTOM_REPORT_SEND_FAILED,a.message)}}sendApiInvoke(e){const t=V("NOT_REPORT_EVENT");if(e.tag&&Ie(t)&&Ie(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const i=this.baseInfoMap.get(e.sid);if(!i)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:o,uid:a,cid:l}=i.info;let u;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof ne){const{code:f,message:m}=e.error;u=f||m||e.error.toString()}else u=e.error.toString();const h={invokeId:e.invokeId,sid:e.sid,cname:o,cid:l,uid:a,lts:e.lts,success:e.success,elapse:e.lts-i.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?u:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:Gt.API_INVOKE,data:h},!1),!0}appendSessionId(){Qh.__CLIENT_LIST__.forEach(e=>{if(e._sessionId){const t=this.apiInvokeUploadPendingItems.length;for(let i=0;i<t;i++){const o=this.apiInvokeUploadPendingItems.shift();o&&(o.sid=e._sessionId,this.sendApiInvoke(Object.assign({},o)))}}})}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>V("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const i=[],o=[];for(;e.length;){const l=e.shift();i.length<20?i.push(l):o.push(l)}e.push(...o);for(const l of[...i]){var a;this.ltsList.indexOf(l.data.lts)!==-1?(l.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(l.data.lts)):(this.ltsList.push(l.data.lts),kh(a=this.ltsList).call(a,(u,h)=>u-h))}return t||(this.lastSendNormalEventTime=Date.now()),V("ENABLE_EVENT_REPORT")&&i.length&&(V("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(i):this.postDataToStatsCollector(i)).catch((l=>u=>{V("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(l):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(l),this.normalEventUploadPendingItems.length>V("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-V("NORMAL_EVENT_QUEUE_CAPACITY")),y.warning("report: drop normal events"))))})(i)),e}async postDataToStatsCollector2(e){Tn.networkState===Ui.OFFLINE&&await X.race([Tn.onlineWaiter,Xn(2*yn.maxRetryTimeout)]);const t=a=>{let l=new Uint8Array;return a.forEach(u=>{const h=NT(JSON.stringify(u.data)),f=new ArrayBuffer(5),m=(v=>{let T=0;return Object.entries(Gt).forEach(A=>{let[C,b]=A;b===v.type&&(T=EventNameToID[C])}),T})(u),E=new DataView(f);E.setUint16(0,h.byteLength,!0),E.setUint8(2,255&m),E.setUint8(3,m>>>8&255),E.setUint8(4,m>>>16&255),l=gP(l,new Uint8Array(f)),l=gP(l,h)}),l},i="event";let o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(V("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(i):"https://".concat(V("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(i);for(let a=0;a<2;a+=1){a===1&&(o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(V("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(i):"https://".concat(V("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(i));try{await ey(o,{timeout:1e4,data:t(e),headers:Xe(Xe({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(l){if(a===1)throw l;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(l=>JSON.stringify(l)),vid:(l=>{const u=l&&l.data.sid&&this.baseInfoMap.get(l.data.sid);return u&&u.info.vid&&+u.info.vid||0})(e[0])};Tn.networkState===Ui.OFFLINE&&await X.race([Tn.onlineWaiter,Xn(2*yn.maxRetryTimeout)]);const o=t?"/events/proto-raws":"/events/messages";let a=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(V("EVENT_REPORT_DOMAIN"),"&p=").concat(V("STATS_COLLECTOR_PORT"),"&d=").concat(o):"https://".concat(V("EVENT_REPORT_DOMAIN"),":").concat(V("STATS_COLLECTOR_PORT")).concat(o));for(let l=0;l<2;l+=1){l===1&&(a=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(V("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(V("STATS_COLLECTOR_PORT"),"&d=").concat(o):"https://".concat(V("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(V("STATS_COLLECTOR_PORT")).concat(o)));try{t?await LK(a,{timeout:1e4,data:i}):await ey(a,{timeout:1e4,data:i})}catch(u){if(l===1)throw u;continue}return}}createBaseInfo(e,t){const i=Object.assign({},BK);return i.sid=e,this.baseInfoMap.set(e,{info:i,startTime:t}),i}reportResourceTiming(e,t){const i=performance.getEntriesByName(e),o=i[i.length-1];o&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:o,tag:Qt.TRACER}).onSuccess()}}function Le(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(e,t,i){const o=i.value;if(typeof o=="function"){const a=n.className||e.__className__||(e.constructor.name==="AgoraRTCClient"?"Client":e.constructor.name);i.value=function(){for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];let f=u;if(n.argsMap)try{f=n.argsMap(this,...u)}catch(E){y.warning(E),f=[]}try{JSON.stringify(f)}catch{y.warning("arguments for method ".concat(a,".").concat(String(t)," not serializable for apiInvoke.")),f=[]}const m=(n.report||Oe).reportApiInvoke(this._sessionId||null,{name:"".concat(a,".").concat(String(t)),options:f,tag:Qt.TRACER,reportResult:n.reportResult},n.throttleTime);try{const E=o.apply(this,u);return E instanceof X?E.then(v=>(m.onSuccess(n.reportResult&&v),v)).catch(v=>{throw m.onError(v),v}):(m.onSuccess(n.reportResult&&E),E)}catch(E){throw m.onError(E),E}}}return i}}S(Qh,"__CLIENT_LIST__",[]);const Oe=new Qh;f_.on("REPORT_LOG_UPLOAD",n=>{n.networkState=Tn.networkState,Oe.reportApiInvoke(null,{name:"logUploadError",options:n,tag:Qt.TRACER})});const GK=["CHINA","GLOBAL"],Wi=function(){const n="us".concat("erna","me"),e="pa".concat("sswo","rd"),t=["t","s","t"];t.splice(1,0,"e");const i=t.join(""),o=[];for(let u=0;u<6;u++)o.push("1");const a=o.join(""),l={};return l[n]=i,l[e]=a,Object.assign(l,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Wi,ty||(Vi.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Vi.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Vi.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Vi.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Vi.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Vi.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Vi.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Vi.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Vi.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Vi.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Vi.AREAS=["NORTH_AMERICA","OVERSEA"]);const R1=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],oc=[];function yl(n,e){return!!e&&oc.some(t=>t.uid===n&&t.channelName===e)}Qh.__CLIENT_LIST__=oc;var ry,sr,Hd,$h,kr,Ci,ke,tt,ye,Ne,ua,He,C1,Ii,je,kn,ac,WK=qa("Array").values,HK=Ja,KK=Fn,zK=x,YK=WK,sy=Array.prototype,qK={DOMTokenList:!0,NodeList:!0},no=p(function(n){var e=n.values;return n===sy||zK(sy,n)&&e===sy.values||KK(qK,HK(n))?YK:e});function ie(n,e,t,i){var o,a=arguments.length,l=a<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(n,e,t,i);else for(var u=n.length-1;u>=0;u--)(o=n[u])&&(l=(a<3?o(l):a>3?o(e,t,l):o(e,t))||l);return a>3&&l&&Object.defineProperty(e,t,l),l}function O(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)}(function(n){n.L1T1="L1T1",n.L1T2="L1T2",n.L1T3="L1T3",n.L2T1_KEY="L2T1_KEY",n.L2T2_KEY="L2T2_KEY",n.L2T3_KEY="L2T3_KEY",n.L3T1_KEY="L3T1_KEY",n.L3T2_KEY="L3T2_KEY",n.L3T3_KEY="L3T3_KEY"})(ry||(ry={})),function(n){n.CERTIFICATE="certificate",n.CODEC="codec",n.CANDIDATE_PAIR="candidate-pair",n.LOCAL_CANDIDATE="local-candidate",n.REMOTE_CANDIDATE="remote-candidate",n.INBOUND="inbound-rtp",n.TRACK="track",n.OUTBOUND="outbound-rtp",n.PC="peer-connection",n.REMOTE_INBOUND="remote-inbound-rtp",n.REMOTE_OUTBOUND="remote-outbound-rtp",n.TRANSPORT="transport",n.CSRC="csrc",n.DATA_CHANNEL="data-channel",n.STREAM="stream",n.SENDER="sender",n.RECEIVER="receiver"}(sr||(sr={})),function(n){n[n.ACCESS_POINT=101]="ACCESS_POINT",n[n.UNILBS=201]="UNILBS",n[n.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(Hd||(Hd={})),function(n){n[n.IIIEGAL_APPID=1]="IIIEGAL_APPID",n[n.IIIEGAL_UID=2]="IIIEGAL_UID",n[n.INTERNAL_ERROR=3]="INTERNAL_ERROR"}($h||($h={})),function(n){n[n.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",n[n.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",n[n.INTERNAL_ERROR=8]="INTERNAL_ERROR",n[n.NO_AUTHORIZED=9]="NO_AUTHORIZED",n[n.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",n[n.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",n[n.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",n[n.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",n[n.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",n[n.USER_OVERLOAD=16]="USER_OVERLOAD",n[n.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",n[n.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(kr||(kr={})),function(n){n[n.NO_FLAG_SET=100]="NO_FLAG_SET",n[n.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",n[n.INVALID_FALG_SET=102]="INVALID_FALG_SET",n[n.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",n[n.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",n[n.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",n[n.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",n[n.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",n[n.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",n[n.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",n[n.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",n[n.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",n[n.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",n[n.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",n[n.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",n[n.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",n[n.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",n[n.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",n[n.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(Ci||(Ci={})),function(n){n[n.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",n[n.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",n[n.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",n[n.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",n[n.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",n[n.K_TICKET_INVALID=7]="K_TICKET_INVALID",n[n.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",n[n.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",n[n.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",n[n.K_UID_BANNED=14]="K_UID_BANNED",n[n.K_IP_BANNED=15]="K_IP_BANNED",n[n.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",n[n.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",n[n.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",n[n.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",n[n.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",n[n.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",n[n.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",n[n.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",n[n.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",n[n.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",n[n.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",n[n.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",n[n.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",n[n.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",n[n.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",n[n.ERR_INVALID_UID=117]="ERR_INVALID_UID",n[n.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",n[n.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",n[n.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",n[n.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",n[n.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",n[n.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",n[n.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",n[n.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",n[n.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",n[n.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",n[n.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",n[n.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",n[n.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",n[n.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",n[n.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",n[n.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",n[n.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",n[n.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",n[n.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",n[n.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",n[n.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",n[n.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",n[n.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",n[n.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",n[n.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",n[n.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",n[n.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",n[n.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",n[n.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",n[n.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",n[n.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",n[n.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",n[n.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",n[n.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",n[n.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",n[n.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",n[n.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(ke||(ke={})),function(n){n.CONNECTING="connecting",n.CONNECTED="connected",n.RECONNECTING="reconnecting",n.CLOSED="closed"}(tt||(tt={})),function(n){n.WS_CONNECTED="ws_connected",n.WS_RECONNECTING="ws_reconnecting",n.WS_CLOSED="ws_closed",n.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",n.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",n.ON_BINARY_DATA="on_binary_data",n.REQUEST_RECOVER="request_recover",n.REQUEST_JOIN_INFO="request_join_info",n.REQUEST_REJOIN_INFO="req_rejoin_info",n.IS_P2P_DISCONNECTED="is_p2p_dis",n.DISCONNECT_P2P="dis_p2p",n.ABORT_P2P_EXECUTION="abort_p2p_execution",n.NEED_RENEW_SESSION="need-sid",n.REPORT_JOIN_GATEWAY="report_join_gateway",n.REQUEST_TIMEOUT="request_timeout",n.REQUEST_SUCCESS="request_success",n.JOIN_RESPONSE="join_response",n.DATACHANNEL_PRECONNECT="datachannel_preconnect",n.DATACHANNEL_CONNECTING="datachannel_connecting",n.DATACHANNEL_FAILBACK="datachannel_failback",n.P2P_CONNECTION="p2p_connection",n.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",n.P2P_SUBSCRIBE="p2p_subscribe",n.P2P_UNSUBSCRIBE="p2p_unsubscribe",n.P2P_EXCHANGE_SDP="p2p_exchange_sdp",n.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",n.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream"}(ye||(ye={})),function(n){n.PING="ping",n.PING_BACK="ping_back",n.JOIN="join_v3",n.REJOIN="rejoin_v3",n.LEAVE="leave",n.SET_CLIENT_ROLE="set_client_role",n.PUBLISH="publish",n.PUBLISH_DATASTREAM="publish_datastream",n.UNPUBLISH="unpublish",n.UNPUBLISH_DATASTREAM="unpublish_datastream",n.SUBSCRIBE="subscribe",n.PRE_SUBSCRIBE="pre_subscribe",n.SUBSCRIBE_DATASTREAM="subscribe_datastream",n.SUBSCRIBE_STREAMS="subscribe_streams",n.UNSUBSCRIBE="unsubscribe",n.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",n.UNSUBSCRIBE_STREAMS="unsubscribe_streams",n.SUBSCRIBE_CHANGE="subscribe_change",n.TRAFFIC_STATS="traffic_stats",n.RENEW_TOKEN="renew_token",n.SWITCH_VIDEO_STREAM="switch_video_stream",n.DEFAULT_VIDEO_STREAM="default_video_stream",n.SET_FALLBACK_OPTION="set_fallback_option",n.GATEWAY_INFO="gateway_info",n.CONTROL="control",n.SEND_METADATA="send_metadata",n.DATA_STREAM="data_stream",n.PICK_SVC_LAYER="pick_svc_layer",n.RESTART_ICE="restart_ice",n.CONNECT_PC="connect_pc",n.SET_VIDEO_PROFILE="set_video_profile",n.SET_PARAMETER="set_parameter",n.SET_RTM2_FLAG="set_rtm2_flag"}(Ne||(Ne={})),function(n){n.WRTC_STATS="wrtc_stats",n.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",n.DENOISER_STATS="denoiser_stats",n.EXTENSION_USAGE_STATS="extension_usage_stats"}(ua||(ua={})),function(n){n.ON_USER_ONLINE="on_user_online",n.ON_USER_OFFLINE="on_user_offline",n.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",n.ON_PUBLISH_STREAM="on_publish_stream",n.ON_UPLINK_STATS="on_uplink_stats",n.ON_P2P_LOST="on_p2p_lost",n.ON_REMOVE_STREAM="on_remove_stream",n.ON_ADD_AUDIO_STREAM="on_add_audio_stream",n.ON_ADD_VIDEO_STREAM="on_add_video_stream",n.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",n.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",n.ON_USER_BANNED="on_user_banned",n.ON_USER_LICENSE_BANNED="on_user_license_banned",n.ON_NOTIFICATION="on_notification",n.ON_CRYPT_ERROR="on_crypt_error",n.MUTE_AUDIO="mute_audio",n.MUTE_VIDEO="mute_video",n.UNMUTE_AUDIO="unmute_audio",n.UNMUTE_VIDEO="unmute_video",n.ON_P2P_OK="on_p2p_ok",n.RECEIVE_METADATA="receive_metadata",n.ON_DATA_STREAM="on_data_stream",n.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",n.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",n.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",n.ENABLE_LOCAL_VIDEO="enable_local_video",n.DISABLE_LOCAL_VIDEO="disable_local_video",n.ENABLE_LOCAL_AUDIO="enable_local_audio",n.DISABLE_LOCAL_AUDIO="disable_local_audio",n.ON_PUBLISHED_USER_LIST="on_published_user_list"}(He||(He={})),function(n){n.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",n.NEED_ANSWER="NEED_ANSWER",n.NEED_RENEGOTIATE="NEED_RENEGOTIATE",n.P2P_LOST="P2P_LOST",n.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",n.NEED_UNPUB="NEED_UNPUB",n.NEED_UNSUB="NEED_UNSUB",n.NEED_UPLOAD="NEED_UPLOAD",n.NEED_CONTROL="NEED_CONTROL",n.START_RECONNECT="START_RECONNECT",n.END_RECONNECT="END_RECONNECT",n.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(C1||(C1={})),function(n){n.SEND_ONLY="SEND_ONLY",n.RECEIVE_ONLY="RECEIVE_ONLY"}(Ii||(Ii={})),function(n){n.CONNECTED="websocket:connected",n.RECONNECTING="websocket:reconnecting",n.WILL_RECONNECT="websocket:will_reconnect",n.CLOSED="websocket:closed",n.FAILED="websocket:failed",n.ON_MESSAGE="websocket:on_message",n.REQUEST_NEW_URLS="websocket:request_new_urls",n.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",n.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",n.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire"}(je||(je={}));class W extends ne{constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),S(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e,y)}throw(){super.throw(y)}}function oy(n){if(typeof n!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(n))throw y.error("Invalid Channel Name ".concat(n)),new W(N.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function ay(n){if(e=n,!(typeof e=="number"&&Math.floor(e)===e&&0<=e&&e<=4294967295||fP(n,1,255)))throw new W(N.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var e;typeof n=="string"&&y.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}(function(n){n.TRANSCODE="mix_streaming",n.RAW="raw_streaming",n.INJECT="inject_streaming"})(kn||(kn={})),function(n){n[n.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",n[n.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",n[n.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",n[n.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",n[n.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",n[n.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",n[n.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",n[n.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",n[n.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",n[n.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",n[n.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN"}(ac||(ac={}));const JK={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},cy={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function ly(n,e){fi(n.url,"".concat(e,".url"),1,1e3,!1),tn(n.x)||Ot(n.x,"".concat(e,".x"),0,1e4),tn(n.y)||Ot(n.y,"".concat(e,".y"),0,1e4),tn(n.width)||Ot(n.width,"".concat(e,".width"),0,1e4),tn(n.height)||Ot(n.height,"".concat(e,".height"),0,1e4),tn(n.zOrder)||Ot(n.zOrder,"".concat(e,".zOrder"),0,255),tn(n.alpha)||Ot(n.alpha,"".concat(e,".alpha"),0,1,!1)}const XK={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},QK={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};var ws,Kd,fn,I1,wi,io,Hi,cc,vt,rn,Rl,Cn,__,pt;function w1(n){if(!n.channelName)throw new W(N.INVALID_PARAMS,"invalid channelName in info");if(typeof n.uid!="number")throw new W(N.INVALID_PARAMS,"invalid uid in info, uid must be a number");return n.token&&fi(n.token,"info.token",1,2047),ay(n.uid),oy(n.channelName),!0}(function(n){n.WARNING="@live_uap-warning",n.ERROR="@line_uap-error",n.PUBLISH_STREAM_STATUS="@live_uap-publish-status",n.INJECT_STREAM_STATUS="@live_uap-inject-status",n.WORKER_STATUS="@live_uap-worker-status",n.REQUEST_NEW_ADDRESS="@live_uap-request-address"})(ws||(ws={})),function(n){n.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(Kd||(Kd={})),function(n){n[n.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",n[n.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",n[n.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",n[n.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",n[n.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",n[n.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",n[n.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",n[n.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",n[n.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",n[n.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",n[n.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",n[n.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",n[n.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",n[n.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",n[n.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",n[n.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",n[n.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",n[n.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",n[n.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",n[n.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",n[n.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(fn||(fn={})),function(n){n.CONNECT_FAILED="connect failed",n.CONNECT_TIMEOUT="connect timeout",n.WS_DISCONNECTED="websocket disconnected",n.REQUEST_TIMEOUT="request timeout",n.REQUEST_FAILED="request failed",n.WAIT_STATUS_TIMEOUT="wait status timeout",n.WAIT_STATUS_ERROR="wait status error",n.BAD_STATE="bad state",n.WS_ABORT="ws abort",n.AP_REQUEST_TIMEOUT="AP request timeout",n.AP_JSON_PARSE_ERROR="AP json parse error",n.AP_REQUEST_ERROR="AP request error",n.AP_REQUEST_ABORT="AP request abort"}(I1||(I1={})),function(n){n[n.SetSdkProfile=0]="SetSdkProfile",n[n.SetSourceChannel=1]="SetSourceChannel",n[n.SetSourceUserId=2]="SetSourceUserId",n[n.SetDestChannel=3]="SetDestChannel",n[n.StartPacketTransfer=4]="StartPacketTransfer",n[n.StopPacketTransfer=5]="StopPacketTransfer",n[n.UpdateDestChannel=6]="UpdateDestChannel",n[n.Reconnect=7]="Reconnect",n[n.SetVideoProfile=8]="SetVideoProfile"}(wi||(wi={})),function(n){n.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",n.NETWORK_CONNECTED="NETWORK_CONNECTED",n.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",n.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",n.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",n.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",n.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",n.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",n.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",n.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}(io||(io={})),function(n){n.RELAY_STATE_IDLE="RELAY_STATE_IDLE",n.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",n.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",n.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE"}(Hi||(Hi={})),function(n){n.RELAY_OK="RELAY_OK",n.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",n.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",n.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED"}(cc||(cc={})),function(n){n.High="high",n.Low="low",n.Audio="audio",n.Screen="screen",n.ScreenLow="screen_low"}(vt||(vt={})),function(n){n.DISCONNECT="disconnect",n.CONNECTION_STATE_CHANGE="connection-state-change",n.NETWORK_QUALITY="network-quality",n.STREAM_TYPE_CHANGE="stream-type-change",n.IS_P2P_DISCONNECTED="is-p2p-dis",n.DISCONNECT_P2P="dis-p2p",n.REQUEST_NEW_GATEWAY_LIST="req-gate-url",n.NEED_RENEW_SESSION="need-sid",n.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",n.JOIN_RESPONSE="join-response",n.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",n.RESET_CONNECTION_EVENTS="reset-connection-events",n.DATACHANNEL_PRECONNECT="datachannel_preconnect",n.DATACHANNEL_FAILBACK="datachannel_failback",n.RESET_SIGNAL="reset-signal"}(rn||(rn={})),function(n){n.P2P_DISCONNECTED="P2P_DISCONNECTED",n.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",n.TIMEOUT="TIMEOUT",n.UNKNOWN_REASON="UNKNOWN_REASON"}(Rl||(Rl={})),function(n){n[n.Nothing=0]="Nothing",n[n.Audio=1]="Audio",n[n.LwoVideo=2]="LwoVideo",n[n.Video=4]="Video",n[n.Data=8]="Data",n[n.DataStream0=256]="DataStream0",n[n.DataStream1=512]="DataStream1",n[n.DataStream2=1024]="DataStream2",n[n.DataStream3=2048]="DataStream3",n[n.DataStream4=4096]="DataStream4",n[n.DataStream5=8192]="DataStream5",n[n.DataStream6=16384]="DataStream6",n[n.DataStream7=32768]="DataStream7"}(Cn||(Cn={})),function(n){n[n.websocket=0]="websocket",n[n.datachannel=1]="datachannel"}(__||(__={})),function(n){n.CHINA="CHINA",n.ASIA="ASIA",n.NORTH_AMERICA="NORTH_AMERICA",n.EUROPE="EUROPE",n.JAPAN="JAPAN",n.INDIA="INDIA",n.KOREA="KOREA",n.HKMC="HKMC",n.US="US",n.OCEANIA="OCEANIA",n.SOUTH_AMERICA="SOUTH_AMERICA",n.AFRICA="AFRICA",n.OVERSEA="OVERSEA",n.GLOBAL="GLOBAL",n.EXTENSIONS="EXTENSIONS"}(pt||(pt={}));const b1=[pt.AFRICA,pt.ASIA,pt.CHINA,pt.EUROPE,pt.GLOBAL,pt.INDIA,pt.JAPAN,pt.NORTH_AMERICA,pt.OCEANIA,pt.OVERSEA,pt.SOUTH_AMERICA];var ri;(function(n){n.CHINA="CN",n.ASIA="AS",n.NORTH_AMERICA="NA",n.EUROPE="EU",n.JAPAN="JP",n.INDIA="IN",n.KOREA="KR",n.HKMC="HK",n.US="US",n.OCEANIA="OC",n.SOUTH_AMERICA="SA",n.AFRICA="AF",n.OVERSEA="OVERSEA",n.GLOBAL="GLOBAL",n.EXTENSIONS="GLOBAL"})(ri||(ri={}));const E_={CHINA:{},ASIA:{CODE:ri.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:ri.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:ri.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:ri.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:ri.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:ri.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:ri.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:ri.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:ri.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:ri.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:ri.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:ri.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:ri.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};var Zh,A1,be,mi,ro,ce,Tt,Me,O1,Lr,Mr,Ln,Po,dn,bs,N1,gr,ns,lc,sn,dc,Do,P1,dy;ty&&(E_.CHINA={CODE:ri.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),function(n){n.UPDATE_BITRATE_LIMIT="update_bitrate_limit"}(Zh||(Zh={}));class D1 extends zt{constructor(e,t){super(),S(this,"onICEConnectionStateChange",void 0),S(this,"onConnectionStateChange",void 0),S(this,"onDTLSTransportStateChange",void 0),S(this,"onDTLSTransportError",void 0),S(this,"onICETransportStateChange",void 0),S(this,"onFirstAudioReceived",void 0),S(this,"onFirstVideoReceived",void 0),S(this,"onFirstAudioDecoded",void 0),S(this,"onFirstVideoDecoded",void 0),S(this,"onFirstVideoDecodedTimeout",void 0),S(this,"onSelectedLocalCandidateChanged",void 0),S(this,"onSelectedRemoteCandidateChanged",void 0)}}class g_ extends D1{constructor(e,t){super(e,t)}}(function(n){n.SEND="sendonly",n.RECV="recvonly",n.SENDRECV="sendrecv",n.INACTIVE="inactive"})(A1||(A1={})),function(n){n.VIDEO="video",n.AUDIO="audio"}(be||(be={})),function(n){n[n.UDP=0]="UDP",n[n.TCP=1]="TCP",n[n.RELAY=2]="RELAY"}(mi||(mi={})),function(n){n[n.FIRST_CONNECTION=0]="FIRST_CONNECTION",n[n.TCP_RESTART=1]="TCP_RESTART",n[n.RELAY_RESTART=2]="RELAY_RESTART",n[n.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",n[n.OLD_RESTART=11]="OLD_RESTART",n[n.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED"}(ro||(ro={})),function(n){n.LocalVideoTrack="videoTrack",n.LocalAudioTrack="audioTrack",n.LocalVideoLowTrack="videoLowTrack"}(ce||(ce={})),function(n){n.New="new",n.Connected="connected",n.Reconnecting="reconnecting",n.Disconnected="disconnected"}(Tt||(Tt={})),function(n){n.StateChange="stateChange",n.IceConnectionStateChange="iceConnectionStateChange",n.RequestMuteLocal="requestMuteLocal",n.RequestUnmuteLocal="requestUnmuteLocal",n.RequestRePublish="requestRePublish",n.RequestRePublishDataChannel="requestRePublishDataChannel",n.RequestReSubscribe="requestReSubscribe",n.RequestUploadStats="requestUploadStats",n.RequestUpload="requestUpload",n.MediaReconnectStart="MediaReconnectStart",n.MediaReconnectEnd="MediaReconnectEnd",n.NeedSignalRTT="NeedSignalRTT",n.RequestRestartICE="RequestRestartIce",n.PeerConnectionStateChange="PeerConnectionStateChange",n.RequestReconnect="RequestReconnect",n.RequestReconnectPC="RequestReconnectPC",n.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",n.P2PLost="P2PLost",n.UpdateVideoEncoder="UpdateVideoEncoder",n.ConnectionTypeChange="ConnectionTypeChange",n.RequestLowStreamParameter="RequestLowStreamParameter",n.QueryClientConnectionState="QueryClientConnectionState",n.LocalCandidate="LocalCandidate",n.RequestP2PMuteLocal="requestP2PMuteLocal",n.RequestP2PUnPublish="RequestP2PUnPublish",n.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",n.RequestP2PMuteRemote="RequestP2PMuteRemote",n.RequestP2PRestartICE="RequestP2PRestartICE"}(Me||(Me={})),function(n){n.MUTE_LOCAL_VIDEO="mute_local_video",n.MUTE_LOCAL_AUDIO="mute_local_audio",n.UNMUTE_LOCAL_VIDEO="unmute_local_video",n.UNMUTE_LOCAL_AUDIO="unmute_local_audio",n.MUTE_REMOTE_VIDEO="mute_remote_video",n.MUTE_REMOTE_AUDIO="mute_remote_audio",n.UNMUTE_REMOTE_VIDEO="unmute_remote_video",n.UNMUTE_REMOTE_AUDIO="unmute_remote_audio"}(O1||(O1={})),function(n){n.CONNECTING="CONNECTING",n.RECONNECTING="RECONNECTING",n.CONNECTED="CONNECTED",n.CLOSED="CLOSED"}(Lr||(Lr={})),function(n){n[n.CONNECT_AP=0]="CONNECT_AP",n[n.AP_CONNECTED=1]="AP_CONNECTED",n[n.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",n[n.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",n[n.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",n[n.CONNECT_WORKER=5]="CONNECT_WORKER",n[n.WORKER_CONNECTED=6]="WORKER_CONNECTED",n[n.CLOSED=7]="CLOSED"}(Mr||(Mr={})),function(n){n.CONNECTION_STATE_CHANGE="connection-state-change",n.STATE_CHANGE="state-change",n.INSPECT_RESULT="inspect-result",n.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",n.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(Ln||(Ln={})),function(n){n.NETWORK_ERROR="NETWORK_ERROR",n.SERVER_ERROR="SERVER_ERROR",n.MULTI_IP="MULTI_IP",n.TIMEOUT="TIMEOUT",n.OFFLINE="OFFLINE",n.LEAVE="LEAVE",n.P2P_FAILED="P2P_FAILED",n.FALLBACK="FALLBACK"}(Po||(Po={})),function(n){n.CONNECTED="transmitter:connected",n.RECONNECTING="transmitter:reconnecting",n.WILL_RECONNECT="transmitter:will_reconnect",n.CLOSED="transmitter:closed",n.FAILED="transmitter:failed",n.ON_MESSAGE="transmitter:on_message",n.REQUEST_NEW_URLS="transmitter:request_new_urls",n.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",n.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",n.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",n.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",n.FAILBACK="transmitter:failback"}(dn||(dn={})),function(n){n.CAMERA_CHANGED="camera-changed",n.MICROPHONE_CHANGED="microphone-changed",n.PLAYBACK_DEVICE_CHANGED="playback-device-changed",n.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",n.AUTOPLAY_FAILED="autoplay-failed",n.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",n.SECURITY_POLICY_VIOLATION="security-policy-violation"}(bs||(bs={})),function(n){n[n.APP_TYPE_INVALID_VALUE=-1]="APP_TYPE_INVALID_VALUE",n[n.APP_TYPE_NATIVE=0]="APP_TYPE_NATIVE",n[n.APP_TYPE_NATIVE_COCOS=1]="APP_TYPE_NATIVE_COCOS",n[n.APP_TYPE_NATIVE_UNITY=2]="APP_TYPE_NATIVE_UNITY",n[n.APP_TYPE_NATIVE_ELECTRON=3]="APP_TYPE_NATIVE_ELECTRON",n[n.APP_TYPE_NATIVE_FLUTTER=4]="APP_TYPE_NATIVE_FLUTTER",n[n.APP_TYPE_NATIVE_UNREAL=5]="APP_TYPE_NATIVE_UNREAL",n[n.APP_TYPE_NATIVE_XAMARIN=6]="APP_TYPE_NATIVE_XAMARIN",n[n.APP_TYPE_NATIVE_API_CLOUD=7]="APP_TYPE_NATIVE_API_CLOUD",n[n.APP_TYPE_NATIVE_REACT_NATIVE=8]="APP_TYPE_NATIVE_REACT_NATIVE",n[n.APP_TYPE_NATIVE_PYTHON=9]="APP_TYPE_NATIVE_PYTHON",n[n.APP_TYPE_NATIVE_COCOS_CREATOR=10]="APP_TYPE_NATIVE_COCOS_CREATOR",n[n.APP_TYPE_NATIVE_RUST=11]="APP_TYPE_NATIVE_RUST",n[n.APP_TYPE_NATIVE_C_SHARP=12]="APP_TYPE_NATIVE_C_SHARP",n[n.APP_TYPE_NATIVE_CEF=13]="APP_TYPE_NATIVE_CEF",n[n.APP_TYPE_NATIVE_UNI_APP=14]="APP_TYPE_NATIVE_UNI_APP",n[n.APP_TYPE_WEBRTC=1e3]="APP_TYPE_WEBRTC",n[n.APP_TYPE_WEBRTC_REACT=1001]="APP_TYPE_WEBRTC_REACT",n[n.APP_TYPE_WEBRTC_VUE=1002]="APP_TYPE_WEBRTC_VUE",n[n.APP_TYPE_WEBRTC_ANGULAR=1003]="APP_TYPE_WEBRTC_ANGULAR"}(N1||(N1={})),function(n){n.CONNECTING="CONNECTING",n.RECONNECTING="RECONNECTING",n.CONNECTED="CONNECTED",n.CLOSED="CLOSED"}(gr||(gr={})),function(n){n.CONNECTION_STATE_CHANGE="connection-state-change",n.STATE_CHANGE="state-change",n.INSPECT_RESULT="inspect-result",n.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",n.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(ns||(ns={})),function(n){n[n.CONNECT_AP=0]="CONNECT_AP",n[n.AP_CONNECTED=1]="AP_CONNECTED",n[n.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",n[n.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",n[n.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",n[n.CONNECT_WORKER=5]="CONNECT_WORKER",n[n.WORKER_CONNECTED=6]="WORKER_CONNECTED",n[n.CLOSED=7]="CLOSED"}(lc||(lc={})),function(n){n.CALL="call",n.CANDIDATE="candidate",n.PUBLISH="publish",n.UNPUBLISH="unpublish",n.CONTROL="control",n.RESTART_ICE="restart_ice",n.ACK="ack",n.RESPONSE="response",n.JOIN="join",n.CHECK="check"}(sn||(sn={})),function(n){n.ABORT="abort"}(dc||(dc={})),function(n){n.MUTE_LOCAL_AUDIO="mute_local_audio",n.MUTE_LOCAL_VIDEO="mute_local_video",n.UNMUTE_LOCAL_AUDIO="unmute_local_audio",n.UNMUTE_LOCAL_VIDEO="unmute_local_video"}(Do||(Do={})),function(n){n[n.SUCCESS=1]="SUCCESS",n[n.FAILED=0]="FAILED"}(P1||(P1={})),function(n){n.P2P_TOKEN_TIMEOUT="p2p_token_timeout",n.P2P_TOKEN_CHANGED="p2p_token_changed"}(dy||(dy={}));const $K={[Hd.ACCESS_POINT]:{[Ci.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Ci.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Ci.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Ci.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Ci.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Ci.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Ci.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Ci.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Ci.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Ci.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Ci.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Ci.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Ci.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Ci.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Ci.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Ci.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Ci.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Ci.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[Hd.UNILBS]:{[kr.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[kr.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[kr.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[kr.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[kr.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[kr.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[kr.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[kr.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[kr.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[kr.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[kr.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[kr.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[Hd.STRING_UID_ALLOCATOR]:{[$h.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[$h.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[$h.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function v_(n){const e=$K[Math.floor(n/1e4)];if(!e)return{desc:"unkonw error",retry:!1};const t=e[n%1e4];if(!t){if(Math.floor(n/1e4)===Hd.ACCESS_POINT){const i=n%1e4;if(i.toString()[0]==="1")return{desc:n.toString(),retry:!1};if(i.toString()[0]==="2")return{desc:n.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return t}const ZK={[ke.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[ke.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[ke.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[ke.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[ke.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[ke.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[ke.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[ke.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[ke.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[ke.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[ke.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[ke.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[ke.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[ke.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[ke.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[ke.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[ke.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[ke.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[ke.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[ke.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[ke.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[ke.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[ke.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[ke.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[ke.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[ke.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[ke.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[ke.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[ke.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[ke.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[ke.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[ke.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[ke.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[ke.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[ke.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[ke.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[ke.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[ke.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[ke.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[ke.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[ke.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[ke.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[ke.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[ke.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[ke.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[ke.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[ke.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[ke.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[ke.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[ke.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[ke.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[ke.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[ke.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[ke.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[ke.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[ke.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[ke.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[ke.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[ke.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[ke.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[ke.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[ke.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[ke.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Cl(n){return ZK[n]||{desc:"UNKNOW_ERROR_".concat(n),action:"failed"}}function k1(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}function uy(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?k1(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):k1(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function L1(n){return n.every(e=>e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING)}function M1(n,e){if(typeof n=="string")return n;const{proxy:t,host:i,port:o}=n;if(e){const a=V("JOIN_GATEWAY_FALLBACK_PORT")||443;return a===443?"wss://".concat(i,"/ws/?p=").concat(Number(o)+150):"wss://".concat(i,":").concat(a,"/ws/?p=").concat(Number(o)+150)}return t?"wss://".concat(t,"/ws/?h=").concat(i,"&p=").concat(o):"wss://".concat(i,":").concat(o)}const ez=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,tz=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,nz=/wss:\/\/(.+):([0-9]+)\/?/,iz=/wss:\/\/(.[^\/]+)\/?/;let rz=0;class sz{constructor(e,t){S(this,"id",0),S(this,"store",void 0),S(this,"recordIndex",void 0),S(this,"websockets",[]),S(this,"try443PortDuration",2e3),S(this,"forceCloseWSDuration",5e3),S(this,"try443PortTimeout",null),S(this,"forceCloseTimeout",null),S(this,"isTry443PortFailed",!1),S(this,"isNormalPortFailed",!1),S(this,"useDoubleDomain",!1),S(this,"useProxy",!1),S(this,"startTime",Date.now()),this.id=++rz,this.try443PortDuration=V("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=t}closeAllWebsockets(){this.websockets.forEach(e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var e;const t=Date.now()-this.startTime;for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];y.debug("[choose-best-ws ".concat((e=this.store)===null||e===void 0?void 0:e.clientId," ").concat(this.id,"] ").concat(t,"ms:"),...o)}createWebSocket(e,t,i){this.logger("createWebSocket:",e,{isTry443Port:t,hasTimeoutDetection:i});const o=V("GATEWAY_DOMAINS"),a=Date.now(),l=[],u=o.find(m=>{var E;return Ie(E=e.host).call(E,m)});u||(this.useDoubleDomain=!1);const h=[];if(this.useDoubleDomain)o.forEach(m=>{h.push(M1(uy(uy({},e),{},{host:e.host.replace(u,m)}),t))});else{const m=uy({},e);if(t&&u){const E=o.find(v=>v!==u);E&&(m.host=m.host.replace(u,E))}h.push(M1(m,t))}try{h.forEach(m=>{const E=new WebSocket(m);E.binaryType="arraybuffer",l.push(E),this.logger("ws is connecting:",E.url)})}catch(m){if(this.logger("ws create failed"),l.forEach(E=>E.close()),l.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,t,i);if(!t&&Number(e.port)!==443)return this.createWebSocket(e,!0,i);throw new W(N.WS_ERR,"init websocket failed! Error: ".concat(m.toString()))}const f=Gh();return this.store&&this.store.recordJoinChannelService({urls:l.map(m=>m.url),service:"gateway"},this.recordIndex),l.forEach(m=>{m.onopen=()=>{this.logger("onopen: ws ".concat(m.url," open cost ").concat(Date.now()-a,"ms")),this.websockets.forEach(E=>{E!==m&&(E.onopen=null,E.onclose=null,E.onmessage=null,E.close(),this.logger("close backup websocket: ".concat(E.url)))}),this.websockets.length=0,f.resolve(m)},m.onclose=E=>{this.logger("onclose: ws ".concat(m.url," closed cost ").concat(Date.now()-a,"ms state: ").concat(m.readyState)),t?this.isTry443PortFailed=L1(l):this.isNormalPortFailed=L1(l),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(t&&this.isTry443PortFailed||!t&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(E.reason)),f.reject({code:E.code,reason:Rl.A_ROUND_WS_FAILED}))},m.onmessage=E=>this.logger("".concat(m.url," onmessage: ").concat(E.data))}),this.websockets.push(...l),i||(()=>{const m=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",f.isResolved),this.websockets.forEach(E=>E.readyState!==WebSocket.OPEN&&E.close())};if(t||this.useProxy)return this.logger("add 5s timeout at ".concat(t?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(m,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",f.isResolved),f.isResolved)return m();ft().os===Nn.MAC_OS&&Pt()&&m(),this.createWebSocket(e,!0,!0).then(E=>f.resolve(E)).catch(E=>{this.isNormalPortFailed&&f.reject(E),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(m,this.forceCloseWSDuration)},this.try443PortDuration)})(),f.promise}chooseBestWebsocket(e,t,i,o){return this.useDoubleDomain=!!t,typeof e=="string"&&(e=function(a){let l,u,h;return[,l,u,h]=a.match(ez)||[],l||([,u,h]=a.match(tz)||[]),u&&h||([,u,h]=a.match(nz)||[]),u&&h||([,u]=a.match(iz)||[]),u||y.warning("un-destructible url: ",a),{proxy:l,host:u,port:h||"443"}}(e)),this.recordIndex=o,this.useProxy=!!e.proxy,i&&this.useProxy&&(y.warn("cannot use 443 only when use proxy"),i=!1),this.createWebSocket(e,!!i,!1).finally(()=>this.clearTimeout())}}function x1(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}class U1 extends zt{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var t;Ie(t=["tryNext","recover"]).call(t,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._state==="reconnecting"?this.emit(je.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(je.CONNECTED):this._state==="closed"?this.emit(je.CLOSED):this._state==="failed"&&this.emit(je.FAILED))}resetReconnectCount(e){y.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],o=arguments.length>3&&arguments[3]!==void 0&&arguments[3],a=arguments.length>4&&arguments[4]!==void 0&&arguments[4],l=arguments.length>5?arguments[5]:void 0;super(),S(this,"connectionID",0),S(this,"currentURLIndex",0),S(this,"urls",[]),S(this,"_reconnectMode","tryNext"),S(this,"reconnectReason",void 0),S(this,"_initMutex",new Qn("websocket")),S(this,"name",void 0),S(this,"_state","closed"),S(this,"reconnectInterrupter",void 0),S(this,"websocket",void 0),S(this,"retryConfig",void 0),S(this,"reconnectCount",0),S(this,"forceCloseTimeout",5e3),S(this,"onlineReconnectListener",void 0),S(this,"useCompress",void 0),S(this,"tryDoubleDomain",!1),S(this,"use443PortOnly",!1),S(this,"wsInflateLength",0),S(this,"wsDeflateLength",0),S(this,"closeEstablishingWs",()=>{}),S(this,"store",void 0),S(this,"joinGatewayRecordIndex",void 0),this.store=l,this.name=e,this.retryConfig=function(E){for(var v=1;v<arguments.length;v++){var T=arguments[v]!=null?arguments[v]:{};v%2?x1(Object(T),!0).forEach(function(A){S(E,A,T[A])}):Object.getOwnPropertyDescriptors?Object.defineProperties(E,Object.getOwnPropertyDescriptors(T)):x1(Object(T)).forEach(function(A){Object.defineProperty(E,A,Object.getOwnPropertyDescriptor(T,A))})}return E}({},t),this.useCompress=i,this.tryDoubleDomain=o,this.use443PortOnly=a;const{timeout:u,timeoutFactor:h}=t,f=Math.max(300,Math.floor(3*u/5)),m=Math.max(1.2,Math.floor(8*h)/10);Ui.ONLINE&&(this.retryConfig.timeout=f,this.retryConfig.timeoutFactor=m),Tn.on(aa.NETWORK_STATE_CHANGE,(E,v)=>{E!==v&&(this.resetReconnectCount("network state change: ".concat(v," -> ").concat(E)),E===Ui.ONLINE?(this.retryConfig.timeout=f,this.retryConfig.timeoutFactor=m):(this.retryConfig.timeout=u,this.retryConfig.timeoutFactor=h))})}getConnection(){return this.websocket||void 0}async init(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=await this._initMutex.lock();this.forceCloseTimeout=t,this.urls=e,this.state="connecting";try{const o=Gh(),a=this.urls[this.currentURLIndex];this.createWebSocketConnection(a).then(o.resolve).catch(o.reject),this.once(je.CLOSED,()=>{o.reject(new ne(N.WS_DISCONNECT))}),this.once(je.CONNECTED,o.resolve),await o.promise}catch{}finally{i()}}close(e,t){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const i=this.websocket;t?setTimeout(()=>i.close(),500):i.close(),this.websocket=void 0}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,t){if(!this.websocket)return void y.warning("[".concat(this.name,"] can not reconnect, no websocket"));e!==void 0&&(this.reconnectMode=e),y.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(t)]},this.joinGatewayRecordIndex);const i=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),i&&i.bind(this.websocket)({code:9999,reason:t})}sendMessage(e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new ne(N.WS_ABORT,"websocket is not ready");try{t||(e=JSON.stringify(e)),this.websocket.send(e)}catch(i){throw new ne(N.WS_ERR,"send websocket message error"+i.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){const e=this.wsInflateLength,t=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:t}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var t;const i=Gh();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const o=m=>{var E;(E=this.store)===null||E===void 0||E.signalChannelOpen(),y.debug("[".concat(this.name,"] websocket opened:"),m),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),i.resolve()},a=async m=>{var E;if(y.debug("[".concat(this.name,"] websocket close ").concat((E=this.websocket)===null||E===void 0?void 0:E.url,", code: ").concat(m.code,", reason: ").concat(m.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)i.reject(new ne(N.WS_DISCONNECT,"websocket close: ".concat(m.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=m.reason,this.state="reconnecting");const v=Er(this,je.WILL_RECONNECT,this.reconnectMode,m.reason)||this.reconnectMode,T=await this.reconnectWithAction(v);if(this.state==="closed")return void y.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!T)return i.reject(new ne(N.WS_DISCONNECT,"websocket reconnect failed: ".concat(m.code))),this.close(!0);i.resolve()}},l=m=>{this.emit(je.ON_MESSAGE,m)},u=m=>{y.warn("[".concat(this.connectionID,"] ws open error ").concat(m))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),V("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=V("GATEWAY_WSS_ADDRESS")),y.debug("[".concat(this.name,"] start connect, url:"),e);const h=(t=this.store)===null||t===void 0?void 0:t.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var f;const m=await this.chooseBestWebsocketConnection(e);this.websocket=m,o&&o(this.websocket.url),this.websocket.onclose=a,this.websocket.onmessage=l,this.websocket.onerror=u,(f=this.store)===null||f===void 0||f.recordJoinChannelService({endTs:Date.now(),status:"success"},h),this.joinGatewayRecordIndex=h}catch(m){const E=this.state==="closed",v=m instanceof ne,T=v&&m.code===N.WS_ABORT,A=v&&m.code===N.WS_ERR,C=v?m.message:m&&(m.reason||m.toString());y.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(C)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:T?"aborted":"error",errors:[m]},h),E||A?(i.reject(E?new ne(N.WS_DISCONNECT,"websocket is closed: ".concat(C)):new ne(N.WS_ERR,"init websocket failed: ".concat(C))),A&&y.error("[".concat(this.name,"] init websocket failed: ").concat(C))):a&&a(m)}return i.promise}async reconnectWithAction(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;y.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||Tn.isOnline||!Tn.onlineWaiter||(this.onlineReconnectListener=Tn.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let i=!0;if(this.reconnectInterrupter=()=>i=!1,t){const l=n_(this.reconnectCount,this.retryConfig);y.debug("[".concat(this.name,"] wait ").concat(l,"ms to reconnect websocket, mode: ").concat(e)),await X.race([Xn(l),this.onlineReconnectListener||new X(()=>{})])}if(this._state==="closed"||!i)return!1;this.reconnectCount+=1;const o=async(l,u)=>{this.emit(je.RECONNECT_CREATE_CONNECTION,u),await this.createWebSocketConnection(l)};try{if(e==="retry")this.emit(je.RECONNECT_WAITTING_FINISH,e),await o(this.urls[this.currentURLIndex],e);else if(e==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);y.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),this.emit(je.RECONNECT_WAITTING_FINISH,e),await o(this.urls[this.currentURLIndex],e)}else e==="recover"&&(y.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(je.RECONNECT_WAITTING_FINISH,e),this.urls=await Sn(this,je.REQUEST_NEW_URLS),this.currentURLIndex=0,await o(this.urls[this.currentURLIndex],e))}catch(l){var a;y.error("[".concat(this.name,"] reconnect failed ").concat(l&&l.toString()));const u=l==null||(a=l.data)===null||a===void 0?void 0:a.desc;return Array.isArray(u)&&Ie(u).call(u,"dynamic key expired")?(this.emit(je.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,t)}return!0}}class ep extends U1{constructor(e,t){super(e,t,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){const i=Gh(),o=function(l,u){return new sz(l,u)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{y.debug("[choose-best-ws] close establishing websockets"),o.closeAllWebsockets(),i.reject(new ne(N.WS_ABORT,"choose best websocket aborted"))};const a=V("GATEWAY_DOMAINS");return y.debug("[choose-best-ws] currentDomain: ",e,", domains: ",a,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),o.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,t).then(i.resolve).catch(i.reject),i.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class tp extends U1{constructor(e,t){super(e,t,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){return new X((i,o)=>{let a=!1;const l=[];this.closeEstablishingWs=()=>{y.debug("[choose-best-ws] close establishing websockets"),l.forEach(A=>{A.onclose=null,A.onopen=null,A.onmessage=null,A.close()}),o(new ne(N.WS_ABORT,"choose best websocket aborted"))};const u=V("GATEWAY_DOMAINS");let h;const f=e.indexOf("?h="),m=u.find(A=>f!==-1?Ie(e).call(e,A,f):Ie(e).call(e,A));y.debug("[choose-best-ws] currentDomain: ",m,", domains: ",u);let E=!this.tryDoubleDomain||!m;if(!E&&m){var v;const A=Date.now();try{u.forEach(C=>{const b=f===-1?e.replace(m,C):e.substr(0,f)+e.substr(f).replace(m,C),D=new WebSocket(b);D.binaryType="arraybuffer",l.push(D),y.debug("[choose-best-ws] ws is connecting:",D.url)})}catch{for(y.debug("[choose-best-ws] ws create failed, fallback to single url"),l.forEach(b=>b.close());l.length;)l.pop();E=!0}(v=this.store)===null||v===void 0||v.recordJoinChannelService({urls:l.map(C=>C.url),service:"gateway"},t),l.forEach(C=>{C.onopen=()=>{if(a)return;const b=Date.now()-A;y.debug("[choose-best-ws] ws open cost ".concat(b,"ms")),l.filter(D=>D!==C).forEach(D=>{y.debug("[choose-best-ws]close backup websocket: ".concat(D.url)),D.close()}),a=!0,i(C)},C.onclose=b=>{h=b,!a&&(l.find(D=>!(D.readyState===WebSocket.CLOSED||D.readyState===WebSocket.CLOSING))||(y.debug("[choose-best-ws] all websocket is closed"),a=!0,o(h)))},C.onmessage=b=>{y.debug("[choose-best-ws]".concat(C.url," onmessage: ").concat(b.data))}}),Xn(this.forceCloseTimeout).then(()=>{l.forEach(C=>{C.readyState!==WebSocket.OPEN&&C.close()})})}if(E){var T;let A;y.debug("[choose-best-ws] use single url: ",e),(T=this.store)===null||T===void 0||T.recordJoinChannelService({urls:[e],service:"gateway"},t);try{A=new WebSocket(e),l.push(A),A.binaryType="arraybuffer"}catch(C){const b=new ne(N.WS_ERR,"init websocket failed! Error: ".concat(C.toString()));return y.error("[".concat(this.name,"]").concat(b)),void o(b)}A.onopen=()=>{i(A)},A.onclose=C=>{o(C)},A.onmessage=C=>{y.debug("[choose-best-ws]".concat(A.url," onmessage: ").concat(C.data))},Xn(this.forceCloseTimeout).then(()=>{A&&A.readyState!==WebSocket.OPEN&&A.close()})}}).then(i=>(this.closeEstablishingWs=void 0,i)).catch(i=>{throw this.closeEstablishingWs=void 0,i})}}class V1 extends zt{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===tt.CONNECTED?this.emit(ye.WS_CONNECTED):e===tt.RECONNECTING?this.emit(ye.WS_RECONNECTING,this._websocketReconnectReason):e===tt.CLOSED&&this.emit(ye.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),S(this,"_disconnectedReason",void 0),S(this,"_websocketReconnectReason",void 0),S(this,"_connectionState",tt.CLOSED),S(this,"reconnectToken",void 0),S(this,"websocket",void 0),S(this,"openConnectionTime",void 0),S(this,"clientId",void 0),S(this,"lastMsgTime",Date.now()),S(this,"uploadCache",[]),S(this,"uploadCacheInterval",void 0),S(this,"rttRolling",new xT(5)),S(this,"pingpongTimer",void 0),S(this,"wsInflateDataTimer",void 0),S(this,"pingpongTimeoutCount",0),S(this,"joinResponse",void 0),S(this,"multiIpOption",void 0),S(this,"initError",void 0),S(this,"spec",void 0),S(this,"store",void 0),S(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(ye.ON_BINARY_DATA,i.data);const o=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(o,"_id")){const a="res-@".concat(o._id);this.emit(a,o._result,o._message)}else if(Object.prototype.hasOwnProperty.call(o,"_type")){if(this.emit(o._type,o._message),o._type===He.ON_NOTIFICATION&&this.handleNotification(o._message),o._type===He.ON_USER_BANNED)switch(o._message.error_code){case 14:this.close(ot.UID_BANNED);break;case 15:this.close(ot.IP_BANNED);break;case 16:this.close(ot.CHANNEL_BANNED)}if(o._type===He.ON_USER_LICENSE_BANNED)switch(o._message.error_code){case ke.ERR_LICENSE_MISSING:this.close(ot.LICENSE_MISSING);break;case ke.ERR_LICENSE_EXPIRED:this.close(ot.LICENSE_EXPIRED);break;case ke.ERR_LICENSE_MINUTES_EXCEEDED:this.close(ot.LICENSE_MINUTES_EXCEEDED);break;case ke.ERR_LICENSE_PERIOD_INVALID:this.close(ot.LICENSE_PERIOD_INVALID);break;case ke.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(ot.LICENSE_MULTIPLE_SDK_SERVICE);break;case ke.ERR_LICENSE_ILLEGAL:this.close(ot.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new ep("gateway-".concat(this.clientId),this.spec.retryConfig,!0,V("JOIN_GATEWAY_USE_DUAL_DOMAIN"),V("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===tt.CONNECTED&&this.reconnect("retry",Jn.OFFLINE)})}async request(e,t,i,o){const a=Lt(6,""),l={_id:a,_type:e,_message:t},u=this.websocket.connectionID,h=()=>new X((A,C)=>{if(this.connectionState===tt.CONNECTED)return A();const b=()=>{this.off(ye.WS_CLOSED,D),A()},D=()=>{this.off(ye.WS_CONNECTED,b),C(new W(N.WS_ABORT))};this.once(ye.WS_CONNECTED,b),this.once(ye.WS_CLOSED,D),e!==Ne.PUBLISH&&e!==Ne.PUBLISH_DATASTREAM&&e!==Ne.SUBSCRIBE&&e!==Ne.SUBSCRIBE_DATASTREAM&&e!==Ne.UNSUBSCRIBE&&e!==Ne.UNSUBSCRIBE_DATASTREAM&&e!==Ne.UNPUBLISH&&e!==Ne.UNPUBLISH_DATASTREAM&&e!==Ne.CONTROL&&e!==Ne.RESTART_ICE||this.once(ye.DISCONNECT_P2P,()=>{C(new W(N.DISCONNECT_P2P))}),e!==Ne.PUBLISH&&e!==Ne.RESTART_ICE||this.once(ye.ABORT_P2P_EXECUTION,()=>{C(new W(N.DISCONNECT_P2P))})});if(this.connectionState!==tt.CONNECTING&&this.connectionState!==tt.RECONNECTING||e===Ne.JOIN||e===Ne.REJOIN||await h(),this.websocket.sendMessage(l,!0),o)return;const f=new X((A,C)=>{let b=!1;const D=(B,J)=>{b=!0,A({isSuccess:B==="success",message:J||{}}),this.off(ye.WS_CLOSED,M),this.off(ye.WS_RECONNECTING,M),this.emit(ye.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(a),D);const M=()=>{C(new W(N.WS_ABORT,"type: ".concat(e))),this.off(ye.WS_CLOSED,M),this.off(ye.WS_RECONNECTING,M),this.off("res-@".concat(a),D)};this.once(ye.WS_CLOSED,M),this.once(ye.WS_RECONNECTING,M),Xn(V("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==u||b||(y.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(ye.REQUEST_TIMEOUT,e,t))})});let m=null;try{m=await f}catch(A){if(this.connectionState===tt.CLOSED||e===Ne.LEAVE)throw new W(N.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?A.throw():e===Ne.JOIN||e===Ne.REJOIN?null:(await h(),await this.request(e,t))}if(m.isSuccess)return m.message;const E=Number(m.message.error_code||m.message.code),v=Cl(E),T=new W(N.UNEXPECTED_RESPONSE,"".concat(v.desc,": ").concat(m.message.error_str),{code:E,data:m.message});return v.action==="success"?m.message:(y.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(E,", message: ").concat(v.desc,", action: ").concat(v.action)),E===ke.ERR_TOO_MANY_BROADCASTERS?((e===Ne.JOIN||e===Ne.REJOIN)&&(this.initError=T,this.close()),T.throw()):v.action==="failed"?T.throw():v.action==="quit"?(this.initError=T,this.close(),T.throw()):(E===ke.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=m.message.option,y.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Jn.MULTI_IP)):this.reconnect(v.action,Jn.SERVER_ERROR),e===Ne.JOIN||e===Ne.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new X(i=>{const o=a=>{(!t||t(a))&&(this.off(e,o),i(a))};this.on(e,o)})}uploadWRTCStats(e){if(!this.store.sessionId)return void y.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(ua.WRTC_STATS,t)}upload(e,t){const i={_type:e,_message:t};try{this.websocket.sendMessage(i)}catch{const a=V("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>a&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==tt.CONNECTED)return;const l=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(l._type,l._message)},V("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){const i={_type:e,_message:t};this.websocket.sendMessage(i)}init(e,t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new X((i,o)=>{this.once(ye.WS_CONNECTED,()=>i(this.joinResponse)),this.once(ye.WS_CLOSED,()=>o(this.initError||new W(N.WS_ABORT))),this.connectionState=tt.CONNECTING,this.websocket.init(e).catch(o),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||ot.LEAVE,this.connectionState=tt.CLOSED,y.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),e===ot.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new ep("gateway-".concat(this.clientId),this.spec.retryConfig,!0,V("JOIN_GATEWAY_USE_DUAL_DOMAIN"),V("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(ye.ABORT_P2P_EXECUTION);const e=await Sn(this,ye.REQUEST_JOIN_INFO),t=await this.request(Ne.JOIN,e);if(!t)return this.emit(ye.REPORT_JOIN_GATEWAY,Rl.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(ye.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=tt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new W(N.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=vl(this,ye.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const t=await this.request(Ne.REJOIN,e);return!!t&&(this.connectionState=tt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),t.peers&&t.peers.forEach(i=>{this.emit(He.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(He.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(He.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(He.MUTE_AUDIO,{uid:i.uid}):this.emit(He.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(He.MUTE_VIDEO,{uid:i.uid}):this.emit(He.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(He.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(He.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(He.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(He.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(He.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleNotification(e){y.debug("[".concat(this.clientId,"] receive notification: "),e);const t=Cl(e.code);if(t.action!=="success"){if(t.action!=="failed")return t.action==="quit"?(t.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(ot.UID_BANNED),void this.close()):void this.reconnect(t.action,Jn.SERVER_ERROR);y.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=V("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(y.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>V("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Jn.TIMEOUT):this.request(Ne.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-t;this.rttRolling.add(i),V("REPORT_STATS")&&this.send(Ne.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){const{wsInflateLength:e,wsDeflateLength:t}=this.websocket.getWsInflateData();e!==0&&t!==0&&this.upload(ua.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:t,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(je.RECONNECT_WAITTING_FINISH,e=>{this.emit(ye.WS_RECONNECT_WAITTING_FINISH,e)}),this.websocket.on(je.RECONNECT_CREATE_CONNECTION,e=>{this.emit(ye.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(je.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(je.CLOSED,()=>{this.connectionState=tt.CLOSED}),this.websocket.on(je.FAILED,()=>{this._disconnectedReason=ot.NETWORK_ERROR,this.connectionState=tt.CLOSED}),this.websocket.on(je.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===tt.CONNECTED?this.connectionState=tt.RECONNECTING:this.connectionState=tt.CONNECTING}),this.websocket.on(je.WILL_RECONNECT,(e,t,i)=>{const o=vl(this,ye.IS_P2P_DISCONNECTED),a=o||e!=="retry";o&&e==="retry"&&(y.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",t=Rl.P2P_DISCONNECTED),a&&(y.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(ye.REPORT_JOIN_GATEWAY,t||Rl.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(ye.NEED_RENEW_SESSION),this.emit(ye.DISCONNECT_P2P)),i(e)}),this.websocket.on(je.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(e=>{y.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",Jn.SERVER_ERROR)}):this.join().catch(e=>{if(this.emit(ye.REPORT_JOIN_GATEWAY,e.message||e.code||Rl.UNKNOWN_REASON,this.url||""),e instanceof W&&e.code===N.UNEXPECTED_RESPONSE&&e.data.code===ke.ERR_NO_AUTHORIZED)return y.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Jn.SERVER_ERROR);y.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Jn.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on(je.REQUEST_NEW_URLS,(e,t)=>{Sn(this,ye.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)}),this.websocket.on(je.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(He.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}var F1=`	
\v\f\r \u2028\u2029\uFEFF`,oz=ll,az=Cs,hy=F1,j1=L("".replace),cz=RegExp("^["+hy+"]+"),lz=RegExp("(^|[^"+hy+"])["+hy+"]+$"),py=function(n){return function(e){var t=az(oz(e));return 1&n&&(t=j1(t,cz,"")),2&n&&(t=j1(t,lz,"$1")),t}},dz={start:py(1),end:py(2),trim:py(3)},uz=oO.PROPER,hz=_,B1=F1,pz=dz.trim;Xt({target:"String",proto:!0,forced:function(n){return hz(function(){return!!B1[n]()||""[n]()!==""||uz&&B1[n].name!==n})}("trim")},{trim:function(){return pz(this)}});var $n,is,fz=qa("String").trim,mz=x,_z=fz,fy=String.prototype,my=p(function(n){var e=n.trim;return typeof n=="string"||n===fy||mz(fy,n)&&e===fy.trim?_z:e});function G1(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}function S_(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?G1(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):G1(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function uc(n){return n.match(/^[\.\:\d]+$/)?"".concat(n.replace(/[^\d]/g,"-"),".").concat(V("TURN_DOMAIN")):(y.info("Unidentified as ip: ".concat(n,", use as host")),n)}function W1(n,e){n.addresses||(n.addresses=[]);const t=function(a,l){if(V("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return a.map(f=>{let{ip:m,port:E}=f;return{address:"".concat(m,":").concat(E)}});const u=V("GATEWAY_DOMAINS");let h=u[1]&&Ie(l).call(l,u[1])?1:0;return a.map(f=>{let{domain_prefix:m,port:E,ip:v}=f;if(m)return{address:"".concat(m,".").concat(u[h++%u.length],":").concat(E)};const T=/^[\.\:\d]+$/.test(v),A=T?"".concat(v.replace(/[^\d]/g,"-"),".").concat(u[h++%u.length],":").concat(E):"".concat(v,":").concat(E);return T||y.info("Unidentified as ip: ".concat(v,", use as host")),{ip:v,port:E,address:A}})}(n.addresses,e),i=Array.isArray(n.detail)&&n.detail[18];if(i&&typeof i=="string"){const a=i.split(";");for(let l=0;l<a.length;l++){var o;const u=my(o=a[l]).call(o);t[l]&&u&&(t[l].ip6=u)}}return{gatewayAddrs:t,uid:n.uid,cid:n.cid,cert:n.cert,vid:n.detail&&n.detail[8],uni_lbs_ip:n.detail&&n.detail[1],res:n,csIp:n.detail&&n.detail[502]}}function xr(n){return typeof n=="number"?n:n.exact||n.ideal||n.max||n.min||0}function H1(n){const e=n._encoderConfig;if(!e)return{};const t={resolution:e.width&&e.height?"".concat(xr(e.width),"x").concat(xr(e.height)):void 0,maxVideoBW:e.bitrateMax,minVideoBW:e.bitrateMin};return typeof e.frameRate=="number"?(t.maxFrameRate=e.frameRate,t.minFrameRate=e.frameRate):e.frameRate&&(t.maxFrameRate=e.frameRate.max||e.frameRate.ideal||e.frameRate.exact||e.frameRate.min,t.minFrameRate=e.frameRate.min||e.frameRate.ideal||e.frameRate.exact||e.frameRate.max),t}function K1(n){return n>=0&&n<.17?1:n>=.17&&n<.36?2:n>=.36&&n<.59?3:n>=.59&&n<=1?4:n>1?5:0}function _y(n,e){let t,i,o;switch(e){case $n.CHOOSE_SERVER:i=4096,o="choose server";break;case $n.CLOUD_PROXY:i=1048576,o="proxy";break;case $n.CLOUD_PROXY_5:i=4194304,o="proxy5";break;case $n.CLOUD_PROXY_FALLBACK:i=4194310,o="proxy fallback";break;default:throw new W(N.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:n.detail&&n.detail[502],retry:!1})}if(n.response_body.forEach(a=>{a.buffer&&a.buffer.flag===i&&(t={code:a.buffer.code,addresses:(a.buffer.edges_services||[]).map(l=>S_(S_({},l),{},{ticket:a.buffer.cert})),server_ts:n.enter_ts,uid:a.buffer.uid,cid:a.buffer.cid,cname:a.buffer.cname,detail:S_(S_({},a.buffer.detail),n.detail),flag:a.buffer.flag,opid:n.opid,cert:a.buffer.cert})}),!t)throw new W(N.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(o," from multi unilbs response"),{csIp:n.detail&&n.detail[502]});return t}async function Ez(n,e){return await X.all(n.addresses.map(async t=>({address:uc(t.ip),tcpport:t.port,udpport:t.port,username:e&&V("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?e.toString():Wi.username,password:e&&V("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await PT(e.toString()):Wi.password})))}function Ey(n,e){const t=e._videoHeight||e.getMediaStreamTrack(!0).getSettings().height;return t?Math.max(t/xr(n.height),1):(y.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function hc(n){let{candidateType:e,relayProtocol:t,type:i,address:o,port:a,protocol:l}=n;return i==="local-candidate"?{candidateType:e,relayProtocol:t,protocol:l}:{candidateType:e,relayProtocol:t,address:o,port:a,protocol:l}}function z1(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}(function(n){n[n.CHOOSE_SERVER=11]="CHOOSE_SERVER",n[n.CLOUD_PROXY=18]="CLOUD_PROXY",n[n.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",n[n.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK"})($n||($n={}));class gz extends zt{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var t;Ie(t=["tryNext","recover"]).call(t,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._state==="reconnecting"?this.emit(dn.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(dn.CONNECTED):this._state==="closed"?this.emit(dn.CLOSED):this._state==="failed"&&this.emit(dn.FAILED))}constructor(e,t,i,o){super(),S(this,"connectionID",0),S(this,"currentURLIndex",0),S(this,"reconnectReason",void 0),S(this,"_reconnectMode","tryNext"),S(this,"_name",void 0),S(this,"_state","closed"),S(this,"_retryConfig",void 0),S(this,"_reconnectCount",0),S(this,"_forceCloseTimeout",5e3),S(this,"_onlineReconnectListener",void 0),S(this,"_closeEstablishingTransmitter",()=>{}),S(this,"_store",void 0),S(this,"_joinChannelServiceRecordIndex",void 0),S(this,"_useCompress",void 0),S(this,"_inflateLength",0),S(this,"_deflateLength",0),this._store=o,this._name=e,this._retryConfig=function(a){for(var l=1;l<arguments.length;l++){var u=arguments[l]!=null?arguments[l]:{};l%2?z1(Object(u),!0).forEach(function(h){S(a,h,u[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(u)):z1(Object(u)).forEach(function(h){Object.defineProperty(a,h,Object.getOwnPropertyDescriptor(u,h))})}return a}({},t),this._useCompress=i}resetReconnectCount(e){y.debug("".concat(this._name," reset reconnect count, reason: ").concat(e)),this._reconnectCount=0}close(e,t){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const i=this._transmitter;t?setTimeout(()=>i.close(),500):i.close(),this._transmitter=void 0}this.state=e?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(e,t){if(!this._transmitter)return void y.warning("[".concat(this._name,"] can not reconnect, no websocket"));var i;e!==void 0&&(this.reconnectMode=e),y.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((i=this._store)===null||i===void 0||i.recordJoinChannelService({status:"error",errors:[new Error(t)]},this._joinChannelServiceRecordIndex));const o=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),o&&o.bind(this._transmitter)({code:9999,reason:t})}getInflateData(){const e=this._inflateLength,t=this._deflateLength;return this.clearInflateData(),{inflateLength:e,deflateLength:t}}setInflateData(e){this._deflateLength=this._deflateLength+e.originLength,this._inflateLength=this._inflateLength+e.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}(function(n){n[n.Default=0]="Default",n[n.Ack=1]="Ack"})(is||(is={}));class vz{constructor(e,t,i){S(this,"version",1),S(this,"initialRTO",void 0),S(this,"maxBatchAckCount",void 0),S(this,"maxRTO",void 0),S(this,"initialRTT",void 0),S(this,"ID",void 0),S(this,"rtt",void 0),S(this,"packetNumber",1),S(this,"rtoRatioMap",new Map),S(this,"timeoutMap",new Map),S(this,"unorderedPacketQueue",[]),S(this,"batchAckPacketQueue",[]),S(this,"lastOrderedPacketNumber",0),S(this,"batchAckTimer",void 0),S(this,"sendImpl",void 0),S(this,"receiveImpl",void 0),this.sendImpl=e,this.receiveImpl=t,this.ID=Lt(7,"transmitter-"),this.initialRTO=(i==null?void 0:i.initialRTO)!==void 0?i.initialRTO:V("TRANSMITTER_INITIAL_RTO"),this.initialRTT=(i==null?void 0:i.initialRTT)!==void 0?i.initialRTT:V("TRANSMITTER_INITIAL_RTT"),this.rtt=(i==null?void 0:i.initialRTT)!==void 0?i.initialRTT:V("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=(i==null?void 0:i.maxBatchAckCount)!==void 0?i.maxBatchAckCount:V("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=(i==null?void 0:i.maxRTO)!==void 0?i.maxRTO:V("TRANSMITTER_MAX_RTO")}packetize(e,t){return{type:is.Default,version:this.version,packetNumber:t,payload:e}}serialize(e){switch(e.type){case is.Default:{let t;typeof e.payload=="string"?t=new TextEncoder().encode(e.payload):t=e.payload;const i=new ArrayBuffer(t.length+15),o=new DataView(i);return o.setUint16(0,e.version),o.setUint8(2,e.type),o.setUint32(3,e.packetNumber),_P(o,7,BigInt(e.sendTs)),new Uint8Array(o.buffer).set(t,15),i}case is.Ack:{const t=new ArrayBuffer(16),i=new DataView(t);return i.setUint16(0,e.version),i.setUint8(2,e.type),i.setUint32(3,e.maxAckPacketNumber),i.setUint8(7,e.shift),_P(i,8,BigInt(e.ackSendTs)),t}}}deserialize(e){const t=new DataView(e),i=t.getUint16(0),o=t.getUint8(2);switch(o){case is.Default:{const a=t.getUint32(3),l=mP(t,7),u=e.slice(15),h=new TextDecoder().decode(u);return{version:i,type:o,packetNumber:a,sendTs:Number(l),payload:h}}case is.Ack:{const a=t.getUint32(3),l=t.getUint8(7),u=mP(t,8);return{version:i,type:o,maxAckPacketNumber:a,shift:l,ackSendTs:Number(u)}}default:throw y.error("[".concat(this.ID,"] Unrecognized packet type ").concat(o)),new Error("Unrecognized packet type ".concat(o))}}sendMessage(e){const t=this.packetize(e,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;const i=this.calculateRTO(t),o=window.setTimeout(()=>{this.resendMessage(t)},i);this.timeoutMap.set(t.packetNumber,o),this.sendPacket(t)}onData(e){const t=this.deserialize(e);t.type===is.Default?this.ack(t):t.type===is.Ack&&(this.updateRTT(t,Math.round(performance.now())),this.clearRTO(t))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(e=>{let[t,i]=e;window.clearTimeout(i)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(e){const t=this.calculateRTO(e),i=window.setTimeout(()=>{this.resendMessage(e)},t);this.timeoutMap.set(e.packetNumber,i),this.sendPacket(e)}calculateRTO(e){const t=this.rtoRatioMap.get(e.packetNumber);if(t===void 0)return this.rtoRatioMap.set(e.packetNumber,1),this.initialRTO;{const i=9*this.rtt/8*t;return this.rtoRatioMap.set(e.packetNumber,t+1),i>this.maxRTO?this.maxRTO:i}}updateRTT(e,t){const i=e.ackSendTs;this.rtt=this.rtt*(7/8)+(t-i-this.rtt)/8}ack(e){if(e.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(e):(this.batchAckPacketQueue.push(e),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(e.payload);;){const t=this.unorderedPacketQueue[0];if(!t){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(t.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(e.packetNumber<=this.lastOrderedPacketNumber){const t={ackSendTs:e.sendTs,maxAckPacketNumber:e.packetNumber,shift:0,type:is.Ack,version:this.version};this.sendPacket(t)}else if(e.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[e.packetNumber-this.lastOrderedPacketNumber-2]=e;const t={ackSendTs:e.sendTs,maxAckPacketNumber:e.packetNumber,shift:0,type:is.Ack,version:this.version};this.sendPacket(t)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const e={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:is.Ack,version:this.version};this.sendPacket(e),this.batchAckPacketQueue=[]}sendPacket(e){e.type===is.Default&&(e.sendTs=Math.round(performance.now()));const t=this.serialize(e);this.sendImpl(t)}clearRTO(e){for(let t=e.maxAckPacketNumber-e.shift;t<=e.maxAckPacketNumber;t++){const i=this.timeoutMap.get(t);i!==void 0&&window.clearTimeout(i),this.timeoutMap.delete(t),this.rtoRatioMap.delete(t)}}}class Y1 extends gz{constructor(e,t){super(e,t,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),S(this,"_initMutex",void 0),S(this,"_reconnectInterrupter",void 0),S(this,"_url",void 0),S(this,"_transmitter",void 0),S(this,"_addresses",void 0),S(this,"_reliableTransmission",void 0),this._initMutex=new Qn("datachannel");const{timeout:i,timeoutFactor:o}=t,a=Math.max(300,Math.floor(3*i/5)),l=Math.max(1.2,Math.floor(8*o)/10);Ui.ONLINE&&(this._retryConfig.timeout=a,this._retryConfig.timeoutFactor=l),Tn.on(aa.NETWORK_STATE_CHANGE,(u,h)=>{u!==h&&(this.resetReconnectCount("network state change: ".concat(h," -> ").concat(u)),u===Ui.ONLINE?(this._retryConfig.timeout=a,this._retryConfig.timeoutFactor=l):(this._retryConfig.timeout=i,this._retryConfig.timeoutFactor=o))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=t;const i=(o,a)=>{this._addresses=e,this.currentURLIndex=this._addresses.findIndex(u=>u.fingerprint||V("FINGERPRINT"));const l=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(l).then(o).catch(a),this.once(dn.CLOSED,()=>a(new W(N.WS_DISCONNECT))),this.once(dn.CONNECTED,()=>o())};return this._initMutex.lock().then(o=>new X((a,l)=>{i(a,l)}).then(()=>{o()}).catch(()=>{o()}))}sendMessage(e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new W(N.WS_ABORT,"datachannel is not ready");try{t||(e=JSON.stringify(e)),this._reliableTransmission.sendMessage(e)}catch(i){throw new W(N.WS_ERR,"send datachannel signal message error"+i.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(e){const t=JSON.stringify(e);return{compressed:t,compressedLength:t.length,origin:e}}sendMessageWithUint8Array(e){return{compressed:e,compressedLength:e.byteLength,origin:e}}createTransmitterConnection(e){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(e.ip,":").concat(e.port),new X((t,i)=>{var o;const a=()=>{y.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),t()},l=async m=>{var E;if((E=this._closeEstablishingTransmitter)===null||E===void 0||E.call(this),y.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(m.code,", reason: ").concat(m.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=m.reason,this.state="reconnecting");const v=Er(this,dn.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,T=await this.reconnectWithAction(v);if(this.state==="closed")return void y.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!T)return i(new W(N.WS_DISCONNECT,"datachannel reconnect failed: ".concat(m.code))),void this.close(!0);t()}else i(new W(N.WS_DISCONNECT,"datachannel close: ".concat(m.code))),this.close()},u=m=>{var E;(E=this._reliableTransmission)===null||E===void 0||E.onData(m.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),y.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(e)));const h=(o=this._store)===null||o===void 0?void 0:o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),f=Date.now();Sn(this,dn.TO_CONNECT_DATACHANNEL,e).then(m=>{var E,v;if(!m)throw new Error("transmissonInfo not exist yet");const{transmitter:T,close:A}=m;this._transmitter=T,(E=this._store)===null||E===void 0||E.signalChannelOpen();const C=Date.now()-f;y.debug("[choose dc] dc open cost ".concat(C,"ms")),this._reliableTransmission=new vz(b=>{var D;this._transmitter&&this._transmitter.readyState==="open"&&((D=this._transmitter)===null||D===void 0||D.send(b))},b=>{typeof b=="string"&&this.emit(dn.ON_MESSAGE,b)}),this._closeEstablishingTransmitter=()=>{var b;(b=this._reliableTransmission)===null||b===void 0||b.close(),this._reliableTransmission=void 0,A()},a&&a(),T.onclose=l,T.onmessage=u,(v=this._store)===null||v===void 0||v.recordJoinChannelService({endTs:Date.now(),status:"success"},h),this._joinChannelServiceRecordIndex=h}).catch(m=>{var E;if((E=this._store)===null||E===void 0||E.recordJoinChannelService({endTs:Date.now(),status:m instanceof W&&m.code===N.WS_ABORT?"aborted":"error",errors:[m]},h),this.state!=="closed"){if(m instanceof W&&m.code===N.WS_ERR){const v=new W(N.WS_ERR,"init datachannel failed! Error: ".concat(m.toString()));return y.error("[".concat(this._name,"]").concat(v)),void i(v)}l&&l(m)}else i(new W(N.WS_DISCONNECT,"datachannel is closed: ".concat(m.toString())))})})}async reconnectWithAction(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||Tn.networkState!==Ui.OFFLINE||(this._onlineReconnectListener=Tn.onlineWaiter&&Tn.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let i=!0;if(this._reconnectInterrupter=()=>{i=!1},t){const u=n_(this._reconnectCount,this._retryConfig);y.debug("[".concat(this._name,"] wait ").concat(u,"ms to reconnect datachannel, mode: ").concat(e)),await X.race([Xn(u),this._onlineReconnectListener||new X(()=>{})])}if(this.state==="closed"||!i)return!1;this._reconnectCount+=1;const o=async(u,h)=>{this.emit(dn.RECONNECT_CREATE_CONNECTION,h),await this.createTransmitterConnection(u)};try{if(e==="retry"){const u=this._addresses[this.currentURLIndex];this.emit(dn.RECONNECT_WAITTING_FINISH,e),await o(u,e)}else if(e==="tryNext"){this.currentURLIndex+=1;for(let h=this.currentURLIndex;h<this._addresses.length;h++){if(this._addresses[h].fingerprint||V("FINGERPRINT")){this.currentURLIndex=h;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return y.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);y.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const u=this._addresses[this.currentURLIndex];this.emit(dn.RECONNECT_WAITTING_FINISH,e),await o(u,e)}else e==="recover"&&(y.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(dn.RECONNECT_WAITTING_FINISH,e),this.emit(dn.FAILBACK));return!0}catch(u){var a,l;return y.error("[".concat(this._name,"] reconnect failed"),u.toString()),u!=null&&(a=u.data)!==null&&a!==void 0&&a.desc&&Array.isArray(u.data.desc)&&u.data.desc.length&&Ie(l=u.data.desc).call(l,"dynamic key expired")?(this.emit(dn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(e,t)}}}class ha extends zt{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===tt.CONNECTED?this.emit(ye.WS_CONNECTED):e===tt.RECONNECTING?this.emit(ye.WS_RECONNECTING,this._websocketReconnectReason):e===tt.CLOSED&&this.emit(ye.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),S(this,"_disconnectedReason",void 0),S(this,"_websocketReconnectReason",void 0),S(this,"_connectionState",tt.CLOSED),S(this,"reconnectToken",void 0),S(this,"websocket",void 0),S(this,"openConnectionTime",void 0),S(this,"clientId",void 0),S(this,"lastMsgTime",Date.now()),S(this,"uploadCache",[]),S(this,"uploadCacheInterval",void 0),S(this,"rttRolling",new xT(5)),S(this,"pingpongTimer",void 0),S(this,"inflateDataTimer",void 0),S(this,"pingpongTimeoutCount",0),S(this,"joinResponse",void 0),S(this,"multiIpOption",void 0),S(this,"initError",void 0),S(this,"spec",void 0),S(this,"store",void 0),S(this,"onWebsocketMessage",i=>{if(i instanceof ArrayBuffer)return void this.emit(ye.ON_BINARY_DATA,i);const o=JSON.parse(i);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(o,"_id")){const a="res-@".concat(o._id);this.emit(a,o._result,o._message)}else if(Object.prototype.hasOwnProperty.call(o,"_type")&&(this.emit(o._type,o._message),o._type===He.ON_NOTIFICATION&&this.handleNotification(o._message),o._type===He.ON_USER_BANNED))switch(o._message.error_code){case 14:this.close(ot.UID_BANNED);break;case 15:this.close(ot.IP_BANNED);break;case 16:this.close(ot.CHANNEL_BANNED)}}),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new Y1("gateway-".concat(this.clientId),this.spec.retryConfig,!0,t),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===tt.CONNECTED&&this.reconnect("retry",Po.OFFLINE)})}async request(e,t,i,o){const a=Lt(6,""),l={_id:a,_type:e,_message:t},u=this.websocket.connectionID,h=()=>new X((A,C)=>{if(this.connectionState===tt.CONNECTED)return A();const b=()=>{this.off(ye.WS_CLOSED,D),A()},D=()=>{this.off(ye.WS_CONNECTED,b),C(new W(N.WS_ABORT))};this.once(ye.WS_CONNECTED,b),this.once(ye.WS_CLOSED,D),e!==Ne.PUBLISH&&e!==Ne.SUBSCRIBE&&e!==Ne.UNSUBSCRIBE&&e!==Ne.UNPUBLISH&&e!==Ne.CONTROL&&e!==Ne.RESTART_ICE||this.once(ye.DISCONNECT_P2P,()=>{C(new W(N.DISCONNECT_P2P))}),e!==Ne.PUBLISH&&e!==Ne.RESTART_ICE||this.once(ye.ABORT_P2P_EXECUTION,()=>{C(new W(N.DISCONNECT_P2P))})});if(this.connectionState!==tt.CONNECTING&&this.connectionState!==tt.RECONNECTING||e===Ne.JOIN||e===Ne.REJOIN||await h(),e===Ne.LEAVE&&(this.websocket.unbindDcCloseEventListener(),o=!0),this.websocket.sendMessage(l,!0,!1),o)return;const f=new X((A,C)=>{let b=!1;const D=(B,J)=>{b=!0,A({isSuccess:B==="success",message:J||{}}),this.off(ye.WS_CLOSED,M),this.off(ye.WS_RECONNECTING,M),this.emit(ye.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(a),D);const M=()=>{C(new W(N.WS_ABORT,"type: ".concat(e))),this.off(ye.WS_CLOSED,M),this.off(ye.WS_RECONNECTING,M),this.off("res-@".concat(a),D)};this.once(ye.WS_CLOSED,M),this.once(ye.WS_RECONNECTING,M),Xn(V("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==u||b||(y.warning("dc request timeout, type: ".concat(e)),this.emit(ye.REQUEST_TIMEOUT,e,t))})});let m=null;try{m=await f}catch(A){if(this.connectionState===tt.CLOSED||e===Ne.LEAVE)throw new W(N.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?A.throw():e===Ne.JOIN||e===Ne.REJOIN?null:(await h(),await this.request(e,t))}if(m.isSuccess)return m.message;const E=Number(m.message.error_code||m.message.code),v=Cl(E),T=new W(N.UNEXPECTED_RESPONSE,"".concat(v.desc,": ").concat(m.message.error_str),{code:E,data:m.message});return v.action==="success"?m.message:(y.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(E,", message: ").concat(v.desc,", action: ").concat(v.action)),E===ke.ERR_TOO_MANY_BROADCASTERS?((e===Ne.JOIN||e===Ne.REJOIN)&&(this.initError=T,this.close()),T.throw()):v.action==="failed"?T.throw():v.action==="quit"?(this.initError=T,this.close(),T.throw()):(E===ke.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=m.message.option,y.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Po.MULTI_IP)):this.reconnect(v.action,Po.SERVER_ERROR),e===Ne.JOIN||e===Ne.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new X(i=>{const o=a=>{(!t||t(a))&&(this.off(e,o),i(a))};this.on(e,o)})}uploadWRTCStats(e){if(!this.store.sessionId)return void y.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(ua.WRTC_STATS,t)}upload(e,t){const i={_type:e,_message:t};try{this.websocket.sendMessage(i)}catch{const a=V("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>a&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==tt.CONNECTED)return;const l=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(l._type,l._message)},V("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){const i={_type:e,_message:t};this.websocket.sendMessage(i)}init(e,t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new X((i,o)=>{this.once(ye.WS_CONNECTED,()=>i(this.joinResponse)),this.once(ye.WS_CLOSED,()=>o(this.initError||new W(N.WS_ABORT))),this.connectionState=tt.CONNECTING,this.websocket.init(e).catch(o),this.websocket.once(dn.FAILBACK,()=>{this.openConnectionTime===void 0&&o(new W(N.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{t&&this.openConnectionTime===void 0&&(y.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),o(new W(N.INIT_DATACHANNEL_TIMEOUT)))},V("DC_JOIN_WITH_FAILBACK"))})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||ot.LEAVE,this.connectionState=tt.CLOSED,y.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),e===ot.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new Y1("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(ye.ABORT_P2P_EXECUTION);const e=await Sn(this,ye.DATACHANNEL_CONNECTING),t=await this.request(Ne.JOIN,e);if(!t)return this.emit(ye.REPORT_JOIN_GATEWAY,N.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(ye.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=tt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new W(N.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=vl(this,ye.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const t=await this.request(Ne.REJOIN,e);return!!t&&(this.connectionState=tt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),t.peers&&t.peers.forEach(i=>{this.emit(He.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(He.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(He.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(He.MUTE_AUDIO,{uid:i.uid}):this.emit(He.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(He.MUTE_VIDEO,{uid:i.uid}):this.emit(He.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(He.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(He.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(He.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(He.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(He.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleNotification(e){y.debug("[".concat(this.clientId,"] receive notification: "),e);const t=Cl(e.code);if(t.action!=="success"){if(t.action!=="failed")return t.action==="quit"?(t.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(ot.UID_BANNED),void this.close()):void this.reconnect(t.action,Po.SERVER_ERROR);y.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=V("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(y.warning("PINGPONG Timeout. Last Socket Message: ".concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>V("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Po.TIMEOUT):this.request(Ne.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-t;this.rttRolling.add(i),V("REPORT_STATS")&&this.send(Ne.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleInflateData(){const{inflateLength:e,deflateLength:t}=this.websocket.getInflateData();e!==0&&t!==0&&this.upload(ua.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:t,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(dn.RECONNECT_WAITTING_FINISH,e=>{this.emit(ye.WS_RECONNECT_WAITTING_FINISH,e)}),this.websocket.on(dn.RECONNECT_CREATE_CONNECTION,e=>{this.emit(ye.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(dn.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(dn.CLOSED,()=>{this.connectionState=tt.CLOSED}),this.websocket.on(dn.FAILED,()=>{this._disconnectedReason=ot.NETWORK_ERROR,this.connectionState=tt.CLOSED}),this.websocket.on(dn.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===tt.CONNECTED?this.connectionState=tt.RECONNECTING:this.connectionState=tt.CONNECTING}),this.websocket.on(dn.WILL_RECONNECT,(e,t)=>{if(vl(this,ye.IS_P2P_DISCONNECTED)&&e==="retry")return y.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(ye.NEED_RENEW_SESSION),this.emit(ye.DISCONNECT_P2P),t("tryNext");e!=="retry"&&(y.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0,this.emit(ye.NEED_RENEW_SESSION),this.emit(ye.DISCONNECT_P2P)),t(e)}),this.websocket.on(dn.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(e=>{y.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",Po.SERVER_ERROR)}):this.join().catch(e=>{if(this.emit(ye.REPORT_JOIN_GATEWAY,e.message||e.code,this.url||""),e instanceof W&&e.code===N.UNEXPECTED_RESPONSE&&e.data.code===ke.ERR_NO_AUTHORIZED)return y.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Po.SERVER_ERROR);y.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Po.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on(dn.REQUEST_NEW_URLS,(e,t)=>{Sn(this,ye.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)}),this.websocket.on(dn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(He.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(dn.TO_CONNECT_DATACHANNEL,async(e,t,i)=>Sn(this,ye.DATACHANNEL_PRECONNECT,e).then(t).catch(i)),this.websocket.on(dn.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(ye.DATACHANNEL_FAILBACK)})}}class Il extends zt{constructor(e,t){super(),S(this,"signal",void 0),S(this,"token",void 0),S(this,"tokenTimeout",void 0),S(this,"tokenInterval",void 0),S(this,"_sequence",0),S(this,"userMap",new Map),S(this,"encoder",new TextEncoder),this.signal=e,this.token=t;const i=()=>{this.signal.connectionState===tt.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(i,1e3):this.tokenInterval=window.setTimeout(i,3*V("P2P_TOKEN_INTERVAL"))};i()}async send(e,t,i,o,a){var l,u,h;if(this.userMap.size===0)return;const f=Array.from(no(l=this.userMap).call(l))[0].token;typeof t!="string"&&(t=JSON.stringify(t)),o=(u=o)!==null&&u!==void 0?u:Lt(6,""),a=(h=a)!==null&&h!==void 0?h:this._sequence++;const m={_id:o,_type:e,_seq:a,_message:t,token:"".concat(this.token,"_").concat(f)};V("SHOW_P2P_LOG")&&y.debug("send message",m,"noNeedResponse : ".concat(i)),this.splitMessage(JSON.stringify(m)).forEach(v=>{this.signal.request(Ne.DATA_STREAM,{payload:Fd(this.encoder.encode(v))})});const E=new X((v,T)=>{const A=window.setTimeout(()=>{this.off("res-@".concat(o,"_ack"),C),this.off("res-@".concat(o),D),this.off(dc.ABORT,b),y.debug("[external-signal] request timeout, type: ".concat(e,", requestId: ").concat(o)),this.userMap.size===0?T(new ne(N.INVALID_REMOTE_USER)):T(new ne(N.TIMEOUT))},V("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),C=()=>{A&&window.clearTimeout(A),this.off(dc.ABORT,b),i&&v()},b=()=>{A&&window.clearTimeout(A),this.off("res-@".concat(o,"_ack"),C),this.off("res-@".concat(o),D),T(new ne(N.EXTERNAL_SIGNAL_ABORT,"type: ".concat(e,", requestId: ").concat(o)))};this.once(dc.ABORT,b),this.once("res-@".concat(o,"_ack"),C);const D=(B,J)=>{M=!0,A&&window.clearTimeout(A),this.off("res-@".concat(o,"_ack"),C),this.off(dc.ABORT,b),B==="success"?v(J):T(new ne(N.P2P_MESSAGE_FAILED,"request ".concat(e," failed, requestId: ").concat(o)))};let M=!1;i||(this.once("res-@".concat(o),D),Xn(V("SIGNAL_REQUEST_TIMEOUT")).then(()=>{M||y.warning("external_signal request timeout, type: ".concat(e,", requestId: ").concat(o,", ").concat(m))}))});try{return await E}catch(v){if(v.code===N.TIMEOUT)return await this.send(e,t,i,o,a);throw v}}onMessage(e){var t;const{_uid:i}=e;let o,a=this.userMap.get(i);if(a)o=a.splitMessageMap;else{if(this.userMap.size>0||!("_type"in e)||e._type!==sn.CHECK)return;const{token:f}=e;o=new Map,a={uid:i,isStart:!0,token:f,splitMessageMap:o,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(i,a),this.signal.emit(He.ON_USER_ONLINE,{uid:i}),this.handleUserOnline()}if("id"in e&&"total"in e){var l;const{id:f,total:m}=e,E=(l=o.get(f))!==null&&l!==void 0?l:[];if(E.push(e),o.has(f)||o.set(f,E),E.length!==m)return;{const v=kh(E).call(E,(T,A)=>T.index-A.index).map(T=>T.payload).join("");o.delete(f),(e=JSON.parse(v))._uid=i}}const{_type:u,token:h}=e;if(Ie(t=[sn.ACK,sn.CHECK]).call(t,u))return u===sn.CHECK&&this.handleCheckToken(a,h),void this.receiveMessage(e);h==="".concat(a.token,"_").concat(this.token)?this.handleReceivedMessage(e):y.debug('Receive unexpected message", '.concat(h,", cur_token: ").concat(a.token,"_").concat(this.token),e)}check(){const e={_id:Lt(6,""),token:this.token,_type:sn.CHECK};V("SHOW_P2P_LOG")&&y.debug("send message",e),this.signal.request(Ne.DATA_STREAM,{payload:Fd(this.encoder.encode(JSON.stringify(e)))})}ack(e){const t={_id:e,_type:sn.ACK,token:this.token};V("SHOW_P2P_LOG")&&y.debug("send message",t),this.signal.request(Ne.DATA_STREAM,{payload:Fd(this.encoder.encode(JSON.stringify(t)))})}response(e,t,i){this.send(sn.RESPONSE,JSON.stringify({success:!i,message:t}),!0,e)}handleReceivedMessage(e){const t=()=>{this.userMap.forEach(f=>{const{receivedMessagesMap:m,nextExpectedSequenceNumber:E}=f;for(;m.has(E);){const v=m.get(E);m.delete(E),this.receiveMessage(v),f.nextExpectedSequenceNumber++}})};if(!e)return void t();const{_uid:i,_seq:o}=e,a=this.userMap.get(i),{receivedMessagesMap:l,isStart:u,nextExpectedSequenceNumber:h}=a;if(o<h)return this.ack(e._id),void y.debug("[external-signal] receive old message, seq: ".concat(o,", ").concat(e._message));l.set(o,e),u&&o===h&&(this.receiveMessage(e),l.delete(h),a.nextExpectedSequenceNumber++,t())}receiveMessage(e){const{_id:t,_type:i,_message:o,_uid:a}=e;if(V("SHOW_P2P_LOG")&&y.debug("receive message",e),t){let l;switch(e._type!==sn.ACK&&(o&&(l=JSON.parse(o)),this.ack(e._id)),e._type){case sn.CANDIDATE:case sn.CONTROL:this.signal.emit(i,l,a);break;case sn.PUBLISH:case sn.UNPUBLISH:case sn.RESTART_ICE:case sn.CALL:l.uid=a,Sn(this.signal,i,l).then(u=>{this.response(e._id,u)}).catch(()=>{this.response(e._id,void 0,!0)});break;case sn.ACK:this.getListeners("res-@".concat(t,"_ack")).length>0&&this.emit("res-@".concat(t,"_ack"));break;case sn.RESPONSE:{const{success:u,message:h}=l;this.emit("res-@".concat(t),u?"success":"failed",h);break}}}}splitMessage(e){if(e.length<Il.MAX_MESSAGE_SIZE)return[e];const t=[],{remoteToken:i}=JSON.parse(e),o=Lt(6,"");let a=0,l=800;const u=Math.ceil(e.length/l);for(;e.length>0;){a++;const h={id:o,index:a,total:u,payload:e.slice(0,l),token:"".concat(this.token,"_").concat(i)};JSON.stringify(h).length>Il.MAX_MESSAGE_SIZE?l-=50:(t.push(h),e=e.slice(l))}return t.map(h=>JSON.stringify(h))}handleCheckToken(e,t){return e.token!==t?(y.debug("token changed, from ".concat(e.token," to ").concat(t)),this.reset(e.uid,t),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{y.debug("token timeout, ".concat(t)),this.reset(e.uid)},V("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const e=await Sn(this.signal,sn.CALL,void 0),t=await this.send(sn.CALL,e);this.signal.emit(ye.P2P_CONNECTION,t,!0)}async reset(e,t){const i=this.userMap.get(e);i&&(this.emit(dc.ABORT),this.signal.emit(He.ON_USER_OFFLINE,{uid:i.uid,reason:dy.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),t||(y.debug("change local token from ".concat(t," to ").concat(t)),this.token=Lt(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(dc.ABORT)}}S(Il,"MAX_SIZE",1),S(Il,"MAX_MESSAGE_SIZE",1024);class q1 extends zt{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===tt.CONNECTED?this.emit(ye.WS_CONNECTED):e===tt.RECONNECTING?this.emit(ye.WS_RECONNECTING,this._websocketReconnectReason):e===tt.CLOSED&&this.emit(ye.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),S(this,"_disconnectedReason",void 0),S(this,"_websocketReconnectReason",void 0),S(this,"_connectionState",tt.CLOSED),S(this,"reconnectToken",void 0),S(this,"p2pToken",void 0),S(this,"websocket",void 0),S(this,"openConnectionTime",void 0),S(this,"clientId",void 0),S(this,"lastMsgTime",Date.now()),S(this,"uploadCache",[]),S(this,"uploadCacheInterval",void 0),S(this,"rttRolling",new xT(5)),S(this,"pingpongTimer",void 0),S(this,"pingpongTimeoutCount",0),S(this,"joinResponse",void 0),S(this,"multiIpOption",void 0),S(this,"initError",void 0),S(this,"spec",void 0),S(this,"store",void 0),S(this,"_external_signal",void 0),S(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(ye.ON_BINARY_DATA,i.data);const o=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(o,"_id")){const a="res-@".concat(o._id);this.emit(a,o._result,o._message)}else if(Object.prototype.hasOwnProperty.call(o,"_type")){switch(o._type){case He.ON_DATA_STREAM:return void this.handleDataStream(o._message);case He.MUTE_AUDIO:case He.MUTE_VIDEO:case He.ON_P2P_LOST:case He.ON_USER_ONLINE:return;case He.ON_USER_OFFLINE:const{uid:a}=o._message;return y.debug("[".concat(this.clientId,"] user-offline uid: ").concat(a)),void this._external_signal.reset(a)}if(this.emit(o._type,o._message),o._type===He.ON_NOTIFICATION&&this.handleNotification(o._message),o._type===He.ON_USER_BANNED)switch(o._message.error_code){case 14:this.close(ot.UID_BANNED);break;case 15:this.close(ot.IP_BANNED);break;case 16:this.close(ot.CHANNEL_BANNED)}if(o._type===He.ON_USER_LICENSE_BANNED)switch(o._message.error_code){case ke.ERR_LICENSE_MISSING:this.close(ot.LICENSE_MISSING);break;case ke.ERR_LICENSE_EXPIRED:this.close(ot.LICENSE_EXPIRED);break;case ke.ERR_LICENSE_MINUTES_EXCEEDED:this.close(ot.LICENSE_MINUTES_EXCEEDED);break;case ke.ERR_LICENSE_PERIOD_INVALID:this.close(ot.LICENSE_PERIOD_INVALID);break;case ke.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(ot.LICENSE_MULTIPLE_SDK_SERVICE);break;case ke.ERR_LICENSE_ILLEGAL:this.close(ot.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new ep("gateway-".concat(this.clientId),this.spec.retryConfig,!0,V("JOIN_GATEWAY_USE_DUAL_DOMAIN"),V("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===tt.CONNECTED&&this.reconnect("retry",Jn.OFFLINE)}),this.p2pToken=Lt(6,""),this._external_signal=new Il(this,this.p2pToken)}async request(e,t,i,o){const a=Lt(6,""),l={_id:a,_type:e,_message:t},u=this.websocket.connectionID,h=()=>new X((A,C)=>{if(this.connectionState===tt.CONNECTED)return A();const b=()=>{this.off(ye.WS_CLOSED,D),A()},D=()=>{this.off(ye.WS_CONNECTED,b),C(new ne(N.WS_ABORT))};this.once(ye.WS_CONNECTED,b),this.once(ye.WS_CLOSED,D)});if(this.connectionState!==tt.CONNECTING&&this.connectionState!==tt.RECONNECTING||e===Ne.JOIN||e===Ne.REJOIN||await h(),this.websocket.sendMessage(l,!0),o)return;const f=new X((A,C)=>{let b=!1;const D=(B,J)=>{b=!0,A({isSuccess:B==="success",message:J||{}}),this.off(ye.WS_CLOSED,M),this.off(ye.WS_RECONNECTING,M),this.emit(ye.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(a),D);const M=()=>{C(new ne(N.WS_ABORT,"type: ".concat(e))),this.off(ye.WS_CLOSED,M),this.off(ye.WS_RECONNECTING,M),this.off("res-@".concat(a),D)};this.once(ye.WS_CLOSED,M),this.once(ye.WS_RECONNECTING,M),Xn(V("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==u||b||(y.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(ye.REQUEST_TIMEOUT,e,t))})});let m=null;try{m=await f}catch(A){if(this.connectionState===tt.CLOSED||e===Ne.LEAVE)throw new ne(N.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?A.throw():e===Ne.JOIN||e===Ne.REJOIN?null:(await h(),await this.request(e,t))}if(m.isSuccess)return m.message;const E=Number(m.message.error_code||m.message.code),v=Cl(E),T=new ne(N.UNEXPECTED_RESPONSE,"".concat(v.desc,": ").concat(m.message.error_str),{code:E,data:m.message});return v.action==="success"?m.message:(y.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(E,", message: ").concat(v.desc,", action: ").concat(v.action)),E===ke.ERR_TOO_MANY_BROADCASTERS?((e===Ne.JOIN||e===Ne.REJOIN)&&(this.initError=T,this.close()),T.throw()):v.action==="failed"?T.throw():v.action==="quit"?(this.initError=T,this.close(),T.throw()):(E===ke.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=m.message.option,y.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Jn.MULTI_IP)):this.reconnect(v.action,Jn.SERVER_ERROR),e===Ne.JOIN||e===Ne.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new X(i=>{const o=a=>{(!t||t(a))&&(this.off(e,o),i(a))};this.on(e,o)})}uploadWRTCStats(e){if(!this.store.sessionId)return void y.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(ua.WRTC_STATS,t)}upload(e,t){const i={_type:e,_message:t};try{this.websocket.sendMessage(i)}catch{const a=V("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>a&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==tt.CONNECTED)return;const l=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(l._type,l._message)},V("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){const i={_type:e,_message:t};this.websocket.sendMessage(i)}async sendExtensionMessage(e,t,i){return await this._external_signal.send(e,t,i)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new X((t,i)=>{this.once(ye.WS_CONNECTED,()=>t(this.joinResponse)),this.once(ye.WS_CLOSED,()=>i(this.initError||new ne(N.WS_ABORT))),this.connectionState=tt.CONNECTING,this.websocket.init(e).catch(i)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||ot.LEAVE,this.connectionState=tt.CLOSED,y.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),e===ot.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new ep("gateway-".concat(this.clientId),this.spec.retryConfig,!0,V("JOIN_GATEWAY_USE_DUAL_DOMAIN"),V("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents()),this.p2pToken=Lt(6,""),this._external_signal.clear(),this._external_signal=new Il(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(ye.ABORT_P2P_EXECUTION);const e=await Sn(this,ye.REQUEST_JOIN_INFO),t=await this.request(Ne.JOIN,e);if(!t)return this.emit(ye.REPORT_JOIN_GATEWAY,N.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(ye.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=tt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleDataStream(e){try{var t;const i=Kh(e.payload),o=new TextDecoder().decode(i),a=JSON.parse(o);"total"in a&&"id"in a||Ie(t=Object.values(sn)).call(t,a._type)?(a._uid=e.uid,this._external_signal.onMessage(a)):this.emit(He.ON_DATA_STREAM,e)}catch{this.emit(He.ON_DATA_STREAM,e)}}handleNotification(e){y.debug("[".concat(this.clientId,"] receive notification: "),e);const t=Cl(e.code);if(t.action!=="success"){if(t.action!=="failed")return t.action==="quit"?(t.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(ot.UID_BANNED),void this.close()):void this.reconnect(t.action,Jn.SERVER_ERROR);y.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=V("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(y.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>V("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Jn.TIMEOUT):this.request(Ne.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-t;this.rttRolling.add(i),V("REPORT_STATS")&&this.send(Ne.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWebsocketEvents(){this.websocket.on(je.RECONNECT_WAITTING_FINISH,e=>{this.emit(ye.WS_RECONNECT_WAITTING_FINISH,e)}),this.websocket.on(je.RECONNECT_CREATE_CONNECTION,e=>{this.emit(ye.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(je.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(je.CLOSED,()=>{this.connectionState=tt.CLOSED}),this.websocket.on(je.FAILED,()=>{this._disconnectedReason=ot.NETWORK_ERROR,this.connectionState=tt.CLOSED}),this.websocket.on(je.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===tt.CONNECTED?this.connectionState=tt.RECONNECTING:this.connectionState=tt.CONNECTING}),this.websocket.on(je.WILL_RECONNECT,(e,t,i)=>{e!=="retry"?(y.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0,this.emit(ye.NEED_RENEW_SESSION)):y.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),i(e)}),this.websocket.on(je.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(e=>{if(this.emit(ye.REPORT_JOIN_GATEWAY,e.message||e.code,this.url||""),e instanceof ne&&e.code===N.UNEXPECTED_RESPONSE&&e.data.code===ke.ERR_NO_AUTHORIZED)return y.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Jn.SERVER_ERROR);y.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Jn.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on(je.REQUEST_NEW_URLS,(e,t)=>{Sn(this,ye.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)}),this.websocket.on(je.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(He.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}function J1(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}function As(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?J1(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):J1(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}const gy=new Map;class Sz extends zt{get state(){return this._state}set state(e){if(e===this._state)return;const t=this._state;this._state=e,e==="DISCONNECTED"&&this._disconnectedReason?this.emit(rn.CONNECTION_STATE_CHANGE,e,t,this._disconnectedReason):this.emit(rn.CONNECTION_STATE_CHANGE,e,t)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){y.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,t){super(),S(this,"store",void 0),S(this,"joinInfo",void 0),S(this,"key",void 0),S(this,"ntpOffset",0),S(this,"signal",void 0),S(this,"role",void 0),S(this,"inChannelInfo",{joinAt:null,duration:0}),S(this,"spec",void 0),S(this,"_state","DISCONNECTED"),S(this,"_statsCollector",void 0),S(this,"_disconnectedReason",void 0),S(this,"isSignalRecover",!1),S(this,"hasChangeBGPAddress",!1),S(this,"trafficStatsInterval",void 0),S(this,"networkQualityInterval",void 0),S(this,"_joinGatewayStartTime",0),S(this,"_signalTimeout",!1),S(this,"_clientRoleOptions",void 0),S(this,"_isProactiveJoin",!1),this.store=e,this.spec=t,this.signal=this.store.useP2P?new q1(As(As({},t),{},{retryConfig:t.websocketRetryConfig}),e):this.store.useDataChannel?new ha(As(As({},t),{},{retryConfig:t.websocketRetryConfig}),e):new V1(As(As({},t),{},{retryConfig:t.websocketRetryConfig}),e),this._statsCollector=t.statsCollector,this.role=t.role||"audience",this._clientRoleOptions=t.clientRoleOptions,this.handleSignalEvents()}async join(e,t,i){if(this.signal instanceof ha){let h=!1;e.cloudProxyServer!=="disabled"?(y.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(e.cloudProxyServer,")")),h=!0):"".concat(e.apResponse.cid,"_").concat(e.apResponse.cert).length>255||"".concat(e.apResponse.cid,"_").concat(e.apResponse.cert).length<22?(y.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),h=!0):e.apResponse.addresses.some(f=>f.fingerprint)||V("FINGERPRINT")||(y.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),h=!0),h&&this.resetSignal()}this.store.joinGatewayStart(),e.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const o=Date.now();let a=gy.get(e.cname);if(a||(a=new Map,gy.set(e.cname,a)),this._isProactiveJoin=!0,a.has(e.uid)){const h=new W(N.UID_CONFLICT);throw Oe.joinGateway(e.sid,{lts:o,succ:!1,ec:h.message,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!e.proxyServer,signalChannel:this.signal instanceof ha?"1":"0"}),this._isProactiveJoin=!1,h}a.set(e.uid,!0),this.joinInfo=e,this.key=t;let l=0;this.joinGatewayStartTime=o;const u=e.proxyServer;try{let h;if(y.debug("[".concat(this.store.clientId,"] use ").concat(this.signal instanceof ha?"datachannel":"websocket"," join uid ").concat(l)),this.signal instanceof ha)h=await this.signal.init(e.apResponse.addresses,i);else{const f=e.gatewayAddrs.map(m=>{let{address:E}=m;const[v,T]=E.split(":"),A={host:v,port:T};return e.proxyServer&&(A.proxy=e.proxyServer),A});h=await this.signal.init(f,i)}l=h.uid,y.debug("[".concat(this.store.clientId,"] ").concat(this.signal instanceof ha?"datachannel":"websocket"," join uid ").concat(l," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(h){throw h&&h.code===N.INIT_WEBSOCKET_TIMEOUT?(y.warning("[".concat(this.store.clientId,"] User join failed"),h.toString()),h):h&&h.code===N.INIT_DATACHANNEL_TIMEOUT?(y.warning("[".concat(this.store.clientId,"] User join datachannel failed"),h.toString()),this.resetSignal(),h):(y.error("[".concat(this.store.clientId,"] User join failed"),h.toString()),Oe.joinGateway(e.sid,{lts:o,succ:!1,ec:h.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!u,signalChannel:this.signal instanceof ha?"1":"0"}),this._isProactiveJoin=!1,a.delete(e.uid),this.signal.close(),h)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),y.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(h=>{y.warning("[".concat(this.store.clientId,"] get traffic stats error"),h.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(rn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(rn.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(rn.NETWORK_QUALITY,{uplinkNetworkQuality:K1(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:K1(this._statsCollector.trafficStats.B_dnq)}):this.emit(rn.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),l}async leave(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){t!==ot.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==tt.CONNECTED||await function(i,o){return o===1/0?i:X.race([i,lK(o)])}(this.signal.request(Ne.LEAVE,void 0,!0),3e3)}catch(i){y.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),i)}this.signal.close(t),t!==ot.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,t,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new W(N.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const o={state:"offer",p2p_id:this.store.p2pId,ortc:t,mode:this.spec.mode,extend:V("PUB_EXTEND"),twcc:!!V("PUBLISH_TWCC"),rtx:!!V("USE_PUB_RTX")};try{return(await this.signal.request(Ne.PUBLISH,o,!0))._message}catch(a){if(i&&a.data&&a.data.code===ke.ERR_PUBLISH_REQUEST_INVALID)return y.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),a.toString()),await this.tryUnpubBeforeRepub(e,t),this.publish(e,t,!1);throw a}}async publishDataChannel(e,t,i){var o;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new W(N.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const a={stream_id:t.streamId,ordered:t.ordered?1:0,max_retrans_times:(o=t.maxRetransmits)!==null&&o!==void 0?o:10,channel_id:t.channelId,metadata:t.metadata};try{await this.signal.request(Ne.PUBLISH_DATASTREAM,a,!0)}catch(l){if(i&&l.data&&l.data.code===ke.ERR_PUBLISH_REQUEST_INVALID)return y.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),l.toString()),await this.tryUnpubDataChannelBeforeRepub(e,t),this.publishDataChannel(e,t,!1);throw l}}async unpublish(e,t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new W(N.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Ne.UNPUBLISH,{stream_id:t,ortc:e},!0)}catch(i){y.warning("[".concat(this.store.clientId,"] unpublish warning: "),i)}}async unpublishDataChannel(e){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new W(N.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await X.all(e.map(t=>this.signal.request(Ne.UNPUBLISH_DATASTREAM,{channel_id:t},!0)))}catch(t){y.warning("unpublish datachannels warning: ",t)}}async presubscribe(e,t,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new W(N.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const o={stream_id:e,stream_type:t,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!V("SUBSCRIBE_TWCC"),rtx:!!V("USE_SUB_RTX")||void 0,extend:V("SUB_EXTEND"),svc:Array.isArray(V("SVC"))&&V("SVC").length!==0?V("SVC"):void 0};try{return await this.signal.request(Ne.PRE_SUBSCRIBE,o,!0)}catch(a){if(i&&a.data&&a.data.code===ke.ERR_SUBSCRIBE_REQUEST_INVALID)return y.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),a.toString()),this.presubscribe(e,t,!1);throw a}}async subscribe(e,t,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new W(N.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const o={stream_id:e,stream_type:t.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!V("SUBSCRIBE_TWCC"),rtx:!!V("USE_SUB_RTX"),extend:V("SUB_EXTEND"),ssrcId:t.ssrcId,svc:Array.isArray(V("SVC"))&&V("SVC").length!==0?V("SVC"):void 0};try{return(await this.signal.request(Ne.SUBSCRIBE,o,!0))._message}catch(a){if(i&&a.data&&a.data.code===ke.ERR_SUBSCRIBE_REQUEST_INVALID)return y.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),a.toString()),await this.tryUnsubBeforeResub(e,t),await this.subscribe(e,t,!1);throw a}}async subscribeDataChannel(e,t,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new W(N.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const o={uid:e,stream_id:t.id,channel_id:t.datachannelId};try{return void await this.signal.request(Ne.SUBSCRIBE_DATASTREAM,o,!0)}catch(a){if(i&&a.data&&a.data.code===ke.ERR_SUBSCRIBE_REQUEST_INVALID)return y.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),a.toString()),await this.tryUnsubDataChannelBeforeResub(e,t),await this.subscribeDataChannel(e,t,!1);throw a}}async subscribeAll(e,t){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new W(N.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const i={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!V("USE_SUB_RTX")};try{return await this.signal.request(Ne.SUBSCRIBE_STREAMS,i,!0)}catch(o){if(t&&o.data&&o.data.code===ke.ERR_SUBSCRIBE_REQUEST_INVALID)return y.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),o.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw o}}async setVideoProfile(e){const t=function(i){if(!(i.bitrateMax&&i.bitrateMin&&i.frameRate&&i.height&&i.width))return;let o=i.frameRate,a=i.width,l=i.height,u=!0;return typeof o!="number"&&(o=o.exact||o.ideal||o.max||o.min||0,o||(u=!1)),typeof a!="number"&&(a=a.exact||a.ideal||a.max||a.min||0,a||(u=!1)),typeof l!="number"&&(l=l.exact||l.ideal||l.max||l.min||0,o||(u=!1)),u?{stream_type:0,width:a,height:l,fps:o,start_bps:1e3*i.bitrateMax,min_bps:1e3*i.bitrateMin,target_bps:1e3*i.bitrateMax}:void 0}(e);if(t)return this.signal.request(Ne.SET_VIDEO_PROFILE,t);y.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,t){try{await this.signal.request(Ne.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:t},!0)}catch(i){y.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),i)}}async unsubscribeDataChannel(e,t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new W(N.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await X.all(e.map(i=>this.signal.request(Ne.UNSUBSCRIBE_DATASTREAM,{stream_id:i,uid:t},!0)))}catch(i){y.warning("unsubscribeDataChannel warning: ",i)}}async massUnsubscribe(e){try{await this.signal.request(Ne.UNSUBSCRIBE_STREAMS,e,!0)}catch(t){y.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),t)}}async reconnectPC(e){const{iceParameters:t,dtlsParameters:i,rtpCapabilities:o}=e;return{gatewayEstablishParams:await this.signal.request(Ne.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:t,dtlsParameters:i,rtpCapabilities:o}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Ne.GATEWAY_INFO)}async renewToken(e){await this.signal.request(Ne.RENEW_TOKEN,e),this.key=e.token}async setClientRole(e,t){if(t&&(this._clientRoleOptions=Object.assign({},t)),this.state!=="CONNECTED")return void(this.role=e);let i,o=0;e==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(i=this._clientRoleOptions.delay,o=1):o=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:o=0,await this.signal.request(Ne.SET_CLIENT_ROLE,{role:e,level:o,delay:i,client_ts:Date.now()}),this.role=e}async setRemoteVideoStreamType(e,t){await this.signal.request(Ne.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:t})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(Ne.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,t){await this.signal.request(Ne.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:t})}async pickSVCLayer(e,t){await this.signal.request(Ne.PICK_SVC_LAYER,{stream_id:e,spatial_layer:t.spatialLayer,temporal_layer:t.temporalLayer})}async setRTM2Flag(e){await this.signal.request(Ne.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,t,i){if(this.signal instanceof q1)return this.signal.sendExtensionMessage(e,t,i)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),As({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Ne.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const e=gy.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const e=function(t){let i;return i=t.startsWith("dc")?t.match(/(dc\:\/\/)?([^:]+):(\d+)/):t.match(/(wss\:\/\/)?([^:]+):(\d+)/),i?{username:Wi.username,password:Wi.password,turnServerURL:i[2],tcpport:parseInt(i[3])+30,udpport:parseInt(i[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(As(As({},Wi),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const e=await this.signal.request(Ne.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),e.ntp_offset!=null&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach(t=>{const i=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(o=>o.peer_uid===t.peer_uid);i&&i.B_st!==t.B_st&&Zm(()=>{this.emit(rn.STREAM_TYPE_CHANGE,t.peer_uid,t.B_st)})}),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){if(!this.joinInfo||!this.key)throw new W(N.UNEXPECTED_ERROR,"can not generate join message, no join info");const t=Object.assign({},this.joinInfo.apResponse);let i=V("REPORT_APP_SCENARIO");if(typeof i!="string")try{i=JSON.stringify(i)}catch{i=void 0}i&&i.length>128&&(i=void 0);const o=As({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:es,browser:navigator.userAgent,process_id:V("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:t,extend:V("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:i,attributes:{userAttributes:{enablePublishedUserList:V("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:V("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:typeof V("SUBSCRIBE_AUDIO_FILTER_TOPN")=="number"?V("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:typeof V("ENABLE_PUBLISH_AUDIO_FILTER")=="boolean"?V("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:typeof V("ENABLE_USER_LICENSE_CHECK")=="boolean"?V("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:V("USE_PUB_RTX")===!0||V("USE_SUB_RTX")===!0||void 0,disableFEC:V("DISABLE_FEC"),enableNTPReport:!!V("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!V("ENABLE_INSTANT_VIDEO")||void 0,enableDataStream2:typeof V("ENABLE_DATASTREAM_2")=="boolean"?V("ENABLE_DATASTREAM_2"):void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!V("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:typeof V("USE_XR")=="boolean"?V("USE_XR"):void 0}},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(o.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(o.aes_mode=this.joinInfo.aesmode,V("ENCRYPT_AES")?(o.aes_secret=this.joinInfo.aespassword,o.aes_encrypt=!0):o.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(o.aes_salt=this.joinInfo.aessalt)),t.addresses[this.signal.websocket.currentURLIndex]&&(o.ap_response.ticket=t.addresses[this.signal.websocket.currentURLIndex].ticket,delete t.addresses),this.joinInfo.defaultVideoStream!==void 0&&(o.default_video_stream=this.joinInfo.defaultVideoStream),o}getRejoinMessage(){if(!this.joinInfo)throw new W(N.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(ye.WS_RECONNECT_WAITTING_FINISH,e=>{var t;Ie(t=["tryNext","recover"]).call(t,e)&&this.joinInfo&&Oe.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(ye.WS_RECONNECT_CREATE_CONNECTION,e=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(ye.WS_RECONNECTING,e=>{this.joinInfo&&Oe.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||Jn.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Oe.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(ye.WS_CLOSED,e=>{let t;switch(e){case ot.LEAVE:t=Jn.LEAVE;break;case ot.UID_BANNED:case ot.IP_BANNED:case ot.CHANNEL_BANNED:case ot.SERVER_ERROR:t=Jn.SERVER_ERROR;break;case ot.FALLBACK:t=Jn.FALLBACK;break;case ot.LICENSE_MISSING:case ot.LICENSE_EXPIRED:case ot.LICENSE_MINUTES_EXCEEDED:case ot.LICENSE_PERIOD_INVALID:case ot.LICENSE_MULTIPLE_SDK_SERVICE:case ot.LICENSE_ILLEGAL:case ot.TOKEN_EXPIRE:t=e;break;default:t=Jn.NETWORK_ERROR}y.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(t||"undefined -> "+Jn.NETWORK_ERROR)),this.joinInfo&&Oe.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===ot.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t}),this._disconnectedReason=e,e!==ot.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(ye.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&(this.role==="audience"&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(y.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),Oe.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof ha?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1)){const e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void y.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));Nt("EVENT_REPORT_DOMAIN",e[1]),Nt("EVENT_REPORT_BACKUP_DOMAIN",e[1]),Nt("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}}),this.signal.on(He.ON_UPLINK_STATS,e=>{this._statsCollector.updateUplinkStats(e)}),this.signal.on(ye.REQUEST_RECOVER,(e,t,i)=>{if(!this.joinInfo)return i(new W(N.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Sn(this,rn.REQUEST_NEW_GATEWAY_LIST).then(t).catch(i)}),this.signal.on(ye.REQUEST_JOIN_INFO,async e=>{var t;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));const{iceParameters:i,dtlsParameters:o,rtpCapabilities:a}=await Sn(this,rn.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(t=this.joinInfo)===null||t===void 0?void 0:t.turnServer});e(this.getJoinMessage({ortc:{iceParameters:i,dtlsParameters:o,rtpCapabilities:a,version:"2"}}))}),this.signal.on(ye.REQUEST_REJOIN_INFO,e=>{e(this.getRejoinMessage())}),this.signal.on(ye.REPORT_JOIN_GATEWAY,(e,t)=>{this.joinInfo&&(Oe.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:e,addr:t,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof ha?"1":"0"}),this._isProactiveJoin=!1)}),this.signal.on(ye.IS_P2P_DISCONNECTED,e=>{e(vl(this,rn.IS_P2P_DISCONNECTED))}),this.signal.on(ye.DISCONNECT_P2P,()=>{this.emit(rn.DISCONNECT_P2P)}),this.signal.on(ye.NEED_RENEW_SESSION,()=>{this.emit(rn.NEED_RENEW_SESSION)}),this.signal.on(ye.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(ye.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(ye.JOIN_RESPONSE,e=>{const t=this.getCurrentGatewayAddress();this.emit(rn.JOIN_RESPONSE,e,t)}),this.signal.on(ye.DATACHANNEL_PRECONNECT,async(e,t,i)=>{this.updateTurnConfigFromSignal();const o=this.getCurrentGatewayAddress();return Sn(this,rn.DATACHANNEL_PRECONNECT,e,o).then(t).catch(i)}),this.signal.on(ye.DATACHANNEL_CONNECTING,async e=>{const{iceParameters:t,dtlsParameters:i,rtpCapabilities:o}=await Sn(this,rn.REQUEST_DC_CONNECTION_PARAMS);e(this.getJoinMessage({ortc:{iceParameters:t,dtlsParameters:i,rtpCapabilities:o,version:"2"}}))}),this.signal.on(ye.DATACHANNEL_FAILBACK,()=>{y.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(rn.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(e,t){try{await this.signal.request(Ne.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[t]},!0)}catch(i){throw y.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),i),i}}async tryUnsubDataChannelBeforeResub(e,t){try{await this.signal.request(Ne.UNSUBSCRIBE,{stream_id:t.id},!0)}catch(i){throw y.warning("unsubscribe datachannel warning",i),i}}async tryUnpubBeforeRepub(e,t){try{await this.signal.request(Ne.UNPUBLISH,{stream_id:e,ortc:t},!0)}catch(i){throw y.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),i),i}}async tryUnpubDataChannelBeforeRepub(e,t){try{await this.signal.request(Ne.UNPUBLISH_DATASTREAM,{channnel_id:t.channelId},!0)}catch(i){throw y.warning("unpublish datastream warning: ",i),i}}async tryMassUnsubBeforeResub(e){const t={users:e.map(i=>({stream_id:i.stream_id,stream_type:i.stream_type}))};try{await this.signal.request(Ne.UNSUBSCRIBE_STREAMS,t,!0)}catch(i){throw y.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),i),i}}async muteLocal(e,t){const i={action:e.find(o=>o.stream_type===vt.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(Ne.CONTROL,i,!0,!0)}catch(o){throw y.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),o),o}}async unmuteLocal(e,t){const i={action:e.find(o=>o.stream_type===vt.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(Ne.CONTROL,i,!0,!0)}catch(o){throw y.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),o),o}}async muteRemote(e,t){const i={action:e===be.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(Ne.CONTROL,i,!0,!0)}catch(o){throw y.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),o),o}}async unmuteRemote(e,t){const i={action:e===be.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(Ne.CONTROL,i,!0,!0)}catch(o){throw y.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),o),o}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,t){this.signal.upload(e,t)}getSignalRTT(){return this.signal.rtt}async restartICE(e){const t={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(Ne.RESTART_ICE,t,!0)}catch(i){throw y.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),i),i}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,Jn.P2P_FAILED)}getCurrentGatewayAddress(){var e;if(!V("GATEWAY_WSS_ADDRESS"))return(e=this.joinInfo)!==null&&e!==void 0&&e.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(Ne.SET_PARAMETER,{enablePublishAudioFilter:e})}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(ot.FALLBACK)),this.store.useDataChannel=!1,this.signal=new V1(As(As({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(rn.RESET_SIGNAL,__.websocket)}}let T_=0,vy=0;function pa(n,e,t,i){return new X((o,a)=>{e.timeout=e.timeout||V("HTTP_CONNECT_TIMEOUT"),e.responseType=e.responseType||"json",e.data&&!t?(e.data=JSON.stringify(e.data),T_+=Ao(e.data)):t&&(e.data.size?T_+=e.data.size:e.data instanceof FormData?T_+=bP(e.data):T_+=Ao(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=n,rr.request(e).then(l=>{typeof l.data=="string"?vy+=Ao(l.data):l.data instanceof ArrayBuffer||l.data instanceof Uint8Array?vy+=l.data.byteLength:vy+=Ao(JSON.stringify(l.data)),i&&o({data:l.data,headers:l.headers}),o(l.data)}).catch(l=>{rr.isCancel(l)?a(new W(N.OPERATION_ABORTED,"cancel token canceled")):l.code==="ECONNABORTED"?a(new W(N.NETWORK_TIMEOUT,l.message)):l.response?a(new W(N.NETWORK_RESPONSE_ERROR,l.response.status)):a(new W(N.NETWORK_ERROR,l.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var n;function e(se){var he=0;return function(){return he<se.length?{done:!1,value:se[he++]}:{done:!0}}}var t=typeof Object.defineProperties=="function"?Object.defineProperty:function(se,he,Ae){return se==Array.prototype||se==Object.prototype||(se[he]=Ae.value),se},i,o=function(se){se=[typeof globalThis=="object"&&globalThis,se,typeof window=="object"&&window,typeof self=="object"&&self,typeof d=="object"&&d];for(var he=0;he<se.length;++he){var Ae=se[he];if(Ae&&Ae.Math==Math)return Ae}throw Error("Cannot find global object")}(this);function a(se,he){if(he)e:{var Ae=o;se=se.split(".");for(var Ke=0;Ke<se.length-1;Ke++){var _t=se[Ke];if(!(_t in Ae))break e;Ae=Ae[_t]}(he=he(Ke=Ae[se=se[se.length-1]]))!=Ke&&he!=null&&t(Ae,se,{configurable:!0,writable:!0,value:he})}}function l(se){return(se={next:se})[Symbol.iterator]=function(){return this},se}function u(se){var he=typeof Symbol<"u"&&Symbol.iterator&&se[Symbol.iterator];return he?he.call(se):{next:e(se)}}if(a("Symbol",function(se){function he(_t,ve){this.A=_t,t(this,"description",{configurable:!0,writable:!0,value:ve})}if(se)return se;he.prototype.toString=function(){return this.A};var Ae="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Ke=0;return function _t(ve){if(this instanceof _t)throw new TypeError("Symbol is not a constructor");return new he(Ae+(ve||"")+"_"+Ke++,ve)}}),a("Symbol.iterator",function(se){if(se)return se;se=Symbol("Symbol.iterator");for(var he="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Ae=0;Ae<he.length;Ae++){var Ke=o[he[Ae]];typeof Ke=="function"&&typeof Ke.prototype[se]!="function"&&t(Ke.prototype,se,{configurable:!0,writable:!0,value:function(){return l(e(this))}})}return se}),typeof Object.setPrototypeOf=="function")i=Object.setPrototypeOf;else{var h;e:{var f={};try{f.__proto__={a:!0},h=f.a;break e}catch{}h=!1}i=h?function(se,he){if(se.__proto__=he,se.__proto__!==he)throw new TypeError(se+" is not extensible");return se}:null}var m=i;function E(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function v(se){if(se.m)throw new TypeError("Generator is already running");se.m=!0}function T(se,he){return se.h=3,{value:he}}function A(se){this.g=new E,this.G=se}function C(se,he,Ae,Ke){try{var _t=he.call(se.g.j,Ae);if(!(_t instanceof Object))throw new TypeError("Iterator result "+_t+" is not an object");if(!_t.done)return se.g.m=!1,_t;var ve=_t.value}catch(w){return se.g.j=null,se.g.s(w),b(se)}return se.g.j=null,Ke.call(se.g,ve),b(se)}function b(se){for(;se.g.h;)try{var he=se.G(se.g);if(he)return se.g.m=!1,{value:he.value,done:!1}}catch(Ae){se.g.v=void 0,se.g.s(Ae)}if(se.g.m=!1,se.g.l){if(he=se.g.l,se.g.l=null,he.F)throw he.D;return{value:he.return,done:!0}}return{value:void 0,done:!0}}function D(se){this.next=function(he){return se.o(he)},this.throw=function(he){return se.s(he)},this.return=function(he){return function(Ae,Ke){v(Ae.g);var _t=Ae.g.j;return _t?C(Ae,"return"in _t?_t.return:function(ve){return{value:ve,done:!0}},Ke,Ae.g.return):(Ae.g.return(Ke),b(Ae))}(se,he)},this[Symbol.iterator]=function(){return this}}function M(se,he){return he=new D(new A(he)),m&&se.prototype&&m(he,se.prototype),he}if(E.prototype.o=function(se){this.v=se},E.prototype.s=function(se){this.l={D:se,F:!0},this.h=this.C||this.u},E.prototype.return=function(se){this.l={return:se},this.h=this.u},A.prototype.o=function(se){return v(this.g),this.g.j?C(this,this.g.j.next,se,this.g.o):(this.g.o(se),b(this))},A.prototype.s=function(se){return v(this.g),this.g.j?C(this,this.g.j.throw,se,this.g.o):(this.g.s(se),b(this))},a("Array.prototype.entries",function(se){return se||function(){return function(he,Ae){he instanceof String&&(he+="");var Ke=0,_t=!1,ve={next:function(){if(!_t&&Ke<he.length){var w=Ke++;return{value:Ae(w,he[w]),done:!1}}return _t=!0,{done:!0,value:void 0}}};return ve[Symbol.iterator]=function(){return ve},ve}(this,function(he,Ae){return[he,Ae]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var B=function(se,he){for(var Ae=0;Ae<se.length;Ae++)he(se[Ae])},J=function(se){return se.replace(/\r?\n|\r/g,`\r
`)},G=function(se,he,Ae){return he instanceof Blob?(Ae=Ae!==void 0?Ae+"":typeof he.name=="string"?he.name:"blob",he.name===Ae&&Object.prototype.toString.call(he)!=="[object Blob]"||(he=new File([he],Ae)),[String(se),he]):[String(se),String(he)]},q=function(se,he){if(se.length<he)throw new TypeError(he+" argument required, but only "+se.length+" present.")},Q=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,$=Q.FormData,ue=Q.XMLHttpRequest&&Q.XMLHttpRequest.prototype.send,Ee=Q.Request&&Q.fetch,Ye=Q.navigator&&Q.navigator.sendBeacon,st=Q.Element&&Q.Element.prototype,Vt=Q.Symbol&&Symbol.toStringTag;Vt&&(Blob.prototype[Vt]||(Blob.prototype[Vt]="Blob"),"File"in Q&&!File.prototype[Vt]&&(File.prototype[Vt]="File"));try{new File([],"")}catch{Q.File=function(he,Ae,Ke){return he=new Blob(he,Ke||{}),Object.defineProperties(he,{name:{value:Ae},lastModified:{value:+(Ke&&Ke.lastModified!==void 0?new Date(Ke.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Vt&&Object.defineProperty(he,Vt,{value:"File"}),he}}var wn=function(se){return se.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Wt=function(se){this.i=[];var he=this;se&&B(se.elements,function(Ae){if(Ae.name&&!Ae.disabled&&Ae.type!=="submit"&&Ae.type!=="button"&&!Ae.matches("form fieldset[disabled] *"))if(Ae.type==="file"){var Ke=Ae.files&&Ae.files.length?Ae.files:[new File([],"",{type:"application/octet-stream"})];B(Ke,function(_t){he.append(Ae.name,_t)})}else Ae.type==="select-multiple"||Ae.type==="select-one"?B(Ae.options,function(_t){!_t.disabled&&_t.selected&&he.append(Ae.name,_t.value)}):Ae.type==="checkbox"||Ae.type==="radio"?Ae.checked&&he.append(Ae.name,Ae.value):(Ke=Ae.type==="textarea"?J(Ae.value):Ae.value,he.append(Ae.name,Ke))})};if((n=Wt.prototype).append=function(se,he,Ae){q(arguments,2),this.i.push(G(se,he,Ae))},n.delete=function(se){q(arguments,1);var he=[];se=String(se),B(this.i,function(Ae){Ae[0]!==se&&he.push(Ae)}),this.i=he},n.entries=function se(){var he,Ae=this;return M(se,function(Ke){if(Ke.h==1&&(he=0),Ke.h!=3)return he<Ae.i.length?Ke=T(Ke,Ae.i[he]):(Ke.h=0,Ke=void 0),Ke;he++,Ke.h=2})},n.forEach=function(se,he){q(arguments,1);for(var Ae=u(this),Ke=Ae.next();!Ke.done;Ke=Ae.next()){var _t=u(Ke.value);Ke=_t.next().value,_t=_t.next().value,se.call(he,_t,Ke,this)}},n.get=function(se){q(arguments,1);var he=this.i;se=String(se);for(var Ae=0;Ae<he.length;Ae++)if(he[Ae][0]===se)return he[Ae][1];return null},n.getAll=function(se){q(arguments,1);var he=[];return se=String(se),B(this.i,function(Ae){Ae[0]===se&&he.push(Ae[1])}),he},n.has=function(se){q(arguments,1),se=String(se);for(var he=0;he<this.i.length;he++)if(this.i[he][0]===se)return!0;return!1},n.keys=function se(){var he,Ae,Ke,_t,ve=this;return M(se,function(w){if(w.h==1&&(he=u(ve),Ae=he.next()),w.h!=3)return Ae.done?void(w.h=0):(Ke=Ae.value,_t=u(Ke),T(w,_t.next().value));Ae=he.next(),w.h=2})},n.set=function(se,he,Ae){q(arguments,2),se=String(se);var Ke=[],_t=G(se,he,Ae),ve=!0;B(this.i,function(w){w[0]===se?ve&&(ve=!Ke.push(_t)):Ke.push(w)}),ve&&Ke.push(_t),this.i=Ke},n.values=function se(){var he,Ae,Ke,_t,ve=this;return M(se,function(w){if(w.h==1&&(he=u(ve),Ae=he.next()),w.h!=3)return Ae.done?void(w.h=0):(Ke=Ae.value,(_t=u(Ke)).next(),T(w,_t.next().value));Ae=he.next(),w.h=2})},Wt.prototype._asNative=function(){for(var se=new $,he=u(this),Ae=he.next();!Ae.done;Ae=he.next()){var Ke=u(Ae.value);Ae=Ke.next().value,Ke=Ke.next().value,se.append(Ae,Ke)}return se},Wt.prototype._blob=function(){var se="----formdata-polyfill-"+Math.random(),he=[],Ae="--"+se+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(Ke,_t){return typeof Ke=="string"?he.push(Ae+wn(J(_t))+`"\r
\r
`+J(Ke)+`\r
`):he.push(Ae+wn(J(_t))+'"; filename="'+wn(Ke.name)+`"\r
Content-Type: `+(Ke.type||"application/octet-stream")+`\r
\r
`,Ke,`\r
`)}),he.push("--"+se+"--"),new Blob(he,{type:"multipart/form-data; boundary="+se})},Wt.prototype[Symbol.iterator]=function(){return this.entries()},Wt.prototype.toString=function(){return"[object FormData]"},st&&!st.matches&&(st.matches=st.matchesSelector||st.mozMatchesSelector||st.msMatchesSelector||st.oMatchesSelector||st.webkitMatchesSelector||function(se){for(var he=(se=(this.document||this.ownerDocument).querySelectorAll(se)).length;0<=--he&&se.item(he)!==this;);return-1<he}),Vt&&(Wt.prototype[Vt]="FormData"),ue){var Rr=Q.XMLHttpRequest.prototype.setRequestHeader;Q.XMLHttpRequest.prototype.setRequestHeader=function(se,he){Rr.call(this,se,he),se.toLowerCase()==="content-type"&&(this.B=!0)},Q.XMLHttpRequest.prototype.send=function(se){se instanceof Wt?(se=se._blob(),this.B||this.setRequestHeader("Content-Type",se.type),ue.call(this,se)):ue.call(this,se)}}Ee&&(Q.fetch=function(se,he){return he&&he.body&&he.body instanceof Wt&&(he.body=he.body._blob()),Ee.call(this,se,he)}),Ye&&(Q.navigator.sendBeacon=function(se,he){return he instanceof Wt&&(he=he._asNative()),Ye.call(this,se,he)}),Q.FormData=Wt}})();const y_=()=>{const n=V("AREAS");return n.length===0&&n.push(pt.GLOBAL),ca(n).call(n,(e,t,i)=>{const o=X1(t);return o?i===0?o:"".concat(e,",").concat(o):e},"")},X1=n=>n===pt.OVERSEA?"".concat(ri.ASIA,",").concat(ri.EUROPE,",").concat(ri.AFRICA,",").concat(ri.NORTH_AMERICA,",").concat(ri.SOUTH_AMERICA,",").concat(ri.OCEANIA):ri[n],Tz=n=>{const e={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return n.map(t=>{const i=E_[t],o=Object.keys(i);o&&o.map(a=>{a!=="CODE"&&(e[a]=e[a].concat(i[a]))})}),e},R_={GLOBAL:{ASIA:[pt.CHINA,pt.JAPAN,pt.INDIA,pt.KOREA,pt.HKMC],EUROPE:[],NORTH_AMERICA:[pt.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},C_=Object.keys(R_[pt.GLOBAL]),Sy=[pt.CHINA,pt.NORTH_AMERICA,pt.EUROPE,pt.ASIA,pt.JAPAN,pt.INDIA,pt.OCEANIA,pt.SOUTH_AMERICA,pt.AFRICA,pt.KOREA,pt.HKMC,pt.US],yz=function(n,e){let t=[];if(Ie(n).call(n,pt.GLOBAL)){const a=[pt.GLOBAL,pt.OVERSEA],l=Object.keys(E_);if(e===pt.GLOBAL)throw new W(N.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(e===pt.CHINA)t=[pt.OVERSEA];else if(o=e,Ie(C_).call(C_,o)){const u=(i=e,R_[pt.GLOBAL][i]||[]),h=[...a,e,...u];t=l.filter(f=>!Ie(h).call(h,f))}else if(function(u){let h=!1;return C_.forEach(f=>{var m;Ie(m=R_[pt.GLOBAL][f]).call(m,u)&&(h=!0)}),h}(e)){const u=function(f){let m;return C_.forEach(E=>{var v;Ie(v=R_[pt.GLOBAL][E]).call(v,f)&&(m=E)}),m}(e),h=[...a,u,e];t=l.filter(f=>!Ie(h).call(h,f))}else t=n;t=function(u){const h=[];return Sy.forEach(f=>{Ie(u).call(u,f)&&h.push(f)}),h.concat(u.filter(f=>!Ie(Sy).call(Sy,f)))}(t)}else t=n;var i,o;return t};function Q1(n){var e,t;if(!n&&Ie(e=V("AREAS")).call(e,pt.EXTENSIONS))return y.debug("update area from ap : reset"),void Ty(GK,!0);if(!Ie(t=V("AREAS")).call(t,pt.GLOBAL)||!n)return;let i=E_.EXTENSIONS;i&&(i={CODE:X1(pt.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(n,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(n,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(n,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(n,".agora.io"),"cds-ap-web-2-".concat(n,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(n,".agora.io"),"sua-ap-web-2-".concat(n,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(n,".agora.io"),"uap-ap-web-2-".concat(n,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(n,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(n,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(n,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(n,".agora.io")]},y.debug("update area from ap success: ".concat(n,",config is "),i),Nt("AREAS",[pt.EXTENSIONS],!0),Object.keys(i).map(o=>{o==="LOG_UPLOAD_SERVER"||o==="EVENT_REPORT_DOMAIN"||o==="EVENT_REPORT_BACKUP_DOMAIN"||o==="PROXY_SERVER_TYPE3"?Nt(o,i[o][0]):Nt(o,i[o])}))}function Ty(n){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const t=Oe.reportApiInvoke(null,{name:vn.SET_AREA,options:n,tag:Qt.TRACER});try{let i=[];if(typeof n=="string"&&(i=[n]),Array.isArray(n)&&(n.forEach(a=>{if(!Ie(b1).call(b1,a))throw new W(N.INVALID_PARAMS,"invalid area code")}),i=n),Object.prototype.toString.call(n)==="[object Object]"){const{areaCode:a,excludedArea:l}=n;if(!a)throw new W(N.INVALID_PARAMS,"area code is needed");let u=a;typeof a=="string"&&(u=[a]),i=l?yz(u,l):u}if(!e){if(rc.AREAS){const a=new W(N.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return t.onError(a),void y.warning("setArea is prohibited because of config-distribute")}if(Ie(i).call(i,pt.GLOBAL)&&V("AREAS")===pt.EXTENSIONS){const a=new W(N.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return t.onError(a),void y.warning("setArea is prohibited because of ap extensions")}}Nt("AREAS",i,e);const o=Tz(i);Object.keys(o).map(a=>{a==="LOG_UPLOAD_SERVER"||a==="EVENT_REPORT_DOMAIN"||a==="EVENT_REPORT_BACKUP_DOMAIN"||a==="PROXY_SERVER_TYPE3"?Nt(a,o[a][0]):Nt(a,o[a])}),y.debug("set area success:",i.join(","))}catch(i){throw t.onError(i),i}t.onSuccess()}function $1(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}function yy(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?$1(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):$1(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}let Ry=1;function Rz(n,e,t,i,o){Ry+=1;const a={sid:t.sid,command:"convergeAllocateEdge",uid:"666",appId:t.appId,ts:Math.floor(Date.now()/1e3),seq:Ry,requestId:Ry,version:es,cname:t.cname},l={service_name:e,json_body:JSON.stringify(a)};let u,h,f=n[0];return to(async()=>{u=Date.now();const m=await pa(f,{data:l,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(h=Date.now()-u,m.code!==0){const T=new W(N.UNEXPECTED_RESPONSE,"live streaming ap error, code"+m.code,{retry:!0,responseTime:h});throw y.error(T.toString()),T}const E=JSON.parse(m.json_body);if(E.code!==200){const T=new W(N.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(E.code,", reason: ").concat(E.reason),{code:E.code,responseTime:h});throw y.error(T.toString()),T}if(!E.servers||E.servers.length===0){const T=new W(N.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:E.code,responseTime:h});throw y.error(T.toString()),T}const v=function(T,A){return{addressList:T.servers.map(C=>"wss://".concat(C.address.replace(/\./g,"-"),".").concat(V("WORKER_DOMAIN"),":").concat(C.wss,"?serviceName=").concat(encodeURIComponent(A))),workerToken:T.workerToken,vid:T.vid}}(E,e);return V("LIVE_STREAMING_ADDRESS")&&(v.addressList=V("LIVE_STREAMING_ADDRESS")instanceof Array?V("LIVE_STREAMING_ADDRESS"):[V("LIVE_STREAMING_ADDRESS")]),yy(yy({},v),{},{responseTime:h})},(m,E)=>(Oe.apworkerEvent(t.sid,{success:!0,sc:200,serviceName:e,responseDetail:JSON.stringify(m.addressList),firstSuccess:E===0,responseTime:h,serverIp:n[E%n.length]}),!1),(m,E)=>(Oe.apworkerEvent(t.sid,{success:!1,sc:m.data&&m.data.code||200,serviceName:e,responseTime:h,serverIp:n[E%n.length]}),!!(m.code!==N.OPERATION_ABORTED&&m.code!==N.UNEXPECTED_RESPONSE||m.data&&m.data.retry)&&(f=n[(E+1)%n.length],!0)),o)}let Cy=1;function Z1(n,e,t,i){let{url:o,areaCode:a}=n;const l=Date.now();let u;const[h,f]=iD(e,a,[$n.CHOOSE_SERVER]);let m=Tn.networkState;return to(async()=>{m&&Tn.networkState===Ui.OFFLINE&&Tn.onlineWaiter&&await X.race([Tn.onlineWaiter,Xn(i&&i.maxRetryTimeout||yn.maxRetryTimeout)]),m=Tn.networkState;const{data:E,headers:v}=await pa(o,{data:h,cancelToken:t,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);u=v.http3==="1"?1:-1,Oe.reportResourceTiming(o,e.sid),tD(E,o,e,l,[$n.CHOOSE_SERVER],u);const T=_y(E,$n.CHOOSE_SERVER);return nD(T),W1(T,o)},E=>(E&&Oe.joinChooseServer(e.sid,{lts:l,succ:!0,csAddr:o,opid:f,serverList:E.gatewayAddrs.map(v=>v.address),ec:null,cid:E.cid.toString(),uid:E.uid.toString(),csIp:E.csIp,unilbsServerIds:[$n.CHOOSE_SERVER].toString(),isHttp3:u}),!1),E=>E.code!==N.OPERATION_ABORTED&&(E.code===N.CAN_NOT_GET_GATEWAY_SERVER?E.data.retry:(Oe.joinChooseServer(e.sid,{lts:l,succ:!1,csAddr:o,serverList:null,opid:f,ec:E.code,csIp:E.data&&E.data.csIp,unilbsServerIds:[$n.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:m}),isHttp3:u}),y.warning("[".concat(e.clientId,"] Choose server network error, retry"),E),!0)),i)}function eD(n,e,t,i){let o,{url:a,areaCode:l,serviceIds:u}=n;const h=Date.now(),[f,m]=iD(e,l,u);let E;return to(async()=>{E&&Tn.networkState===Ui.OFFLINE&&Tn.onlineWaiter&&await X.race([Tn.onlineWaiter,Xn(i&&i.maxRetryTimeout||yn.maxRetryTimeout)]),E=Tn.networkState;const{data:v,headers:T}=await pa(a,{data:f,cancelToken:t,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);o=T.http3==="1"?1:-1,Oe.reportResourceTiming(a,e.sid),tD(v,a,e,h,u,o);const A=_y(v,$n.CHOOSE_SERVER),C=_y(v,e.cloudProxyServer==="proxy5"?$n.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?$n.CLOUD_PROXY:$n.CLOUD_PROXY_FALLBACK);return nD(A),{gatewayInfo:W1(A,a),proxyInfo:C,url:a}},v=>(v.gatewayInfo&&Oe.joinChooseServer(e.sid,{lts:h,succ:!0,csAddr:a,serverList:v.gatewayInfo.gatewayAddrs.map(T=>T.address),ec:null,opid:m,cid:v.gatewayInfo.cid.toString(),uid:v.gatewayInfo.uid.toString(),csIp:v.gatewayInfo.csIp,unilbsServerIds:u.toString(),isHttp3:o}),v.proxyInfo&&Oe.joinWebProxyAP(e.sid,{lts:h,sucess:1,apServerAddr:a,turnServerAddrList:v.proxyInfo.addresses.map(T=>T.ip).join(","),errorCode:null,eventType:e.cloudProxyServer,unilbsServerIds:u.toString()}),!1),v=>v.code!==N.OPERATION_ABORTED&&(v.code===N.CAN_NOT_GET_GATEWAY_SERVER?v.data.retry:(Oe.joinWebProxyAP(e.sid,{lts:h,sucess:0,apServerAddr:a,turnServerAddrList:null,errorCode:v.code,eventType:e.cloudProxyServer,unilbsServerIds:u.toString(),extend:JSON.stringify({networkState:E})}),y.warning("[".concat(e.clientId,"] multi unilbs network error, retry"),v),!0)),i)}const tD=(n,e,t,i,o,a)=>{const l=[],u=h=>{h.flag===4096?Oe.joinChooseServer(t.sid,{lts:i,succ:!1,csAddr:e,opid:n.opid,serverList:null,ec:h.error.message,csIp:h.error.data&&h.error.data.csIp,unilbsServerIds:o.toString(),isHttp3:a}):h.flag!==1048576&&h.flag!==4194304&&h.flag!==4194310||Oe.joinWebProxyAP(t.sid,{lts:i,sucess:0,apServerAddr:e,turnServerAddrList:null,errorCode:h.error.code,eventType:t.cloudProxyServer,unilbsServerIds:o.toString()})};if(n.response_body.forEach(h=>{const f=h.buffer.code;if(h.uri===23&&f===0&&!h.buffer.edges_services)if(h.buffer.flag===4194310)y.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),h.buffer.edges_services=[];else{const m={error:new W(N.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:n.detail[502]}),flag:h.buffer.flag};l.push(m),u(m)}if(f!==0){const m=v_(f),E={error:new W(N.CAN_NOT_GET_GATEWAY_SERVER,m.desc,{desc:m.desc,retry:m.retry,csIp:n.detail[502]}),flag:h.buffer.flag};h.buffer.flag===4194310?y.warning(E.error.toString()):l.push(E),u(E)}}),l.length)throw y.warning("[".concat(t.clientId,"] multi unilbs ").concat(e," failed, ").concat(l.map(h=>"flag: ".concat(h.flag,", message: ").concat(h.error.message,", retry: ").concat(h.error.data.retry)).join(" | "))),new W(N.CAN_NOT_GET_GATEWAY_SERVER,l.map(h=>"flag: ".concat(h.flag,", message: ").concat(h.error.message)).join(" | "),{retry:!!l.find(h=>h.error.data.retry),csIp:n.detail[502],desc:[...new Set(l.map(h=>{var f;return h==null||(f=h.error)===null||f===void 0||(f=f.data)===null||f===void 0?void 0:f.desc}).filter(h=>!!h))]})},nD=n=>{var e,t,i,o;if(n.addresses&&n.addresses.length===0&&n.code===0)throw new W(N.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:n.detail&&n.detail[502]});if(V("AP_AREA")&&((i=n.detail)!==null&&i!==void 0&&i[23]&&typeof((o=n.detail)===null||o===void 0?void 0:o[23])=="string"?Q1(n.detail[23].toLowerCase()):Q1()),(e=n.detail)!==null&&e!==void 0&&e[19]&&typeof((t=n.detail)===null||t===void 0?void 0:t[19])=="string"){const l=n.detail[19],u=l==null?void 0:l.split(";");for(let h=0;h<u.length;h++){var a;const f=my(a=u[h]).call(a);n.addresses[h]&&u&&(n.addresses[h].fingerprint=f)}}if(V("GATEWAY_ADDRESS")&&V("GATEWAY_ADDRESS").length>0){y.debug("assign gateway address to",V("GATEWAY_ADDRESS"));const l=V("GATEWAY_ADDRESS").map(u=>{var h,f;const m=(h=(f=n.addresses.find(E=>E.ip===u.ip&&E.port===u.port))===null||f===void 0?void 0:f.fingerprint)!==null&&h!==void 0?h:"";return{ip:u.ip,port:u.port,ticket:n.addresses[0]&&n.addresses[0].ticket,fingerprint:m}});n.addresses=l}},Cz=(n,e)=>{if(n.response_body&&n.response_body.length){const t=n.response_body[0];if(t.buffer.code!==0){const i=v_(t.buffer.code);throw new W(N.UPDATE_TICKET_FAILED,"[".concat(t.buffer.code,"]: ").concat(i.desc),{retry:i.retry})}return t.buffer.ticket}throw y.debug("update ticket request received ap response without response body:",e),new W(N.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},iD=(n,e,t)=>{const i=Math.floor(Math.random()*1e12),o={appid:n.appId,client_ts:Date.now(),opid:i,sid:n.sid,request_bodies:[{uri:22,buffer:{cname:n.cname,detail:yy({6:n.stringUid,11:e,12:V("USE_NEW_TOKEN")?"1":void 0,22:e},n.apRTM?{26:"RTM2"}:{}),key:n.token,service_ids:t,uid:n.uid||0}}]};o.request_bodies.forEach(l=>{n.multiIP&&n.multiIP.gateway_ip&&(l.buffer.detail[5]=JSON.stringify({vocs_ip:[n.multiIP.uni_lbs_ip],vos_ip:[n.multiIP.gateway_ip]}))});const a=new FormData;return a.append("request",JSON.stringify(o)),[a,i]},Iz=(n,e)=>{const t=Math.floor(Math.random()*1e12),i={appid:n.appId,client_ts:Date.now(),opid:t,sid:n.sid,request_bodies:[{uri:28,buffer:{cname:n.cname,detail:{1:"",6:n.stringUid,12:"1"},token:n.token,service_ids:e,uid:n.uid||0,edges_services:n.apResponse.addresses.map(a=>({ip:a.ip,port:a.port}))}}]},o=new FormData;return o.append("request",JSON.stringify(i)),[o,t]};let zd=0;function Yd(n){return X.all(n.map(e=>e.then(t=>{throw t},t=>t))).then(e=>{throw e},e=>e)}const np=async n=>{let{fragementLength:e,referenceList:t,asyncMapHandler:i,allFailedhandler:o,promisesCollector:a}=n,l=0;const u=e;let h,f=0;const m=async()=>{const E=(()=>{const v=l*u,T=v+u;return t.slice(v,T).map(i)})();a&&a.push(...E);try{h=await Yd(E)}catch(v){if(f+=u,l++,!(f>=t.length))return void await m();o(v)}E.forEach(v=>v.cancel())};return await m(),h};async function Iy(n,e,t,i){return{gatewayInfo:await async function(a,l,u,h){let f=null;const m=[],E=async()=>{const T=V("WEBCS_DOMAIN").slice(0,V("AJAX_REQUEST_CONCURRENT")).map(b=>({url:a.proxyServer?"https://".concat(a.proxyServer,"/ap/?url=").concat(b+"/api/v2/transpond/webrtc?v=2"):"https://".concat(b,"/api/v2/transpond/webrtc?v=2"),areaCode:y_()})),A=h.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:T.map(b=>b.url)}),C=await np({fragementLength:V("FRAGEMENT_LENGTH"),referenceList:T,asyncMapHandler:b=>(y.debug("[".concat(a.clientId,"] Connect to choose_server:"),b.url),Z1(b,a,l,u)),allFailedhandler:b=>{throw h.recordJoinChannelService({endTs:Date.now(),status:"error",errors:b},A),b[0]},promisesCollector:m});return h.recordJoinChannelService({endTs:Date.now(),status:"success"},A),C},v=async()=>{if(await Xn(1e3),f!==null)return f;const T=V("WEBCS_DOMAIN_BACKUP_LIST").map(b=>({url:a.proxyServer?"https://".concat(a.proxyServer,"/ap/?url=").concat(b+"/api/v2/transpond/webrtc?v=2"):"https://".concat(b,"/api/v2/transpond/webrtc?v=2"),areaCode:y_()})),A=h.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:T.map(b=>b.url)}),C=await np({fragementLength:V("FRAGEMENT_LENGTH"),referenceList:T,asyncMapHandler:b=>(y.debug("[".concat(a.clientId,"] Connect to backup choose_server:"),b.url),Z1(b,a,l,u)),allFailedhandler:b=>{throw h.recordJoinChannelService({endTs:Date.now(),status:"error",errors:b},A),b[0]},promisesCollector:m});return h.recordJoinChannelService({endTs:Date.now(),status:"success"},A),C};try{return f=await Yd([E(),v()]),m.length&&m.forEach(T=>T.cancel&&typeof T.cancel=="function"&&T.cancel()),f}catch(T){throw T[0]}}(n,e,t,i)}}async function rD(n,e,t,i,o){const a=n.cloudProxyServer;if(a==="disabled"){if(!i)return;if(n.useLocalAccessPoint)return await Iy(n,e,t,o);if(V("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:v,proxyInfo:T}=await oD(n,e,t,o);if(n.turnServer&&n.turnServer.mode!=="auto")return{gatewayInfo:v};const A=T.map(C=>({turnServerURL:C.address,tcpport:C.tcpport||Wi.tcpport,udpport:C.udpport||Wi.udpport,username:C.username||Wi.username,password:C.password||Wi.password,forceturn:!1,security:!0}));if(o.useP2P){var l;const C=(l=n.uid)!==null&&l!==void 0?l:v.uid,b="glb:".concat(C.toString()),D=await PT(b),M=T.map(B=>({turnServerURL:B.address,tcpport:B.tcpport||Wi.tcpport,udpport:B.udpport||Wi.udpport,username:b,password:D,forceturn:!1,security:!0}));A.push(...M)}return n.turnServer={mode:"manual",servers:A},{gatewayInfo:v}}return await Iy(n,e,t,o)}const{proxyInfo:u,gatewayInfo:h}=await oD(n,e,t,o),f={gatewayInfo:h},m=u.map(v=>({turnServerURL:v.address,tcpport:a==="proxy3"?void 0:v.tcpport?v.tcpport:Wi.tcpport,udpport:a==="proxy4"?void 0:v.udpport?v.udpport:Wi.udpport,username:v.username||Wi.username,password:v.password||Wi.password,forceturn:a!=="proxy4",security:a==="proxy5"}));if(o.useP2P){var E;const v=(E=n.uid)!==null&&E!==void 0?E:h.uid,T="glb:".concat(v.toString()),A=await PT(T),C=u.map(b=>({turnServerURL:b.address,tcpport:a==="proxy3"?void 0:b.tcpport||Wi.tcpport,udpport:a==="proxy4"?void 0:b.udpport||Wi.udpport,username:T,password:A,forceturn:a!=="proxy4",security:a==="proxy5"}));m.push(...C)}return n.turnServer={mode:"manual",servers:m},y.debug("[".concat(n.clientId,"] set proxy server: ").concat(n.proxyServer,", mode: ").concat(a)),f}async function sD(n,e,t,i,o){const a=V("ACCOUNT_REGISTER").slice(0,V("AJAX_REQUEST_CONCURRENT"));let l=[];l=e.proxyServer?a.map(h=>"https://".concat(e.proxyServer,"/ap/?url=").concat(h+"/api/v1")):a.map(h=>"https://".concat(h,"/api/v1"));const u=o==null?void 0:o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:l});try{const h=await async function(f,m,E,v,T){const A=Date.now(),C={sid:E.sid,opid:10,appid:E.appId,string_uid:m};let b=f[0];const D=await to(()=>pa(b+"".concat(b.indexOf("?")===-1?"?":"&","action=stringuid"),{data:C,cancelToken:v,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(M,B)=>{if(M.code===0){if(M.uid<=0||M.uid>=Math.pow(2,32))throw y.error("Invalid Uint Uid ".concat(m," => ").concat(M.uid),M),Oe.reqUserAccount(C.sid,{lts:A,success:!1,serverAddr:b,stringUid:C.string_uid,uid:M.uid,errorCode:N.INVALID_UINT_UID_FROM_STRING_UID,extend:C}),new W(N.INVALID_UINT_UID_FROM_STRING_UID);return Oe.reqUserAccount(C.sid,{lts:A,success:!0,serverAddr:b,stringUid:C.string_uid,uid:M.uid,errorCode:null,extend:C}),!1}const J=v_(M.code);return J.retry&&(b=f[(B+1)%f.length]),Oe.reqUserAccount(C.sid,{lts:A,success:!1,serverAddr:b,stringUid:C.string_uid,uid:M.uid,errorCode:J.desc,extend:C}),J.retry},(M,B)=>M.code!==N.OPERATION_ABORTED&&(Oe.reqUserAccount(C.sid,{lts:A,success:!1,serverAddr:b,stringUid:C.string_uid,uid:null,errorCode:M.code,extend:C}),b=f[(B+1)%f.length],!0),T);if(D.code!==0){const M=v_(D.code);throw new W(N.UNEXPECTED_RESPONSE,M.desc)}return D}(l,n,e,t,i);return o==null||o.recordJoinChannelService({status:"success",endTs:Date.now()},u),h.uid}catch(h){throw o==null||o.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[h]},u),h}}async function wz(n,e,t){const i=V("CDS_AP").slice(0,V("AJAX_REQUEST_CONCURRENT")).map(h=>n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(h+"/api/v1"):"https://".concat(h,"/api/v1?action=config")),o=i.map(h=>function(f,m,E,v){const T=ft(),A={flag:64,cipher_method:0,features:{device:T.name,system:T.os,system_general:navigator.userAgent,vendor:m.appId,version:es,cname:m.cname,sid:m.sid,session_id:m.sid,detail:"",proxyServer:m.proxyServer}};return to(()=>pa(f,{data:A,timeout:1e3,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,C=>C.code!==N.OPERATION_ABORTED,v)}(h,n,e,t));let a=null,l=null,u={};try{a=await Yd(o)}catch(h){if(h.code===N.OPERATION_ABORTED)throw h;l=h}if(o.forEach(h=>h.cancel()),Oe.reportApiInvoke(n.sid,{name:vn.REQUEST_CONFIG_DISTRIBUTE,options:{error:l,res:a}}).onSuccess(),a&&a.test_tags)try{u=function(h){if(!h.test_tags)return{};const f=h.test_tags,m=Object.keys(f),E={};return m.forEach(v=>{var T;const A=my(T=v.slice(4)).call(T),C=JSON.parse(f[v])[1];E[A]=C}),E}(a)}catch{}return u}async function oD(n,e,t,i){const o=V("PROXY_SERVER_TYPE3"),a=(T,A,C)=>{let b=C||o;return Array.isArray(b)&&(b=A%2==0?o[1]:o[0]),"https://".concat(b,"/ap/?url=").concat(T)};let l=null;const u=[],h=async()=>{const T=V("WEBCS_DOMAIN").slice(0,V("AJAX_REQUEST_CONCURRENT")).map((b,D)=>{let M;return M=n.cloudProxyServer==="disabled"&&n.proxyServer?a("".concat(b,"/api/v2/transpond/webrtc?v=2"),D,n.proxyServer):n.cloudProxyServer==="disabled"||n.cloudProxyServer==="fallback"?"https://".concat(b,"/api/v2/transpond/webrtc?v=2"):a("".concat(b,"/api/v2/transpond/webrtc?v=2"),D),{url:M,areaCode:y_(),serviceIds:[$n.CHOOSE_SERVER,n.cloudProxyServer==="proxy5"?$n.CLOUD_PROXY_5:n.cloudProxyServer==="proxy3"||n.cloudProxyServer==="proxy4"?$n.CLOUD_PROXY:$n.CLOUD_PROXY_FALLBACK]}}),A=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:T.map(b=>b.url)}),C=await np({fragementLength:V("FRAGEMENT_LENGTH"),referenceList:T,asyncMapHandler:b=>(y.debug("[".concat(n.clientId,"] Connect to choose_server:"),b.url),eD(b,n,e,t)),allFailedhandler:b=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:b},A),b[0]},promisesCollector:u});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},A),C},f=async()=>{if(await Xn(1e3),l!==null)return l;const T=V("WEBCS_DOMAIN_BACKUP_LIST").map((b,D)=>{let M;return M=n.cloudProxyServer==="disabled"&&n.proxyServer?a("".concat(b,"/api/v2/transpond/webrtc?v=2"),D,n.proxyServer):n.cloudProxyServer==="disabled"||n.cloudProxyServer==="fallback"?"https://".concat(b,"/api/v2/transpond/webrtc?v=2"):a("".concat(b,"/api/v2/transpond/webrtc?v=2"),D),{url:M,areaCode:y_(),serviceIds:[$n.CHOOSE_SERVER,n.cloudProxyServer==="proxy5"?$n.CLOUD_PROXY_5:n.cloudProxyServer==="proxy3"||n.cloudProxyServer==="proxy4"?$n.CLOUD_PROXY:$n.CLOUD_PROXY_FALLBACK]}}),A=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:T.map(b=>b.url)}),C=await np({fragementLength:V("FRAGEMENT_LENGTH"),referenceList:T,asyncMapHandler:b=>(y.debug("[".concat(n.clientId,"] Connect to backup choose_server:"),b.url),eD(b,n,e,t)),allFailedhandler:b=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:b},A),b[0]},promisesCollector:u});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},A),C};let m,E,v;try{({gatewayInfo:m,proxyInfo:E,url:v}=await Yd([h(),f()]))}catch(T){throw T[0]}if(u.length&&u.forEach(T=>T.cancel&&typeof T.cancel=="function"&&T.cancel()),!m||!E)throw new W(N.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(n.apUrl=v,n.cloudProxyServer!=="disabled"&&Array.isArray(o)&&v){const T=/^https?:\/\/(.+?)(\/.*)?$/.exec(v)[1];Ie(o).call(o,T)&&(n.proxyServer=T,y.setProxyServer(T),Oe.setProxyServer(T))}return l={gatewayInfo:m,proxyInfo:await Ez(E,m.uid)},l}async function aD(n,e,t,i){const o=V("UAP_AP").slice(0,V("AJAX_REQUEST_CONCURRENT")).map(a=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(a+"/api/v1?action=uap"):"https://".concat(a,"/api/v1?action=uap"));return await Rz(o,n,e,t,i)}async function bz(n,e,t){const i=V("UAP_AP").slice(0,V("AJAX_REQUEST_CONCURRENT")).map(a=>n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(a+"/api/v1?action=uap"):"https://".concat(a,"/api/v1?action=uap")),o=i.map(a=>function(l,u,h,f){const m={command:"convergeAllocateEdge",sid:u.sid,appId:u.appId,token:u.token,ts:Date.now(),version:es,cname:u.cname,uid:u.uid.toString(),requestId:Cy,seq:Cy};Cy+=1;const E={service_name:"tele_channel",json_body:JSON.stringify(m)};return to(async()=>{const v=await pa(l,{data:E,cancelToken:h,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(v.code!==0){const A=new W(N.UNEXPECTED_RESPONSE,"cross channel ap error, code"+v.code,{retry:!0});throw y.error(A.toString()),A}const T=JSON.parse(v.json_body);if(T.code!==200){const A=new W(N.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(T.code,", reason: ").concat(T.reason));throw y.error(A.toString()),A}if(!T.servers||T.servers.length===0){const A=new W(N.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw y.error(A.toString()),A}return{vid:T.vid,workerToken:T.workerToken,addressList:(V("CHANNEL_MEDIA_RELAY_SERVERS")||T.servers).map(A=>"wss://".concat(A.address.replace(/\./g,"-"),".").concat(V("WORKER_DOMAIN"),":").concat(A.wss))}},void 0,v=>!!(v.code!==N.OPERATION_ABORTED&&v.code!==N.UNEXPECTED_RESPONSE||v.data&&v.data.retry),f)}(a,n,e,t));try{const a=await Yd(o);return o.forEach(l=>l.cancel()),a}catch(a){throw a[0]}}async function Az(n,e,t){let i=null;const o=[],a=async l=>{const u=V(l?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(h=>n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(h+"/api/v2/transpond/webrtc?v=2"):"https://".concat(h,"/api/v2/transpond/webrtc?v=2"));return l&&(await Xn(1e3),i!==null)?i:await np({fragementLength:V("FRAGEMENT_LENGTH"),referenceList:u,asyncMapHandler:h=>(y.debug("[".concat(n.clientId,"] update ticket, Connect to ").concat(l?"backup":""," choose_server:"),h),function(f,m,E,v){const[T]=Iz(m,[$n.CHOOSE_SERVER]);let A=Tn.networkState;return to(async()=>{A&&Tn.networkState===Ui.OFFLINE&&Tn.onlineWaiter&&await X.race([Tn.onlineWaiter,Xn(v&&v.maxRetryTimeout||yn.maxRetryTimeout)]),A=Tn.networkState;const C=await pa(f,{data:T,cancelToken:E,headers:{"Content-Type":"multipart/form-data;"}},!0);return Cz(C,f)},()=>!1,C=>C.code!==N.OPERATION_ABORTED&&(C.code===N.UPDATE_TICKET_FAILED?C.data.retry:(y.warning("[".concat(m.clientId,"] update ticket network error, retry"),C),!0)),v)}(h,n,e,t)),allFailedhandler:h=>{throw h[0]},promisesCollector:o})};try{return i=await Yd([a(!1),a(!0)]),o.length&&o.forEach(l=>l.cancel&&typeof l.cancel=="function"&&l.cancel()),i}catch(l){throw l[0]}}function cD(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}function lD(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?cD(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):cD(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}class Oz extends zt{get isSuccess(){return!!this.configs}constructor(){super(),S(this,"configs",void 0),S(this,"joinInfo",void 0),S(this,"cancelToken",void 0),S(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),S(this,"interval",void 0),S(this,"mutex",new Qn("config-distribute")),S(this,"mutableParamsRead",!1)}startGetConfigDistribute(e,t){this.joinInfo=e,this.cancelToken=t,this.interval&&this.stopGetConfigDistribute(),V("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},V("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Oe.reportApiInvoke(null,{options:void 0,name:vn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Qt.TRACER}).onSuccess(JSON.stringify(rc))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void y.debug("[config-distribute] get config distribute interrupted have no joininfo");let e;const t=await this.mutex.lock();try{e=await wz(this.joinInfo,this.cancelToken,this.retryConfig),y.debug("[config-distribute] get config distribute",JSON.stringify(e)),e.limit_bitrate&&this.handleBitrateLimit(e.limit_bitrate),this.cacheGlobalParameterConfig(e),this.configs=e}catch(i){const o=new W(N.NETWORK_RESPONSE_ERROR,i);y.warning("[config-distribute] ".concat(o.toString()))}finally{t()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(e){var t;(t=e)&&t.uplink&&t.id&&t.uplink.max_bitrate!==void 0&&t.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==e.id&&this.emit(Zh.UPDATE_BITRATE_LIMIT,e):this.emit(Zh.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&lD({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(e){var t;const i=kh(t=Object.keys(e).filter(a=>/^webrtc_ng_global_parameter/.test(a))).call(t);for(let a=0;a<i.length;a++)for(let l=i.length-1;l>a;l--){const u=i[l];if(typeof e[u].__priority=="number"){const h=e[u].__priority,f=i[l-1];if(typeof e[f].__priority=="number"){if(!(h>e[f].__priority))continue;{const m=u;i[l]=i[l-1],i[l-1]=m}}else{const m=u;i[l]=i[l-1],i[l-1]=m}}}const o={};i.forEach(a=>{const l=e[a],u=l.__expires;Object.keys(l).forEach(h=>{h==="__priority"||h==="__expires"||Object.prototype.hasOwnProperty.call(o,h)||(o[h]=lD({value:l[h]},u&&{expires:u}))})});try{(function(u){try{const h=Date.now();Object.keys(u).forEach(f=>{switch(f){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":if(Object.prototype.hasOwnProperty.call(Vi,f)){const{value:m,expires:E}=u[f];if(E&&E<=h)return;rc[f]=m,Vi[f]=m,y.debug("Update global parameters from config distribute",f,m)}}})}catch(h){y.error("Error update config immediately: ".concat(u),h.message)}})(o);const a=JSON.stringify(o),l=window.btoa(a);window.localStorage.setItem("websdk_ng_global_parameter",l),y.debug("Caching global parameters ".concat(a))}catch(a){y.error("Error caching global parameters:",a.message)}}}const bi={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1};function mt(){return bi}var jn;function qd(n,e,t){return{sampleRate:n,stereo:e,bitrate:t}}function ut(n,e,t,i,o){return{width:n,height:e,frameRate:t,bitrateMin:i,bitrateMax:o}}function Os(n,e,t,i,o){return{width:{max:n},height:{max:e},frameRate:t,bitrateMin:i,bitrateMax:o}}function wy(n,e){return{numSpatialLayers:n,numTemporalLayers:e}}(function(n){n.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",n.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",n.IOS_INTERRUPTION_START="ios-interruption-start",n.IOS_INTERRUPTION_END="ios-interruption-end",n.STATE_CHANGE="state-change"})(jn||(jn={}));const Nz={"90p":ut(160,90),"90p_1":ut(160,90),"120p":ut(160,120,15,30,65),"120p_1":ut(160,120,15,30,65),"120p_3":ut(120,120,15,30,50),"120p_4":ut(212,120),"180p":ut(320,180,15,30,140),"180p_1":ut(320,180,15,30,140),"180p_3":ut(180,180,15,30,100),"180p_4":ut(240,180,15,30,120),"240p":ut(320,240,15,40,200),"240p_1":ut(320,240,15,40,200),"240p_3":ut(240,240,15,40,140),"240p_4":ut(424,240,15,40,220),"360p":ut(640,360,15,80,400),"360p_1":ut(640,360,15,80,400),"360p_3":ut(360,360,15,80,260),"360p_4":ut(640,360,30,80,600),"360p_6":ut(360,360,30,80,400),"360p_7":ut(480,360,15,80,320),"360p_8":ut(480,360,30,80,490),"360p_9":ut(640,360,15,80,800),"360p_10":ut(640,360,24,80,800),"360p_11":ut(640,360,24,80,1e3),"480p":ut(640,480,15,100,500),"480p_1":ut(640,480,15,100,500),"480p_2":ut(640,480,30,100,1e3),"480p_3":ut(480,480,15,100,400),"480p_4":ut(640,480,30,100,750),"480p_6":ut(480,480,30,100,600),"480p_8":ut(848,480,15,100,610),"480p_9":ut(848,480,30,100,930),"480p_10":ut(640,480,10,100,400),"720p":ut(1280,720,15,120,1130),"720p_auto":ut(1280,720,30,900,3e3),"720p_1":ut(1280,720,15,120,1130),"720p_2":ut(1280,720,30,120,2e3),"720p_3":ut(1280,720,30,120,1710),"720p_5":ut(960,720,15,120,910),"720p_6":ut(960,720,30,120,1380),"1080p":ut(1920,1080,15,120,2080),"1080p_1":ut(1920,1080,15,120,2080),"1080p_2":ut(1920,1080,30,120,3e3),"1080p_3":ut(1920,1080,30,120,3150),"1080p_5":ut(1920,1080,60,120,4780),"1440p":ut(2560,1440,30,120,4850),"1440p_1":ut(2560,1440,30,120,4850),"1440p_2":ut(2560,1440,60,120,7350),"4k":ut(3840,2160,30,120,8910),"4k_1":ut(3840,2160,30,120,8910),"4k_3":ut(3840,2160,60,120,13500)},I_=[{scaleResolutionDownBy:2,width:1280,height:720,frameRate:30,bitrateMin:300,bitrateMax:900},{scaleResolutionDownBy:1.333333,width:1280,height:720,frameRate:30,bitrateMin:600,bitrateMax:2e3},{scaleResolutionDownBy:1,width:1280,height:720,frameRate:30,bitrateMin:900,bitrateMax:3e3}],Pz={"480p":Os(640,480,5),"480p_1":Os(640,480,5),"480p_2":Os(640,480,30),"480p_3":Os(640,480,15),"720p":Os(1280,720,5),"720p_auto":ut(1280,720,30,900,3e3),"720p_1":Os(1280,720,5),"720p_2":Os(1280,720,30),"720p_3":Os(1280,720,15),"1080p":Os(1920,1080,5),"1080p_1":Os(1920,1080,5),"1080p_2":Os(1920,1080,30),"1080p_3":Os(1920,1080,15)},Dz={"1SL1TL":wy(1,1),"3SL3TL":wy(3,3),"2SL3TL":wy(2,3)};function ko(n){return n||(n="480p_1"),typeof n=="string"?Object.assign({},Nz[n]):n}function by(n){return typeof n=="string"?Object.assign({},Pz[n]):n}function w_(n){return typeof n=="string"?Object.assign({},Dz[n]):n}const kz={speech_low_quality:qd(16e3,!1),speech_standard:qd(32e3,!1,18),music_standard:qd(48e3,!1),standard_stereo:qd(48e3,!0,56),high_quality:qd(48e3,!1,128),high_quality_stereo:qd(48e3,!0,192)};function b_(n){return typeof n=="string"?Object.assign({},kz[n]):n}const Jd=[];function dD(n){return Pn(n,"mediaSource",["screen","window","application"]),!0}var Te,Ut,pc,Ay,Oy,fc,mc,_c,or,uD;(function(n){n.NEED_RENEGOTIATE="@need_renegotiate",n.NEED_REPLACE_TRACK="@need_replace_track",n.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",n.NEED_CLOSE="@need_close",n.NEED_ENABLE_TRACK="@need_enable_track",n.NEED_DISABLE_TRACK="@need_disable_track",n.NEED_SESSION_ID="@need_sid",n.SET_OPTIMIZATION_MODE="@set_optimization_mode",n.GET_STATS="@get_stats",n.GET_RTC_STATS="@get_rtc_stats",n.GET_LOW_VIDEO_TRACK="@get_low_video_track",n.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",n.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",n.NEED_MUTE_TRACK="@need_mute_track",n.NEED_UNMUTE_TRACK="@need_unmute_track"})(Te||(Te={})),function(n){n.SCREEN_TRACK="screen_track",n.CUSTOM_TRACK="custome_track",n.LOW_STREAM="low_stream"}(Ut||(Ut={})),function(n){n[n.HIGH_STREAM=0]="HIGH_STREAM",n[n.LOW_STREAM=1]="LOW_STREAM"}(pc||(pc={})),function(n){n[n.HIGH_STREAM=0]="HIGH_STREAM",n[n.LOW_STREAM=1]="LOW_STREAM"}(Ay||(Ay={})),function(n){n[n.DISABLE=0]="DISABLE",n[n.LOW_STREAM=1]="LOW_STREAM",n[n.AUDIO_ONLY=2]="AUDIO_ONLY"}(Oy||(Oy={})),function(n){n.TRANSCEIVER_UPDATED="transceiver-updated",n.SEI_TO_SEND="sei-to-send",n.SEI_RECEIVED="sei-received"}(fc||(fc={})),function(n){n.SOURCE_STATE_CHANGE="source-state-change",n.TRACK_ENDED="track-ended",n.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",n.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",n.CLOSED="closed"}(mc||(mc={})),function(n){n.FIRST_FRAME_DECODED="first-frame-decoded",n.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",n.VIDEO_STATE_CHANGED="video-state-changed"}(_c||(_c={})),function(n){n.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",n.RECEIVE_TRACK_BUFFER="receive_track_buffer",n.ON_AUDIO_BUFFER="on_audio_buffer",n.UPDATE_SOURCE="update_source"}(or||(or={})),function(n){n.UPDATE_TRACK_SOURCE="update-track-source"}(uD||(uD={}));const Ny={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},Py={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},hD={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Lz={uplinkNetworkQuality:0,downlinkNetworkQuality:0},pD={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};var Ai,ar,wl,fa,Oi,Ns;(function(n){n.ON_TRACK="on_track",n.ON_NODE="on_node"})(Ai||(Ai={})),function(n){n.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",n.REQUEST_CONSTRAINTS="request_constraints"}(ar||(ar={})),function(n){n.IDLE="IDLE",n.INITING="INITING",n.INITEND="INITEND"}(wl||(wl={})),function(n){n.STATE_CHANGE="state_change",n.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",n.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",n.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(fa||(fa={})),function(n){n.NONE="none",n.INIT="init",n.CANPLAY="canplay",n.PLAYING="playing",n.PAUSED="paused",n.SUSPEND="suspend",n.STALLED="stalled",n.WAITING="waiting",n.ERROR="error",n.DESTROYED="destroyed",n.ABORT="abort",n.ENDED="ended",n.EMPTIED="emptied",n.LOADEDDATA="loadeddata"}(Oi||(Oi={})),function(n){n[n.VideoStateStopped=0]="VideoStateStopped",n[n.VideoStateStarting=1]="VideoStateStarting",n[n.VideoStateDecoding=2]="VideoStateDecoding",n[n.VideoStateFrozen=3]="VideoStateFrozen"}(Ns||(Ns={}));const Dy={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};var Xd;(function(n){n.OPEN="open",n.MESSAGE="message",n.CLOSE="close",n.CLOSING="closing",n.ERROR="error"})(Xd||(Xd={}));class fD extends zt{constructor(e,t){super(),S(this,"_ID",void 0),S(this,"_rtpTransceiver",void 0),S(this,"_lowRtpTransceiver",void 0),S(this,"_hints",[]),S(this,"_isClosed",!1),S(this,"_originMediaStreamTrack",void 0),S(this,"_mediaStreamTrack",void 0),S(this,"_external",{}),this._ID=t||Lt(8,"track-"),this._originMediaStreamTrack=e,this._mediaStreamTrack=e,function(i){Ie(Jd).call(Jd,i)||Jd.push(i)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){if(!e){const t=Oe.reportApiInvoke(null,{name:vn.GET_MEDIA_STREAM_TRACK,options:[],tag:Qt.TRACER});this._mediaStreamTrack&&typeof this._mediaStreamTrack.label=="string"?t.onSuccess(this._mediaStreamTrack.label):t.onSuccess("")}return this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===pc.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){const t=Jd.indexOf(e);t!==-1&&Jd.splice(t,1)}(this),this.emit(mc.CLOSED),this.removeAllListeners(fc.SEI_RECEIVED)}_updateRtpTransceiver(e,t){if(t===pc.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(fc.TRANSCEIVER_UPDATED,e,t)}}class _i extends fD{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,t){super(e,t),S(this,"_enabled",!0),S(this,"_muted",!1),S(this,"_isExternalTrack",!1),S(this,"_isClosed",!1),S(this,"_enabledMutex",void 0),S(this,"processor",void 0),S(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Qn("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,t;return(e=(t=this._originMediaStreamTrack)===null||t===void 0?void 0:t.label)!==null&&e!==void 0?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,y.debug("[".concat(this.getTrackId(),"] close")),this.emit(Te.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,t){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=i,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Dt(this,Te.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){y.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(mc.TRACK_ENDED)}stateCheck(e,t){if(y.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(t,"]")),sa(t,e),this._enabled&&this._muted&&e==="enabled"&&t===!1)throw new ne(N.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",y);if(!this._enabled&&!this._muted&&e==="muted"&&t===!0)throw new ne(N.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",y)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():X.resolve([])}}function mD(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}const _D=window.AudioContext||window.webkitAudioContext;let Ur=null;const wt=new class extends zt{constructor(){super(...arguments),S(this,"prevState",void 0),S(this,"curState",void 0),S(this,"currentTime",void 0),S(this,"currentTimeStuckAt",void 0),S(this,"interruptDetectorTrack",void 0),S(this,"onLocalAudioTrackMute",()=>{y.info("ios15-interruption-start"),this.emit(jn.IOS_15_16_INTERRUPTION_START)}),S(this,"onLocalAudioTrackUnmute",async()=>{y.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?y.info("ios15-interruption-end-canceled"):(Ur&&await Ur.suspend(),this.emit(jn.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(n){y.debug("webaudio bindInterruptDetectorTrack ".concat(n.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=n,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(n){y.debug("webaudio unbindInterruptDetectorTrack ".concat(n.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===n&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Mz(){if(!_D)return void y.error("your browser is not support web audio");y.info("create audio context");const n=function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?mD(Object(i),!0).forEach(function(o){S(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):mD(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}({},V("WEBAUDIO_INIT_OPTIONS"));y.debug("audio context init option:",JSON.stringify(n)),Ur=new _D(n),wt.curState=Ur.state,Ur.onstatechange=()=>{wt.prevState=wt.curState,wt.curState=Ur?Ur.state:void 0;const{prevState:e,curState:t}=wt,i=t==="running",o=t==="interrupted",a=e==="running",l=e==="suspended",u=e==="interrupted",h=ft().osVersion;(xi()||bo())&&a&&o&&(y.info("ios".concat(h,"-interruption-start")),wt.emit(jn.IOS_INTERRUPTION_START)),(xi()||bo())&&(l||u)&&i&&(y.info("ios".concat(h,"-interruption-end")),wt.emit(jn.IOS_INTERRUPTION_END)),e!==t&&wt.emit(jn.STATE_CHANGE,t,e)},setInterval(()=>{var e;const t=(e=Ur)===null||e===void 0?void 0:e.currentTime;wt.currentTime!==t?(wt.currentTimeStuckAt&&(y.debug("AudioContext current time resume at ".concat(t)),wt.currentTimeStuckAt=void 0),wt.currentTime=t):(t!==wt.currentTimeStuckAt&&(Oe.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:t},tag:Qt.TRACER}).onSuccess(),y.warning("AudioContext current time stuck at ".concat(t))),wt.currentTimeStuckAt=t)},5e3),async function(e){const t=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let i,o=!1,a=!1,l=!1;function u(b){e.state==="running"?h(!1):xi()||bo()?e.state==="suspended"&&(h(!0),b&&e.resume().then(m,m)):e.state!=="closed"&&(h(!0),b&&e.resume().then(m,m))}function h(b){if(o!==b){o=b;for(let D=0,M=t;D<M.length;D+=1){const B=M[D];b?window.addEventListener(B,E,{capture:!0,passive:!0}):window.removeEventListener(B,E,{capture:!0,passive:!0})}}}function f(){u(!0)}function m(){u(!1)}function E(){u(!0)}function v(b){if(!l)if(i.paused)if(b){let D;T(!1),l=!0;try{D=i.play(),D?D.then(A,A):(i.addEventListener("playing",A),i.addEventListener("abort",A),i.addEventListener("error",A))}catch{A()}}else T(!0);else T(!1)}function T(b){if(a!==b){a=b;for(let D=0,M=t;D<M.length;D++){const B=M[D];b?window.addEventListener(B,C,{capture:!0,passive:!0}):window.removeEventListener(B,C,{capture:!0,passive:!0})}}}function A(){i.removeEventListener("playing",A),i.removeEventListener("abort",A),i.removeEventListener("error",A),l=!1,v(!1)}function C(){v(!0)}if(xi()){const b=e.createMediaStreamDestination(),D=document.createElement("div");D.innerHTML="<audio x-webkit-airplay='deny'></audio>",i=D.children.item(0),i.controls=!1,i.disableRemotePlayback=!0,i.preload="auto",i.srcObject=b.stream,v(!0)}wt.on(jn.STATE_CHANGE,f),u(!1)}(Ur)}function Qd(){if(!Ur){if(Mz(),!Ur)throw new ne(N.NOT_SUPPORTED,"can not create audio context");return Ur}return Ur}function bl(n){if(function(){if(ky!==null)return ky;const i=Qd(),o=i.createBufferSource(),a=i.createGain(),l=i.createGain();o.connect(a),o.connect(l),o.disconnect(a);let u=!1;try{o.disconnect(a)}catch{u=!0}return o.disconnect(),ky=u,u}())return;const e=n.connect,t=n.disconnect;n.connect=(i,o,a)=>{var l;return n._inputNodes||(n._inputNodes=[]),Ie(l=n._inputNodes).call(l,i)||(i instanceof AudioNode?(n._inputNodes.push(i),e.call(n,i,o,a)):e.call(n,i,o)),n},n.disconnect=(i,o,a)=>{t.call(n),i?$m(n._inputNodes,i):n._inputNodes=[];for(const l of n._inputNodes)e.call(n,l)}}let ky=null;function Ly(n,e){let t=!1;const i=1/e;if(V("DISABLE_WEBAUDIO")){const o=window.setInterval(()=>{t?window.clearInterval(o):n(performance.now()/1e3)},1e3*i)}else{const o=Qd();let a=o.createGain();a.gain.value=0,a.connect(o.destination);const l=()=>{if(t)return void(a=null);const u=o.createOscillator();u.onended=l,u.connect(a),u.start(0),u.stop(o.currentTime+i),n(o.currentTime)};l()}return()=>{t=!0}}class ED{constructor(){S(this,"context",void 0),S(this,"analyserNode",void 0),S(this,"sourceNode",void 0),this.context=Qd(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=e,e==null||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||xi()||bo()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{const i=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(i);for(let o=0;o<e.length;++o)e[o]=i[o]/128-1}const t=ca(e).call(e,(i,o)=>i+o*o,0)/e.length;return Math.max(10*Math.log10(t)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,t;(e=this.sourceNode)===null||e===void 0||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(t=this.sourceNode)===null||t===void 0||t.connect(this.analyserNode)}catch{y.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class gD extends zt{get processSourceNode(){return this.sourceNode}set processedNode(e){var t;if(!this.isDestroyed&&this._processedNode!==e){try{var i;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.outputNode)}catch{}(t=this._processedNode)===null||t===void 0||t.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),S(this,"outputNode",void 0),S(this,"outputTrack",void 0),S(this,"isPlayed",!1),S(this,"context",void 0),S(this,"audioBufferNode",void 0),S(this,"destNode",void 0),S(this,"audioOutputLevel",0),S(this,"volumeLevelAnalyser",void 0),S(this,"_processedNode",void 0),S(this,"playNode",void 0),S(this,"isDestroyed",!1),S(this,"onNoAudioInput",void 0),S(this,"isNoAudioInput",!1),S(this,"_noAudioInputCount",0),this.context=Qd(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),bl(this.outputNode),this.volumeLevelAnalyser=new ED}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=t=>{this.emit(or.ON_AUDIO_BUFFER,function(i){for(let o=0;o<i.outputBuffer.numberOfChannels;o+=1){const a=i.outputBuffer.getChannelData(o);for(let l=0;l<a.length;l+=1)a[l]=0}return i.inputBuffer}(t))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!mt().webAudioMediaStreamDest)throw new ne(N.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){this.context.state!=="running"&&Zm(()=>{wt.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;xi()||bo()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const t=this.volumeLevelAnalyser.getAnalyserNode();let i;t.getFloatTimeDomainData?(i=new Float32Array(t.fftSize),t.getFloatTimeDomainData(i)):(i=new Uint8Array(t.fftSize),t.getByteTimeDomainData(i));let o=!1;for(let a=0;a<i.length;a++)i[a]!==0&&(o=!0);return o?(this.isNoAudioInput=!1,!0):(await Xn(200),await this.checkHasAudioInput(e?e+1:1)&&o)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,t;(e=this.processedNode)===null||e===void 0||e.disconnect(),(t=this.sourceNode)===null||t===void 0||t.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?(e=this.processedNode)===null||e===void 0||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class vD extends gD{get isFreeze(){return!1}constructor(e,t,i){var o;if(super(),S(this,"sourceNode",void 0),S(this,"track",void 0),S(this,"clonedTrack",void 0),S(this,"audioElement",void 0),S(this,"isCurrentTrackCloned",!1),S(this,"isRemoteTrack",!1),S(this,"originVolumeLevelAnalyser",void 0),S(this,"rebuildWebAudio",async()=>{if(y.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void y.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>y.info("resume success")),y.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const u=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?u.stop():this.isCurrentTrackCloned=!0;const h=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(h),bl(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const f=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(f,this.context.currentTime),bl(this.outputNode),this.emit(or.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=h,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),e.kind!=="audio")throw new ne(N.UNEXPECTED_ERROR);this.track=e;const a=new MediaStream([this.track]);if(this.isRemoteTrack=!!t,this.sourceNode=this.context.createMediaStreamSource(a),bl(this.sourceNode),i){const u=i.clone();u.enabled=!0,this.clonedTrack=u,y.debug("create an unmuted track ".concat(u.id," from the original track ").concat(i.id," to get the volume"));const h=this.context.createMediaStreamSource(new MediaStream([u]));bl(h),this.originVolumeLevelAnalyser=new ED,this.originVolumeLevelAnalyser.updateSource(h)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=a;const l=ft();t&&l.os===Nn.IOS&&Number((o=l.osVersion)===null||o===void 0?void 0:o.split(".")[0])<15&&(wt.on(jn.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(u=>{u||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;const t=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(t),bl(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(or.UPDATE_SOURCE),this.audioElement.srcObject=t}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),wt.off("state-change",this.rebuildWebAudio),(e=this.originVolumeLevelAnalyser)===null||e===void 0||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){const t=e.clone();t.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=t),y.debug("create an unmuted track ".concat(t.id," from the original track ").concat(e.id," to get the volume"));const i=this.context.createMediaStreamSource(new MediaStream([t]));bl(i),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(i)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function SD(n,e,t){const i=(a,l)=>a?typeof a!="number"?a.max||a.exact||a.ideal||a.min||l:a:l,o={audio:!!t&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n,maxHeight:i(e.height,1080),maxWidth:i(e.width,1920)}}};return e.frameRate&&typeof e.frameRate!="number"?(o.video.mandatory.maxFrameRate=e.frameRate.max,o.video.mandatory.minFrameRate=e.frameRate.min):typeof e.frameRate=="number"&&(o.video.mandatory.maxFrameRate=e.frameRate),await navigator.mediaDevices.getUserMedia(o)}async function xz(n,e){const t=await TD(n.mediaSource),{sourceId:i,audio:o}=await function(a){let l=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new X((u,h)=>{const f=document.createElement("div");f.innerText="share screen",f.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const m=document.createElement("div");m.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const E=document.createElement("div");E.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",E.setAttribute("style","height: 12%;");const v=document.createElement("div");v.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const T=document.createElement("div");T.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const A=document.createElement("button");A.innerHTML="cancel",A.setAttribute("style","width: 85px;"),A.onclick=()=>{document.body.removeChild(D);const M=new Error("NotAllowedError");M.name="NotAllowedError",h(M)};let C=l;const b=document.createElement("div");if(l){const M=document.createElement("input");M.setAttribute("type","checkbox");const B=document.createElement("span");M.setAttribute("style","margin-right: 6px;"),B.innerText="Share audio",M.checked=C,M.onchange=()=>{C=M.checked},b.appendChild(M),b.appendChild(B)}T.appendChild(b),T.appendChild(A),m.appendChild(E),m.appendChild(v),m.appendChild(T);const D=document.createElement("div");D.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),D.appendChild(f),D.appendChild(m),document.body.appendChild(D),a.map(M=>{if(M.id){const B=document.createElement("div");B.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let J=M.thumbnail;try{const{width:G}=J.getSize();G>1920&&(J=J.resize({width:1920}))}catch(G){throw G&&G.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),G}B.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+J.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+M.name.replace(/[\u00A0-\u9999<>\&]/g,function(G){return"&#"+G.charCodeAt(0)+";"})+"</span>",B.onclick=()=>{document.body.removeChild(D),u({sourceId:M.id,audio:C})},v.appendChild(B)}})})}(t,e);return await SD(i,n,o)}async function TD(n){let e=["window","screen"];n!=="application"&&n!=="window"||(e=["window"]),n==="screen"&&(e=["screen"]);const t=vP();if(!t)throw console.error("failed to fetch electron, please mount it to window"),new ne(N.ELECTRON_IS_NULL);let i=null;try{var o;i=((o=t.desktopCapturer)===null||o===void 0?void 0:o.getSources({types:e}))||t.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:e})}catch{i=null}i&&i.then||(i=new X((a,l)=>{t.desktopCapturer.getSources({types:e},(u,h)=>{u?l(u):a(h)})}));try{return await i}catch(a){throw new ne(N.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,a.toString())}}function yD(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}const My=new Qn("safari");let RD=!1,CD=!1;async function Vr(n,e){let t=0,i=null;for(;t<2;)try{i=await Uz(n,e,t>0);break}catch(o){if(o instanceof ne)throw y.error("[".concat(e,"] ").concat(o.toString())),o;const a=A_(o.name||o.code||o,o.message);if(a.code===N.MEDIA_OPTION_INVALID){y.debug("[".concat(e,"] detect media option invalid, retry")),t+=1,await Xn(500);continue}throw y.error("[".concat(e,"] ").concat(a.toString())),a}if(!i)throw new ne(N.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function Uz(n,e,t){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new ne(N.NOT_SUPPORTED,"can not find getUserMedia");t&&(n.video&&(delete n.video.width,delete n.video.height),n.screen&&(delete n.screen.width,delete n.screen.height));const i=mt(),o=new MediaStream;if(n.audioSource&&o.addTrack(n.audioSource),n.videoSource&&o.addTrack(n.videoSource),!n.audio&&!n.video&&!n.screen)return y.debug("Using Video Source/ Audio Source"),o;if(n.screen)if(vP())n.screen.sourceId?$d(o,await SD(n.screen.sourceId,n.screen,n.screenAudio)):$d(o,await xz(n.screen,n.screenAudio));else if(ra()&&n.screen.extensionId&&n.screen.mandatory){if(!i.getStreamFromExtension)throw new ne(N.NOT_SUPPORTED,"This browser does not support screen sharing");y.debug("[".concat(e,'] Screen access on chrome stable, looking for extension"'));const v=await(l=n.screen.extensionId,u=e,new X((T,A)=>{try{chrome.runtime.sendMessage(l,{getStream:!0},C=>{if(!C||!C.streamId)return y.error("[".concat(u,"] No response from Chrome Plugin. Plugin not installed properly"),C),void A(new ne(N.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));T(C.streamId)})}catch(C){y.error("[".concat(u,"] AgoraRTC screensharing plugin is not accessible(").concat(l,")"),C.toString()),A(new ne(N.CHROME_PLUGIN_NOT_INSTALL))}}));n.screen.mandatory.chromeMediaSourceId=v,$d(o,await navigator.mediaDevices.getUserMedia({video:{mandatory:n.screen.mandatory}}))}else if(i.getDisplayMedia){var a;n.screen.mediaSource&&dD(n.screen.mediaSource);const v={width:n.screen.width,height:n.screen.height,frameRate:n.screen.frameRate,displaySurface:(a=n.screen.displaySurface)!==null&&a!==void 0?a:n.screen.mediaSource==="screen"?"monitor":n.screen.mediaSource},{selfBrowserSurface:T,surfaceSwitching:A,systemAudio:C}=n.screen,b={selfBrowserSurface:T,surfaceSwitching:A,systemAudio:C};!T&&delete b.selfBrowserSurface,!A&&delete b.surfaceSwitching,!C&&delete b.systemAudio,y.debug("[".concat(e,"] getDisplayMedia:"),JSON.stringify({video:v,audio:!!n.screenAudio,controls:b}));const D=await navigator.mediaDevices.getDisplayMedia(function(M){for(var B=1;B<arguments.length;B++){var J=arguments[B]!=null?arguments[B]:{};B%2?yD(Object(J),!0).forEach(function(G){S(M,G,J[G])}):Object.getOwnPropertyDescriptors?Object.defineProperties(M,Object.getOwnPropertyDescriptors(J)):yD(Object(J)).forEach(function(G){Object.defineProperty(M,G,Object.getOwnPropertyDescriptor(J,G))})}return M}({video:v,audio:!!n.screenAudio},b));$d(o,D)}else{if(!Pt())throw y.error("[".concat(e,"] This browser does not support screenSharing")),new ne(N.NOT_SUPPORTED,"This browser does not support screen sharing");{n.screen.mediaSource&&dD(n.screen.mediaSource);const v={video:{mediaSource:n.screen.mediaSource,width:n.screen.width,height:n.screen.height,frameRate:n.screen.frameRate}};y.debug("[".concat(e,"] getUserMedia: ").concat(JSON.stringify(v))),$d(o,await navigator.mediaDevices.getUserMedia(v))}}var l,u;if(!n.video&&!n.audio)return o;let h={video:n.video,audio:n.audio},f=V("MEDIA_DEVICE_CONSTRAINTS");if(f)try{typeof f=="string"&&(f=JSON.parse(f)),h=MT(h,f)}catch{}y.debug("[".concat(e,"] GetUserMedia"),JSON.stringify(h)),ft();let m,E=null;(ii()||xi()||Jm())&&(E=await My.lock());try{m=await navigator.mediaDevices.getUserMedia(h)}catch(v){throw E&&E(),v}return h.audio&&(RD=!0),h.video&&(CD=!0),$d(o,m),E&&E(),o}function A_(n,e){switch(n){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new ne(N.MEDIA_OPTION_INVALID,"".concat(n,": ").concat(e));case"NotFoundError":case"DevicesNotFoundError":return new ne(N.DEVICE_NOT_FOUND,"".concat(n,": ").concat(e));case"NotSupportedError":return new ne(N.NOT_SUPPORTED,"".concat(n,": ").concat(e));case"NotReadableError":return new ne(N.NOT_READABLE,"".concat(n,": ").concat(e));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new ne(N.PERMISSION_DENIED,"".concat(n,": ").concat(e));case"ConstraintNotSatisfiedError":return new ne(N.CONSTRAINT_NOT_SATISFIED,"".concat(n,": ").concat(e));default:return y.error("getUserMedia unexpected error",n),new ne(N.UNEXPECTED_ERROR,"".concat(n,": ").concat(e))}}function $d(n,e){const t=n.getVideoTracks()[0],i=n.getAudioTracks()[0],o=e.getVideoTracks()[0],a=e.getAudioTracks()[0];a&&(i&&n.removeTrack(i),n.addTrack(a)),o&&(t&&n.removeTrack(t),n.addTrack(o))}const Fr=new class extends zt{get state(){return this._state}set state(n){n!==this._state&&(this.emit(fa.STATE_CHANGE,n),this._state=n)}constructor(){super(),S(this,"_state",wl.IDLE),S(this,"isAccessMicrophonePermission",!1),S(this,"isAccessCameraPermission",!1),S(this,"lastAccessMicrophonePermission",!1),S(this,"lastAccessCameraPermission",!1),S(this,"checkdeviceMatched",!1),S(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(V("ENUMERATE_DEVICES_INTERVAL")||(Xm()||qm()===Nn.HARMONY_OS)&&nc())&&this.updateDevicesInfo()},V("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(n=>y.error(n.toString()))}async enumerateDevices(n,e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new ne(N.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const i=await navigator.mediaDevices.enumerateDevices(),o=this.checkMediaDeviceInfoIsOk(i);let a=!this.isAccessMicrophonePermission&&n,l=!this.isAccessCameraPermission&&e;o.audio&&(a=!1),o.video&&(l=!1);let u=null,h=null,f=null;if(!t&&(a||l)){if(My.isLocked&&(y.debug("[device manager] wait GUM lock"),(await My.lock())(),y.debug("[device manager] GUM unlock")),RD&&(a=!1,this.isAccessMicrophonePermission=!0),CD&&(l=!1,this.isAccessCameraPermission=!0),y.debug("[device manager] check media device permissions",n,e,a,l),a&&l){try{f=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(m){const E=A_(m.name||m.code||m,m.message);if(E.code===N.PERMISSION_DENIED)throw E;y.warning("getUserMedia failed in getDevices",E)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(a){try{u=await navigator.mediaDevices.getUserMedia({audio:n})}catch(m){const E=A_(m.name||m.code||m,m.message);if(E.code===N.PERMISSION_DENIED)throw E;y.warning("getUserMedia failed in getDevices",E)}this.isAccessMicrophonePermission=!0}else if(l){try{h=await navigator.mediaDevices.getUserMedia({video:e})}catch(m){const E=A_(m.name||m.code||m,m.message);if(E.code===N.PERMISSION_DENIED)throw E;y.warning("getUserMedia failed in getDevices",E)}this.isAccessCameraPermission=!0}y.debug("[device manager] mic permission",n,"cam permission",e)}try{const m=await navigator.mediaDevices.enumerateDevices();return u&&u.getTracks().forEach(E=>E.stop()),h&&h.getTracks().forEach(E=>E.stop()),f&&f.getTracks().forEach(E=>E.stop()),u=null,h=null,f=null,m}catch(m){return u&&u.getTracks().forEach(E=>E.stop()),h&&h.getTracks().forEach(E=>E.stop()),f&&f.getTracks().forEach(E=>E.stop()),u=null,h=null,f=null,new ne(N.ENUMERATE_DEVICES_FAILED,m.toString()).throw()}}async getRecordingDevices(){let n=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,n)).filter(e=>e.kind==="audioinput")}async getCamerasDevices(){let n=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,n)).filter(e=>e.kind==="videoinput")}async getSpeakers(){let n=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,n)).filter(e=>e.kind==="audiooutput")}searchDeviceIdByName(n){let e=null;return this.deviceInfoMap.forEach(t=>{t.device.label===n&&(e=t.device.deviceId)}),e}async getDeviceById(n){const e=(await this.enumerateDevices(!0,!0,!0)).find(t=>t.deviceId===n);if(!e)throw new ne(N.DEVICE_NOT_FOUND,"deviceId: ".concat(n));return e}async init(){this.state=wl.INITING;try{await this.updateDevicesInfo(),this.state=wl.INITEND}catch(n){throw y.warning("Device Detection functionality cannot start properly.",n.toString()),this.state=wl.IDLE,!(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")&&new ne(N.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),n}}async updateDevicesInfo(){const n=await this.enumerateDevices(!0,!0,!0),e=Date.now(),t=[];if(n[0]&&n[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const o=n.find(l=>l.kind==="audioinput"&&l.deviceId==="default"),a=n.find(l=>l.kind==="audiooutput"&&l.deviceId==="default");o&&a?a.groupId===o.groupId?y.debug("[device-check] default input ".concat(o.label," and output ").concat(a.label," is the same group")):y.warning("[device-check] default input ".concat(o.label," and output ").concat(a.label," is not the same group")):y.debug("[device-check] default input or output not found")}const i=this.checkMediaDeviceInfoIsOk(n);if(n.forEach(o=>{if(!o.deviceId)return;const a=this.deviceInfoMap.get("".concat(o.kind,"_").concat(o.deviceId));if((a?a.state:"INACTIVE")!=="ACTIVE"){const l={initAt:e,updateAt:e,device:o,state:"ACTIVE"};this.deviceInfoMap.set("".concat(o.kind,"_").concat(o.deviceId),l),t.push(l)}a&&(a.updateAt=e)}),this.deviceInfoMap.forEach((o,a)=>{o.state==="ACTIVE"&&o.updateAt!==e&&(o.state="INACTIVE",t.push(o))}),this.state!==wl.INITEND)return i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));t.forEach(o=>{switch(o.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(fa.RECORDING_DEVICE_CHANGED,o);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(fa.CAMERA_DEVICE_CHANGED,o);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(fa.PLAYOUT_DEVICE_CHANGED,o)}}),i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(n){const e=n.filter(o=>o.kind==="audioinput"),t=n.filter(o=>o.kind==="videoinput"),i={audio:!1,video:!1};for(const o of e)if(o.label&&o.deviceId){i.audio=!0;break}for(const o of t)if(o.label&&o.deviceId){i.video=!0;break}return i}};let xy=!1;const jr=new class extends zt{constructor(){super(...arguments),S(this,"onAutoplayFailed",void 0),S(this,"onAudioAutoplayFailed",void 0)}};function ID(){if(ft(),!xy){const n=e=>{e.preventDefault(),xy=!1,Wh()?document.body.removeEventListener("click",n,!0):(document.body.removeEventListener("touchstart",n,!0),document.body.removeEventListener("mousedown",n,!0))};xy=!0,Wh()?document.body.addEventListener("click",n,!0):(document.body.addEventListener("touchstart",n,!0),document.body.addEventListener("mousedown",n,!0)),y.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),jr.onAutoplayFailed?jr.onAutoplayFailed():jr.onAudioAutoplayFailed?y.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):y.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),jr.emit("autoplay-failed")}}function wD(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}function bD(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?wD(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):wD(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function AD(n,e,t,i){if(!n)return;const o=Oe.getBaseInfoBySessionId(n);if(!o)return;const a=o.info,l=Date.now(),u=bD(bD({},a),{},{vid:a.vid===void 0?0:Number(a.vid),lts:l,elapse:l-o.startTime,cbRegistered:jr.onAutoplayFailed||jr.onAudioAutoplayFailed?1:-1,errorMsg:t,mediaType:e,trackId:i,extend:void 0});Oe.send({type:Gt.AUTOPLAY_FAILED,data:u},!0)}const Vz=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],qi=new class{constructor(){S(this,"onAutoplayFailed",void 0),S(this,"elementMap",new Map),S(this,"elementStateMap",new Map),S(this,"elementsNeedToResume",[]),S(this,"sinkIdMap",new Map),S(this,"autoResumeAfterInterruption",n=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,i]=e;const o=this.elementStateMap.get(t),a=i.srcObject.getAudioTracks()[0],l=a&&a.readyState;if(y.debug("resume after interrupted, ele: ".concat(o," audio: ").concat(l," ").concat(n)),l==="live"){if(n)return i.pause(),void i.play();if(wt.curState==="running")return Ld()?(i.pause(),void i.play()):void(o&&o==="paused"&&i.play())}})}),S(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(n=>{let[e,t]=n;const i=t.srcObject.getAudioTracks()[0];i&&i.readyState==="live"&&(y.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),t.pause(),t.play())})}),this.autoResumeAudioElement(),wt.on(jn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),wt.on(jn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),wt.on(jn.STATE_CHANGE,()=>{xi()&&wt.prevState==="suspended"&&wt.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(n,e){const t=this.elementMap.get(n);if(this.sinkIdMap.set(n,e),t)try{await t.setSinkId(e)}catch(i){throw new ne(N.PERMISSION_DENIED,"can not set sink id: "+i.toString())}}play(n,e,t,i){if(this.elementMap.has(e))return;const o=document.createElement("audio");o.autoplay=!0,o.srcObject=new MediaStream([n]),this.bindAudioElementEvents(e,o),this.elementMap.set(e,o),this.elementStateMap.set(e,Oi.INIT),this.setVolume(e,t);const a=this.sinkIdMap.get(e);if(a)try{o.setSinkId(a).catch(u=>{y.warning("[".concat(e,"] set sink id failed"),u.toString())})}catch(u){y.warning("[".concat(e,"] set sink id failed"),u.toString())}const l=o.play();l&&l.then&&l.catch(u=>{i&&AD(i,"audio",u.message,e),y.warning("audio element play warning",u.toString()),this.elementMap.has(e)&&u.name==="NotAllowedError"&&(y.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(o),Zm(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),ID()}))})}updateTrack(n,e){const t=this.elementMap.get(n);t&&(t.srcObject=new MediaStream([e]))}isPlaying(n){return this.elementMap.has(n)&&this.elementStateMap.get(n)==="playing"}setVolume(n,e){const t=this.elementMap.get(n);t&&(e=Math.max(0,Math.min(100,e)),t.volume=e/100)}stop(n){const e=this.elementMap.get(n);if(this.sinkIdMap.delete(n),!e)return;const t=this.elementsNeedToResume.indexOf(e);this.elementsNeedToResume.splice(t,1),e.srcObject=null,e.remove(),this.elementMap.delete(n),this.elementStateMap.delete(n)}bindAudioElementEvents(n,e){Vz.forEach(t=>{e.addEventListener(t,i=>{const o=this.elementStateMap.get(n),a=i.type==="pause"?"paused":i.type;if(y.debug("[".concat(n,"] audio-element-status change ").concat(o," => ").concat(a)),i.type==="error"){const l=e==null?void 0:e.error;l&&y.error("[".concat(n,"] media error, code: ").concat(l.code,", message: ").concat(l.message))}this.elementStateMap.set(n,a)})})}getPlayerState(n){return this.elementStateMap.get(n)||"uninit"}autoResumeAudioElement(){const n=()=>{this.elementsNeedToResume.forEach(e=>{e.play().then(t=>{y.debug("Auto resume audio element success")}).catch(t=>{y.warning("Auto resume audio element failed!",t)})}),this.elementsNeedToResume=[]};new X(e=>{document.body?e():window.addEventListener("load",()=>e())}).then(()=>{Wh()?document.body.addEventListener("click",n,!0):(document.body.addEventListener("touchstart",n,!0),document.body.addEventListener("mousedown",n,!0))})}};function un(){return function(n,e,t){const i=t.value;return typeof i=="function"&&(t.value=function(){this._isClosed&&new ne(N.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",y);for(var o=arguments.length,a=new Array(o),l=0;l<o;l++)a[l]=arguments[l];const u=i.apply(this,a);return u instanceof X?new X((h,f)=>{u.then(h).catch(f)}):u}),t}}function OD(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}function O_(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?OD(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):OD(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}class ND extends zt{constructor(e){super(),S(this,"name","VideoProcessorDestination"),S(this,"ID","0"),S(this,"_source",void 0),S(this,"videoContext",void 0),S(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new ne(N.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new ne(N.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(Ai.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Ai.ON_TRACK,void 0)}}class PD extends zt{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t){super(),S(this,"constraintsMap",new Map),S(this,"statsRegistry",[]),S(this,"usageRegistry",[]),S(this,"trackId",void 0),S(this,"direction",void 0),S(this,"_chained",!1),this.trackId=e,this.direction=t}async getConstraints(){return await Sn(this,ar.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,t){var i;return y.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),Dt(this,ar.REQUEST_UPDATE_CONSTRAINTS,Array.from(no(i=this.constraintsMap).call(i)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return y.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),Dt(this,ar.REQUEST_UPDATE_CONSTRAINTS,Array.from(no(t=this.constraintsMap).call(t)))}registerStats(e,t,i){this.statsRegistry.find(o=>o.processorID===e.ID&&o.processorName===e.name&&o.type===t)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:i})}unregisterStats(e,t){const i=this.statsRegistry.findIndex(o=>o.processorID===e.ID&&o.processorName===e.name&&o.type===t);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const e=[];for(const{processorID:t,processorName:i,type:o,cb:a}of this.statsRegistry)try{const l=a();e.push({processorID:t,processorName:i,type:o,stats:l})}catch(l){y.error(new ne(N.UNEXPECTED_ERROR,l.message))}return e}registerUsage(e,t){this.usageRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){const t=this.usageRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name);t!==-1&&this.usageRegistry.splice(t,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:t}of this.usageRegistry)try{let i=t();i instanceof X&&(i=await i),e.push(O_(O_({},i),{},{direction:this.direction}))}catch(i){y.error("gather extension usage error",i)}return e}getDirection(){return this.direction}}class DD extends zt{constructor(e){super(),S(this,"name","AudioProcessorDestination"),S(this,"ID","0"),S(this,"inputTrack",void 0),S(this,"inputNode",void 0),S(this,"audioProcessorContext",void 0),S(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new ne(N.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new ne(N.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Ai.ON_TRACK,void 0),this.emit(Ai.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(Ai.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(Ai.ON_NODE,this.inputNode))}}class kD extends zt{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t,i){super(),S(this,"constraintsMap",new Map),S(this,"statsRegistry",[]),S(this,"audioContext",void 0),S(this,"trackId",void 0),S(this,"direction",void 0),S(this,"usageRegistry",[]),S(this,"_chained",!1),this.audioContext=e,this.trackId=t,this.direction=i}async getConstraints(){return Sn(this,ar.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,t){var i;return y.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),Dt(this,ar.REQUEST_UPDATE_CONSTRAINTS,Array.from(no(i=this.constraintsMap).call(i)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),Dt(this,ar.REQUEST_UPDATE_CONSTRAINTS,Array.from(no(t=this.constraintsMap).call(t)))}registerStats(e,t,i){this.statsRegistry.find(o=>o.processorID===e.ID&&o.processorName===e.name&&o.type===t)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:i})}unregisterStats(e,t){const i=this.statsRegistry.findIndex(o=>o.processorID===e.ID&&o.processorName===e.name&&o.type===t);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const e=[];for(const{processorID:t,processorName:i,type:o,cb:a}of this.statsRegistry)try{const l=a();e.push({processorID:t,processorName:i,type:o,stats:l})}catch(l){y.error(new ne(N.UNEXPECTED_ERROR,l.message))}return e}registerUsage(e,t){this.usageRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){const t=this.usageRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name);t!==-1&&this.usageRegistry.splice(t,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:t}of this.usageRegistry)try{let i=t();i instanceof X&&(i=await i),e.push(O_(O_({},i),{},{direction:this.direction}))}catch(i){y.error("gather extension usage error",i)}return e}getDirection(){return this.direction}}class Uy extends zt{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),S(this,"context",void 0),S(this,"processSourceNode",void 0),S(this,"outputTrack",void 0),S(this,"processedNode",void 0),S(this,"clonedTrack",void 0),S(this,"outputNode",void 0),this.outputNode=new Fz}setVolume(){}createOutputTrack(){throw new ne(N.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Fz{disconnect(){}connect(){}}function LD(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}function Vy(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?LD(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):LD(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}class bt extends _i{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?qi.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,i,o){super(e,i),S(this,"trackMediaType","audio"),S(this,"_encoderConfig",void 0),S(this,"_trackSource",void 0),S(this,"_enabled",!0),S(this,"_volume",100),S(this,"_useAudioElement",!0),S(this,"_bypassWebAudio",!1),S(this,"processor",void 0),S(this,"_processorContext",void 0),S(this,"_processorDestination",void 0),S(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!o,this._trackSource=new Uy,V("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),V("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),ii()&&!Ur?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){Ot(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&qi.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void y.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,Dt(this,Te.NEED_REPLACE_TRACK,this).then(()=>{y.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(i=>{y.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),i)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!ra()&&V("RESTRICTION_SET_PLAYBACK_DEVICE"))throw new ne(N.NOT_SUPPORTED,"your browser does not support setting the audio output device");await qi.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,i){return this._setEnabled(e,t,i)}async _setEnabled(e,t,i){if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(y.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{i||(this._enabled=!0),await Dt(this,Te.NEED_ENABLE_TRACK,this),y.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(o){throw i||(this._enabled=!1),y.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}}else{this._originMediaStreamTrack.enabled=!1,i||(this._enabled=!1);try{await Dt(this,Te.NEED_DISABLE_TRACK,this)}catch(o){throw i||(this._enabled=!0),y.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,y.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await Dt(this,Te.NEED_MUTE_TRACK,this):await Dt(this,Te.NEED_UNMUTE_TRACK,this))}getStats(){return Vd(()=>{y.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Er(this,Te.GET_STATS)||Vy({},Ny)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(or.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(or.ON_AUDIO_BUFFER),this._source.on(or.ON_AUDIO_BUFFER,i=>e(i))}play(){y.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(y.debug("[".concat(this.getTrackId(),"] start audio playback in element")),qi.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){y.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?qi.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];y.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&qi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Dt(this,Te.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return X.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new ne(N.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new ne(N.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(Ai.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await Dt(this,Te.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Dt(this,Te.NEED_REPLACE_TRACK,this))}),e.on(Ai.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(Ai.ON_TRACK),e.removeAllListeners(Ai.ON_NODE)}bindProcessorContextEvents(e){e.on(ar.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(ar.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof Uy&&(this._trackSource=new vD(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new kD(this._source.context,this.getTrackId(),"local"),t=new DD(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(or.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(qi.stop(this.getTrackId()),this._source.play()),Dt(this,Te.NEED_REPLACE_MIXING_TRACK,this).then(()=>{y.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(i=>{y.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),i)})),{processorContext:e,processorDestination:t}}}ie([Le({argsMap:(n,e)=>[n.getTrackId(),e],throttleTime:300}),O("design:type",Function),O("design:paramtypes",[Number]),O("design:returntype",void 0)],bt.prototype,"setVolume",null),ie([Le({argsMap:(n,e)=>[n.getTrackId(),e]}),un(),O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",X)],bt.prototype,"setPlaybackDevice",null),ie([jd("LocalAudioTrack","_enabledMutex"),Le({argsMap:(n,e)=>[n.getTrackId(),e]}),un(),O("design:type",Function),O("design:paramtypes",[Boolean,Object,Boolean]),O("design:returntype",X)],bt.prototype,"setEnabled",null),ie([jd("LocalAudioTrack","_enabledMutex"),Le({argsMap:(n,e)=>[n.getTrackId(),e]}),un(),O("design:type",Function),O("design:paramtypes",[Boolean]),O("design:returntype",X)],bt.prototype,"setMuted",null),ie([un(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",Object)],bt.prototype,"getStats",null),ie([un(),O("design:type",Function),O("design:paramtypes",[Object,Number]),O("design:returntype",void 0)],bt.prototype,"setAudioFrameCallback",null),ie([Le({argsMap:n=>[n.getTrackId()]}),un(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],bt.prototype,"play",null),ie([Le({argsMap:n=>[n.getTrackId()]}),un(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],bt.prototype,"stop",null),ie([Le({argsMap:n=>[n.getTrackId()]}),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],bt.prototype,"close",null),ie([Le({argsMap:(n,e)=>[n.getTrackId(),e.name]}),O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",Object)],bt.prototype,"pipe",null),ie([Le({argsMap:n=>[n.getTrackId()]}),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],bt.prototype,"unpipe",null);class Al extends bt{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,i,o){super(e,t.encoderConfig?b_(t.encoderConfig):{},o,V("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),S(this,"_config",void 0),S(this,"_deviceName","default"),S(this,"_constraints",void 0),S(this,"_originalConstraints",void 0),S(this,"_enabled",!0),this._config=t,this._constraints=i,this._originalConstraints=i,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(Ld()||AT())&&wt.bindInterruptDetectorTrack(this)}async setDevice(e){if(y.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await Fr.getDeviceById(e),i={};i.audio=Vy({},this._constraints),i.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let o=null;try{o=await Vr(i,this.getTrackId())}catch(a){throw y.error("[".concat(this.getTrackId(),"] setDevice failed"),a.toString()),o=await Vr({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),a}await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw y.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await Fr.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw y.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}y.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,i){if(t)return y.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(y.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){var o;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(o=this._source.clonedTrack)===null||o===void 0||o.stop(),i||(this._enabled=!1);try{await Dt(this,Te.NEED_DISABLE_TRACK,this)}catch(u){throw y.error("[".concat(this.getTrackId(),"] setEnabled false failed"),u.toString()),u}return}const a=Vy({},this._constraints),l=Fr.searchDeviceIdByName(this._deviceName);l&&!a.deviceId&&(a.deviceId=l);try{i||(this._enabled=!0);const u=await Vr({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(u.getAudioTracks()[0],!1),await Dt(this,Te.NEED_ENABLE_TRACK,this)}catch(u){throw i||(this._enabled=!1),y.error("[".concat(this.getTrackId(),"] setEnabled true failed"),u.toString()),u}y.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Ld()||AT())&&wt.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((xi()||bo())&&this._enabled&&!this._isClosed&&wt.duringInterruption){const e=async()=>{wt.off(jn.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(y.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};wt.on(jn.IOS_INTERRUPTION_END,e)}else y.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(mc.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,i=Fr.searchDeviceIdByName(this._deviceName);if(i&&!t.deviceId&&(t.deviceId=i),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const o=await Vr({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(ar.REQUEST_UPDATE_CONSTRAINTS,async(t,i,o)=>{try{const a=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(a),i()}catch(a){o(a)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(ar.REQUEST_UPDATE_CONSTRAINTS)}}ie([Le({argsMap:(n,e)=>[n.getTrackId(),e]}),un(),O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",X)],Al.prototype,"setDevice",null),ie([jd("MicrophoneAudioTrack","_enabledMutex"),Le({argsMap:(n,e,t)=>[n.getTrackId(),e,t]}),un(),O("design:type",Function),O("design:paramtypes",[Boolean,Boolean,Boolean]),O("design:returntype",X)],Al.prototype,"setEnabled",null),ie([Le({argsMap:n=>[n.getTrackId()]}),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],Al.prototype,"close",null);class Ec extends bt{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,i,o){super(t.createOutputTrack(),i,o),S(this,"source",void 0),S(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(or.AUDIO_SOURCE_STATE_CHANGE,a=>{this.safeEmit(mc.SOURCE_STATE_CHANGE,a)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){Ot(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}ie([Le({argsMap:(n,e)=>[n.getTrackId(),e,n.duration]}),un(),O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",void 0)],Ec.prototype,"startProcessAudioBuffer",null),ie([Le({argsMap:n=>[n.getTrackId()]}),un(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],Ec.prototype,"pauseProcessAudioBuffer",null),ie([Le({argsMap:n=>[n.getTrackId()]}),un(),O("design:type",Function),O("design:paramtypes",[Number]),O("design:returntype",void 0)],Ec.prototype,"seekAudioBuffer",null),ie([Le({argsMap:n=>[n.getTrackId()]}),un(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],Ec.prototype,"resumeProcessAudioBuffer",null),ie([Le({argsMap:n=>[n.getTrackId()]}),un(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],Ec.prototype,"stopProcessAudioBuffer",null),ie([Le({argsMap:n=>[n.getTrackId()]}),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],Ec.prototype,"close",null),ie([Le({argsMap:n=>[n.getTrackId()]}),un(),O("design:type",Function),O("design:paramtypes",[Number]),O("design:returntype",void 0)],Ec.prototype,"setAudioBufferPlaybackSpeed",null);class In extends bt{get __className__(){return"MixingAudioTrack"}get isActive(){for(const e of this.trackList)if(e._enabled&&!e._isClosed&&!e.muted)return!0;return!1}constructor(){const e=Qd().createMediaStreamDestination();super(e.stream.getAudioTracks()[0],void 0,Lt(8,"track-mix-")),S(this,"trackList",void 0),S(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=e,this.trackList=[]}hasAudioTrack(e){return this.trackList.indexOf(e)!==-1}addAudioTrack(e){this.trackList.indexOf(e)===-1?(y.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):y.debug("track ".concat(e.getTrackId()," is already added"))}removeAudioTrack(e){if(this.trackList.indexOf(e)!==-1){y.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch{}$m(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){const e={};this.trackList.forEach(t=>{t._encoderConfig&&((t._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=t._encoderConfig.bitrate),(t._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=t._encoderConfig.sampleRate),(t._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=t._encoderConfig.sampleSize),t._encoderConfig.stereo&&(e.stereo=!0))}),this._encoderConfig=e}_updateRtpTransceiver(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach(t=>{t instanceof In?t.emit(fc.TRANSCEIVER_UPDATED,e):t._updateRtpTransceiver(e)}))}}function N_(n){const e={};n.facingMode&&(e.facingMode=n.facingMode),n.cameraId&&(e.deviceId={exact:n.cameraId});const t=ko(n.encoderConfig);return t.width!=null&&(e.width=t.width),t.height!=null&&(e.height=t.height),!pP()&&t.frameRate&&(e.frameRate=t.frameRate),ft().name===St.EDGE&&typeof e.frameRate=="object"&&(e.frameRate.max=60),Pt()&&(e.frameRate={ideal:30,max:30}),e}function MD(n){const e={};if(pP()||(n.AGC!==void 0&&(e.autoGainControl=n.AGC),n.AEC!==void 0&&(e.echoCancellation=n.AEC),n.ANS!==void 0&&(e.noiseSuppression=n.ANS,ra()&&n.ANS&&(e.googHighpassFilter=n.ANS))),n.encoderConfig){const t=b_(n.encoderConfig);e.channelCount=t.stereo?2:1,e.sampleRate=t.sampleRate,e.sampleSize=t.sampleSize}return n.microphoneId&&(e.deviceId={exact:n.microphoneId}),Xm()&&(e.sampleRate=void 0),e}class jz extends gD{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(or.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),S(this,"audioBuffer",void 0),S(this,"sourceNode",void 0),S(this,"startPlayTime",0),S(this,"startPlayOffset",0),S(this,"pausePlayTime",0),S(this,"options",void 0),S(this,"currentLoopCount",0),S(this,"currentPlaybackSpeed",100),S(this,"_currentState","stopped"),this.audioBuffer=e,this.options=t,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){this.currentState==="stopped"?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):y.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=e,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const xD=new Map;async function Bz(n,e){let t=null;if(typeof n=="string"){const o=xD.get(n);if(o)return y.debug("use cached audio resource: ",n),o;try{t=(await to(()=>rr.get(n,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(a){throw new ne(N.FETCH_AUDIO_FILE_FAILED,a.toString())}}else t=await new X((a,l)=>{const u=new FileReader;u.onload=h=>{h.target?a(h.target.result):l(new ne(N.READ_LOCAL_AUDIO_FILE_ERROR))},u.onerror=()=>{l(new ne(N.READ_LOCAL_AUDIO_FILE_ERROR))},u.readAsArrayBuffer(n)});const i=await function(o){const a=Qd();return new X((l,u)=>{a.decodeAudioData(o,h=>{l(h)},h=>{u(new ne(N.DECODE_AUDIO_FILE_FAILED,h.toString()))})})}(t);return typeof n=="string"&&e&&xD.set(n,i),i}const Fy=n=>{const e=document.createElement("canvas");return e.width=2,e.height=2,new X((t,i)=>{e.toBlob(async o=>{if(e.remove(),o){const a=await UD(o);t({buffer:a,width:e.width,height:e.height})}else i(new ne(N.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},n,1)})},UD=async n=>{const e=await n.arrayBuffer();return new Uint8Array(e)};function VD(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}function FD(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?VD(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):VD(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}class jy{get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(e){e!==this._videoElementStatus&&(y.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var t;e!==this._videoState&&(y.debug("[".concat(this.trackId,"] video-status change ").concat(this._videoState," => ").concat(e)),this._videoState=e,(t=this.onVideoStateChanged)===null||t===void 0||t.call(this,this.videoState))}constructor(e){S(this,"trackId",void 0),S(this,"config",void 0),S(this,"onFirstVideoFrameDecoded",void 0),S(this,"onVideoStateChanged",void 0),S(this,"freezeTimeCounterList",[]),S(this,"renderFreezeAccTime",0),S(this,"isKeepLastFrame",!1),S(this,"timeUpdatedCount",0),S(this,"freezeTime",0),S(this,"playbackTime",0),S(this,"lastTimeUpdatedTime",0),S(this,"autoplayFailed",!1),S(this,"videoTrack",void 0),S(this,"videoElement",void 0),S(this,"cacheVideoElement",void 0),S(this,"_videoState",Ns.VideoStateStopped),S(this,"videoElementCheckInterval",void 0),S(this,"videoElementFreezeTimeout",void 0),S(this,"_videoElementStatus",Oi.NONE),S(this,"isGettingVideoDimensions",!1),S(this,"startGetVideoDimensions",()=>{const t=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return y.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(t,500)};!this.isGettingVideoDimensions&&t()}),S(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&wt.curState==="running"&&(y.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(oP())),uP()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),S(this,"handleVideoEvents",t=>{switch(t.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Oi.PLAYING;break;case"loadeddata":if(this.videoState=Ns.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Oi.CANPLAY;break;case"stalled":this.videoElementStatus=Oi.STALLED;break;case"suspend":this.videoElementStatus=Oi.SUSPEND;break;case"pause":this.videoElementStatus=Oi.PAUSED,xi()||bo()||ii()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(y.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Oi.WAITING;break;case"abort":this.videoElementStatus=Oi.ABORT;break;case"ended":this.videoElementStatus=Oi.ENDED;break;case"emptied":this.videoElementStatus=Oi.EMPTIED;break;case"error":{this.videoElementStatus=Oi.ERROR;const i=this.videoElement.error;i&&y.error("[".concat(this.trackId,"] media error, code: ").concat(i.code,", message: ").concat(i.message));break}case"timeupdate":{const i=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=i);const o=i-this.lastTimeUpdatedTime,a=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=i,ma.lastVisibleTime<ma.lastHiddenTime||a<ma.lastHiddenTime||a<ma.lastVisibleTime)return;for(o>V("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=o),this.playbackTime+=o;this.playbackTime>=6e3;){this.playbackTime-=6e3;const l=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(l),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),S(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(y.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(oP())),uP()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),wt.on(jn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),wt.on(jn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return(e=this.videoElement.parentElement)!==null&&e!==void 0?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){const t=this.videoElement.play();t&&t.catch&&t.catch(o=>{e&&AD(e,"video",o.message,this.trackId),o.name==="NotAllowedError"?(y.warning("detected video element autoplay failed",o),this.autoplayFailed=!0,this.handleAutoPlayFailed()):y.warning("[".concat(this.trackId,"] play warning: "),o)});const i=ft();if((i.name==="Safari"&&Number(i.version)===15||Ld())&&t&&t.then){const o=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};t.then(o).catch(o)}}getCurrentFrame(){const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const t=e.getContext("2d");if(!t)return y.error("create canvas context failed!"),new ImageData(2,2);t.drawImage(this.videoElement,0,0,e.width,e.height);const i=t.getImageData(0,0,e.width,e.height);return e.remove(),i}async getCurrentFrameToUint8Array(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const o=i.getContext("2d");return o?(o.drawImage(this.videoElement,0,0,i.width,i.height),new X((a,l)=>{i.toBlob(async u=>{if(i.remove(),u){const h=await UD(u);a({buffer:h,width:i.width,height:i.height})}else l(new ne(N.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,t<0?.1:t>1?1:t)})):await Fy(e)}destroy(){wt.off(jn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),wt.off(jn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Ns.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Oi.INIT,!this.videoElementCheckInterval&&(jD.forEach(a=>{this.videoElement.addEventListener(a,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(a){return a!==document.body&&document.body.contains(a)})(this.videoElement)||(this.videoElementStatus=Oi.DESTROYED)},1e3),V("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,t;let a;const l=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",l),this.videoElementFreezeTimeout=window.setTimeout(u,V("VIDEO_FREEZE_DURATION")))},u=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Ns.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Ns.VideoStateFrozen:document.addEventListener("visibilitychange",l))},h=(f,m)=>{if(this.videoElementStatus===Oi.PLAYING){if(a){const T=m.presentationTime-a.presentationTime;this.videoState===Ns.VideoStateStarting&&(this.videoState=Ns.VideoStateDecoding),this.videoState===Ns.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(u,V("VIDEO_FREEZE_DURATION"))),T<V("VIDEO_FREEZE_DURATION")&&this.videoState===Ns.VideoStateFrozen&&(this.videoState=Ns.VideoStateDecoding),T>V("VIDEO_FREEZE_DURATION")&&ma.lastVisibleTime>=ma.lastHiddenTime&&a.timestamp>ma.lastVisibleTime&&a.timestamp>ma.lastHiddenTime&&(this.renderFreezeAccTime+=T)}a=FD(FD({},m),{},{timestamp:f})}var E,v;V("ENABLE_VIDEO_FRAME_CALLBACK")&&((E=(v=this.videoElement).requestVideoFrameCallback)===null||E===void 0||E.call(v,h))};(e=(t=this.videoElement).requestVideoFrameCallback)===null||e===void 0||e.call(t,h)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),Xm()&&(this.videoElement.poster="noposter");const i=ft();i.name==="Safari"&&Number(i.version)===15||Ld()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Pt()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Pt()&&this.videoElement.load());const o=this.videoElement.play();o!==void 0&&o.catch(a=>{y.debug("[".concat(this.trackId,"] playback interrupted"),a.toString())})}resetVideoElement(){jD.forEach(e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Oi.NONE}handleAutoPlayFailed(){const e=t=>{t.preventDefault(),this.videoElement.play().then(()=>{y.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(i=>{y.error(i)}),this.autoplayFailed=!1,Wh()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};Wh()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),ID()}}const jD=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class BD extends jy{constructor(e){super(e),S(this,"container",void 0),S(this,"slot",void 0),this.slot=e.element,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;const t=e.element;t!==this.slot&&(this.destroy(),this.slot=t),this.createElements()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var t;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,i):await Fy(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",V("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var e;!this.container||(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if((e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}function GD(n){return new X((e,t)=>{let i=!1;const o=document.createElement("video");o.setAttribute("autoplay",""),o.setAttribute("muted",""),o.muted=!0,o.autoplay=!0,o.setAttribute("playsinline",""),o.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(o);const a=xi()?"canplay":"playing";o.addEventListener(a,()=>{const l=o.videoWidth,u=o.videoHeight;!l&&Pt()||(i=!0,o.srcObject=null,o.remove(),e([l,u]))}),o.srcObject=new MediaStream([n]),o.play().catch(e_),setTimeout(()=>{i||(o.srcObject=null,o.remove(),e([o.videoWidth,o.videoHeight]))},4e3)})}const Gz=async(n,e,t)=>{const i=function(l){const u=[];for(let h=0;h<l.length;h+=2)u.push(parseInt(l.slice(h,h+2),16));return Uint8Array.from(u)}(function(l){const u="0123456789abcdef";function h(ue){let Ee,Ye="";for(Ee=0;Ee<=3;Ee++)Ye+=u.charAt(ue>>8*Ee+4&15)+u.charAt(ue>>8*Ee&15);return Ye}function f(ue,Ee){const Ye=(65535&ue)+(65535&Ee);return(ue>>16)+(Ee>>16)+(Ye>>16)<<16|65535&Ye}function m(ue,Ee,Ye,st,Vt,wn){return f(function(Wt,Rr){return Wt<<Rr|Wt>>>32-Rr}(f(f(Ee,ue),f(st,wn)),Vt),Ye)}function E(ue,Ee,Ye,st,Vt,wn,Wt){return m(Ee&Ye|~Ee&st,ue,Ee,Vt,wn,Wt)}function v(ue,Ee,Ye,st,Vt,wn,Wt){return m(Ee&st|Ye&~st,ue,Ee,Vt,wn,Wt)}function T(ue,Ee,Ye,st,Vt,wn,Wt){return m(Ee^Ye^st,ue,Ee,Vt,wn,Wt)}function A(ue,Ee,Ye,st,Vt,wn,Wt){return m(Ye^(Ee|~st),ue,Ee,Vt,wn,Wt)}const C=function(ue){let Ee;const Ye=1+(ue.length+8>>6),st=new Array(16*Ye);for(Ee=0;Ee<16*Ye;Ee++)st[Ee]=0;for(Ee=0;Ee<ue.length;Ee++)st[Ee>>2]|=ue.charCodeAt(Ee)<<Ee%4*8;return st[Ee>>2]|=128<<Ee%4*8,st[16*Ye-2]=8*ue.length,st}(l);let b,D,M,B,J,G=1732584193,q=-271733879,Q=-1732584194,$=271733878;for(b=0;b<C.length;b+=16)D=G,M=q,B=Q,J=$,G=E(G,q,Q,$,C[b+0],7,-680876936),$=E($,G,q,Q,C[b+1],12,-389564586),Q=E(Q,$,G,q,C[b+2],17,606105819),q=E(q,Q,$,G,C[b+3],22,-1044525330),G=E(G,q,Q,$,C[b+4],7,-176418897),$=E($,G,q,Q,C[b+5],12,1200080426),Q=E(Q,$,G,q,C[b+6],17,-1473231341),q=E(q,Q,$,G,C[b+7],22,-45705983),G=E(G,q,Q,$,C[b+8],7,1770035416),$=E($,G,q,Q,C[b+9],12,-1958414417),Q=E(Q,$,G,q,C[b+10],17,-42063),q=E(q,Q,$,G,C[b+11],22,-1990404162),G=E(G,q,Q,$,C[b+12],7,1804603682),$=E($,G,q,Q,C[b+13],12,-40341101),Q=E(Q,$,G,q,C[b+14],17,-1502002290),q=E(q,Q,$,G,C[b+15],22,1236535329),G=v(G,q,Q,$,C[b+1],5,-165796510),$=v($,G,q,Q,C[b+6],9,-1069501632),Q=v(Q,$,G,q,C[b+11],14,643717713),q=v(q,Q,$,G,C[b+0],20,-373897302),G=v(G,q,Q,$,C[b+5],5,-701558691),$=v($,G,q,Q,C[b+10],9,38016083),Q=v(Q,$,G,q,C[b+15],14,-660478335),q=v(q,Q,$,G,C[b+4],20,-405537848),G=v(G,q,Q,$,C[b+9],5,568446438),$=v($,G,q,Q,C[b+14],9,-1019803690),Q=v(Q,$,G,q,C[b+3],14,-187363961),q=v(q,Q,$,G,C[b+8],20,1163531501),G=v(G,q,Q,$,C[b+13],5,-1444681467),$=v($,G,q,Q,C[b+2],9,-51403784),Q=v(Q,$,G,q,C[b+7],14,1735328473),q=v(q,Q,$,G,C[b+12],20,-1926607734),G=T(G,q,Q,$,C[b+5],4,-378558),$=T($,G,q,Q,C[b+8],11,-2022574463),Q=T(Q,$,G,q,C[b+11],16,1839030562),q=T(q,Q,$,G,C[b+14],23,-35309556),G=T(G,q,Q,$,C[b+1],4,-1530992060),$=T($,G,q,Q,C[b+4],11,1272893353),Q=T(Q,$,G,q,C[b+7],16,-155497632),q=T(q,Q,$,G,C[b+10],23,-1094730640),G=T(G,q,Q,$,C[b+13],4,681279174),$=T($,G,q,Q,C[b+0],11,-358537222),Q=T(Q,$,G,q,C[b+3],16,-722521979),q=T(q,Q,$,G,C[b+6],23,76029189),G=T(G,q,Q,$,C[b+9],4,-640364487),$=T($,G,q,Q,C[b+12],11,-421815835),Q=T(Q,$,G,q,C[b+15],16,530742520),q=T(q,Q,$,G,C[b+2],23,-995338651),G=A(G,q,Q,$,C[b+0],6,-198630844),$=A($,G,q,Q,C[b+7],10,1126891415),Q=A(Q,$,G,q,C[b+14],15,-1416354905),q=A(q,Q,$,G,C[b+5],21,-57434055),G=A(G,q,Q,$,C[b+12],6,1700485571),$=A($,G,q,Q,C[b+3],10,-1894986606),Q=A(Q,$,G,q,C[b+10],15,-1051523),q=A(q,Q,$,G,C[b+1],21,-2054922799),G=A(G,q,Q,$,C[b+8],6,1873313359),$=A($,G,q,Q,C[b+15],10,-30611744),Q=A(Q,$,G,q,C[b+6],15,-1560198380),q=A(q,Q,$,G,C[b+13],21,1309151649),G=A(G,q,Q,$,C[b+4],6,-145523070),$=A($,G,q,Q,C[b+11],10,-1120210379),Q=A(Q,$,G,q,C[b+2],15,718787259),q=A(q,Q,$,G,C[b+9],21,-343485551),G=f(G,D),q=f(q,M),Q=f(Q,B),$=f($,J);return h(G)+h(q)+h(Q)+h($)}(""+e+t)).slice(0,16),o=i.slice(0,12),a=await window.crypto.subtle.importKey("raw",i,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:o},a,n))},WD=async(n,e,t)=>await Gz(n.buffer,e,t);function HD(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}function Br(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?HD(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):HD(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}class et extends _i{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Oi.PLAYING)}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get __className__(){return"LocalVideoTrack"}constructor(e,t,i,o,a,l){if(super(e,a),S(this,"trackMediaType","video"),S(this,"_player",void 0),S(this,"isUseScaleResolutionDownBy",!1),S(this,"_videoVisibleTimer",null),S(this,"_statsTimer",null),S(this,"_previousVideoVisibleStatus",void 0),S(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),S(this,"_encoderConfig",void 0),S(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),S(this,"_optimizationMode",void 0),S(this,"_videoHeight",void 0),S(this,"_videoWidth",void 0),S(this,"_forceBitrateLimit",void 0),S(this,"_enabled",!0),S(this,"processorDestination",void 0),S(this,"_processorContext",void 0),ii()){const{width:u,height:h}=e.getSettings();this._videoWidth=u,this._videoHeight=h}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=t,this._scalabilityMode=i,this._optimizationMode=o,this._hints=l||[],this._hints.indexOf(Ut.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(function(u,h,f){const m=ft();return!(m.name!==u||!m.osVersion)&&(f?Number(m.version)>=h&&Number(m.version)<=f:Number(m.version)===h)}(St.CHROME,115)&&qm().indexOf("Windows")!==-1){const u=function(h,f){if("VideoFrame"in window&&"TransformStream"in window&&mt().supportWebRTCInsertableStream){const m=new MediaStreamTrackProcessor(h),E=new MediaStreamTrackGenerator({kind:"video"});let v,T,A=Date.now();const C=()=>{b&&(clearInterval(b),b=void 0),v&&(v.close(),v=void 0),h.stop(),T=void 0,E.removeEventListener("ended",C)};let b=window.setInterval(()=>{if(T&&v&&Date.now()-A>(f??1e3))try{E.readyState==="live"?T.enqueue(v.clone()):C()}catch{C()}},f??1e3);const D=new TransformStream({transform:(M,B)=>{E.readyState==="live"?(T=B,A=Date.now(),v===void 0?(v=M,B.enqueue(M.clone())):(B.enqueue(v),v=M)):M.close()}});return E.addEventListener("ended",C),m.readable.pipeThrough(D).pipeTo(E.writable),E}}(e);u&&(y.info("local screen video track begin to inject frame"),this._mediaStreamTrack=u)}t&&this._hints.indexOf(Ut.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(t),this._processorContext=new PD(this.getTrackId(),"local"),this.processorDestination=new ND(this.processorContext),this.bindProcessorDestinationEvents()}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const o=document.getElementById(e);o?e=o:(y.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}y.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const i=Br(Br(Br({},this._getDefaultPlayerConfig()),t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new jy(i):this._player=new BD(i),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const o=this.getVideoElementVisibleStatus();this.safeEmit(mc.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},V("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._statsTimer&&(this.isUseScaleResolutionDownBy=!1,window.clearInterval(this._statsTimer),this._statsTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,y.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(y.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){this._originMediaStreamTrack.enabled=!1;try{await Dt(this,Te.NEED_DISABLE_TRACK,this)}catch(i){throw y.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}return t||(this._enabled=!1),void y.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await Dt(this,Te.NEED_ENABLE_TRACK,this)}catch(i){throw y.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}y.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,y.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await Dt(this,Te.NEED_MUTE_TRACK,this):await Dt(this,Te.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(e,t){if(!this._enabled)throw new ne(N.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(e==="720p_auto"?this.startMonitorStats():this._statsTimer&&(window.clearInterval(this._statsTimer),this._statsTimer=null),e=ko(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),e.width||e.height||e.frameRate){const i=N_({encoderConfig:e});(ii()||xi()||bo())&&(i.deviceId=void 0),y.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(o){const a=new ne(N.UNEXPECTED_ERROR,o.toString());throw y.error("[".concat(this.getTrackId(),"] applyConstraints error"),a.toString()),a}}this._encoderConfig=e,this._hints.indexOf(Ut.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Dt(this,Te.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(y)}}getStats(){return Vd(()=>{y.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Er(this,Te.GET_STATS)||Br({},Py)}async setBeautyEffect(e){y.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(e,t):await Fy(e)}async setBitrateLimit(e){if(y.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e))),e){this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate:this._encoderConfig.bitrateMax=e.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=e.min_bitrate);try{await Dt(this,Te.NEED_UPDATE_VIDEO_ENCODER,this)}catch(t){return t.throw(y)}}}async setOptimizationMode(e){if(e!=="motion"&&e!=="detail"&&e!=="balanced")return void y.error(N.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const t=this._optimizationMode;try{this._optimizationMode=e,await Dt(this,Te.SET_OPTIMIZATION_MODE,this)}catch(i){throw this._optimizationMode=t,y.error("[".concat(this.getTrackId(),"] set optimization mode failed"),i.toString()),i}y.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e,")"))}setScalabiltyMode(e){if(e.numSpatialLayers===1&&e.numTemporalLayers!==1)return y.error(N.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e,y.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}updateMediaStreamTrackResolution(){GD(this._originMediaStreamTrack).then(e=>{let[t,i]=e;this._videoHeight=i,this._videoWidth=t}).catch(e_)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(e){if(!this._enabled)throw new ne(N.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");y.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(e)),e=ko(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),this._encoderConfig=e,this._hints.indexOf(Ut.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Dt(this,Te.NEED_UPDATE_VIDEO_ENCODER,this)}catch(t){return t.throw(y)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:e,height:t,frameRate:i}=this.getMediaStreamTrackSettings();if(!e||!t||!i)return;const{bitrateMax:o,bitrateMin:a}=this._encoderConfig;if(a==null||o==null){const{max:l,min:u}=function(h,f,m,E,v){const T=V("BITRATE_ADAPTER_TYPE");if(T==="DEFAULT_BITRATE")return{min:E,max:v};if(v===void 0){var A;const b=Math.floor(200*Math.pow(m/15,.6)*Math.pow(h*f/640/360,.75));v=T==="STANDARD_BITRATE"?4*b:2*b,E=(A=E)!==null&&A!==void 0?A:b}else{var C;E=(C=E)!==null&&C!==void 0?C:Math.floor(v/10)}return{min:E,max:v}}(e,t,i,a,o);this._encoderConfig.bitrateMin=u,this._encoderConfig.bitrateMax=l,y.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e,", h: ").concat(t,", fps: ").concat(i,"] => [brMax: ").concat(l,", brMin: ").concat(u,"]"))}}getVideoElementVisibleStatus(){try{var e,t;const i=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),o={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:a,slot:l}=o;if(this.isPlaying&&a instanceof HTMLVideoElement&&l instanceof HTMLElement){const u=EP.checkOneElementVisible(a),h=Object.assign({},u);if(h.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=h.visible;const f=Oe.reportApiInvoke(null,{tag:Qt.TRACER,name:vn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});h.visible?f.onSuccess("Video is visible"):f.onSuccess("Invisible because of ".concat(h.reason))}return h}return}catch(i){throw new ne(N.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}async renewMediaStreamTrack(e){}pipe(e){if(this.processor===e)return e;if(e._source)throw new ne(N.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;e&&(i=Br(Br({},i),ko(e))),i=Tl(i);const o=Lt(8,"track-video-cloned-"),a=new et(t?this._mediaStreamTrack.clone():this._mediaStreamTrack,i,Tl(this._scalabilityMode),this._optimizationMode,o,Tl(this._hints));return e&&i&&a.setEncoderConfiguration(i),y.debug("clone video track from ".concat(this.getTrackId()," to ").concat(o,", clone ").concat(t)),a}async replaceTrack(e,t){if(!(e instanceof MediaStreamTrack))throw new ne(N.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(e.kind!=="video")throw new ne(N.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e,t,!0),this.updateMediaStreamTrackResolution()}startMonitorStats(){if(!ii()&&!xi())return;this._statsTimer&&window.clearInterval(this._statsTimer);let e=2,t=I_[e],i=-1,o=Date.now();const a=l=>{l>2||l<0||(o=Date.now(),t=I_[l],this.setSenderConfiguration(t))};this.isUseScaleResolutionDownBy=!0,this._statsTimer=window.setInterval(()=>{const l=this.getStats(),u=Er(this,Te.GET_RTC_STATS);if(l.sendPackets>0&&u){i===-1&&(i=Date.now());const h=Date.now();if(h-i<1e3||h-o<V("PROFILE_SWITCH_INTERVAL"))return;const f=l.sendFrameRate,m=.6*t.frameRate,E=.9*t.frameRate;typeof f=="number"&&f>0&&f<m?e>0&&(e--,a(e),y.debug("[".concat(this.getTrackId(),"] step down for fps ").concat(f,", switchProfile to ").concat(e))):u.OutgoingAvailableBandwidth<t.bitrateMin?e>0&&(e--,a(e),y.debug("[".concat(this.getTrackId(),"] step down for OutgoingAvailableBandwidth ").concat(u.OutgoingAvailableBandwidth,", bitrateMin ").concat(t.bitrateMin,", switchProfile to ").concat(e))):typeof f=="number"&&f>E&&e<I_.length-1&&u.OutgoingAvailableBandwidth>1.2*I_[e+1].bitrateMin&&(e++,a(e),y.debug("[".concat(this.getTrackId(),"] step up for fps ").concat(f,", OutgoingAvailableBandwidth ").concat(u.OutgoingAvailableBandwidth,", switchProfile to ").concat(e)))}},V("CHECK_LOCAL_STATS_INTERVAL"))}sendSeiData(e){if(Vd(()=>{Oe.reportApiInvoke(null,{name:vn.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Qt.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!V("ENABLE_VIDEO_SEI")||!V("ENABLE_ENCODED_TRANSFORM"))return void y.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(!(e instanceof Uint8Array))return new ne(N.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const t=this.getRTCRtpTransceiver();if(!t)return void y.warning("Video track is not published, SEI can not be send");const i=t.sender.getParameters();if(i.codecs.length===0)return;const o=i.codecs[0].mimeType.toLocaleLowerCase();o==="video/h264"?this.safeEmit("sei-to-send",e):y.warning("SEI is not supported by ".concat(o))}bindProcessorDestinationEvents(){this.processorDestination.on(Ai.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(),await Dt(this,Te.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Dt(this,Te.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ai.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(ar.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(ar.REQUEST_CONSTRAINTS)}}ie([Le({argsMap:(n,e,t)=>[n.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",t]}),un(),O("design:type",Function),O("design:paramtypes",[Object,Object]),O("design:returntype",void 0)],et.prototype,"play",null),ie([Le({argsMap:n=>[n.getTrackId()]}),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],et.prototype,"stop",null),ie([jd("LocalVideoTrack","_enabledMutex"),Le({argsMap:(n,e)=>[n.getTrackId(),e]}),un(),O("design:type",Function),O("design:paramtypes",[Boolean,Boolean]),O("design:returntype",X)],et.prototype,"setEnabled",null),ie([jd("LocalVideoTrack","_enabledMutex"),Le({argsMap:(n,e)=>[n.getTrackId(),e]}),un(),O("design:type",Function),O("design:paramtypes",[Boolean]),O("design:returntype",X)],et.prototype,"setMuted",null),ie([Le({argsMap:(n,e)=>[n.getTrackId(),e]}),un(),O("design:type",Function),O("design:paramtypes",[Object,Boolean]),O("design:returntype",X)],et.prototype,"setEncoderConfiguration",null),ie([un(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",Object)],et.prototype,"getStats",null),ie([Le({argsMap:(n,e,t)=>[n.getTrackId(),e,t]}),un(),O("design:type",Function),O("design:paramtypes",[Boolean,Object]),O("design:returntype",X)],et.prototype,"setBeautyEffect",null),ie([un(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",ImageData)],et.prototype,"getCurrentFrameData",null),ie([un(),O("design:type",Function),O("design:paramtypes",[String,Number]),O("design:returntype",X)],et.prototype,"getCurrentFrameImage",null),ie([un(),O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",X)],et.prototype,"setBitrateLimit",null),ie([un(),O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",X)],et.prototype,"setOptimizationMode",null),ie([un(),O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",void 0)],et.prototype,"setScalabiltyMode",null),ie([un(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],et.prototype,"updateMediaStreamTrackResolution",null),ie([Le({argsMap:(n,e)=>[n.getTrackId(),e.name]}),O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",Object)],et.prototype,"pipe",null),ie([Le({argsMap:n=>[n.getTrackId()]}),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],et.prototype,"unpipe",null),ie([Le({argsMap:n=>[n.getTrackId()]}),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],et.prototype,"close",null),ie([Le({argsMap:(n,e,t)=>[n.getTrackId(),e.label,t]}),O("design:type",Function),O("design:paramtypes",[MediaStreamTrack,Boolean]),O("design:returntype",X)],et.prototype,"replaceTrack",null),ie([Le(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],et.prototype,"startMonitorStats",null);class gc extends et{get __className__(){return"CameraVideoTrack"}constructor(e,t,i,o,a,l){super(e,ko(t.encoderConfig),o,a,l),S(this,"_config",void 0),S(this,"_originalConstraints",void 0),S(this,"_constraints",void 0),S(this,"_enabled",!0),S(this,"_deviceName","default"),S(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Ld()||AT())&&!function(){const u=ft();if(u.os!==Nn.IOS||!u.osVersion)return!1;const h=u.osVersion.split(".");return Number(h[0])===15&&Number(h[1])>=2}()&&hP()&&this._enabled&&!this._isClosed&&(y.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=t,this._originalConstraints=i,this._constraints=i,this._deviceName=e.label,this._encoderConfig=ko(this._config.encoderConfig),wt.on(jn.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),wt.on(jn.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){return typeof e=="string"?this._setDeviceById(e):e.deviceId?this._setDeviceById(e.deviceId):e.facingMode?this._setDeviceByFacingModel(e.facingMode):void 0}async _setDeviceById(e){if(y.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{const t=await Fr.getDeviceById(e),i={};i.video=Br({},this._constraints),i.video.deviceId={exact:e},i.video.facingMode=void 0,this._originMediaStreamTrack.stop();let o=null;try{o=await Vr(i,this.getTrackId())}catch(a){throw y.error("[".concat(this.getTrackId(),"] setDevice failed"),a.toString()),o=await Vr({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),a}await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(t){throw y.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await Fr.getDeviceById(e);this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(t){throw y.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}y.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(e){y.info("[".concat(this.getTrackId(),"] set facingMode ").concat(e));const t={video:Br(Br({},this._constraints),{},{deviceId:void 0,facingMode:{exact:e}})};if(this._enabled){this._originMediaStreamTrack.stop();let i=null;try{i=await Vr(t,this.getTrackId())}catch(o){throw y.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),o.toString()),i=await Vr({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),o}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=e,this._config.cameraId=void 0,this._constraints=Br({},t.video),y.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(y.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const i=await Vr({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1)}await Dt(this,Te.NEED_ENABLE_TRACK,this)}catch(i){throw y.error("[".concat(this.getTrackId(),"] setEnabled true error"),i.toString()),i}this.updateMediaStreamTrackResolution(),y.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),t||(this._enabled=!1);try{await Dt(this,Te.NEED_DISABLE_TRACK,this)}catch(i){throw y.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}y.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,t){if(!this._enabled)throw new ne(N.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e==="720p_auto"?this.startMonitorStats():this._statsTimer&&(window.clearInterval(this._statsTimer),this._statsTimer=null),e=ko(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin);const i=xt(this._config);i.encoderConfig=e;const o=N_(i);(ii()||xi()||bo())&&(o.deviceId=void 0),y.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(o));try{await this._originMediaStreamTrack.applyConstraints(o),this.updateMediaStreamTrackResolution()}catch(a){const l=new ne(N.UNEXPECTED_ERROR,a.toString());throw y.error("[".concat(this.getTrackId(),"] applyConstraints error"),l.toString()),l}this._config=i,this._constraints=o,this._originalConstraints=o,this._encoderConfig=e,this._hints.indexOf(Ut.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Dt(this,Te.NEED_UPDATE_VIDEO_ENCODER,this)}catch(a){return a.throw(y)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((xi()||bo())&&this._enabled&&!this._isClosed&&wt.duringInterruption){const e=async()=>{wt.off(jn.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(y.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};wt.on(jn.IOS_INTERRUPTION_END,e)}else y.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(mc.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,i=Fr.searchDeviceIdByName(this._deviceName);if(i&&!t.deviceId&&(t.deviceId={exact:i}),this._enabled){const o=await Vr({video:t},this.getTrackId());this._constraints=t,await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),wt.off(jn.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),wt.off(jn.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;e&&(i=Br(Br({},i),ko(e))),i=Tl(i);const o=Lt(8,"track-cam-cloned-"),a=new gc(t?this._mediaStreamTrack.clone():this._mediaStreamTrack,Tl(Br(Br({},this._config),{},{encoderConfig:i})),Tl(this._constraints),Tl(this._scalabilityMode),this._optimizationMode,o);return e&&i&&a.setEncoderConfiguration(i),y.debug("clone track from ".concat(this.getTrackId()," to ").concat(o,", clone ").concat(t)),a}bindProcessorContextEvents(){this.processorContext.on(ar.REQUEST_UPDATE_CONSTRAINTS,async(e,t,i)=>{try{const o=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(o),t()}catch(o){i(o)}}),this.processorContext.on(ar.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}}function KD(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}function P_(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?KD(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):KD(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function By(n,e,t,i){t.optimizationMode&&(i&&i.width&&i.height?(t.encoderConfig=P_(P_({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),t.optimizationMode!=="motion"&&t.optimizationMode!=="detail"||(e.contentHint=t.optimizationMode,e.contentHint===t.optimizationMode?y.debug("[".concat(n,"] set content hint to"),t.optimizationMode):y.debug("[".concat(n,"] set content hint failed")))):y.warning("[".concat(n,"] can not apply optimization mode bitrate config, no encoderConfig")))}function zD(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}function D_(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?zD(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):zD(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}ie([Le({argsMap:(n,e)=>[n.getTrackId(),e]}),un(),O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",X)],gc.prototype,"setDevice",null),ie([jd("CameraVideoTrack","_enabledMutex"),Le({argsMap:(n,e)=>[n.getTrackId(),e]}),un(),O("design:type",Function),O("design:paramtypes",[Boolean,Boolean]),O("design:returntype",X)],gc.prototype,"setEnabled",null),ie([Le({argsMap:(n,e)=>[n.getTrackId(),e]}),un(),O("design:type",Function),O("design:paramtypes",[Object,Boolean]),O("design:returntype",X)],gc.prototype,"setEncoderConfiguration",null),ie([Le({argsMap:n=>[n.getTrackId()]}),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],gc.prototype,"close",null);class YD extends fD{getUserId(){return this._userId}constructor(e,t,i,o){super(e,"track-".concat(e.kind,"-").concat(t,"-").concat(o.clientId,"_").concat(Lt(5,""))),S(this,"_userId",void 0),S(this,"_uintId",void 0),S(this,"_isDestroyed",!1),S(this,"store",void 0),S(this,"processor",void 0),this._userId=t,this._uintId=i,this.store=o}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,y.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}class Lo extends YD{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Oi.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,i,o){super(e,t,i,o),S(this,"_videoVisibleTimer",null),S(this,"_previousVideoVisibleStatus",void 0),S(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),S(this,"trackMediaType","video"),S(this,"_videoWidth",void 0),S(this,"_videoHeight",void 0),S(this,"_player",void 0),S(this,"processorDestination",void 0),S(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new PD(this.getTrackId(),"remote"),this.processorDestination=new ND(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Vd(()=>{y.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Er(this,Te.GET_STATS)||D_({},pD)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const o=document.getElementById(e);o?e=o:(y.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}y.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const i=D_(D_({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new jy(i):this._player=new BD(i),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(_c.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=o=>{this.safeEmit(_c.VIDEO_STATE_CHANGED,o)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const o=this.getVideoElementVisibleStatus();this.safeEmit(_c.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},V("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,y.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){GD(this._originMediaStreamTrack).then(e=>{let[t,i]=e;this._videoHeight=i,this._videoWidth=t}).catch(e_)}_updatePlayerSource(){y.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const i=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),o={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:a,slot:l}=o;if(this.isPlaying&&a instanceof HTMLVideoElement&&l instanceof HTMLElement){const u=EP.checkOneElementVisible(a),h=Object.assign({},u);if(h.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=h.visible;const f=Oe.reportApiInvoke(null,{tag:Qt.TRACER,name:vn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});h.visible?f.onSuccess("Video is visible"):f.onSuccess("Invisible because of ".concat(h.reason))}return h}return}catch(i){throw new ne(N.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new ne(N.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Ai.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ai.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(fc.SEI_RECEIVED,e)}}ie([Le({argsMap:(n,e,t)=>[n.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",t]}),O("design:type",Function),O("design:paramtypes",[Object,Object]),O("design:returntype",void 0)],Lo.prototype,"play",null),ie([Le({argsMap:n=>[n.getTrackId()]}),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],Lo.prototype,"stop",null),ie([Le({argsMap:(n,e)=>[n.getTrackId(),e.name]}),O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",Object)],Lo.prototype,"pipe",null),ie([Le({argsMap:n=>[n.getTrackId()]}),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],Lo.prototype,"unpipe",null);class Ps extends YD{get isPlaying(){return this._useAudioElement?qi.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,i,o){super(e,t,i,o),S(this,"trackMediaType","audio"),S(this,"_source",void 0),S(this,"_useAudioElement",!0),S(this,"_volume",100),S(this,"processorContext",void 0),S(this,"processorDestination",void 0),S(this,"_played",!1),S(this,"_bypassWebAudio",!1),V("DISABLE_WEBAUDIO")?(this._source=new Uy,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new vD(e,!0),V("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(or.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(_c.FIRST_FRAME_DECODED)}),this.processorContext=new kD(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new DD(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(or.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(or.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(or.ON_AUDIO_BUFFER),this._source.on(or.ON_AUDIO_BUFFER,i=>e(i))}setVolume(e){this._volume=e,this._useAudioElement?qi.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!ra()&&V("RESTRICTION_SET_PLAYBACK_DEVICE"))throw new ne(N.NOT_SUPPORTED,"your browser does not support setting the audio output device");await qi.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Vd(()=>{y.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Er(this,Te.GET_STATS)||D_({},hD)}play(){y.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(y.debug("[".concat(this.getTrackId(),"] use audio element to play")),qi.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){y.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?qi.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];y.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&qi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new ne(N.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new ne(N.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new ne(N.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Ai.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Ai.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ai.ON_TRACK),this.processorDestination.removeAllListeners(Ai.ON_NODE)}}ie([Le({argsMap:(n,e)=>[n.getTrackId(),e],throttleTime:300}),O("design:type",Function),O("design:paramtypes",[Number]),O("design:returntype",void 0)],Ps.prototype,"setVolume",null),ie([Le({argsMap:(n,e)=>[n.getTrackId(),e]}),O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",X)],Ps.prototype,"setPlaybackDevice",null),ie([Le({argsMap:n=>[n.getTrackId()]}),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],Ps.prototype,"play",null),ie([Le({argsMap:n=>[n.getTrackId()]}),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],Ps.prototype,"stop",null),ie([Le({argsMap:(n,e)=>[n.getTrackId(),e.name]}),O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",Object)],Ps.prototype,"pipe",null),ie([Le({argsMap:n=>[n.getTrackId()]}),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],Ps.prototype,"unpipe",null);const ma=new class extends zt{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),S(this,"_lastHiddenTime",0),S(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),y.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */function Zd(n){let e=n.length;for(;--e>=0;)n[e]=0}const Gy=256,qD=286,ip=30,rp=15,Wy=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),k_=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Wz=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),JD=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),_a=new Array(576);Zd(_a);const sp=new Array(60);Zd(sp);const op=new Array(512);Zd(op);const ap=new Array(256);Zd(ap);const Hy=new Array(29);Zd(Hy);const L_=new Array(ip);function Ky(n,e,t,i,o){this.static_tree=n,this.extra_bits=e,this.extra_base=t,this.elems=i,this.max_length=o,this.has_stree=n&&n.length}let XD,QD,$D;function zy(n,e){this.dyn_tree=n,this.max_code=0,this.stat_desc=e}Zd(L_);const ZD=n=>n<256?op[n]:op[256+(n>>>7)],cp=(n,e)=>{n.pending_buf[n.pending++]=255&e,n.pending_buf[n.pending++]=e>>>8&255},Gr=(n,e,t)=>{n.bi_valid>16-t?(n.bi_buf|=e<<n.bi_valid&65535,cp(n,n.bi_buf),n.bi_buf=e>>16-n.bi_valid,n.bi_valid+=t-16):(n.bi_buf|=e<<n.bi_valid&65535,n.bi_valid+=t)},Mo=(n,e,t)=>{Gr(n,t[2*e],t[2*e+1])},ek=(n,e)=>{let t=0;do t|=1&n,n>>>=1,t<<=1;while(--e>0);return t>>>1},tk=(n,e,t)=>{const i=new Array(16);let o,a,l=0;for(o=1;o<=rp;o++)l=l+t[o-1]<<1,i[o]=l;for(a=0;a<=e;a++){let u=n[2*a+1];u!==0&&(n[2*a]=ek(i[u]++,u))}},nk=n=>{let e;for(e=0;e<qD;e++)n.dyn_ltree[2*e]=0;for(e=0;e<ip;e++)n.dyn_dtree[2*e]=0;for(e=0;e<19;e++)n.bl_tree[2*e]=0;n.dyn_ltree[512]=1,n.opt_len=n.static_len=0,n.sym_next=n.matches=0},ik=n=>{n.bi_valid>8?cp(n,n.bi_buf):n.bi_valid>0&&(n.pending_buf[n.pending++]=n.bi_buf),n.bi_buf=0,n.bi_valid=0},rk=(n,e,t,i)=>{const o=2*e,a=2*t;return n[o]<n[a]||n[o]===n[a]&&i[e]<=i[t]},Yy=(n,e,t)=>{const i=n.heap[t];let o=t<<1;for(;o<=n.heap_len&&(o<n.heap_len&&rk(e,n.heap[o+1],n.heap[o],n.depth)&&o++,!rk(e,i,n.heap[o],n.depth));)n.heap[t]=n.heap[o],t=o,o<<=1;n.heap[t]=i},sk=(n,e,t)=>{let i,o,a,l,u=0;if(n.sym_next!==0)do i=255&n.pending_buf[n.sym_buf+u++],i+=(255&n.pending_buf[n.sym_buf+u++])<<8,o=n.pending_buf[n.sym_buf+u++],i===0?Mo(n,o,e):(a=ap[o],Mo(n,a+Gy+1,e),l=Wy[a],l!==0&&(o-=Hy[a],Gr(n,o,l)),i--,a=ZD(i),Mo(n,a,t),l=k_[a],l!==0&&(i-=L_[a],Gr(n,i,l)));while(u<n.sym_next);Mo(n,256,e)},qy=(n,e)=>{const t=e.dyn_tree,i=e.stat_desc.static_tree,o=e.stat_desc.has_stree,a=e.stat_desc.elems;let l,u,h,f=-1;for(n.heap_len=0,n.heap_max=573,l=0;l<a;l++)t[2*l]!==0?(n.heap[++n.heap_len]=f=l,n.depth[l]=0):t[2*l+1]=0;for(;n.heap_len<2;)h=n.heap[++n.heap_len]=f<2?++f:0,t[2*h]=1,n.depth[h]=0,n.opt_len--,o&&(n.static_len-=i[2*h+1]);for(e.max_code=f,l=n.heap_len>>1;l>=1;l--)Yy(n,t,l);h=a;do l=n.heap[1],n.heap[1]=n.heap[n.heap_len--],Yy(n,t,1),u=n.heap[1],n.heap[--n.heap_max]=l,n.heap[--n.heap_max]=u,t[2*h]=t[2*l]+t[2*u],n.depth[h]=(n.depth[l]>=n.depth[u]?n.depth[l]:n.depth[u])+1,t[2*l+1]=t[2*u+1]=h,n.heap[1]=h++,Yy(n,t,1);while(n.heap_len>=2);n.heap[--n.heap_max]=n.heap[1],((m,E)=>{const v=E.dyn_tree,T=E.max_code,A=E.stat_desc.static_tree,C=E.stat_desc.has_stree,b=E.stat_desc.extra_bits,D=E.stat_desc.extra_base,M=E.stat_desc.max_length;let B,J,G,q,Q,$,ue=0;for(q=0;q<=rp;q++)m.bl_count[q]=0;for(v[2*m.heap[m.heap_max]+1]=0,B=m.heap_max+1;B<573;B++)J=m.heap[B],q=v[2*v[2*J+1]+1]+1,q>M&&(q=M,ue++),v[2*J+1]=q,J>T||(m.bl_count[q]++,Q=0,J>=D&&(Q=b[J-D]),$=v[2*J],m.opt_len+=$*(q+Q),C&&(m.static_len+=$*(A[2*J+1]+Q)));if(ue!==0){do{for(q=M-1;m.bl_count[q]===0;)q--;m.bl_count[q]--,m.bl_count[q+1]+=2,m.bl_count[M]--,ue-=2}while(ue>0);for(q=M;q!==0;q--)for(J=m.bl_count[q];J!==0;)G=m.heap[--B],G>T||(v[2*G+1]!==q&&(m.opt_len+=(q-v[2*G+1])*v[2*G],v[2*G+1]=q),J--)}})(n,e),tk(t,f,n.bl_count)},ok=(n,e,t)=>{let i,o,a=-1,l=e[1],u=0,h=7,f=4;for(l===0&&(h=138,f=3),e[2*(t+1)+1]=65535,i=0;i<=t;i++)o=l,l=e[2*(i+1)+1],++u<h&&o===l||(u<f?n.bl_tree[2*o]+=u:o!==0?(o!==a&&n.bl_tree[2*o]++,n.bl_tree[32]++):u<=10?n.bl_tree[34]++:n.bl_tree[36]++,u=0,a=o,l===0?(h=138,f=3):o===l?(h=6,f=3):(h=7,f=4))},ak=(n,e,t)=>{let i,o,a=-1,l=e[1],u=0,h=7,f=4;for(l===0&&(h=138,f=3),i=0;i<=t;i++)if(o=l,l=e[2*(i+1)+1],!(++u<h&&o===l)){if(u<f)do Mo(n,o,n.bl_tree);while(--u!=0);else o!==0?(o!==a&&(Mo(n,o,n.bl_tree),u--),Mo(n,16,n.bl_tree),Gr(n,u-3,2)):u<=10?(Mo(n,17,n.bl_tree),Gr(n,u-3,3)):(Mo(n,18,n.bl_tree),Gr(n,u-11,7));u=0,a=o,l===0?(h=138,f=3):o===l?(h=6,f=3):(h=7,f=4)}};let ck=!1;const lk=(n,e,t,i)=>{Gr(n,0+(i?1:0),3),ik(n),cp(n,t),cp(n,~t),t&&n.pending_buf.set(n.window.subarray(e,e+t),n.pending),n.pending+=t};var Hz=n=>{ck||((()=>{let e,t,i,o,a;const l=new Array(16);for(i=0,o=0;o<28;o++)for(Hy[o]=i,e=0;e<1<<Wy[o];e++)ap[i++]=o;for(ap[i-1]=o,a=0,o=0;o<16;o++)for(L_[o]=a,e=0;e<1<<k_[o];e++)op[a++]=o;for(a>>=7;o<ip;o++)for(L_[o]=a<<7,e=0;e<1<<k_[o]-7;e++)op[256+a++]=o;for(t=0;t<=rp;t++)l[t]=0;for(e=0;e<=143;)_a[2*e+1]=8,e++,l[8]++;for(;e<=255;)_a[2*e+1]=9,e++,l[9]++;for(;e<=279;)_a[2*e+1]=7,e++,l[7]++;for(;e<=287;)_a[2*e+1]=8,e++,l[8]++;for(tk(_a,287,l),e=0;e<ip;e++)sp[2*e+1]=5,sp[2*e]=ek(e,5);XD=new Ky(_a,Wy,257,qD,rp),QD=new Ky(sp,k_,0,ip,rp),$D=new Ky(new Array(0),Wz,0,19,7)})(),ck=!0),n.l_desc=new zy(n.dyn_ltree,XD),n.d_desc=new zy(n.dyn_dtree,QD),n.bl_desc=new zy(n.bl_tree,$D),n.bi_buf=0,n.bi_valid=0,nk(n)},Kz=(n,e,t,i)=>{let o,a,l=0;n.level>0?(n.strm.data_type===2&&(n.strm.data_type=(u=>{let h,f=4093624447;for(h=0;h<=31;h++,f>>>=1)if(1&f&&u.dyn_ltree[2*h]!==0)return 0;if(u.dyn_ltree[18]!==0||u.dyn_ltree[20]!==0||u.dyn_ltree[26]!==0)return 1;for(h=32;h<Gy;h++)if(u.dyn_ltree[2*h]!==0)return 1;return 0})(n)),qy(n,n.l_desc),qy(n,n.d_desc),l=(u=>{let h;for(ok(u,u.dyn_ltree,u.l_desc.max_code),ok(u,u.dyn_dtree,u.d_desc.max_code),qy(u,u.bl_desc),h=18;h>=3&&u.bl_tree[2*JD[h]+1]===0;h--);return u.opt_len+=3*(h+1)+5+5+4,h})(n),o=n.opt_len+3+7>>>3,a=n.static_len+3+7>>>3,a<=o&&(o=a)):o=a=t+5,t+4<=o&&e!==-1?lk(n,e,t,i):n.strategy===4||a===o?(Gr(n,2+(i?1:0),3),sk(n,_a,sp)):(Gr(n,4+(i?1:0),3),((u,h,f,m)=>{let E;for(Gr(u,h-257,5),Gr(u,f-1,5),Gr(u,m-4,4),E=0;E<m;E++)Gr(u,u.bl_tree[2*JD[E]+1],3);ak(u,u.dyn_ltree,h-1),ak(u,u.dyn_dtree,f-1)})(n,n.l_desc.max_code+1,n.d_desc.max_code+1,l+1),sk(n,n.dyn_ltree,n.dyn_dtree)),nk(n),i&&ik(n)},zz=(n,e,t)=>(n.pending_buf[n.sym_buf+n.sym_next++]=e,n.pending_buf[n.sym_buf+n.sym_next++]=e>>8,n.pending_buf[n.sym_buf+n.sym_next++]=t,e===0?n.dyn_ltree[2*t]++:(n.matches++,e--,n.dyn_ltree[2*(ap[t]+Gy+1)]++,n.dyn_dtree[2*ZD(e)]++),n.sym_next===n.sym_end),Yz={_tr_init:Hz,_tr_stored_block:lk,_tr_flush_block:Kz,_tr_tally:zz,_tr_align:n=>{Gr(n,2,3),Mo(n,256,_a),(e=>{e.bi_valid===16?(cp(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(n)}},lp=(n,e,t,i)=>{let o=65535&n|0,a=n>>>16&65535|0,l=0;for(;t!==0;){l=t>2e3?2e3:t,t-=l;do o=o+e[i++]|0,a=a+o|0;while(--l);o%=65521,a%=65521}return o|a<<16|0};const qz=new Uint32Array((()=>{let n,e=[];for(var t=0;t<256;t++){n=t;for(var i=0;i<8;i++)n=1&n?3988292384^n>>>1:n>>>1;e[t]=n}return e})());var Ki=(n,e,t,i)=>{const o=qz,a=i+t;n^=-1;for(let l=i;l<a;l++)n=n>>>8^o[255&(n^e[l])];return-1^n},Ol={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},eu={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Jz,_tr_stored_block:Jy,_tr_flush_block:Xz,_tr_tally:vc,_tr_align:Qz}=Yz,{Z_NO_FLUSH:Sc,Z_PARTIAL_FLUSH:$z,Z_FULL_FLUSH:Zz,Z_FINISH:Ds,Z_BLOCK:dk,Z_OK:Ji,Z_STREAM_END:uk,Z_STREAM_ERROR:xo,Z_DATA_ERROR:e9,Z_BUF_ERROR:Xy,Z_DEFAULT_COMPRESSION:t9,Z_FILTERED:n9,Z_HUFFMAN_ONLY:M_,Z_RLE:i9,Z_FIXED:r9,Z_DEFAULT_STRATEGY:s9,Z_UNKNOWN:o9,Z_DEFLATED:x_}=eu,Qy=286,a9=30,c9=19,l9=2*Qy+1,d9=15,Nl=258,Uo=262,tu=42,Pl=113,dp=666,Dl=(n,e)=>(n.msg=Ol[e],e),hk=n=>2*n-(n>4?9:0),Tc=n=>{let e=n.length;for(;--e>=0;)n[e]=0},u9=n=>{let e,t,i,o=n.w_size;e=n.hash_size,i=e;do t=n.head[--i],n.head[i]=t>=o?t-o:0;while(--e);e=o,i=e;do t=n.prev[--i],n.prev[i]=t>=o?t-o:0;while(--e)};let yc=(n,e,t)=>(e<<n.hash_shift^t)&n.hash_mask;const rs=n=>{const e=n.state;let t=e.pending;t>n.avail_out&&(t=n.avail_out),t!==0&&(n.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+t),n.next_out),n.next_out+=t,e.pending_out+=t,n.total_out+=t,n.avail_out-=t,e.pending-=t,e.pending===0&&(e.pending_out=0))},ss=(n,e)=>{Xz(n,n.block_start>=0?n.block_start:-1,n.strstart-n.block_start,e),n.block_start=n.strstart,rs(n.strm)},an=(n,e)=>{n.pending_buf[n.pending++]=e},up=(n,e)=>{n.pending_buf[n.pending++]=e>>>8&255,n.pending_buf[n.pending++]=255&e},$y=(n,e,t,i)=>{let o=n.avail_in;return o>i&&(o=i),o===0?0:(n.avail_in-=o,e.set(n.input.subarray(n.next_in,n.next_in+o),t),n.state.wrap===1?n.adler=lp(n.adler,e,o,t):n.state.wrap===2&&(n.adler=Ki(n.adler,e,o,t)),n.next_in+=o,n.total_in+=o,o)},pk=(n,e)=>{let t,i,o=n.max_chain_length,a=n.strstart,l=n.prev_length,u=n.nice_match;const h=n.strstart>n.w_size-Uo?n.strstart-(n.w_size-Uo):0,f=n.window,m=n.w_mask,E=n.prev,v=n.strstart+Nl;let T=f[a+l-1],A=f[a+l];n.prev_length>=n.good_match&&(o>>=2),u>n.lookahead&&(u=n.lookahead);do if(t=e,f[t+l]===A&&f[t+l-1]===T&&f[t]===f[a]&&f[++t]===f[a+1]){a+=2,t++;do;while(f[++a]===f[++t]&&f[++a]===f[++t]&&f[++a]===f[++t]&&f[++a]===f[++t]&&f[++a]===f[++t]&&f[++a]===f[++t]&&f[++a]===f[++t]&&f[++a]===f[++t]&&a<v);if(i=Nl-(v-a),a=v-Nl,i>l){if(n.match_start=e,l=i,i>=u)break;T=f[a+l-1],A=f[a+l]}}while((e=E[e&m])>h&&--o!=0);return l<=n.lookahead?l:n.lookahead},nu=n=>{const e=n.w_size;let t,i,o;do{if(i=n.window_size-n.lookahead-n.strstart,n.strstart>=e+(e-Uo)&&(n.window.set(n.window.subarray(e,e+e-i),0),n.match_start-=e,n.strstart-=e,n.block_start-=e,n.insert>n.strstart&&(n.insert=n.strstart),u9(n),i+=e),n.strm.avail_in===0)break;if(t=$y(n.strm,n.window,n.strstart+n.lookahead,i),n.lookahead+=t,n.lookahead+n.insert>=3)for(o=n.strstart-n.insert,n.ins_h=n.window[o],n.ins_h=yc(n,n.ins_h,n.window[o+1]);n.insert&&(n.ins_h=yc(n,n.ins_h,n.window[o+3-1]),n.prev[o&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=o,o++,n.insert--,!(n.lookahead+n.insert<3)););}while(n.lookahead<Uo&&n.strm.avail_in!==0)},fk=(n,e)=>{let t,i,o,a=n.pending_buf_size-5>n.w_size?n.w_size:n.pending_buf_size-5,l=0,u=n.strm.avail_in;do{if(t=65535,o=n.bi_valid+42>>3,n.strm.avail_out<o||(o=n.strm.avail_out-o,i=n.strstart-n.block_start,t>i+n.strm.avail_in&&(t=i+n.strm.avail_in),t>o&&(t=o),t<a&&(t===0&&e!==Ds||e===Sc||t!==i+n.strm.avail_in)))break;l=e===Ds&&t===i+n.strm.avail_in?1:0,Jy(n,0,0,l),n.pending_buf[n.pending-4]=t,n.pending_buf[n.pending-3]=t>>8,n.pending_buf[n.pending-2]=~t,n.pending_buf[n.pending-1]=~t>>8,rs(n.strm),i&&(i>t&&(i=t),n.strm.output.set(n.window.subarray(n.block_start,n.block_start+i),n.strm.next_out),n.strm.next_out+=i,n.strm.avail_out-=i,n.strm.total_out+=i,n.block_start+=i,t-=i),t&&($y(n.strm,n.strm.output,n.strm.next_out,t),n.strm.next_out+=t,n.strm.avail_out-=t,n.strm.total_out+=t)}while(l===0);return u-=n.strm.avail_in,u&&(u>=n.w_size?(n.matches=2,n.window.set(n.strm.input.subarray(n.strm.next_in-n.w_size,n.strm.next_in),0),n.strstart=n.w_size,n.insert=n.strstart):(n.window_size-n.strstart<=u&&(n.strstart-=n.w_size,n.window.set(n.window.subarray(n.w_size,n.w_size+n.strstart),0),n.matches<2&&n.matches++,n.insert>n.strstart&&(n.insert=n.strstart)),n.window.set(n.strm.input.subarray(n.strm.next_in-u,n.strm.next_in),n.strstart),n.strstart+=u,n.insert+=u>n.w_size-n.insert?n.w_size-n.insert:u),n.block_start=n.strstart),n.high_water<n.strstart&&(n.high_water=n.strstart),l?4:e!==Sc&&e!==Ds&&n.strm.avail_in===0&&n.strstart===n.block_start?2:(o=n.window_size-n.strstart,n.strm.avail_in>o&&n.block_start>=n.w_size&&(n.block_start-=n.w_size,n.strstart-=n.w_size,n.window.set(n.window.subarray(n.w_size,n.w_size+n.strstart),0),n.matches<2&&n.matches++,o+=n.w_size,n.insert>n.strstart&&(n.insert=n.strstart)),o>n.strm.avail_in&&(o=n.strm.avail_in),o&&($y(n.strm,n.window,n.strstart,o),n.strstart+=o,n.insert+=o>n.w_size-n.insert?n.w_size-n.insert:o),n.high_water<n.strstart&&(n.high_water=n.strstart),o=n.bi_valid+42>>3,o=n.pending_buf_size-o>65535?65535:n.pending_buf_size-o,a=o>n.w_size?n.w_size:o,i=n.strstart-n.block_start,(i>=a||(i||e===Ds)&&e!==Sc&&n.strm.avail_in===0&&i<=o)&&(t=i>o?o:i,l=e===Ds&&n.strm.avail_in===0&&t===i?1:0,Jy(n,n.block_start,t,l),n.block_start+=t,rs(n.strm)),l?3:1)},Zy=(n,e)=>{let t,i;for(;;){if(n.lookahead<Uo){if(nu(n),n.lookahead<Uo&&e===Sc)return 1;if(n.lookahead===0)break}if(t=0,n.lookahead>=3&&(n.ins_h=yc(n,n.ins_h,n.window[n.strstart+3-1]),t=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),t!==0&&n.strstart-t<=n.w_size-Uo&&(n.match_length=pk(n,t)),n.match_length>=3)if(i=vc(n,n.strstart-n.match_start,n.match_length-3),n.lookahead-=n.match_length,n.match_length<=n.max_lazy_match&&n.lookahead>=3){n.match_length--;do n.strstart++,n.ins_h=yc(n,n.ins_h,n.window[n.strstart+3-1]),t=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart;while(--n.match_length!=0);n.strstart++}else n.strstart+=n.match_length,n.match_length=0,n.ins_h=n.window[n.strstart],n.ins_h=yc(n,n.ins_h,n.window[n.strstart+1]);else i=vc(n,0,n.window[n.strstart]),n.lookahead--,n.strstart++;if(i&&(ss(n,!1),n.strm.avail_out===0))return 1}return n.insert=n.strstart<2?n.strstart:2,e===Ds?(ss(n,!0),n.strm.avail_out===0?3:4):n.sym_next&&(ss(n,!1),n.strm.avail_out===0)?1:2},iu=(n,e)=>{let t,i,o;for(;;){if(n.lookahead<Uo){if(nu(n),n.lookahead<Uo&&e===Sc)return 1;if(n.lookahead===0)break}if(t=0,n.lookahead>=3&&(n.ins_h=yc(n,n.ins_h,n.window[n.strstart+3-1]),t=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),n.prev_length=n.match_length,n.prev_match=n.match_start,n.match_length=2,t!==0&&n.prev_length<n.max_lazy_match&&n.strstart-t<=n.w_size-Uo&&(n.match_length=pk(n,t),n.match_length<=5&&(n.strategy===n9||n.match_length===3&&n.strstart-n.match_start>4096)&&(n.match_length=2)),n.prev_length>=3&&n.match_length<=n.prev_length){o=n.strstart+n.lookahead-3,i=vc(n,n.strstart-1-n.prev_match,n.prev_length-3),n.lookahead-=n.prev_length-1,n.prev_length-=2;do++n.strstart<=o&&(n.ins_h=yc(n,n.ins_h,n.window[n.strstart+3-1]),t=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart);while(--n.prev_length!=0);if(n.match_available=0,n.match_length=2,n.strstart++,i&&(ss(n,!1),n.strm.avail_out===0))return 1}else if(n.match_available){if(i=vc(n,0,n.window[n.strstart-1]),i&&ss(n,!1),n.strstart++,n.lookahead--,n.strm.avail_out===0)return 1}else n.match_available=1,n.strstart++,n.lookahead--}return n.match_available&&(i=vc(n,0,n.window[n.strstart-1]),n.match_available=0),n.insert=n.strstart<2?n.strstart:2,e===Ds?(ss(n,!0),n.strm.avail_out===0?3:4):n.sym_next&&(ss(n,!1),n.strm.avail_out===0)?1:2};function Vo(n,e,t,i,o){this.good_length=n,this.max_lazy=e,this.nice_length=t,this.max_chain=i,this.func=o}const hp=[new Vo(0,0,0,0,fk),new Vo(4,4,8,4,Zy),new Vo(4,5,16,8,Zy),new Vo(4,6,32,32,Zy),new Vo(4,4,16,16,iu),new Vo(8,16,32,32,iu),new Vo(8,16,128,128,iu),new Vo(8,32,128,256,iu),new Vo(32,128,258,1024,iu),new Vo(32,258,258,4096,iu)];function h9(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=x_,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*l9),this.dyn_dtree=new Uint16Array(2*(2*a9+1)),this.bl_tree=new Uint16Array(2*(2*c9+1)),Tc(this.dyn_ltree),Tc(this.dyn_dtree),Tc(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(d9+1),this.heap=new Uint16Array(2*Qy+1),Tc(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Qy+1),Tc(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const pp=n=>{if(!n)return 1;const e=n.state;return!e||e.strm!==n||e.status!==tu&&e.status!==57&&e.status!==69&&e.status!==73&&e.status!==91&&e.status!==103&&e.status!==Pl&&e.status!==dp?1:0},mk=n=>{if(pp(n))return Dl(n,xo);n.total_in=n.total_out=0,n.data_type=o9;const e=n.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?57:e.wrap?tu:Pl,n.adler=e.wrap===2?0:1,e.last_flush=-2,Jz(e),Ji},_k=n=>{const e=mk(n);var t;return e===Ji&&((t=n.state).window_size=2*t.w_size,Tc(t.head),t.max_lazy_match=hp[t.level].max_lazy,t.good_match=hp[t.level].good_length,t.nice_match=hp[t.level].nice_length,t.max_chain_length=hp[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),e},Ek=(n,e,t,i,o,a)=>{if(!n)return xo;let l=1;if(e===t9&&(e=6),i<0?(l=0,i=-i):i>15&&(l=2,i-=16),o<1||o>9||t!==x_||i<8||i>15||e<0||e>9||a<0||a>r9||i===8&&l!==1)return Dl(n,xo);i===8&&(i=9);const u=new h9;return n.state=u,u.strm=n,u.status=tu,u.wrap=l,u.gzhead=null,u.w_bits=i,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=o+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+3-1)/3),u.window=new Uint8Array(2*u.w_size),u.head=new Uint16Array(u.hash_size),u.prev=new Uint16Array(u.w_size),u.lit_bufsize=1<<o+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new Uint8Array(u.pending_buf_size),u.sym_buf=u.lit_bufsize,u.sym_end=3*(u.lit_bufsize-1),u.level=e,u.strategy=a,u.method=t,_k(n)};var p9=(n,e)=>{if(pp(n)||e>dk||e<0)return n?Dl(n,xo):xo;const t=n.state;if(!n.output||n.avail_in!==0&&!n.input||t.status===dp&&e!==Ds)return Dl(n,n.avail_out===0?Xy:xo);const i=t.last_flush;if(t.last_flush=e,t.pending!==0){if(rs(n),n.avail_out===0)return t.last_flush=-1,Ji}else if(n.avail_in===0&&hk(e)<=hk(i)&&e!==Ds)return Dl(n,Xy);if(t.status===dp&&n.avail_in!==0)return Dl(n,Xy);if(t.status===tu&&t.wrap===0&&(t.status=Pl),t.status===tu){let o=x_+(t.w_bits-8<<4)<<8,a=-1;if(a=t.strategy>=M_||t.level<2?0:t.level<6?1:t.level===6?2:3,o|=a<<6,t.strstart!==0&&(o|=32),o+=31-o%31,up(t,o),t.strstart!==0&&(up(t,n.adler>>>16),up(t,65535&n.adler)),n.adler=1,t.status=Pl,rs(n),t.pending!==0)return t.last_flush=-1,Ji}if(t.status===57){if(n.adler=0,an(t,31),an(t,139),an(t,8),t.gzhead)an(t,(t.gzhead.text?1:0)+(t.gzhead.hcrc?2:0)+(t.gzhead.extra?4:0)+(t.gzhead.name?8:0)+(t.gzhead.comment?16:0)),an(t,255&t.gzhead.time),an(t,t.gzhead.time>>8&255),an(t,t.gzhead.time>>16&255),an(t,t.gzhead.time>>24&255),an(t,t.level===9?2:t.strategy>=M_||t.level<2?4:0),an(t,255&t.gzhead.os),t.gzhead.extra&&t.gzhead.extra.length&&(an(t,255&t.gzhead.extra.length),an(t,t.gzhead.extra.length>>8&255)),t.gzhead.hcrc&&(n.adler=Ki(n.adler,t.pending_buf,t.pending,0)),t.gzindex=0,t.status=69;else if(an(t,0),an(t,0),an(t,0),an(t,0),an(t,0),an(t,t.level===9?2:t.strategy>=M_||t.level<2?4:0),an(t,3),t.status=Pl,rs(n),t.pending!==0)return t.last_flush=-1,Ji}if(t.status===69){if(t.gzhead.extra){let o=t.pending,a=(65535&t.gzhead.extra.length)-t.gzindex;for(;t.pending+a>t.pending_buf_size;){let u=t.pending_buf_size-t.pending;if(t.pending_buf.set(t.gzhead.extra.subarray(t.gzindex,t.gzindex+u),t.pending),t.pending=t.pending_buf_size,t.gzhead.hcrc&&t.pending>o&&(n.adler=Ki(n.adler,t.pending_buf,t.pending-o,o)),t.gzindex+=u,rs(n),t.pending!==0)return t.last_flush=-1,Ji;o=0,a-=u}let l=new Uint8Array(t.gzhead.extra);t.pending_buf.set(l.subarray(t.gzindex,t.gzindex+a),t.pending),t.pending+=a,t.gzhead.hcrc&&t.pending>o&&(n.adler=Ki(n.adler,t.pending_buf,t.pending-o,o)),t.gzindex=0}t.status=73}if(t.status===73){if(t.gzhead.name){let o,a=t.pending;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>a&&(n.adler=Ki(n.adler,t.pending_buf,t.pending-a,a)),rs(n),t.pending!==0)return t.last_flush=-1,Ji;a=0}o=t.gzindex<t.gzhead.name.length?255&t.gzhead.name.charCodeAt(t.gzindex++):0,an(t,o)}while(o!==0);t.gzhead.hcrc&&t.pending>a&&(n.adler=Ki(n.adler,t.pending_buf,t.pending-a,a)),t.gzindex=0}t.status=91}if(t.status===91){if(t.gzhead.comment){let o,a=t.pending;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>a&&(n.adler=Ki(n.adler,t.pending_buf,t.pending-a,a)),rs(n),t.pending!==0)return t.last_flush=-1,Ji;a=0}o=t.gzindex<t.gzhead.comment.length?255&t.gzhead.comment.charCodeAt(t.gzindex++):0,an(t,o)}while(o!==0);t.gzhead.hcrc&&t.pending>a&&(n.adler=Ki(n.adler,t.pending_buf,t.pending-a,a))}t.status=103}if(t.status===103){if(t.gzhead.hcrc){if(t.pending+2>t.pending_buf_size&&(rs(n),t.pending!==0))return t.last_flush=-1,Ji;an(t,255&n.adler),an(t,n.adler>>8&255),n.adler=0}if(t.status=Pl,rs(n),t.pending!==0)return t.last_flush=-1,Ji}if(n.avail_in!==0||t.lookahead!==0||e!==Sc&&t.status!==dp){let o=t.level===0?fk(t,e):t.strategy===M_?((a,l)=>{let u;for(;;){if(a.lookahead===0&&(nu(a),a.lookahead===0)){if(l===Sc)return 1;break}if(a.match_length=0,u=vc(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++,u&&(ss(a,!1),a.strm.avail_out===0))return 1}return a.insert=0,l===Ds?(ss(a,!0),a.strm.avail_out===0?3:4):a.sym_next&&(ss(a,!1),a.strm.avail_out===0)?1:2})(t,e):t.strategy===i9?((a,l)=>{let u,h,f,m;const E=a.window;for(;;){if(a.lookahead<=Nl){if(nu(a),a.lookahead<=Nl&&l===Sc)return 1;if(a.lookahead===0)break}if(a.match_length=0,a.lookahead>=3&&a.strstart>0&&(f=a.strstart-1,h=E[f],h===E[++f]&&h===E[++f]&&h===E[++f])){m=a.strstart+Nl;do;while(h===E[++f]&&h===E[++f]&&h===E[++f]&&h===E[++f]&&h===E[++f]&&h===E[++f]&&h===E[++f]&&h===E[++f]&&f<m);a.match_length=Nl-(m-f),a.match_length>a.lookahead&&(a.match_length=a.lookahead)}if(a.match_length>=3?(u=vc(a,1,a.match_length-3),a.lookahead-=a.match_length,a.strstart+=a.match_length,a.match_length=0):(u=vc(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++),u&&(ss(a,!1),a.strm.avail_out===0))return 1}return a.insert=0,l===Ds?(ss(a,!0),a.strm.avail_out===0?3:4):a.sym_next&&(ss(a,!1),a.strm.avail_out===0)?1:2})(t,e):hp[t.level].func(t,e);if(o!==3&&o!==4||(t.status=dp),o===1||o===3)return n.avail_out===0&&(t.last_flush=-1),Ji;if(o===2&&(e===$z?Qz(t):e!==dk&&(Jy(t,0,0,!1),e===Zz&&(Tc(t.head),t.lookahead===0&&(t.strstart=0,t.block_start=0,t.insert=0))),rs(n),n.avail_out===0))return t.last_flush=-1,Ji}return e!==Ds?Ji:t.wrap<=0?uk:(t.wrap===2?(an(t,255&n.adler),an(t,n.adler>>8&255),an(t,n.adler>>16&255),an(t,n.adler>>24&255),an(t,255&n.total_in),an(t,n.total_in>>8&255),an(t,n.total_in>>16&255),an(t,n.total_in>>24&255)):(up(t,n.adler>>>16),up(t,65535&n.adler)),rs(n),t.wrap>0&&(t.wrap=-t.wrap),t.pending!==0?Ji:uk)},f9=(n,e)=>{let t=e.length;if(pp(n))return xo;const i=n.state,o=i.wrap;if(o===2||o===1&&i.status!==tu||i.lookahead)return xo;if(o===1&&(n.adler=lp(n.adler,e,t,0)),i.wrap=0,t>=i.w_size){o===0&&(Tc(i.head),i.strstart=0,i.block_start=0,i.insert=0);let h=new Uint8Array(i.w_size);h.set(e.subarray(t-i.w_size,t),0),e=h,t=i.w_size}const a=n.avail_in,l=n.next_in,u=n.input;for(n.avail_in=t,n.next_in=0,n.input=e,nu(i);i.lookahead>=3;){let h=i.strstart,f=i.lookahead-2;do i.ins_h=yc(i,i.ins_h,i.window[h+3-1]),i.prev[h&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=h,h++;while(--f);i.strstart=h,i.lookahead=2,nu(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,n.next_in=l,n.input=u,n.avail_in=a,i.wrap=o,Ji},fp={deflateInit:(n,e)=>Ek(n,e,x_,15,8,s9),deflateInit2:Ek,deflateReset:_k,deflateResetKeep:mk,deflateSetHeader:(n,e)=>pp(n)||n.state.wrap!==2?xo:(n.state.gzhead=e,Ji),deflate:p9,deflateEnd:n=>{if(pp(n))return xo;const e=n.state.status;return n.state=null,e===Pl?Dl(n,e9):Ji},deflateSetDictionary:f9,deflateInfo:"pako deflate (from Nodeca project)"};const m9=(n,e)=>Object.prototype.hasOwnProperty.call(n,e);var U_={assign:function(n){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const t=e.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(const i in t)m9(t,i)&&(n[i]=t[i])}}return n},flattenChunks:n=>{let e=0;for(let i=0,o=n.length;i<o;i++)e+=n[i].length;const t=new Uint8Array(e);for(let i=0,o=0,a=n.length;i<a;i++){let l=n[i];t.set(l,o),o+=l.length}return t}};let gk=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{gk=!1}const mp=new Uint8Array(256);for(let n=0;n<256;n++)mp[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;mp[254]=mp[254]=1;var _p={string2buf:n=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(n);let e,t,i,o,a,l=n.length,u=0;for(o=0;o<l;o++)t=n.charCodeAt(o),(64512&t)==55296&&o+1<l&&(i=n.charCodeAt(o+1),(64512&i)==56320&&(t=65536+(t-55296<<10)+(i-56320),o++)),u+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(u),a=0,o=0;a<u;o++)t=n.charCodeAt(o),(64512&t)==55296&&o+1<l&&(i=n.charCodeAt(o+1),(64512&i)==56320&&(t=65536+(t-55296<<10)+(i-56320),o++)),t<128?e[a++]=t:t<2048?(e[a++]=192|t>>>6,e[a++]=128|63&t):t<65536?(e[a++]=224|t>>>12,e[a++]=128|t>>>6&63,e[a++]=128|63&t):(e[a++]=240|t>>>18,e[a++]=128|t>>>12&63,e[a++]=128|t>>>6&63,e[a++]=128|63&t);return e},buf2string:(n,e)=>{const t=e||n.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(n.subarray(0,e));let i,o;const a=new Array(2*t);for(o=0,i=0;i<t;){let l=n[i++];if(l<128){a[o++]=l;continue}let u=mp[l];if(u>4)a[o++]=65533,i+=u-1;else{for(l&=u===2?31:u===3?15:7;u>1&&i<t;)l=l<<6|63&n[i++],u--;u>1?a[o++]=65533:l<65536?a[o++]=l:(l-=65536,a[o++]=55296|l>>10&1023,a[o++]=56320|1023&l)}}return((l,u)=>{if(u<65534&&l.subarray&&gk)return String.fromCharCode.apply(null,l.length===u?l:l.subarray(0,u));let h="";for(let f=0;f<u;f++)h+=String.fromCharCode(l[f]);return h})(a,o)},utf8border:(n,e)=>{(e=e||n.length)>n.length&&(e=n.length);let t=e-1;for(;t>=0&&(192&n[t])==128;)t--;return t<0||t===0?e:t+mp[n[t]]>e?t:e}},vk=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Sk=Object.prototype.toString,{Z_NO_FLUSH:_9,Z_SYNC_FLUSH:E9,Z_FULL_FLUSH:g9,Z_FINISH:v9,Z_OK:V_,Z_STREAM_END:S9,Z_DEFAULT_COMPRESSION:T9,Z_DEFAULT_STRATEGY:y9,Z_DEFLATED:R9}=eu;function Ep(n){this.options=U_.assign({level:T9,method:R9,chunkSize:16384,windowBits:15,memLevel:8,strategy:y9},n||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new vk,this.strm.avail_out=0;let t=fp.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(t!==V_)throw new Error(Ol[t]);if(e.header&&fp.deflateSetHeader(this.strm,e.header),e.dictionary){let i;if(i=typeof e.dictionary=="string"?_p.string2buf(e.dictionary):Sk.call(e.dictionary)==="[object ArrayBuffer]"?new Uint8Array(e.dictionary):e.dictionary,t=fp.deflateSetDictionary(this.strm,i),t!==V_)throw new Error(Ol[t]);this._dict_set=!0}}function e0(n,e){const t=new Ep(e);if(t.push(n,!0),t.err)throw t.msg||Ol[t.err];return t.result}Ep.prototype.push=function(n,e){const t=this.strm,i=this.options.chunkSize;let o,a;if(this.ended)return!1;for(a=e===~~e?e:e===!0?v9:_9,typeof n=="string"?t.input=_p.string2buf(n):Sk.call(n)==="[object ArrayBuffer]"?t.input=new Uint8Array(n):t.input=n,t.next_in=0,t.avail_in=t.input.length;;)if(t.avail_out===0&&(t.output=new Uint8Array(i),t.next_out=0,t.avail_out=i),(a===E9||a===g9)&&t.avail_out<=6)this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;else{if(o=fp.deflate(t,a),o===S9)return t.next_out>0&&this.onData(t.output.subarray(0,t.next_out)),o=fp.deflateEnd(this.strm),this.onEnd(o),this.ended=!0,o===V_;if(t.avail_out!==0){if(a>0&&t.next_out>0)this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;else if(t.avail_in===0)break}else this.onData(t.output)}return!0},Ep.prototype.onData=function(n){this.chunks.push(n)},Ep.prototype.onEnd=function(n){n===V_&&(this.result=U_.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};var C9={Deflate:Ep,deflate:e0,deflateRaw:function(n,e){return(e=e||{}).raw=!0,e0(n,e)},gzip:function(n,e){return(e=e||{}).gzip=!0,e0(n,e)},constants:eu};const F_=16209;var I9=function(n,e){let t,i,o,a,l,u,h,f,m,E,v,T,A,C,b,D,M,B,J,G,q,Q,$,ue;const Ee=n.state;t=n.next_in,$=n.input,i=t+(n.avail_in-5),o=n.next_out,ue=n.output,a=o-(e-n.avail_out),l=o+(n.avail_out-257),u=Ee.dmax,h=Ee.wsize,f=Ee.whave,m=Ee.wnext,E=Ee.window,v=Ee.hold,T=Ee.bits,A=Ee.lencode,C=Ee.distcode,b=(1<<Ee.lenbits)-1,D=(1<<Ee.distbits)-1;e:do{T<15&&(v+=$[t++]<<T,T+=8,v+=$[t++]<<T,T+=8),M=A[v&b];t:for(;;){if(B=M>>>24,v>>>=B,T-=B,B=M>>>16&255,B===0)ue[o++]=65535&M;else{if(!(16&B)){if(!(64&B)){M=A[(65535&M)+(v&(1<<B)-1)];continue t}if(32&B){Ee.mode=16191;break e}n.msg="invalid literal/length code",Ee.mode=F_;break e}J=65535&M,B&=15,B&&(T<B&&(v+=$[t++]<<T,T+=8),J+=v&(1<<B)-1,v>>>=B,T-=B),T<15&&(v+=$[t++]<<T,T+=8,v+=$[t++]<<T,T+=8),M=C[v&D];n:for(;;){if(B=M>>>24,v>>>=B,T-=B,B=M>>>16&255,!(16&B)){if(!(64&B)){M=C[(65535&M)+(v&(1<<B)-1)];continue n}n.msg="invalid distance code",Ee.mode=F_;break e}if(G=65535&M,B&=15,T<B&&(v+=$[t++]<<T,T+=8,T<B&&(v+=$[t++]<<T,T+=8)),G+=v&(1<<B)-1,G>u){n.msg="invalid distance too far back",Ee.mode=F_;break e}if(v>>>=B,T-=B,B=o-a,G>B){if(B=G-B,B>f&&Ee.sane){n.msg="invalid distance too far back",Ee.mode=F_;break e}if(q=0,Q=E,m===0){if(q+=h-B,B<J){J-=B;do ue[o++]=E[q++];while(--B);q=o-G,Q=ue}}else if(m<B){if(q+=h+m-B,B-=m,B<J){J-=B;do ue[o++]=E[q++];while(--B);if(q=0,m<J){B=m,J-=B;do ue[o++]=E[q++];while(--B);q=o-G,Q=ue}}}else if(q+=m-B,B<J){J-=B;do ue[o++]=E[q++];while(--B);q=o-G,Q=ue}for(;J>2;)ue[o++]=Q[q++],ue[o++]=Q[q++],ue[o++]=Q[q++],J-=3;J&&(ue[o++]=Q[q++],J>1&&(ue[o++]=Q[q++]))}else{q=o-G;do ue[o++]=ue[q++],ue[o++]=ue[q++],ue[o++]=ue[q++],J-=3;while(J>2);J&&(ue[o++]=ue[q++],J>1&&(ue[o++]=ue[q++]))}break}}break}}while(t<i&&o<l);J=T>>3,t-=J,T-=J<<3,v&=(1<<T)-1,n.next_in=t,n.next_out=o,n.avail_in=t<i?i-t+5:5-(t-i),n.avail_out=o<l?l-o+257:257-(o-l),Ee.hold=v,Ee.bits=T};const j_=15,w9=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),b9=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),A9=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),O9=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var gp=(n,e,t,i,o,a,l,u)=>{const h=u.bits;let f,m,E,v,T,A,C=0,b=0,D=0,M=0,B=0,J=0,G=0,q=0,Q=0,$=0,ue=null;const Ee=new Uint16Array(16),Ye=new Uint16Array(16);let st,Vt,wn,Wt=null;for(C=0;C<=j_;C++)Ee[C]=0;for(b=0;b<i;b++)Ee[e[t+b]]++;for(B=h,M=j_;M>=1&&Ee[M]===0;M--);if(B>M&&(B=M),M===0)return o[a++]=20971520,o[a++]=20971520,u.bits=1,0;for(D=1;D<M&&Ee[D]===0;D++);for(B<D&&(B=D),q=1,C=1;C<=j_;C++)if(q<<=1,q-=Ee[C],q<0)return-1;if(q>0&&(n===0||M!==1))return-1;for(Ye[1]=0,C=1;C<j_;C++)Ye[C+1]=Ye[C]+Ee[C];for(b=0;b<i;b++)e[t+b]!==0&&(l[Ye[e[t+b]]++]=b);if(n===0?(ue=Wt=l,A=20):n===1?(ue=w9,Wt=b9,A=257):(ue=A9,Wt=O9,A=0),$=0,b=0,C=D,T=a,J=B,G=0,E=-1,Q=1<<B,v=Q-1,n===1&&Q>852||n===2&&Q>592)return 1;for(;;){st=C-G,l[b]+1<A?(Vt=0,wn=l[b]):l[b]>=A?(Vt=Wt[l[b]-A],wn=ue[l[b]-A]):(Vt=96,wn=0),f=1<<C-G,m=1<<J,D=m;do m-=f,o[T+($>>G)+m]=st<<24|Vt<<16|wn|0;while(m!==0);for(f=1<<C-1;$&f;)f>>=1;if(f!==0?($&=f-1,$+=f):$=0,b++,--Ee[C]==0){if(C===M)break;C=e[t+l[b]]}if(C>B&&($&v)!==E){for(G===0&&(G=B),T+=D,J=C-G,q=1<<J;J+G<M&&(q-=Ee[J+G],!(q<=0));)J++,q<<=1;if(Q+=1<<J,n===1&&Q>852||n===2&&Q>592)return 1;E=$&v,o[E]=B<<24|J<<16|T-a|0}}return $!==0&&(o[T+$]=C-G<<24|64<<16|0),u.bits=B,0};const{Z_FINISH:Tk,Z_BLOCK:N9,Z_TREES:B_,Z_OK:kl,Z_STREAM_END:P9,Z_NEED_DICT:D9,Z_STREAM_ERROR:ks,Z_DATA_ERROR:yk,Z_MEM_ERROR:Rk,Z_BUF_ERROR:k9,Z_DEFLATED:Ck}=eu,G_=16180,W_=16190,Ea=16191,t0=16192,n0=16194,H_=16199,K_=16200,i0=16206,Zn=16209,Ik=n=>(n>>>24&255)+(n>>>8&65280)+((65280&n)<<8)+((255&n)<<24);function L9(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ll=n=>{if(!n)return 1;const e=n.state;return!e||e.strm!==n||e.mode<G_||e.mode>16211?1:0},wk=n=>{if(Ll(n))return ks;const e=n.state;return n.total_in=n.total_out=e.total=0,n.msg="",e.wrap&&(n.adler=1&e.wrap),e.mode=G_,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,kl},bk=n=>{if(Ll(n))return ks;const e=n.state;return e.wsize=0,e.whave=0,e.wnext=0,wk(n)},Ak=(n,e)=>{let t;if(Ll(n))return ks;const i=n.state;return e<0?(t=0,e=-e):(t=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?ks:(i.window!==null&&i.wbits!==e&&(i.window=null),i.wrap=t,i.wbits=e,bk(n))},Ok=(n,e)=>{if(!n)return ks;const t=new L9;n.state=t,t.strm=n,t.window=null,t.mode=G_;const i=Ak(n,e);return i!==kl&&(n.state=null),i};let r0,s0,Nk=!0;const M9=n=>{if(Nk){r0=new Int32Array(512),s0=new Int32Array(32);let e=0;for(;e<144;)n.lens[e++]=8;for(;e<256;)n.lens[e++]=9;for(;e<280;)n.lens[e++]=7;for(;e<288;)n.lens[e++]=8;for(gp(1,n.lens,0,288,r0,0,n.work,{bits:9}),e=0;e<32;)n.lens[e++]=5;gp(2,n.lens,0,32,s0,0,n.work,{bits:5}),Nk=!1}n.lencode=r0,n.lenbits=9,n.distcode=s0,n.distbits=5},Pk=(n,e,t,i)=>{let o;const a=n.state;return a.window===null&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),i>=a.wsize?(a.window.set(e.subarray(t-a.wsize,t),0),a.wnext=0,a.whave=a.wsize):(o=a.wsize-a.wnext,o>i&&(o=i),a.window.set(e.subarray(t-i,t-i+o),a.wnext),(i-=o)?(a.window.set(e.subarray(t-i,t),0),a.wnext=i,a.whave=a.wsize):(a.wnext+=o,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=o))),0};var x9=(n,e)=>{let t,i,o,a,l,u,h,f,m,E,v,T,A,C,b,D,M,B,J,G,q,Q,$=0;const ue=new Uint8Array(4);let Ee,Ye;const st=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ll(n)||!n.output||!n.input&&n.avail_in!==0)return ks;t=n.state,t.mode===Ea&&(t.mode=t0),l=n.next_out,o=n.output,h=n.avail_out,a=n.next_in,i=n.input,u=n.avail_in,f=t.hold,m=t.bits,E=u,v=h,Q=kl;e:for(;;)switch(t.mode){case G_:if(t.wrap===0){t.mode=t0;break}for(;m<16;){if(u===0)break e;u--,f+=i[a++]<<m,m+=8}if(2&t.wrap&&f===35615){t.wbits===0&&(t.wbits=15),t.check=0,ue[0]=255&f,ue[1]=f>>>8&255,t.check=Ki(t.check,ue,2,0),f=0,m=0,t.mode=16181;break}if(t.head&&(t.head.done=!1),!(1&t.wrap)||(((255&f)<<8)+(f>>8))%31){n.msg="incorrect header check",t.mode=Zn;break}if((15&f)!==Ck){n.msg="unknown compression method",t.mode=Zn;break}if(f>>>=4,m-=4,q=8+(15&f),t.wbits===0&&(t.wbits=q),q>15||q>t.wbits){n.msg="invalid window size",t.mode=Zn;break}t.dmax=1<<t.wbits,t.flags=0,n.adler=t.check=1,t.mode=512&f?16189:Ea,f=0,m=0;break;case 16181:for(;m<16;){if(u===0)break e;u--,f+=i[a++]<<m,m+=8}if(t.flags=f,(255&t.flags)!==Ck){n.msg="unknown compression method",t.mode=Zn;break}if(57344&t.flags){n.msg="unknown header flags set",t.mode=Zn;break}t.head&&(t.head.text=f>>8&1),512&t.flags&&4&t.wrap&&(ue[0]=255&f,ue[1]=f>>>8&255,t.check=Ki(t.check,ue,2,0)),f=0,m=0,t.mode=16182;case 16182:for(;m<32;){if(u===0)break e;u--,f+=i[a++]<<m,m+=8}t.head&&(t.head.time=f),512&t.flags&&4&t.wrap&&(ue[0]=255&f,ue[1]=f>>>8&255,ue[2]=f>>>16&255,ue[3]=f>>>24&255,t.check=Ki(t.check,ue,4,0)),f=0,m=0,t.mode=16183;case 16183:for(;m<16;){if(u===0)break e;u--,f+=i[a++]<<m,m+=8}t.head&&(t.head.xflags=255&f,t.head.os=f>>8),512&t.flags&&4&t.wrap&&(ue[0]=255&f,ue[1]=f>>>8&255,t.check=Ki(t.check,ue,2,0)),f=0,m=0,t.mode=16184;case 16184:if(1024&t.flags){for(;m<16;){if(u===0)break e;u--,f+=i[a++]<<m,m+=8}t.length=f,t.head&&(t.head.extra_len=f),512&t.flags&&4&t.wrap&&(ue[0]=255&f,ue[1]=f>>>8&255,t.check=Ki(t.check,ue,2,0)),f=0,m=0}else t.head&&(t.head.extra=null);t.mode=16185;case 16185:if(1024&t.flags&&(T=t.length,T>u&&(T=u),T&&(t.head&&(q=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(i.subarray(a,a+T),q)),512&t.flags&&4&t.wrap&&(t.check=Ki(t.check,i,T,a)),u-=T,a+=T,t.length-=T),t.length))break e;t.length=0,t.mode=16186;case 16186:if(2048&t.flags){if(u===0)break e;T=0;do q=i[a+T++],t.head&&q&&t.length<65536&&(t.head.name+=String.fromCharCode(q));while(q&&T<u);if(512&t.flags&&4&t.wrap&&(t.check=Ki(t.check,i,T,a)),u-=T,a+=T,q)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=16187;case 16187:if(4096&t.flags){if(u===0)break e;T=0;do q=i[a+T++],t.head&&q&&t.length<65536&&(t.head.comment+=String.fromCharCode(q));while(q&&T<u);if(512&t.flags&&4&t.wrap&&(t.check=Ki(t.check,i,T,a)),u-=T,a+=T,q)break e}else t.head&&(t.head.comment=null);t.mode=16188;case 16188:if(512&t.flags){for(;m<16;){if(u===0)break e;u--,f+=i[a++]<<m,m+=8}if(4&t.wrap&&f!==(65535&t.check)){n.msg="header crc mismatch",t.mode=Zn;break}f=0,m=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),n.adler=t.check=0,t.mode=Ea;break;case 16189:for(;m<32;){if(u===0)break e;u--,f+=i[a++]<<m,m+=8}n.adler=t.check=Ik(f),f=0,m=0,t.mode=W_;case W_:if(t.havedict===0)return n.next_out=l,n.avail_out=h,n.next_in=a,n.avail_in=u,t.hold=f,t.bits=m,D9;n.adler=t.check=1,t.mode=Ea;case Ea:if(e===N9||e===B_)break e;case t0:if(t.last){f>>>=7&m,m-=7&m,t.mode=i0;break}for(;m<3;){if(u===0)break e;u--,f+=i[a++]<<m,m+=8}switch(t.last=1&f,f>>>=1,m-=1,3&f){case 0:t.mode=16193;break;case 1:if(M9(t),t.mode=H_,e===B_){f>>>=2,m-=2;break e}break;case 2:t.mode=16196;break;case 3:n.msg="invalid block type",t.mode=Zn}f>>>=2,m-=2;break;case 16193:for(f>>>=7&m,m-=7&m;m<32;){if(u===0)break e;u--,f+=i[a++]<<m,m+=8}if((65535&f)!=(f>>>16^65535)){n.msg="invalid stored block lengths",t.mode=Zn;break}if(t.length=65535&f,f=0,m=0,t.mode=n0,e===B_)break e;case n0:t.mode=16195;case 16195:if(T=t.length,T){if(T>u&&(T=u),T>h&&(T=h),T===0)break e;o.set(i.subarray(a,a+T),l),u-=T,a+=T,h-=T,l+=T,t.length-=T;break}t.mode=Ea;break;case 16196:for(;m<14;){if(u===0)break e;u--,f+=i[a++]<<m,m+=8}if(t.nlen=257+(31&f),f>>>=5,m-=5,t.ndist=1+(31&f),f>>>=5,m-=5,t.ncode=4+(15&f),f>>>=4,m-=4,t.nlen>286||t.ndist>30){n.msg="too many length or distance symbols",t.mode=Zn;break}t.have=0,t.mode=16197;case 16197:for(;t.have<t.ncode;){for(;m<3;){if(u===0)break e;u--,f+=i[a++]<<m,m+=8}t.lens[st[t.have++]]=7&f,f>>>=3,m-=3}for(;t.have<19;)t.lens[st[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,Ee={bits:t.lenbits},Q=gp(0,t.lens,0,19,t.lencode,0,t.work,Ee),t.lenbits=Ee.bits,Q){n.msg="invalid code lengths set",t.mode=Zn;break}t.have=0,t.mode=16198;case 16198:for(;t.have<t.nlen+t.ndist;){for(;$=t.lencode[f&(1<<t.lenbits)-1],b=$>>>24,D=$>>>16&255,M=65535&$,!(b<=m);){if(u===0)break e;u--,f+=i[a++]<<m,m+=8}if(M<16)f>>>=b,m-=b,t.lens[t.have++]=M;else{if(M===16){for(Ye=b+2;m<Ye;){if(u===0)break e;u--,f+=i[a++]<<m,m+=8}if(f>>>=b,m-=b,t.have===0){n.msg="invalid bit length repeat",t.mode=Zn;break}q=t.lens[t.have-1],T=3+(3&f),f>>>=2,m-=2}else if(M===17){for(Ye=b+3;m<Ye;){if(u===0)break e;u--,f+=i[a++]<<m,m+=8}f>>>=b,m-=b,q=0,T=3+(7&f),f>>>=3,m-=3}else{for(Ye=b+7;m<Ye;){if(u===0)break e;u--,f+=i[a++]<<m,m+=8}f>>>=b,m-=b,q=0,T=11+(127&f),f>>>=7,m-=7}if(t.have+T>t.nlen+t.ndist){n.msg="invalid bit length repeat",t.mode=Zn;break}for(;T--;)t.lens[t.have++]=q}}if(t.mode===Zn)break;if(t.lens[256]===0){n.msg="invalid code -- missing end-of-block",t.mode=Zn;break}if(t.lenbits=9,Ee={bits:t.lenbits},Q=gp(1,t.lens,0,t.nlen,t.lencode,0,t.work,Ee),t.lenbits=Ee.bits,Q){n.msg="invalid literal/lengths set",t.mode=Zn;break}if(t.distbits=6,t.distcode=t.distdyn,Ee={bits:t.distbits},Q=gp(2,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,Ee),t.distbits=Ee.bits,Q){n.msg="invalid distances set",t.mode=Zn;break}if(t.mode=H_,e===B_)break e;case H_:t.mode=K_;case K_:if(u>=6&&h>=258){n.next_out=l,n.avail_out=h,n.next_in=a,n.avail_in=u,t.hold=f,t.bits=m,I9(n,v),l=n.next_out,o=n.output,h=n.avail_out,a=n.next_in,i=n.input,u=n.avail_in,f=t.hold,m=t.bits,t.mode===Ea&&(t.back=-1);break}for(t.back=0;$=t.lencode[f&(1<<t.lenbits)-1],b=$>>>24,D=$>>>16&255,M=65535&$,!(b<=m);){if(u===0)break e;u--,f+=i[a++]<<m,m+=8}if(D&&!(240&D)){for(B=b,J=D,G=M;$=t.lencode[G+((f&(1<<B+J)-1)>>B)],b=$>>>24,D=$>>>16&255,M=65535&$,!(B+b<=m);){if(u===0)break e;u--,f+=i[a++]<<m,m+=8}f>>>=B,m-=B,t.back+=B}if(f>>>=b,m-=b,t.back+=b,t.length=M,D===0){t.mode=16205;break}if(32&D){t.back=-1,t.mode=Ea;break}if(64&D){n.msg="invalid literal/length code",t.mode=Zn;break}t.extra=15&D,t.mode=16201;case 16201:if(t.extra){for(Ye=t.extra;m<Ye;){if(u===0)break e;u--,f+=i[a++]<<m,m+=8}t.length+=f&(1<<t.extra)-1,f>>>=t.extra,m-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=16202;case 16202:for(;$=t.distcode[f&(1<<t.distbits)-1],b=$>>>24,D=$>>>16&255,M=65535&$,!(b<=m);){if(u===0)break e;u--,f+=i[a++]<<m,m+=8}if(!(240&D)){for(B=b,J=D,G=M;$=t.distcode[G+((f&(1<<B+J)-1)>>B)],b=$>>>24,D=$>>>16&255,M=65535&$,!(B+b<=m);){if(u===0)break e;u--,f+=i[a++]<<m,m+=8}f>>>=B,m-=B,t.back+=B}if(f>>>=b,m-=b,t.back+=b,64&D){n.msg="invalid distance code",t.mode=Zn;break}t.offset=M,t.extra=15&D,t.mode=16203;case 16203:if(t.extra){for(Ye=t.extra;m<Ye;){if(u===0)break e;u--,f+=i[a++]<<m,m+=8}t.offset+=f&(1<<t.extra)-1,f>>>=t.extra,m-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){n.msg="invalid distance too far back",t.mode=Zn;break}t.mode=16204;case 16204:if(h===0)break e;if(T=v-h,t.offset>T){if(T=t.offset-T,T>t.whave&&t.sane){n.msg="invalid distance too far back",t.mode=Zn;break}T>t.wnext?(T-=t.wnext,A=t.wsize-T):A=t.wnext-T,T>t.length&&(T=t.length),C=t.window}else C=o,A=l-t.offset,T=t.length;T>h&&(T=h),h-=T,t.length-=T;do o[l++]=C[A++];while(--T);t.length===0&&(t.mode=K_);break;case 16205:if(h===0)break e;o[l++]=t.length,h--,t.mode=K_;break;case i0:if(t.wrap){for(;m<32;){if(u===0)break e;u--,f|=i[a++]<<m,m+=8}if(v-=h,n.total_out+=v,t.total+=v,4&t.wrap&&v&&(n.adler=t.check=t.flags?Ki(t.check,o,v,l-v):lp(t.check,o,v,l-v)),v=h,4&t.wrap&&(t.flags?f:Ik(f))!==t.check){n.msg="incorrect data check",t.mode=Zn;break}f=0,m=0}t.mode=16207;case 16207:if(t.wrap&&t.flags){for(;m<32;){if(u===0)break e;u--,f+=i[a++]<<m,m+=8}if(4&t.wrap&&f!==(4294967295&t.total)){n.msg="incorrect length check",t.mode=Zn;break}f=0,m=0}t.mode=16208;case 16208:Q=P9;break e;case Zn:Q=yk;break e;case 16210:return Rk;default:return ks}return n.next_out=l,n.avail_out=h,n.next_in=a,n.avail_in=u,t.hold=f,t.bits=m,(t.wsize||v!==n.avail_out&&t.mode<Zn&&(t.mode<i0||e!==Tk))&&Pk(n,n.output,n.next_out,v-n.avail_out),E-=n.avail_in,v-=n.avail_out,n.total_in+=E,n.total_out+=v,t.total+=v,4&t.wrap&&v&&(n.adler=t.check=t.flags?Ki(t.check,o,v,n.next_out-v):lp(t.check,o,v,n.next_out-v)),n.data_type=t.bits+(t.last?64:0)+(t.mode===Ea?128:0)+(t.mode===H_||t.mode===n0?256:0),(E===0&&v===0||e===Tk)&&Q===kl&&(Q=k9),Q},ga={inflateReset:bk,inflateReset2:Ak,inflateResetKeep:wk,inflateInit:n=>Ok(n,15),inflateInit2:Ok,inflate:x9,inflateEnd:n=>{if(Ll(n))return ks;let e=n.state;return e.window&&(e.window=null),n.state=null,kl},inflateGetHeader:(n,e)=>{if(Ll(n))return ks;const t=n.state;return 2&t.wrap?(t.head=e,e.done=!1,kl):ks},inflateSetDictionary:(n,e)=>{const t=e.length;let i,o,a;return Ll(n)?ks:(i=n.state,i.wrap!==0&&i.mode!==W_?ks:i.mode===W_&&(o=1,o=lp(o,e,t,0),o!==i.check)?yk:(a=Pk(n,e,t,t),a?(i.mode=16210,Rk):(i.havedict=1,kl)))},inflateInfo:"pako inflate (from Nodeca project)"},U9=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Dk=Object.prototype.toString,{Z_NO_FLUSH:V9,Z_FINISH:F9,Z_OK:vp,Z_STREAM_END:o0,Z_NEED_DICT:a0,Z_STREAM_ERROR:j9,Z_DATA_ERROR:kk,Z_MEM_ERROR:B9}=eu;function Sp(n){this.options=U_.assign({chunkSize:65536,windowBits:15,to:""},n||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||n&&n.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&!(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new vk,this.strm.avail_out=0;let t=ga.inflateInit2(this.strm,e.windowBits);if(t!==vp)throw new Error(Ol[t]);if(this.header=new U9,ga.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=_p.string2buf(e.dictionary):Dk.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=ga.inflateSetDictionary(this.strm,e.dictionary),t!==vp)))throw new Error(Ol[t])}function c0(n,e){const t=new Sp(e);if(t.push(n),t.err)throw t.msg||Ol[t.err];return t.result}Sp.prototype.push=function(n,e){const t=this.strm,i=this.options.chunkSize,o=this.options.dictionary;let a,l,u;if(this.ended)return!1;for(l=e===~~e?e:e===!0?F9:V9,Dk.call(n)==="[object ArrayBuffer]"?t.input=new Uint8Array(n):t.input=n,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(i),t.next_out=0,t.avail_out=i),a=ga.inflate(t,l),a===a0&&o&&(a=ga.inflateSetDictionary(t,o),a===vp?a=ga.inflate(t,l):a===kk&&(a=a0));t.avail_in>0&&a===o0&&t.state.wrap>0&&n[t.next_in]!==0;)ga.inflateReset(t),a=ga.inflate(t,l);switch(a){case j9:case kk:case a0:case B9:return this.onEnd(a),this.ended=!0,!1}if(u=t.avail_out,t.next_out&&(t.avail_out===0||a===o0))if(this.options.to==="string"){let h=_p.utf8border(t.output,t.next_out),f=t.next_out-h,m=_p.buf2string(t.output,h);t.next_out=f,t.avail_out=i-f,f&&t.output.set(t.output.subarray(h,h+f),0),this.onData(m)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(a!==vp||u!==0){if(a===o0)return a=ga.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(t.avail_in===0)break}}return!0},Sp.prototype.onData=function(n){this.chunks.push(n)},Sp.prototype.onEnd=function(n){n===vp&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=U_.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};var G9={Inflate:Sp,inflate:c0,inflateRaw:function(n,e){return(e=e||{}).raw=!0,c0(n,e)},ungzip:c0,constants:eu};const{Deflate:ine,deflate:W9,deflateRaw:rne,gzip:sne}=C9,{Inflate:one,inflate:H9,inflateRaw:ane,ungzip:cne}=G9;var l0,K9=W9,z9=H9;(function(n){n[n.ONE_BYTE=0]="ONE_BYTE",n[n.TWO_BYTE=1]="TWO_BYTE"})(l0||(l0={}));class Y9{constructor(){S(this,"_sequence",0),S(this,"_startTime",Date.now()),S(this,"isUseOneByte",!0)}get startTime(){const e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e){const t={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){const u=new Uint8Array(4);u.set([1,0,0,0]);const h={id:0,length:4,data:u.buffer},f={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[h]};t.commonPacketHeader.extension=1,t.extension=f,t.payload=this.compress(e),t.commonPacketHeader.length=8+(t.extension.length+2)+t.payload.byteLength}else t.commonPacketHeader.length=8+t.payload.byteLength;V("SHOW_DATASTREAM2_LOG")&&y.debug("send data header: ".concat(JSON.stringify(t.commonPacketHeader)));const i=new ArrayBuffer(t.commonPacketHeader.length),o=new Uint8Array(i),a=new DataView(i);let l=0;if(a.setUint16(l,t.commonPacketHeader.extension<<15|t.commonPacketHeader.reserved<<14|t.commonPacketHeader.length,!0),l+=2,a.setUint32(l,t.commonPacketHeader.sequence,!0),l+=4,a.setUint16(l,t.commonStreamHeader,!0),l+=2,t.extension){const u=this.serializeExtension(t.extension);o.set(new Uint8Array(u),l),l+=u.byteLength}if(o.set(new Uint8Array(t.payload),l),l+=t.payload.byteLength,l!==t.commonPacketHeader.length)throw Error("serialize error!");return i}deserialize(e){if(e.byteLength<4)return new ArrayBuffer(0);const t=new DataView(e);let i=0;const o=t.getUint16(i,!0);i+=2;const a={length:16383&o,reserved:(16384&o)>>14,extension:(32768&o)>>15,sequence:t.getUint16(i+2,!0)<<16|t.getUint16(i,!0)};let l,u;if(i+=4,V("SHOW_DATASTREAM2_LOG")&&y.debug("receive data header: ".concat(JSON.stringify(a))),t.getUint16(i,!0),i+=2,a.extension){u=this.deserializeExtension(e.slice(i)),i+=2+u.length,l=e.slice(i);let h=!1;if(u.datas.length>0){const f=u.datas.find(m=>m.id===0);f&&(h=(1&new DataView(f.data).getUint32(0,!0))==1)}l=h?this.decompress(l):l}else l=e.slice(8);return l}serializeExtension(e){const{profile:t,length:i,datas:o}=e,a=new ArrayBuffer(i+2),l=new Uint8Array(a),u=new DataView(a);let h=0;if(u.setUint8(h++,t),u.setUint8(h++,i),o.forEach(f=>{t?(u.setUint8(h++,f.id),u.setUint8(h++,f.length),l.set(new Uint8Array(f.data),h),h+=f.data.byteLength):(u.setUint8(h++,f.id|f.length<<4),l.set(new Uint8Array(f.data),h),h+=f.data.byteLength)}),h!==i+2)throw Error("serialize extension error, is ".concat(h,"!==").concat(i+2));return a}deserializeExtension(e){const t=new DataView(e);let i=0;const o=t.getUint8(i);i++;const a=t.getUint8(i);i++;const l=o===l0.TWO_BYTE,u=[],h=new DataView(e,2);let f=0;for(;f<a;){let m=0,E=0,v=new ArrayBuffer(0);l?(m=h.getUint8(f),f++,E=h.getUint8(f),f++):(m=15&h.getUint8(f),E=h.getUint8(f)>>4,f++),E>0&&(v=h.buffer.slice(f+2,f+2+E),f+=v.byteLength),u.push({id:m,length:E,data:v})}if(f!==a)throw Error("parse error");return{profile:o,length:a,datas:u}}decompress(e){return z9(new Uint8Array(e))}compress(e){return K9(new Uint8Array(e))}}class Lk extends zt{constructor(e,t){super(),S(this,"_version",1),S(this,"_type",3),S(this,"_config",void 0),S(this,"_originDataChannel",void 0),S(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),S(this,"_dataStreamPacketHandler",void 0),S(this,"_datachannelEventMap",new Map),this._config=e,t&&(this._originDataChannel=t,this._bandDataChannelEvents(t)),this._initPacketHeader(),this._dataStreamPacketHandler=new Y9}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return V("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,t;return(e=(t=this._originDataChannel)===null||t===void 0?void 0:t.readyState)!==null&&e!==void 0?e:"connecting"}get _originDataChannelId(){var e,t;return(e=(t=this._originDataChannel)===null||t===void 0?void 0:t.id)!==null&&e!==void 0?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new X((e,t)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&e();const i=setTimeout(()=>{var o;t(new ne(N.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((o=this._originDataChannel)===null||o===void 0?void 0:o.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(i),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(i),new ne(N.DATACHANNEL_CONNECTION_TIMEOUT)}}else t(new ne(N.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){const e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[Xd.OPEN,Xd.CLOSE,Xd.ERROR].forEach(t=>{const i=()=>{this.emit(t)};this._datachannelEventMap.set(t,i),e.addEventListener(t,i)})}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach(t=>{let[i,o]=t;e.removeEventListener(i,o)}),this._datachannelEventMap.clear()}}class q9 extends Lk{constructor(e){super(e),S(this,"_messageListener",void 0),this._messageListener=t=>{if(t.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const i=t.data.slice(0,this._dataStreamPacketHeader.byteLength),o=new DataView(i).getUint8(3);if(o!==this.id)return void(V("SHOW_DATASTREAM2_LOG")&&y.debug("invalid datachannel id: ".concat(o," !== ").concat(this.id)));let a=t.data.slice(this._dataStreamPacketHeader.byteLength);a=this._dataStreamPacketHandler.deserialize(a),this.emit(Xd.MESSAGE,a)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Mk extends Lk{send(e){if(this._originDataChannel){let t=e;t=this._dataStreamPacketHandler.serialize(e);const i=new Uint8Array(this._dataStreamPacketHeader.byteLength+t.byteLength);i.set(new Uint8Array(this._dataStreamPacketHeader),0),i.set(new Uint8Array(t),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(i.buffer)}}}var J9=_,X9=On("iterator"),d0=!J9(function(){var n=new URL("b?a=1&b=2&c=3","http://a"),e=n.searchParams,t=new URLSearchParams("a=1&a=2"),i="";return n.pathname="c%20d",e.forEach(function(o,a){e.delete("b"),i+=a+o}),t.delete("a",2),!n.toJSON||!t.has("a",1)||t.has("a",2)||!e.size&&!0||!e.sort||n.href!=="http://a/c%20d?a=1&c=3"||e.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!e[X9]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||i!=="a1c3"||new URL("http://x",void 0).host!=="x"}),Q9=Xa,u0=Xt,ru=K,z_=We,Fo=L,su=Zt,xk=d0,Uk=Xa,$9=ym,Z9=function(n,e,t){for(var i in e)t&&t.unsafe&&n[i]?n[i]=e[i]:Q9(n,i,e[i],t);return n},eY=Qa,tY=uO,h0=Rd,Vk=ZS,p0=Ge,nY=Fn,iY=Ka,rY=Ja,sY=$r,Fk=_r,vr=Cs,oY=Ih,jk=zn,f0=qS,aY=Mm,ou=Fm,cY=HO,lY=On("iterator"),Tp="URLSearchParams",Bk=Tp+"Iterator",Gk=h0.set,Ls=h0.getterFor(Tp),dY=h0.getterFor(Bk),uY=Object.getOwnPropertyDescriptor,m0=function(n){if(!su)return ru[n];var e=uY(ru,n);return e&&e.value},Wk=m0("fetch"),Y_=m0("Request"),yp=m0("Headers"),_0=Y_&&Y_.prototype,Hk=yp&&yp.prototype,hY=ru.RegExp,pY=ru.TypeError,Kk=ru.decodeURIComponent,fY=ru.encodeURIComponent,mY=Fo("".charAt),zk=Fo([].join),Ml=Fo([].push),E0=Fo("".replace),_Y=Fo([].shift),Yk=Fo([].splice),qk=Fo("".split),EY=Fo("".slice),gY=/\+/g,Jk=Array(4),vY=function(n){return Jk[n-1]||(Jk[n-1]=hY("((?:%[\\da-f]{2}){"+n+"})","gi"))},SY=function(n){try{return Kk(n)}catch{return n}},Xk=function(n){var e=E0(n,gY," "),t=4;try{return Kk(e)}catch{for(;t;)e=E0(e,vY(t--),SY);return e}},TY=/[!'()~]|%20/g,yY={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},RY=function(n){return yY[n]},Qk=function(n){return E0(fY(n),TY,RY)},g0=tY(function(n,e){Gk(this,{type:Bk,iterator:f0(Ls(n).entries),kind:e})},"Iterator",function(){var n=dY(this),e=n.kind,t=n.iterator.next(),i=t.value;return t.done||(t.value=e==="keys"?i.key:e==="values"?i.value:[i.key,i.value]),t},!0),$k=function(n){this.entries=[],this.url=null,n!==void 0&&(Fk(n)?this.parseObject(n):this.parseQuery(typeof n=="string"?mY(n,0)==="?"?EY(n,1):n:vr(n)))};$k.prototype={type:Tp,bindURL:function(n){this.url=n,this.update()},parseObject:function(n){var e,t,i,o,a,l,u,h=aY(n);if(h)for(t=(e=f0(n,h)).next;!(i=z_(t,e)).done;){if(a=(o=f0(sY(i.value))).next,(l=z_(a,o)).done||(u=z_(a,o)).done||!z_(a,o).done)throw pY("Expected sequence with length 2");Ml(this.entries,{key:vr(l.value),value:vr(u.value)})}else for(var f in n)nY(n,f)&&Ml(this.entries,{key:f,value:vr(n[f])})},parseQuery:function(n){if(n)for(var e,t,i=qk(n,"&"),o=0;o<i.length;)(e=i[o++]).length&&(t=qk(e,"="),Ml(this.entries,{key:Xk(_Y(t)),value:Xk(zk(t,"="))}))},serialize:function(){for(var n,e=this.entries,t=[],i=0;i<e.length;)n=e[i++],Ml(t,Qk(n.key)+"="+Qk(n.value));return zk(t,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var q_=function(){Vk(this,au);var n=Gk(this,new $k(arguments.length>0?arguments[0]:void 0));su||(this.size=n.entries.length)},au=q_.prototype;if(Z9(au,{append:function(n,e){var t=Ls(this);ou(arguments.length,2),Ml(t.entries,{key:vr(n),value:vr(e)}),su||this.length++,t.updateURL()},delete:function(n){for(var e=Ls(this),t=ou(arguments.length,1),i=e.entries,o=vr(n),a=t<2?void 0:arguments[1],l=a===void 0?a:vr(a),u=0;u<i.length;){var h=i[u];if(h.key!==o||l!==void 0&&h.value!==l)u++;else if(Yk(i,u,1),l!==void 0)break}su||(this.size=i.length),e.updateURL()},get:function(n){var e=Ls(this).entries;ou(arguments.length,1);for(var t=vr(n),i=0;i<e.length;i++)if(e[i].key===t)return e[i].value;return null},getAll:function(n){var e=Ls(this).entries;ou(arguments.length,1);for(var t=vr(n),i=[],o=0;o<e.length;o++)e[o].key===t&&Ml(i,e[o].value);return i},has:function(n){for(var e=Ls(this).entries,t=ou(arguments.length,1),i=vr(n),o=t<2?void 0:arguments[1],a=o===void 0?o:vr(o),l=0;l<e.length;){var u=e[l++];if(u.key===i&&(a===void 0||u.value===a))return!0}return!1},set:function(n,e){var t=Ls(this);ou(arguments.length,1);for(var i,o=t.entries,a=!1,l=vr(n),u=vr(e),h=0;h<o.length;h++)(i=o[h]).key===l&&(a?Yk(o,h--,1):(a=!0,i.value=u));a||Ml(o,{key:l,value:u}),su||(this.size=o.length),t.updateURL()},sort:function(){var n=Ls(this);cY(n.entries,function(e,t){return e.key>t.key?1:-1}),n.updateURL()},forEach:function(n){for(var e,t=Ls(this).entries,i=iY(n,arguments.length>1?arguments[1]:void 0),o=0;o<t.length;)i((e=t[o++]).value,e.key,this)},keys:function(){return new g0(this,"keys")},values:function(){return new g0(this,"values")},entries:function(){return new g0(this,"entries")}},{enumerable:!0}),Uk(au,lY,au.entries,{name:"entries"}),Uk(au,"toString",function(){return Ls(this).serialize()},{enumerable:!0}),su&&$9(au,"size",{get:function(){return Ls(this).entries.length},configurable:!0,enumerable:!0}),eY(q_,Tp),u0({global:!0,constructor:!0,forced:!xk},{URLSearchParams:q_}),!xk&&p0(yp)){var CY=Fo(Hk.has),IY=Fo(Hk.set),Zk=function(n){if(Fk(n)){var e,t=n.body;if(rY(t)===Tp)return e=n.headers?new yp(n.headers):new yp,CY(e,"content-type")||IY(e,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),oY(n,{body:jk(0,vr(t)),headers:jk(0,e)})}return n};if(p0(Wk)&&u0({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(n){return Wk(n,arguments.length>1?Zk(arguments[1]):{})}}),p0(Y_)){var v0=function(n){return Vk(this,_0),new Y_(n,arguments.length>1?Zk(arguments[1]):{})};_0.constructor=v0,v0.prototype=_0,u0({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:v0})}}var Ms,wY={URLSearchParams:q_,getState:Ls},eL=Zt,bY=L,AY=We,OY=_,S0=Em,NY=wh,PY=ct,DY=Mi,kY=ud,cu=Object.assign,tL=Object.defineProperty,LY=bY([].concat),MY=!cu||OY(function(){if(eL&&cu({b:1},cu(tL({},"a",{enumerable:!0,get:function(){tL(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var n={},e={},t=Symbol(),i="abcdefghijklmnopqrst";return n[t]=7,i.split("").forEach(function(o){e[o]=o}),cu({},n)[t]!=7||S0(cu({},e)).join("")!=i})?function(n,e){for(var t=DY(n),i=arguments.length,o=1,a=NY.f,l=PY.f;i>o;)for(var u,h=kY(arguments[o++]),f=a?LY(S0(h),a(h)):S0(h),m=f.length,E=0;m>E;)u=f[E++],eL&&!AY(l,h,u)||(t[u]=h[u]);return t}:cu,xY=$r,UY=cN,VY=Ka,FY=We,jY=Mi,BY=function(n,e,t,i){try{return i?e(xY(t)[0],t[1]):e(t)}catch(o){UY(n,"throw",o)}},GY=sN,WY=lS,HY=Ya,nL=oS,KY=qS,zY=Mm,iL=Array,xl=L,T0=2147483647,YY=/[^\0-\u007E]/,rL=/[.\u3002\uFF0E\uFF61]/g,sL="Overflow: input needs wider integers to process",oL=RangeError,qY=xl(rL.exec),lu=Math.floor,y0=String.fromCharCode,aL=xl("".charCodeAt),cL=xl([].join),Rc=xl([].push),JY=xl("".replace),XY=xl("".split),QY=xl("".toLowerCase),lL=function(n){return n+22+75*(n<26)},$Y=function(n,e,t){var i=0;for(n=t?lu(n/700):n>>1,n+=lu(n/e);n>455;)n=lu(n/35),i+=36;return lu(i+36*n/(n+38))},ZY=function(n){var e=[];n=function(D){for(var M=[],B=0,J=D.length;B<J;){var G=aL(D,B++);if(G>=55296&&G<=56319&&B<J){var q=aL(D,B++);(64512&q)==56320?Rc(M,((1023&G)<<10)+(1023&q)+65536):(Rc(M,G),B--)}else Rc(M,G)}return M}(n);var t,i,o=n.length,a=128,l=0,u=72;for(t=0;t<n.length;t++)(i=n[t])<128&&Rc(e,y0(i));var h=e.length,f=h;for(h&&Rc(e,"-");f<o;){var m=T0;for(t=0;t<n.length;t++)(i=n[t])>=a&&i<m&&(m=i);var E=f+1;if(m-a>lu((T0-l)/E))throw oL(sL);for(l+=(m-a)*E,a=m,t=0;t<n.length;t++){if((i=n[t])<a&&++l>T0)throw oL(sL);if(i==a){for(var v=l,T=36;;){var A=T<=u?1:T>=u+26?26:T-u;if(v<A)break;var C=v-A,b=36-A;Rc(e,y0(lL(A+C%b))),v=lu(C/b),T+=36}Rc(e,y0(lL(v))),u=$Y(l,E,f==h),l=0,f++}}l++,a++}return cL(e,"")},e7=Xt,R0=Zt,t7=d0,C0=K,dL=Ka,xs=L,J_=Xa,Us=ym,n7=ZS,I0=Fn,w0=MY,du=function(n){var e=jY(n),t=WY(this),i=arguments.length,o=i>1?arguments[1]:void 0,a=o!==void 0;a&&(o=VY(o,i>2?arguments[2]:void 0));var l,u,h,f,m,E,v=zY(e),T=0;if(!v||this===iL&&GY(v))for(l=HY(e),u=t?new this(l):iL(l);l>T;T++)E=a?o(e[T],T):e[T],nL(u,T,E);else for(m=(f=KY(e,v)).next,u=t?new this:[];!(h=FY(m,f)).done;T++)E=a?BY(f,o,[h.value,T],!0):h.value,nL(u,T,E);return u.length=T,u},so=_S,i7=UO.codeAt,r7=function(n){var e,t,i=[],o=XY(JY(QY(n),rL,"."),".");for(e=0;e<o.length;e++)t=o[e],Rc(i,qY(YY,t)?"xn--"+ZY(t):t);return cL(i,".")},va=Cs,s7=Qa,o7=Fm,uL=wY,hL=Rd,a7=hL.set,X_=hL.getterFor("URL"),c7=uL.URLSearchParams,l7=uL.getState,Rp=C0.URL,b0=C0.TypeError,Q_=C0.parseInt,d7=Math.floor,pL=Math.pow,Vs=xs("".charAt),oo=xs(/./.exec),Cp=xs([].join),u7=xs(1 .toString),h7=xs([].pop),uu=xs([].push),A0=xs("".replace),p7=xs([].shift),f7=xs("".split),Ip=xs("".slice),$_=xs("".toLowerCase),m7=xs([].unshift),O0="Invalid scheme",Ul="Invalid host",fL="Invalid port",mL=/[a-z]/i,_7=/[\d+-.a-z]/i,N0=/\d/,E7=/^0x/i,g7=/^[0-7]+$/,v7=/^\d+$/,_L=/^[\da-f]+$/i,S7=/[\0\t\n\r #%/:<>?@[\\\]^|]/,T7=/[\0\t\n\r #/:<>?@[\\\]^|]/,y7=/^[\u0000-\u0020]+/,R7=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,C7=/[\t\n\r]/g,wp=function(n){var e,t,i,o;if(typeof n=="number"){for(e=[],t=0;t<4;t++)m7(e,n%256),n=d7(n/256);return Cp(e,".")}if(typeof n=="object"){for(e="",i=function(a){for(var l=null,u=1,h=null,f=0,m=0;m<8;m++)a[m]!==0?(f>u&&(l=h,u=f),h=null,f=0):(h===null&&(h=m),++f);return f>u&&(l=h,u=f),l}(n),t=0;t<8;t++)o&&n[t]===0||(o&&(o=!1),i===t?(e+=t?":":"::",o=!0):(e+=u7(n[t],16),t<7&&(e+=":")));return"["+e+"]"}return n},Z_={},EL=w0({},Z_,{" ":1,'"':1,"<":1,">":1,"`":1}),gL=w0({},EL,{"#":1,"?":1,"{":1,"}":1}),P0=w0({},gL,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Cc=function(n,e){var t=i7(n,0);return t>32&&t<127&&!I0(e,n)?n:encodeURIComponent(n)},eE={ftp:21,file:null,http:80,https:443,ws:80,wss:443},bp=function(n,e){var t;return n.length==2&&oo(mL,Vs(n,0))&&((t=Vs(n,1))==":"||!e&&t=="|")},vL=function(n){var e;return n.length>1&&bp(Ip(n,0,2))&&(n.length==2||(e=Vs(n,2))==="/"||e==="\\"||e==="?"||e==="#")},I7=function(n){return n==="."||$_(n)==="%2e"},D0={},SL={},k0={},TL={},yL={},L0={},RL={},CL={},tE={},nE={},M0={},x0={},U0={},V0={},IL={},F0={},hu={},jo={},wL={},Vl={},Sa={},j0=function(n,e,t){var i,o,a,l=va(n);if(e){if(o=this.parse(l))throw b0(o);this.searchParams=null}else{if(t!==void 0&&(i=new j0(t,!0)),o=this.parse(l,null,i))throw b0(o);(a=l7(new c7)).bindURL(this),this.searchParams=a}};j0.prototype={type:"URL",parse:function(n,e,t){var i,o,a,l,u,h=this,f=e||D0,m=0,E="",v=!1,T=!1,A=!1;for(n=va(n),e||(h.scheme="",h.username="",h.password="",h.host=null,h.port=null,h.path=[],h.query=null,h.fragment=null,h.cannotBeABaseURL=!1,n=A0(n,y7,""),n=A0(n,R7,"$1")),n=A0(n,C7,""),i=du(n);m<=i.length;){switch(o=i[m],f){case D0:if(!o||!oo(mL,o)){if(e)return O0;f=k0;continue}E+=$_(o),f=SL;break;case SL:if(o&&(oo(_7,o)||o=="+"||o=="-"||o=="."))E+=$_(o);else{if(o!=":"){if(e)return O0;E="",f=k0,m=0;continue}if(e&&(h.isSpecial()!=I0(eE,E)||E=="file"&&(h.includesCredentials()||h.port!==null)||h.scheme=="file"&&!h.host))return;if(h.scheme=E,e)return void(h.isSpecial()&&eE[h.scheme]==h.port&&(h.port=null));E="",h.scheme=="file"?f=V0:h.isSpecial()&&t&&t.scheme==h.scheme?f=TL:h.isSpecial()?f=CL:i[m+1]=="/"?(f=yL,m++):(h.cannotBeABaseURL=!0,uu(h.path,""),f=wL)}break;case k0:if(!t||t.cannotBeABaseURL&&o!="#")return O0;if(t.cannotBeABaseURL&&o=="#"){h.scheme=t.scheme,h.path=so(t.path),h.query=t.query,h.fragment="",h.cannotBeABaseURL=!0,f=Sa;break}f=t.scheme=="file"?V0:L0;continue;case TL:if(o!="/"||i[m+1]!="/"){f=L0;continue}f=tE,m++;break;case yL:if(o=="/"){f=nE;break}f=jo;continue;case L0:if(h.scheme=t.scheme,o==Ms)h.username=t.username,h.password=t.password,h.host=t.host,h.port=t.port,h.path=so(t.path),h.query=t.query;else if(o=="/"||o=="\\"&&h.isSpecial())f=RL;else if(o=="?")h.username=t.username,h.password=t.password,h.host=t.host,h.port=t.port,h.path=so(t.path),h.query="",f=Vl;else{if(o!="#"){h.username=t.username,h.password=t.password,h.host=t.host,h.port=t.port,h.path=so(t.path),h.path.length--,f=jo;continue}h.username=t.username,h.password=t.password,h.host=t.host,h.port=t.port,h.path=so(t.path),h.query=t.query,h.fragment="",f=Sa}break;case RL:if(!h.isSpecial()||o!="/"&&o!="\\"){if(o!="/"){h.username=t.username,h.password=t.password,h.host=t.host,h.port=t.port,f=jo;continue}f=nE}else f=tE;break;case CL:if(f=tE,o!="/"||Vs(E,m+1)!="/")continue;m++;break;case tE:if(o!="/"&&o!="\\"){f=nE;continue}break;case nE:if(o=="@"){v&&(E="%40"+E),v=!0,a=du(E);for(var C=0;C<a.length;C++){var b=a[C];if(b!=":"||A){var D=Cc(b,P0);A?h.password+=D:h.username+=D}else A=!0}E=""}else if(o==Ms||o=="/"||o=="?"||o=="#"||o=="\\"&&h.isSpecial()){if(v&&E=="")return"Invalid authority";m-=du(E).length+1,E="",f=M0}else E+=o;break;case M0:case x0:if(e&&h.scheme=="file"){f=F0;continue}if(o!=":"||T){if(o==Ms||o=="/"||o=="?"||o=="#"||o=="\\"&&h.isSpecial()){if(h.isSpecial()&&E=="")return Ul;if(e&&E==""&&(h.includesCredentials()||h.port!==null))return;if(l=h.parseHost(E))return l;if(E="",f=hu,e)return;continue}o=="["?T=!0:o=="]"&&(T=!1),E+=o}else{if(E=="")return Ul;if(l=h.parseHost(E))return l;if(E="",f=U0,e==x0)return}break;case U0:if(!oo(N0,o)){if(o==Ms||o=="/"||o=="?"||o=="#"||o=="\\"&&h.isSpecial()||e){if(E!=""){var M=Q_(E,10);if(M>65535)return fL;h.port=h.isSpecial()&&M===eE[h.scheme]?null:M,E=""}if(e)return;f=hu;continue}return fL}E+=o;break;case V0:if(h.scheme="file",o=="/"||o=="\\")f=IL;else{if(!t||t.scheme!="file"){f=jo;continue}if(o==Ms)h.host=t.host,h.path=so(t.path),h.query=t.query;else if(o=="?")h.host=t.host,h.path=so(t.path),h.query="",f=Vl;else{if(o!="#"){vL(Cp(so(i,m),""))||(h.host=t.host,h.path=so(t.path),h.shortenPath()),f=jo;continue}h.host=t.host,h.path=so(t.path),h.query=t.query,h.fragment="",f=Sa}}break;case IL:if(o=="/"||o=="\\"){f=F0;break}t&&t.scheme=="file"&&!vL(Cp(so(i,m),""))&&(bp(t.path[0],!0)?uu(h.path,t.path[0]):h.host=t.host),f=jo;continue;case F0:if(o==Ms||o=="/"||o=="\\"||o=="?"||o=="#"){if(!e&&bp(E))f=jo;else if(E==""){if(h.host="",e)return;f=hu}else{if(l=h.parseHost(E))return l;if(h.host=="localhost"&&(h.host=""),e)return;E="",f=hu}continue}E+=o;break;case hu:if(h.isSpecial()){if(f=jo,o!="/"&&o!="\\")continue}else if(e||o!="?")if(e||o!="#"){if(o!=Ms&&(f=jo,o!="/"))continue}else h.fragment="",f=Sa;else h.query="",f=Vl;break;case jo:if(o==Ms||o=="/"||o=="\\"&&h.isSpecial()||!e&&(o=="?"||o=="#")){if((u=$_(u=E))===".."||u==="%2e."||u===".%2e"||u==="%2e%2e"?(h.shortenPath(),o=="/"||o=="\\"&&h.isSpecial()||uu(h.path,"")):I7(E)?o=="/"||o=="\\"&&h.isSpecial()||uu(h.path,""):(h.scheme=="file"&&!h.path.length&&bp(E)&&(h.host&&(h.host=""),E=Vs(E,0)+":"),uu(h.path,E)),E="",h.scheme=="file"&&(o==Ms||o=="?"||o=="#"))for(;h.path.length>1&&h.path[0]==="";)p7(h.path);o=="?"?(h.query="",f=Vl):o=="#"&&(h.fragment="",f=Sa)}else E+=Cc(o,gL);break;case wL:o=="?"?(h.query="",f=Vl):o=="#"?(h.fragment="",f=Sa):o!=Ms&&(h.path[0]+=Cc(o,Z_));break;case Vl:e||o!="#"?o!=Ms&&(o=="'"&&h.isSpecial()?h.query+="%27":h.query+=o=="#"?"%23":Cc(o,Z_)):(h.fragment="",f=Sa);break;case Sa:o!=Ms&&(h.fragment+=Cc(o,EL))}m++}},parseHost:function(n){var e,t,i;if(Vs(n,0)=="["){if(Vs(n,n.length-1)!="]"||(e=function(o){var a,l,u,h,f,m,E,v=[0,0,0,0,0,0,0,0],T=0,A=null,C=0,b=function(){return Vs(o,C)};if(b()==":"){if(Vs(o,1)!=":")return;C+=2,A=++T}for(;b();){if(T==8)return;if(b()!=":"){for(a=l=0;l<4&&oo(_L,b());)a=16*a+Q_(b(),16),C++,l++;if(b()=="."){if(l==0||(C-=l,T>6))return;for(u=0;b();){if(h=null,u>0){if(!(b()=="."&&u<4))return;C++}if(!oo(N0,b()))return;for(;oo(N0,b());){if(f=Q_(b(),10),h===null)h=f;else{if(h==0)return;h=10*h+f}if(h>255)return;C++}v[T]=256*v[T]+h,++u!=2&&u!=4||T++}if(u!=4)return;break}if(b()==":"){if(C++,!b())return}else if(b())return;v[T++]=a}else{if(A!==null)return;C++,A=++T}}if(A!==null)for(m=T-A,T=7;T!=0&&m>0;)E=v[T],v[T--]=v[A+m-1],v[A+--m]=E;else if(T!=8)return;return v}(Ip(n,1,-1)),!e))return Ul;this.host=e}else if(this.isSpecial()){if(n=r7(n),oo(S7,n)||(e=function(o){var a,l,u,h,f,m,E,v=f7(o,".");if(v.length&&v[v.length-1]==""&&v.length--,(a=v.length)>4)return o;for(l=[],u=0;u<a;u++){if((h=v[u])=="")return o;if(f=10,h.length>1&&Vs(h,0)=="0"&&(f=oo(E7,h)?16:8,h=Ip(h,f==8?1:2)),h==="")m=0;else{if(!oo(f==10?v7:f==8?g7:_L,h))return o;m=Q_(h,f)}uu(l,m)}for(u=0;u<a;u++)if(m=l[u],u==a-1){if(m>=pL(256,5-a))return null}else if(m>255)return null;for(E=h7(l),u=0;u<l.length;u++)E+=l[u]*pL(256,3-u);return E}(n),e===null))return Ul;this.host=e}else{if(oo(T7,n))return Ul;for(e="",t=du(n),i=0;i<t.length;i++)e+=Cc(t[i],Z_);this.host=e}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return I0(eE,this.scheme)},shortenPath:function(){var n=this.path,e=n.length;!e||this.scheme=="file"&&e==1&&bp(n[0],!0)||n.length--},serialize:function(){var n=this,e=n.scheme,t=n.username,i=n.password,o=n.host,a=n.port,l=n.path,u=n.query,h=n.fragment,f=e+":";return o!==null?(f+="//",n.includesCredentials()&&(f+=t+(i?":"+i:"")+"@"),f+=wp(o),a!==null&&(f+=":"+a)):e=="file"&&(f+="//"),f+=n.cannotBeABaseURL?l[0]:l.length?"/"+Cp(l,"/"):"",u!==null&&(f+="?"+u),h!==null&&(f+="#"+h),f},setHref:function(n){var e=this.parse(n);if(e)throw b0(e);this.searchParams.update()},getOrigin:function(){var n=this.scheme,e=this.port;if(n=="blob")try{return new pu(n.path[0]).origin}catch{return"null"}return n!="file"&&this.isSpecial()?n+"://"+wp(this.host)+(e!==null?":"+e:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(n){this.parse(va(n)+":",D0)},getUsername:function(){return this.username},setUsername:function(n){var e=du(va(n));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var t=0;t<e.length;t++)this.username+=Cc(e[t],P0)}},getPassword:function(){return this.password},setPassword:function(n){var e=du(va(n));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var t=0;t<e.length;t++)this.password+=Cc(e[t],P0)}},getHost:function(){var n=this.host,e=this.port;return n===null?"":e===null?wp(n):wp(n)+":"+e},setHost:function(n){this.cannotBeABaseURL||this.parse(n,M0)},getHostname:function(){var n=this.host;return n===null?"":wp(n)},setHostname:function(n){this.cannotBeABaseURL||this.parse(n,x0)},getPort:function(){var n=this.port;return n===null?"":va(n)},setPort:function(n){this.cannotHaveUsernamePasswordPort()||((n=va(n))==""?this.port=null:this.parse(n,U0))},getPathname:function(){var n=this.path;return this.cannotBeABaseURL?n[0]:n.length?"/"+Cp(n,"/"):""},setPathname:function(n){this.cannotBeABaseURL||(this.path=[],this.parse(n,hu))},getSearch:function(){var n=this.query;return n?"?"+n:""},setSearch:function(n){(n=va(n))==""?this.query=null:(Vs(n,0)=="?"&&(n=Ip(n,1)),this.query="",this.parse(n,Vl)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var n=this.fragment;return n?"#"+n:""},setHash:function(n){(n=va(n))!=""?(Vs(n,0)=="#"&&(n=Ip(n,1)),this.fragment="",this.parse(n,Sa)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var pu=function(n){var e=n7(this,Sr),t=o7(arguments.length,1)>1?arguments[1]:void 0,i=a7(e,new j0(n,!1,t));R0||(e.href=i.serialize(),e.origin=i.getOrigin(),e.protocol=i.getProtocol(),e.username=i.getUsername(),e.password=i.getPassword(),e.host=i.getHost(),e.hostname=i.getHostname(),e.port=i.getPort(),e.pathname=i.getPathname(),e.search=i.getSearch(),e.searchParams=i.getSearchParams(),e.hash=i.getHash())},Sr=pu.prototype,Fs=function(n,e){return{get:function(){return X_(this)[n]()},set:e&&function(t){return X_(this)[e](t)},configurable:!0,enumerable:!0}};if(R0&&(Us(Sr,"href",Fs("serialize","setHref")),Us(Sr,"origin",Fs("getOrigin")),Us(Sr,"protocol",Fs("getProtocol","setProtocol")),Us(Sr,"username",Fs("getUsername","setUsername")),Us(Sr,"password",Fs("getPassword","setPassword")),Us(Sr,"host",Fs("getHost","setHost")),Us(Sr,"hostname",Fs("getHostname","setHostname")),Us(Sr,"port",Fs("getPort","setPort")),Us(Sr,"pathname",Fs("getPathname","setPathname")),Us(Sr,"search",Fs("getSearch","setSearch")),Us(Sr,"searchParams",Fs("getSearchParams")),Us(Sr,"hash",Fs("getHash","setHash"))),J_(Sr,"toJSON",function(){return X_(this).serialize()},{enumerable:!0}),J_(Sr,"toString",function(){return X_(this).serialize()},{enumerable:!0}),Rp){var bL=Rp.createObjectURL,AL=Rp.revokeObjectURL;bL&&J_(pu,"createObjectURL",dL(bL,Rp)),AL&&J_(pu,"revokeObjectURL",dL(AL,Rp))}s7(pu,"URL"),e7({global:!0,constructor:!0,forced:!t7,sham:!R0},{URL:pu});var w7=Xt,b7=_,A7=Fm,OL=Cs,O7=d0,NL=Li("URL");w7({target:"URL",stat:!0,forced:!(O7&&b7(function(){NL.canParse()}))},{canParse:function(n){var e=A7(arguments.length,1),t=OL(n),i=e<2||arguments[1]===void 0?void 0:OL(arguments[1]);try{return!!new NL(t,i)}catch{return!1}}});var PL=p(Ss.URL);function iE(){const n=new Blob([atob("ZnVuY3Rpb24gZShlKXtjb25zdCB0PW5ldyBEYXRhVmlldyhlLmRhdGEpO2lmKDA9PT10LmdldFVpbnQ4KDApJiYwPT09dC5nZXRVaW50OCgxKSYmMD09PXQuZ2V0VWludDgoMikmJjE9PT10LmdldFVpbnQ4KDMpJiY2PT09dC5nZXRVaW50OCg0KSl7bGV0IG49NixyPTAsbz0wO2Zvcig7MjU1PT09KG89dC5nZXRVaW50OChuKyspKTspcis9MjU1O3IrPW87Y29uc3QgYT1mdW5jdGlvbihlLHQsbil7bGV0IHI9bmV3IFVpbnQ4QXJyYXkoZSx0LG4pLG89W10sYT0wO2Zvcig7YTxuOylhKzM8biYmMD09PXJbYV0mJjA9PT1yW2ErMV0mJjM9PT1yW2ErMl0mJigwPT09clthKzNdfHwxPT09clthKzNdfHwyPT09clthKzNdfHwzPT09clthKzNdKT8oby5wdXNoKHJbYV0sclthKzFdLHJbYSszXSksYSs9NCk6KG8ucHVzaChyW2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShvKX0oZS5kYXRhLG4scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGEpfXJldHVybiBudWxsfWZ1bmN0aW9uIHQoZSx0KXtjb25zdCBuPWZ1bmN0aW9uKGUpe2NvbnN0IHQ9ZS5sZW5ndGg7bGV0IG49W10scj0wO2Zvcig7cjx0OylyKzI8dCYmMD09PWVbcl0mJjA9PT1lW3IrMV0mJigwPT09ZVtyKzJdfHwxPT09ZVtyKzJdfHwyPT09ZVtyKzJdfHwzPT09ZVtyKzJdKT8obi5wdXNoKGVbcl0sZVtyKzFdLDMsZVtyKzJdKSxyKz0zKToobi5wdXNoKGVbcl0pLHIrKyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KG4pfSh0KSxyPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihyLzI1NSksYT1yJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK3IrZS5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBpPTA7Zm9yKDtpPG87KXNbNitpXT0yNTUsaSsrO3JldHVybiBzWzYraV09YSxpKysscy5zZXQobiw2K2kpLHMuc2V0KG5ldyBVaW50OEFycmF5KGUpLDYraStyKSxzLmJ1ZmZlcn1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIlNhZmFyaSIpPi0xJiYtMT09PW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiQ2hyb21lIikmJihzZWxmLm9ucnRjdHJhbnNmb3JtPW49Pntjb25zdCByPW4udHJhbnNmb3JtZXI7bGV0IG89W107ci5vcHRpb25zLnBvcnQub25tZXNzYWdlPWU9PntlLmRhdGEuc2VpJiZvLnB1c2goZS5kYXRhLnNlaSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBhPXIucmVhZGFibGUuZ2V0UmVhZGVyKCkscz1yLndyaXRhYmxlLmdldFdyaXRlcigpOyJyeCI9PT1yLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2EucmVhZCgpLnRoZW4oKHI9PntpZighci5kb25lKXtpZihyLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZShyLnZhbHVlKTt0JiZuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7c2VpOnR9KX1zLndyaXRlKHIudmFsdWUpLG4ub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQobil9fSkpfShyKToidHgiPT09ci5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIGUobil7YS5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgZT1vLnNoaWZ0KCk7ZSYmKHIudmFsdWUuZGF0YT10KHIudmFsdWUuZGF0YSxlKSl9cy53cml0ZShyLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0ocil9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKSk7Cg==")],{type:"text/javascript"});return setTimeout(()=>PL.revokeObjectURL(n),0),new Worker(PL.createObjectURL(n))}const rE=new Map,sE=new Map;async function N7(n){if(!mt().supportWebRTCEncodedTransform)return void y.warning("browser not support audio encoded transform");if(sE.has(n))return;const e={track:n.track};if(ra()){if(!n.createEncodedStreams)return void y.warning("browser not support createEncodedStreams() API");let i=null;try{i=n.createEncodedStreams()}catch(a){return void y.error("create audio-encoded-streams error",a&&a.message)}const o=new TransformStream({transform(a,l){e.controller||(e.controller=l),n.track&&n.track.id!==e.track.id&&(y.debug("audio track changed: ".concat(e.track.id," => ").concat(n.track.id)),e.track.removeEventListener("ended",t),e.track=n.track,e.track.addEventListener("ended",t)),l.enqueue(a)}});i.readable.pipeThrough(o).pipeTo(i.writable)}else if(ii()){if(typeof RTCRtpScriptTransform>"u")return void y.warning("browser not support RTCRtpScriptTransform");const i=iE(),o=new MessageChannel;await new X(l=>i.onmessage=u=>{u.data==="registered"&&l(void 0)});const a=new RTCRtpScriptTransform(i,{name:"rx",port:o.port2},[o.port2]);n.transform=a,await new X(l=>i.onmessage=u=>{u.data==="started"&&l(void 0)}),o.port1.onmessage=l=>{var u;l.data.transformed&&n.track&&((u=n.track)===null||u===void 0?void 0:u.id)!==e.track.id&&(y.debug("audio track changed: ".concat(e.track.id," => ").concat(n.track.id)),e.track.removeEventListener("ended",t),e.track=n.track,e.track.addEventListener("ended",t))},e.worker=i}function t(){n.track.removeEventListener("ended",t),function(i){const o=sE.get(i);if(o){sE.delete(i);try{var a,l;(a=o.controller)===null||a===void 0||a.terminate(),(l=o.worker)===null||l===void 0||l.terminate()}catch(u){y.warning(u&&u.message)}}}(n)}sE.set(n,e),n.track.addEventListener("ended",t)}function P7(n){const e=new DataView(n.data);if(e.getUint8(0)===0&&e.getUint8(1)===0&&e.getUint8(2)===0&&e.getUint8(3)===1&&e.getUint8(4)===6){let t=6,i=0,o=0;for(;(o=e.getUint8(t++))===255;)i+=255;i+=o;const a=function(l,u,h){let f=new Uint8Array(l,u,h),m=[],E=0;for(;E<h;)E+3<h&&f[E]===0&&f[E+1]===0&&f[E+2]===3&&(f[E+3]===0||f[E+3]===1||f[E+3]===2||f[E+3]===3)?(m.push(f[E],f[E+1],f[E+3]),E+=4):(m.push(f[E]),E++);return new Uint8Array(m)}(n.data,t,i);return new Uint8Array(a)}return null}function D7(n,e){const t=function(h){const f=h.length;let m=[],E=0;for(;E<f;)E+2<f&&h[E]===0&&h[E+1]===0&&(h[E+2]===0||h[E+2]===1||h[E+2]===2||h[E+2]===3)?(m.push(h[E],h[E+1],3,h[E+2]),E+=3):(m.push(h[E]),E++);return new Uint8Array(m)}(e),i=t.length,o=Math.floor(i/255),a=i%255,l=new Uint8Array(6+o+1+i+n.byteLength);l[0]=0,l[1]=0,l[2]=0,l[3]=1,l[4]=6,l[5]=101;let u=0;for(;u<o;)l[6+u]=255,u++;return l[6+u]=a,u++,l.set(t,6+u),l.set(new Uint8Array(n),6+u+i),l.buffer}const oE=new Map,Ap=new Map;async function k7(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!mt().supportWebRTCEncodedTransform)return void y.warning("browser not support video encoded transform");if(!n.track)return;if(Ap.has(n)){const o=Ap.get(n);return void(o&&(o.onSei=e.onSei))}const t={track:n.track,onSei:e.onSei};if(ra()){if(!n.createEncodedStreams)return void y.warning("browser not support createEncodedStreams() API");let o=null;try{o=n.createEncodedStreams()}catch(l){return void y.error("create video-encoded-streams error",l&&l.message)}const a=new TransformStream({transform(l,u){t.controller||(t.controller=u),n.track&&n.track.id!==t.track.id&&(y.debug("video track changed: ".concat(t.track.id," => ").concat(n.track.id)),t.track.removeEventListener("ended",i),t.track=n.track,t.track.addEventListener("ended",i));const h=P7(l);h&&t.onSei&&t.onSei(h),u.enqueue(l)}});o.readable.pipeThrough(a).pipeTo(o.writable)}else if(ii()){if(typeof RTCRtpScriptTransform>"u")return void y.warning("browser not support RTCRtpScriptTransform");const o=iE(),a=new MessageChannel;await new X(u=>o.onmessage=h=>{h.data==="registered"&&u(void 0)});const l=new RTCRtpScriptTransform(o,{name:"rx",port:a.port2},[a.port2]);n.transform=l,await new X(u=>o.onmessage=h=>{h.data==="started"&&u(void 0)}),a.port1.onmessage=u=>{var h;u.data.transformed&&n.track&&((h=n.track)===null||h===void 0?void 0:h.id)!==t.track.id?(y.debug("video track changed: ".concat(t.track.id," => ").concat(n.track.id)),t.track.removeEventListener("ended",i),t.track=n.track,t.track.addEventListener("ended",i)):u.data.sei&&t.onSei&&t.onSei(u.data.sei)},t.worker=o}function i(){if(n.track){if(this.id!==n.track.id)return;n.track.removeEventListener("ended",i)}(function(o){const a=Ap.get(o);if(a){Ap.delete(o);try{var l,u;(l=a.controller)===null||l===void 0||l.terminate(),(u=a.worker)===null||u===void 0||u.terminate()}catch(h){y.warning(h&&h.message)}}})(n)}Ap.set(n,t),n.track.addEventListener("ended",i)}(function(){const n=ft();bi.getDisplayMedia=function(e){return!!(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)}(),bi.getStreamFromExtension=n.name===St.CHROME&&Number(n.version)>34,bi.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const e=new RTCPeerConnection;let t=!1;try{e.addTransceiver("audio"),t=!0}catch{}return e.close(),t}(),bi.supportMinBitrate=n.name===St.CHROME||n.name===St.EDGE,bi.supportSetRtpSenderParameters=function(){const e=ft();return!window.RTCRtpSender||!window.RTCRtpSender.prototype.setParameters||!window.RTCRtpSender.prototype.getParameters?!1:!!nc()||!(!ii()&&!Jm())||e.name===St.FIREFOX&&Number(e.version)>=64}(),n.name===St.SAFARI&&(Number(n.version)>=14?bi.supportDualStream=!0:bi.supportDualStream=!1),bi.webAudioMediaStreamDest=function(){const e=ft();return!(e.name===St.SAFARI&&Number(e.version)<12)}(),bi.supportReplaceTrack=function(){return window.RTCRtpSender?typeof RTCRtpSender.prototype.replaceTrack=="function":!1}(),bi.supportWebGL=typeof WebGLRenderingContext<"u",bi.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,nc()||(bi.webAudioWithAEC=!0),bi.supportShareAudio=function(){const e=ft();return(e.os===Nn.WIN_10||e.os===Nn.WIN_81||e.os===Nn.WIN_7||e.os===Nn.LINUX||e.os===Nn.MAC_OS||e.os===Nn.CHROMIUM_OS)&&e.name===St.CHROME&&Number(e.version)>=74}(),bi.supportDataChannel=function(){return!!(bT(76)||function(e){const t=ft();return!(t.name!==St.FIREFOX||!t.osVersion)&&Number(t.version)>=e}(68)||function(e){const t=ft();return!(t.name!==St.SAFARI||!t.osVersion)&&Number(t.version)>=e}(14))}(),bi.supportPCSetConfiguration=function(){const e=window.RTCPeerConnection;return!Pt()&&!!e&&e.prototype.setConfiguration instanceof Function}(),bi.supportWebRTCEncodedTransform=function(){const e=ft();return e.name==="Chrome"&&Number(e.version)>=86||e.name==="Safari"&&Number(e.version)>=15}(),bi.supportWebRTCInsertableStream=function(){const e=ft();return(e.name===St.CHROME||e.name===St.EDGE)&&Number(e.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Zm(()=>{bi.supportDualStreamEncoding=function(){const e=ft();return V("DISABLE_WEBAUDIO")?!0:e.name==="Safari"&&Number(e.version)>=14||!!(e.name==="Chrome"&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&V("CHROME_DUAL_STREAM_USE_ENCODING"))}(),y.info("browser compatibility",JSON.stringify(bi),JSON.stringify(n))})})();class L7 extends zt{constructor(){super(...arguments),S(this,"resultStorage",new Map)}setLocalAudioStats(e,t,i){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(i,t)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(i,t))}setLocalVideoStats(e,t,i){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(i,t)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(i,t)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(i))}setRemoteAudioStats(e,t){const i=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",i,this.checkAudioOutputLevel(t))}setRemoteVideoStats(e,t){const i=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",i,this.checkVideoDecode(t))}record(e,t,i){if(V("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});const o=this.resultStorage.get(e);if(o&&(o.result.push(i),o.result.length>=5)){var a;const l=Ie(a=o.result).call(a,!0);o.isPrevNormal&&!l&&this.emit("exception",DL[e],e,t),!o.isPrevNormal&&l&&this.emit("exception",DL[e]+2e3,e+"_RECOVER",t),o.isPrevNormal=l,o.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&e.receiveLevel===0)}checkAudioInputLevel(e,t){return t instanceof In&&!t.isActive||!!t.muted||e.sendVolumeLevel!==0}checkFramerateInput(e,t){let i=null;t._encoderConfig&&t._encoderConfig.frameRate&&(i=xr(t._encoderConfig.frameRate));const o=e.captureFrameRate;return!i||!o||!(i>10&&o<5||i<10&&i>=5&&o<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checkSendVideoBitrate(e,t){return!!t.muted||e.sendBitrate!==0}checkSendAudioBitrate(e,t){return t instanceof In&&!t.isActive||!!t.muted||e.sendBitrate!==0}checkVideoDecode(e){return e.receiveBitrate===0||e.decodeFrameRate!==0}}const DL={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Ei=new class{markSubscribeStart(n,e){performance.mark("agora-web-sdk/".concat(n,"/subscribe-").concat(e))}markPublishStart(n,e){performance.mark("agora-web-sdk/".concat(n,"/publish-").concat(e))}measureFromSubscribeStart(n,e){const t=performance.getEntriesByName("agora-web-sdk/".concat(n,"/subscribe-").concat(e));if(t.length>0){const i=t[t.length-1];return Math.round(performance.now()-i.startTime)}return 0}measureFromPublishStart(n,e){const t=performance.getEntriesByName("agora-web-sdk/".concat(n,"/publish-").concat(e));if(t.length>0){const i=t[t.length-1];return Math.round(performance.now()-i.startTime)}return 0}};function B0(n,e){this.v=n,this.k=e}function Qe(n){return new B0(n,0)}var M7=sP,x7=Io;Xt({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var n=x7.f(this);return{promise:n.promise,resolve:n.resolve,reject:n.reject}}});var U7=Io,V7=Pd;Xt({target:"Promise",stat:!0,forced:!0},{try:function(n){var e=U7.f(this),t=V7(n);return(t.error?e.reject:e.resolve)(t.value),e.promise}});var G0=p(M7),kL=Td.f("asyncIterator"),F7=p(kL);function Op(n){var e,t;function i(a,l){try{var u=n[a](l),h=u.value,f=h instanceof B0;G0.resolve(f?h.v:h).then(function(m){if(f){var E=a==="return"?"return":"next";if(!h.k||m.done)return i(E,m);m=n[E](m).value}o(u.done?"return":"normal",m)},function(m){i("throw",m)})}catch(m){o("throw",m)}}function o(a,l){switch(a){case"return":e.resolve({value:l,done:!0});break;case"throw":e.reject(l);break;default:e.resolve({value:l,done:!1})}(e=e.next)?i(e.key,e.arg):t=null}this._invoke=function(a,l){return new G0(function(u,h){var f={key:a,arg:l,resolve:u,reject:h,next:null};t?t=t.next=f:(e=t=f,i(a,l))})},typeof n.return!="function"&&(this.return=void 0)}function Tr(n){return function(){return new Op(n.apply(this,arguments))}}Op.prototype[typeof bd=="function"&&F7||"@@asyncIterator"]=function(){return this},Op.prototype.next=function(n){return this._invoke("next",n)},Op.prototype.throw=function(n){return this._invoke("throw",n)},Op.prototype.return=function(n){return this._invoke("return",n)};var LL=p(Ss.Object.getOwnPropertySymbols),j7=Xt,B7=qv.indexOf,G7=KS,W0=me([].indexOf),ML=!!W0&&1/W0([1],1,-0)<0;j7({target:"Array",proto:!0,forced:ML||!G7("indexOf")},{indexOf:function(n){var e=arguments.length>1?arguments[1]:void 0;return ML?W0(this,n,e)||0:B7(this,n,e)}});var W7=qa("Array").indexOf,H7=x,K7=W7,H0=Array.prototype,xL=p(function(n){var e=n.indexOf;return n===H0||H7(H0,n)&&e===H0.indexOf?K7:e}),z7=Mi,UL=Em;Xt({target:"Object",stat:!0,forced:_(function(){UL(1)})},{keys:function(n){return UL(z7(n))}});var Y7=p(Ss.Object.keys);function q7(n,e){if(n==null)return{};var t,i,o=function(l,u){if(l==null)return{};var h,f,m={},E=Y7(l);for(f=0;f<E.length;f++)h=E[f],xL(u).call(u,h)>=0||(m[h]=l[h]);return m}(n,e);if(LL){var a=LL(n);for(i=0;i<a.length;i++)t=a[i],xL(e).call(e,t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(o[t]=n[t])}return o}var VL={exports:{}};(function(n,e){n.exports=(()=>{var t={8:(a,l,u)=>{u.r(l),u.d(l,{Parser:()=>Ye,Printer:()=>Rr,parse:()=>Ke,print:()=>_t});const h=`
`,f="".concat("\r").concat(h),m=" ";let E;function v(ve){return ve>="0"&&ve<="9"}function T(ve){return ve>="!"&&ve<="~"}function A(ve){return T(ve)||ve>=""&&ve<=""}function C(ve){return ve==="!"||ve>="#"&&ve<="'"||ve>="*"&&ve<="+"||ve>="-"&&ve<="."||ve>="0"&&ve<="9"||ve>="A"&&ve<="Z"||ve>="^"&&ve<="~"}function b(ve){return ve>="1"&&ve<="9"}function D(ve){return ve>="A"&&ve<="Z"||ve>="a"&&ve<="z"}function M(ve){return ve==="d"||ve==="h"||ve==="m"||ve==="s"}function B(ve){return ve>""&&ve<"	"||ve>"\v"&&ve<"\f"||ve>""&&ve<""}function J(ve){return D(ve)||v(ve)||ve==="+"||ve==="/"}function G(ve){return v(ve)||D(ve)||ve==="+"||ve==="/"||ve==="-"||ve==="_"}function q(ve){return D(ve)||v(ve)||ve==="+"||ve==="/"}function Q(ve,w){var U=Object.keys(ve);if(Object.getOwnPropertySymbols){var j=Object.getOwnPropertySymbols(ve);w&&(j=j.filter(function(de){return Object.getOwnPropertyDescriptor(ve,de).enumerable})),U.push.apply(U,j)}return U}function $(ve){for(var w=1;w<arguments.length;w++){var U=arguments[w]!=null?arguments[w]:{};w%2?Q(Object(U),!0).forEach(function(j){ue(ve,j,U[j])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ve,Object.getOwnPropertyDescriptors(U)):Q(Object(U)).forEach(function(j){Object.defineProperty(ve,j,Object.getOwnPropertyDescriptor(U,j))})}return ve}function ue(ve,w,U){return w in ve?Object.defineProperty(ve,w,{value:U,enumerable:!0,configurable:!0,writable:!0}):ve[w]=U,ve}(function(ve){ve.VERSION="v",ve.ORIGIN="o",ve.SESSION_NAME="s",ve.INFORMATION="i",ve.URI="u",ve.EMAIL="e",ve.PHONE="p",ve.CONNECTION="c",ve.BANDWIDTH="b",ve.TIME="t",ve.REPEAT="r",ve.ZONE_ADJUSTMENTS="z",ve.KEY="k",ve.ATTRIBUTE="a",ve.MEDIA="m"})(E||(E={}));class Ee{consumeText(w,U){let j=U;for(;j<w.length;){const de=w[j];if(de==="\0"||de==="\r"||de===h)break;j+=1}if(j-U==0)throw new Error("Invalid text, at ".concat(w));return j}consumeUnicastAddress(w,U,j){return this.consumeTill(w,U,m)}consumeOneOrMore(w,U,j){let de=U;for(;j(w[de]);)de++;if(de-U==0)throw new Error("Invalid rule at ".concat(U,"."));return de}consumeSpace(w,U){if(w[U]===m)return U+1;throw new Error("Invalid space at ".concat(U,"."))}consumeIP4Address(w,U){let j=U;for(let de=0;de<4;de++)if(j=this.consumeDecimalUChar(w,j),de!==3){if(w[j]!==".")throw new Error("Invalid IP4 address.");j++}return j}consumeDecimalUChar(w,U){let j=U;for(let qe=0;qe<3&&v(w[j]);qe++,j++);if(j-U==0)throw new Error("Invalid decimal uchar.");const de=parseInt(w.slice(U,j));if(de>=0&&de<=255)return j;throw new Error("Invalid decimal uchar")}consumeIP6Address(w,U){let j=this.consumeHexpart(w,U);return w[j]===":"&&(j+=1,j=this.consumeIP4Address(w,j)),j}consumeHexpart(w,U){let j=U;if(w[j]===":"&&w[j+1]===":"){j+=2;try{j=this.consumeHexseq(w,j)}catch{}return j}if(j=this.consumeHexseq(w,j),w[j]===":"&&w[j+1]===":"){j+=2;try{j=this.consumeHexseq(w,j)}catch{}return j}return j}consumeHexseq(w,U){let j=U;for(;j=this.consumeHex4(w,j),w[j]===":"&&w[j+1]!==":";)j+=1;return j}consumeHex4(w,U){let j=0;for(;j<4;j++)if(!((de=w[U+j])>="0"&&de<="9"||de>="a"&&de<="f"||de>="A"&&de<="F")){if(j===0)throw new Error("Invalid hex 4");break}var de;return U+j}consumeFQDN(w,U){let j=U;for(;v(w[j])||D(w[j])||w[j]==="-"||w[j]===".";)j+=1;if(j-U<4)throw new Error("Invalid FQDN");return j}consumeExtnAddr(w,U){return this.consumeOneOrMore(w,U,A)}consumeMulticastAddress(w,U,j){switch(j){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(w,U);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(w,U);default:try{return this.consumeFQDN(w,U)}catch{return this.consumeExtnAddr(w,U)}}}consumeIP6MulticastAddress(w,U){const j=this.consumeHexpart(w,U);return w[j]==="/"?this.consumeInteger(w,j+1):j}consumeIP4MulticastAddress(w,U){let j=U+3;const de=w.slice(U,j),qe=parseInt(de);if(qe<224||qe>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let jt=0;jt<3;jt++){if(w[j]!==".")throw new Error("Invalid IP4 multicast address.");j+=1,j=this.consumeDecimalUChar(w,j)}return w[j]==="/"&&(j+=1),j=this.consumeTTL(w,j),w[j]==="/"&&(j=this.consumeInteger(w,j)),j}consumeInteger(w,U){if(!b(w[U]))throw new Error("Invalid integer.");for(U+=1;v(w[U]);)U+=1;return U}consumeTTL(w,U){if(w[U]==="0")return U+1;if(!b(w[U]))throw new Error("Invalid TTL.");U+=1;for(let j=0;j<2&&v(w[U]);j++)U+=1;return U}consumeToken(w,U){return this.consumeOneOrMore(w,U,C)}consumeTime(w,U){let j=U;if(w[j]==="0")return j+1;for(b(w[j])&&(j+=1);v(w[j]);)j++;if(j-U<10)throw new Error("Invalid time");return j}consumeAddress(w,U){return this.consumeTill(w,U,m)}consumeTypedTime(w,U){let j=U;return j=this.consumeOneOrMore(w,j,v),M(w[j])?j+1:j}consumeRepeatInterval(w,U){if(!b(w[U]))throw new Error("Invalid repeat interval");for(U+=1;v(w[U]);)U+=1;return M(w[U])&&(U+=1),U}consumePort(w,U){return this.consumeOneOrMore(w,U,v)}consume(w,U,j){for(let de=0;de<j.length;de++){if(U+de>=w.length)throw new Error("consume exceeding value length");if(w[U+de]!==j[de])throw new Error("consume ".concat(j," failed at ").concat(de))}return U+j.length}consumeTill(w,U,j){let de=U;for(;de<w.length&&(typeof j!="string"||w[de]!==j)&&(typeof j!="function"||!j(w[de]));)de++;return de}}class Ye extends Ee{constructor(){super(),ue(this,"records",[]),ue(this,"currentLine",0)}parse(w){const U=this.probeEOL(w);this.records=w.split(U).filter(bn=>!!bn.trim()).map(this.parseLine),this.currentLine=0;const j=this.parseVersion(),de=this.parseOrigin(),qe=this.parseSessionName(),jt=this.parseInformation(),Si=this.parseUri(),Cr=this.parseEmail(),Ra=this.parsePhone(),TE=this.parseConnection(),yE=this.parseBandWidth(),ls=this.parseTimeFields(),kc=this.parseKey(),yu=this.parseSessionAttribute(),hn=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:j,origin:de,sessionName:qe,information:jt,uri:Si,emails:Cr,phones:Ra,connection:TE,bandwidths:yE,timeFields:ls,key:kc,attributes:yu,mediaDescriptions:hn}}getCurrentRecord(){const w=this.records[this.currentLine];if(!w)throw new Error("Record doesn't exit.");return w}probeEOL(w){for(let U=0;U<w.length;U++)if(w[U]===h)return w[U-1]==="\r"?f:h;throw new Error("Invalid newline character.")}parseLine(w,U){if(w.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const j=w[0];if(w[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:j,value:w.slice(2),line:U,cur:0}}parseSessionAttribute(){const w=new Vt;for(;this.currentLine<this.records.length;){const U=this.getCurrentRecord();if(U.type!==E.ATTRIBUTE)break;const j={attField:this.extractOneOrMore(U,de=>C(de)&&de!==":"),_cur:0};U.value[U.cur]===":"&&(U.cur+=1,j.attValue=this.extractOneOrMore(U,B)),w.parse(j),this.currentLine++}return w.digest()}parseMediaAttributes(w){const U=new wn(w);for(;this.currentLine<this.records.length;){const j=this.getCurrentRecord();if(j.type!==E.ATTRIBUTE)break;const de={attField:this.extractOneOrMore(j,qe=>C(qe)&&qe!==":"),_cur:0};j.value[j.cur]===":"&&(j.cur+=1,de.attValue=this.extractOneOrMore(j,B)),U.parse(de),this.currentLine++}return U.digest()}parseKey(){const w=this.getCurrentRecord();if(w.type===E.KEY){if(w.value==="prompt"||w.value==="clear:"||w.value==="base64:"||w.value==="uri:")return w.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const w=this.getCurrentRecord();if(w.type===E.ZONE_ADJUSTMENTS){const U=[];for(;;)try{const j=this.extract(w,this.consumeTime);this.consumeSpaceForRecord(w);let de=!1;w.value[w.cur]==="-"&&(de=!0,w.cur+=1);const qe=this.extract(w,this.consumeTypedTime);U.push({time:j,typedTime:qe,back:de})}catch{break}if(U.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,U}return[]}parseRepeat(){const w=[];for(;;){const U=this.getCurrentRecord();if(U.type!==E.REPEAT)break;{const j=this.extract(U,this.consumeRepeatInterval),de=this.parseTypedTime(U);w.push({repeatInterval:j,typedTimes:de}),this.currentLine++}}return w}parseTypedTime(w){const U=[];for(;;)try{this.consumeSpaceForRecord(w),U.push(this.extract(w,this.consumeTypedTime))}catch{break}if(U.length===0)throw new Error("Invalid typed time.");return U}parseTime(){const w=this.getCurrentRecord(),U=this.extract(w,this.consumeTime);this.consumeSpaceForRecord(w);const j=this.extract(w,this.consumeTime);return this.currentLine++,{startTime:U,stopTime:j}}parseBandWidth(){const w=[];for(;this.currentLine<this.records.length;){const U=this.getCurrentRecord();if(U.type!==E.BANDWIDTH)break;{const j=this.extractOneOrMore(U,C);if(U.value[U.cur]!==":")throw new Error("Invalid bandwidth field.");U.cur++;const de=this.extractOneOrMore(U,v);w.push({bwtype:j,bandwidth:de}),this.currentLine++}}return w}parseVersion(){const w=this.getCurrentRecord();if(w.type!==E.VERSION)throw new Error("first sdp record must be version");const U=w.value.slice(0,this.consumeOneOrMore(w.value,0,v));if(U.length!==w.value.length)throw new Error('invalid proto version, "v='.concat(w.value,'"'));return this.currentLine++,U}parseOrigin(){const w=this.getCurrentRecord();if(w.type!==E.ORIGIN)throw new Error("second line of sdp must be origin");const U=this.extractOneOrMore(w,A);this.consumeSpaceForRecord(w);const j=this.extractOneOrMore(w,v);this.consumeSpaceForRecord(w);const de=this.extractOneOrMore(w,v);this.consumeSpaceForRecord(w);const qe=this.extractOneOrMore(w,C);this.consumeSpaceForRecord(w);const jt=this.extractOneOrMore(w,C);this.consumeSpaceForRecord(w);const Si=this.extract(w,this.consumeUnicastAddress);return this.currentLine++,{username:U,sessId:j,sessVersion:de,nettype:qe,addrtype:jt,unicastAddress:Si}}parseSessionName(){const w=this.getCurrentRecord();if(w.type===E.SESSION_NAME){const U=this.extract(w,this.consumeText);return this.currentLine++,U}}parseInformation(){const w=this.getCurrentRecord();if(w.type!==E.INFORMATION)return;const U=this.extract(w,this.consumeText);return this.currentLine++,U}parseUri(){const w=this.getCurrentRecord();if(w.type===E.URI)return this.currentLine++,w.value}parseEmail(){const w=[];for(;;){const U=this.getCurrentRecord();if(U.type!==E.EMAIL)break;w.push(U.value),this.currentLine++}return w}parsePhone(){const w=[];for(;;){const U=this.getCurrentRecord();if(U.type!==E.PHONE)break;w.push(U.value),this.currentLine++}return w}parseConnection(){const w=this.getCurrentRecord();if(w.type===E.CONNECTION){const U=this.extractOneOrMore(w,C);this.consumeSpaceForRecord(w);const j=this.extractOneOrMore(w,C);this.consumeSpaceForRecord(w);const de=this.extract(w,this.consumeAddress);return this.currentLine++,{nettype:U,addrtype:j,address:de}}}parseMedia(){const w=this.getCurrentRecord(),U=this.extract(w,this.consumeToken);this.consumeSpaceForRecord(w);let j=this.extract(w,this.consumePort);w.value[w.cur]==="/"&&(w.cur+=1,j+=this.extract(w,this.consumeInteger)),this.consumeSpaceForRecord(w);const de=[];for(de.push(this.extract(w,this.consumeToken));w.value[w.cur]==="/";)w.cur+=1,de.push(this.extract(w,this.consumeToken));if(de.length===0)throw new Error("Invalid proto");const qe=this.parseFmt(w);return this.currentLine++,{mediaType:U,port:j,protos:de,fmts:qe}}parseTimeFields(){const w=[];for(;this.getCurrentRecord().type===E.TIME;){const U=this.parseTime(),j=this.parseRepeat(),de=this.parseZone();w.push({time:U,repeats:j,zones:de})}return w}parseMediaDescription(){const w=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===E.MEDIA;){const U=this.parseMedia(),j=this.parseInformation(),de=this.parseConnections(),qe=this.parseBandWidth(),jt=this.parseKey(),Si=this.parseMediaAttributes(U);w.push({media:U,information:j,connections:de,bandwidths:qe,key:jt,attributes:Si})}return w}parseConnections(){const w=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===E.CONNECTION;)w.push(this.parseConnection());return w}parseFmt(w){const U=[];for(;;)try{this.consumeSpaceForRecord(w),U.push(this.extract(w,this.consumeToken))}catch{break}if(U.length===0)throw new Error("Invalid fmts");return U}extract(w,U,...j){const de=U.call(this,w.value,w.cur,...j),qe=w.value.slice(w.cur,de);return w.cur=de,qe}extractOneOrMore(w,U){const j=this.consumeOneOrMore(w.value,w.cur,U),de=w.value.slice(w.cur,j);return w.cur=j,de}consumeSpaceForRecord(w){if(w.value[w.cur]!==m)throw new Error("Invalid space at ".concat(w.cur,"."));w.cur+=1}}class st extends Ee{constructor(...w){super(...w),ue(this,"attributes",void 0),ue(this,"digested",!1)}extractOneOrMore(w,U,j){const de=this.consumeOneOrMore(w.attValue,w._cur,U),qe=w.attValue.slice(w._cur,de),[jt,Si]=j||[];if(typeof jt=="number"&&qe.length<jt)throw new Error("error in length, should be more or equal than ".concat(jt," characters."));if(typeof Si=="number"&&qe.length>Si)throw new Error("error in length, should be less or equal than ".concat(Si," characters."));return w._cur=de,qe}consumeAttributeSpace(w){if(w.attValue[w._cur]!==m)throw new Error("Invalid space at ".concat(w._cur,"."));w._cur+=1}extract(w,U,...j){if(!w.attValue)throw new Error("Nothing to extract from attValue.");const de=U.call(this,w.attValue,w._cur,...j),qe=w.attValue.slice(w._cur,de);return w._cur=de,qe}atEnd(w){if(!w.attValue)throw new Error;return w._cur>=w.attValue.length}peekChar(w){if(!w.attValue)throw new Error;return w.attValue[w._cur]}peek(w,U){if(!w.attValue)throw new Error;for(let j=0;j<U.length;j++)if(U[j]!==w.attValue[w._cur+j])return!1;return!0}parseIceUfrag(w){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(w,J,[4,256])}parseIcePwd(w){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(w,J,[22,256])}parseIceOptions(w){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const U=[];for(;!this.atEnd(w);){U.push(this.extractOneOrMore(w,J));try{this.consumeAttributeSpace(w)}catch(j){if(this.atEnd(w))break;throw j}}this.attributes.iceOptions=U}parseFingerprint(w){const U=this.extract(w,this.consumeToken);this.consumeAttributeSpace(w);const j=this.extract(w,this.consumeTill);this.attributes.fingerprints.push({hashFunction:U,fingerprint:j})}parseExtmap(w){const U=this.extractOneOrMore(w,v);let j;this.peekChar(w)==="/"&&(this.extract(w,this.consume,"/"),j=this.extract(w,this.consumeToken)),this.consumeAttributeSpace(w);const de=this.extract(w,this.consumeTill,m),qe=$($({entry:parseInt(U,10)},j&&{direction:j}),{},{extensionName:de});this.peekChar(w)===m&&(this.consumeAttributeSpace(w),qe.extensionAttributes=this.extract(w,this.consumeTill)),this.attributes.extmaps.push(qe)}parseSetup(w){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const U=this.extract(w,this.consumeTill);if(U!=="active"&&U!=="passive"&&U!=="actpass"&&U!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=U}}class Vt extends st{constructor(...w){super(...w),ue(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(w){if(this.digested)throw new Error("already digested");try{switch(w.attField){case"group":this.parseGroup(w);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(w);break;case"ice-pwd":this.parseIcePwd(w);break;case"ice-options":this.parseIceOptions(w);break;case"fingerprint":this.parseFingerprint(w);break;case"setup":this.parseSetup(w);break;case"tls-id":this.parseTlsId(w);break;case"identity":this.parseIdentity(w);break;case"extmap":this.parseExtmap(w);break;case"msid-semantic":this.parseMsidSemantic(w);break;default:w.ignored=!0,this.attributes.unrecognized.push(w)}}catch(U){throw console.error("parsing session attribute ".concat(w.attField,' error, "a=').concat(w.attField,":").concat(w.attValue,'"')),U}if(!w.ignored&&w.attValue&&!this.atEnd(w))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(w){const U=this.extract(w,this.consumeToken),j=[];for(;!this.atEnd(w)&&this.peekChar(w)===m;)this.consumeAttributeSpace(w),j.push(this.extract(w,this.consumeToken));this.attributes.groups.push({semantic:U,identificationTag:j})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(w){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(w,G)}parseIdentity(w){const U=this.extractOneOrMore(w,q),j=[];for(;!this.atEnd(w)&&this.peekChar(w)===m;){this.consumeAttributeSpace(w);const de=this.extract(w,this.consumeToken);this.extract(w,this.consume,"=");const qe=this.extractOneOrMore(w,jt=>jt!==m&&B(jt));j.push({name:de,value:qe})}this.attributes.identities.push({assertionValue:U,extensions:j})}parseMsidSemantic(w){this.peekChar(w)===m&&this.consumeAttributeSpace(w);const U={semantic:this.extract(w,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(w)}catch{break}if(this.peekChar(w)==="*"){this.extract(w,this.consume,"*"),U.applyForAll=!0;break}{const j=this.extract(w,this.consumeTill,m);U.identifierList.push(j)}}this.attributes.msidSemantic=U}}class wn extends st{constructor(w){super(),ue(this,"attributes",void 0),w.protos.indexOf("RTP")!==-1||w.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(w){if(this.digested)throw new Error("already digested");try{switch(w.attField){case"extmap":this.parseExtmap(w);break;case"setup":this.parseSetup(w);break;case"ice-ufrag":this.parseIceUfrag(w);break;case"ice-pwd":this.parseIcePwd(w);break;case"ice-options":this.parseIceOptions(w);break;case"candidate":this.parseCandidate(w);break;case"remote-candidate":this.parseRemoteCandidate(w);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(w);break;case"rtpmap":this.parseRtpmap(w);break;case"ptime":this.parsePtime(w);break;case"maxptime":this.parseMaxPtime(w);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(w);break;case"ssrc":this.parseSSRC(w);break;case"fmtp":this.parseFmtp(w);break;case"rtcp-fb":this.parseRtcpFb(w);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(w);break;case"mid":this.parseMid(w);break;case"msid":this.parseMsid(w);break;case"imageattr":this.parseImageAttr(w);break;case"rid":this.parseRid(w);break;case"simulcast":this.parseSimulcast(w);break;case"sctp-port":this.parseSctpPort(w);break;case"max-message-size":this.parseMaxMessageSize(w);break;case"ssrc-group":this.parseSSRCGroup(w);break;default:w.ignored=!0,this.attributes.unrecognized.push(w)}}catch(U){throw console.error("parsing media attribute ".concat(w.attField,' error, "a=').concat(w.attField,":").concat(w.attValue,'"')),U}if(!w.ignored&&w.attValue&&!this.atEnd(w))throw new Error("attribute parsing error")}parseCandidate(w){const U=this.extractOneOrMore(w,J,[1,32]);this.consumeAttributeSpace(w);const j=this.extractOneOrMore(w,v,[1,5]);this.consumeAttributeSpace(w);const de=this.extract(w,this.consumeToken);this.consumeAttributeSpace(w);const qe=this.extractOneOrMore(w,v,[1,10]);this.consumeAttributeSpace(w);const jt=this.extract(w,this.consumeAddress);this.consumeAttributeSpace(w);const Si=this.extract(w,this.consumePort);this.consumeAttributeSpace(w),this.extract(w,this.consume,"typ"),this.consumeAttributeSpace(w);const Cr={foundation:U,componentId:j,transport:de,priority:qe,connectionAddress:jt,port:Si,type:this.extract(w,this.consumeToken),extension:{}};for(this.peek(w," raddr")&&(this.extract(w,this.consume," raddr"),this.consumeAttributeSpace(w),Cr.relAddr=this.extract(w,this.consumeAddress)),this.peek(w," rport")&&(this.extract(w,this.consume," rport"),this.consumeAttributeSpace(w),Cr.relPort=this.extract(w,this.consumePort));this.peekChar(w)===m;){this.consumeAttributeSpace(w);const Ra=this.extract(w,this.consumeToken);this.consumeAttributeSpace(w),Cr.extension[Ra]=this.extractOneOrMore(w,T)}this.attributes.candidates.push(Cr)}parseRemoteCandidate(w){const U=[];for(;;){const j=this.extractOneOrMore(w,v,[1,5]);this.consumeAttributeSpace(w);const de=this.extract(w,this.consumeAddress);this.consumeAttributeSpace(w);const qe=this.extract(w,this.consumePort);U.push({componentId:j,connectionAddress:de,port:qe});try{this.consumeAttributeSpace(w)}catch{break}}this.attributes.remoteCandidatesList.push(U)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(w){const U=this.extract(w,this.consumeToken);this.consumeAttributeSpace(w);const j=this.extract(w,this.consumeTill,"/");this.extract(w,this.consume,"/");const de={encodingName:j,clockRate:this.extractOneOrMore(w,v)};this.atEnd(w)||this.peekChar(w)!=="/"||(this.extract(w,this.consume,"/"),de.encodingParameters=parseInt(this.extract(w,this.consumeTill),10));const qe=this.attributes.payloads.find(jt=>jt.payloadType===parseInt(U,10));qe?qe.rtpMap=de:this.attributes.payloads.push({payloadType:parseInt(U,10),rtpMap:de,rtcpFeedbacks:[]})}parsePtime(w){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(w,this.consumeTill)}parseMaxPtime(w){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(w,this.consumeTill)}parseDirection(w){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=w.attField}parseSSRC(w){const U=this.extractOneOrMore(w,v);this.consumeAttributeSpace(w);const j=this.extract(w,this.consumeTill,":");let de;this.peekChar(w)===":"&&(this.extract(w,this.consume,":"),de=this.extract(w,this.consumeTill));const qe=this.attributes.ssrcs.find(jt=>jt.ssrcId===parseInt(U,10));qe?qe.attributes[j]=de:this.attributes.ssrcs.push({ssrcId:parseInt(U,10),attributes:{[j]:de}})}parseFmtp(w){const U=this.extract(w,this.consumeTill,m);this.consumeAttributeSpace(w);const j=this.extract(w,this.consumeTill),de={};j.split(";").forEach(jt=>{let[Si,Cr]=jt.split("=");Si=Si.trim();const Ra=typeof Cr=="string"?Cr.trim():null;typeof Si=="string"&&Si.length>0&&(de[Si]=Ra)});const qe=this.attributes.payloads.find(jt=>jt.payloadType===parseInt(U,10));qe?qe.fmtp={parameters:de}:this.attributes.payloads.push({payloadType:parseInt(U,10),rtcpFeedbacks:[],fmtp:{parameters:de}})}parseFmtParameters(w){const U={},j=this.extract(w,this.consumeTill,"=");w._cur++;const de=this.extract(w,this.consumeTill,";");for(U[j]=de;w.attValue[w._cur]===";";){const qe=this.extract(w,this.consumeTill,"=");w._cur++;const jt=this.extract(w,this.consumeTill,";");U[qe]=jt}return U}parseRtcpFb(w){let U="";U=this.peekChar(w)==="*"?this.extract(w,this.consume,"*"):this.extract(w,this.consumeTill,m),this.consumeAttributeSpace(w);const j=this.extract(w,this.consumeTill,m);let de;if(j==="trr-int")de={type:j,interval:this.extract(w,this.consumeTill)};else{const qe={type:j};this.peekChar(w)===m&&(this.consumeAttributeSpace(w),qe.parameter=this.extract(w,this.consumeToken),this.peekChar(w)===m&&(qe.additional=this.extract(w,this.consumeTill))),de=qe}if(U==="*")this.attributes.rtcpFeedbackWildcards.push(de);else{const qe=this.attributes.payloads.find(jt=>jt.payloadType===parseInt(U,10));qe?qe.rtcpFeedbacks.push(de):this.attributes.payloads.push({payloadType:parseInt(U,10),rtcpFeedbacks:[de]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(w){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const U={port:this.extract(w,this.consumePort)};this.peekChar(w)===m&&(this.consumeAttributeSpace(w),U.netType=this.extractOneOrMore(w,C),this.consumeAttributeSpace(w),U.addressType=this.extractOneOrMore(w,C),this.consumeAttributeSpace(w),U.address=this.extract(w,this.consumeAddress)),this.attributes.rtcp=U}parseMsid(w){const U={id:this.extractOneOrMore(w,C,[1,64])};this.peekChar(w)===m&&(this.consumeAttributeSpace(w),U.appdata=this.extractOneOrMore(w,C,[1,64])),this.attributes.msids.push(U)}parseImageAttr(w){this.attributes.imageattr.push(w.attValue)}parseRid(w){const U=this.extractOneOrMore(w,de=>D(de)||v(de)||de==="_"||de==="-");this.consumeAttributeSpace(w);const j={id:U,direction:this.extract(w,this.consumeToken),params:[]};if(this.peekChar(w)===m){if(this.consumeAttributeSpace(w),this.peek(w,"pt=")){this.extract(w,this.consume,"pt=");const de=[];for(;;){const qe=this.extract(w,this.consumeToken);de.push(qe);try{this.extract(w,this.consume,",")}catch{break}}j.payloads=de,this.peekChar(w)===m&&this.extract(w,this.consume,m)}for(;;){const de=this.extract(w,this.consumeToken);switch(de){case"depend":{const qe={type:de,rids:this.extract(w,this.consume,"=").split(",")};j.params.push(qe);break}default:{const qe={type:de};this.peekChar(w)==="="&&(this.extract(w,this.consume,"="),qe.val=this.extract(w,this.consumeTill,";")),j.params.push(qe)}}try{this.extract(w,this.consume,";")}catch{break}}}this.attributes.rids.push(j)}parseSimulcast(w){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=w.attValue,this.extract(w,this.consumeTill)}parseSctpPort(w){this.attributes.sctpPort=this.extractOneOrMore(w,v,[1,5])}parseMaxMessageSize(w){this.attributes.maxMessageSize=this.extractOneOrMore(w,v,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(w){this.attributes.mid=this.extract(w,this.consumeToken)}parseSSRCGroup(w){const U=this.extract(w,this.consumeToken),j=[];for(;;)try{this.consumeAttributeSpace(w);const de=this.extract(w,this.consumeInteger);j.push(parseInt(de,10))}catch{break}this.attributes.ssrcGroups.push({semantic:U,ssrcIds:j})}}function Wt(ve,w,U){return w in ve?Object.defineProperty(ve,w,{value:U,enumerable:!0,configurable:!0,writable:!0}):ve[w]=U,ve}class Rr{constructor(){Wt(this,"eol",f)}print(w,U){let j="";return U&&(this.eol=U),j+=this.printVersion(w.version),j+=this.printOrigin(w.origin),j+=this.printSessionName(w.sessionName),j+=this.printInformation(w.information),j+=this.printUri(w.uri),j+=this.printEmail(w.emails),j+=this.printPhone(w.phones),j+=this.printConnection(w.connection),j+=this.printBandwidth(w.bandwidths),j+=this.printTimeFields(w.timeFields),j+=this.printKey(w.key),j+=this.printSessionAttributes(w.attributes),j+=this.printMediaDescription(w.mediaDescriptions),j}printVersion(w){return"v=".concat(w).concat(this.eol)}printOrigin(w){return"o=".concat(w.username," ").concat(w.sessId," ").concat(w.sessVersion," ").concat(w.nettype," ").concat(w.addrtype," ").concat(w.unicastAddress).concat(this.eol)}printSessionName(w){return w?"s=".concat(w).concat(this.eol):""}printInformation(w){return w?"i=".concat(w).concat(this.eol):""}printUri(w){return w?"u=".concat(w).concat(this.eol):""}printEmail(w){let U="";for(const j of w)U+="e=".concat(j).concat(this.eol);return U}printPhone(w){let U="";for(const j of w)U+="e=".concat(j).concat(this.eol);return U}printConnection(w){return w?"c=".concat(w.nettype," ").concat(w.addrtype," ").concat(w.address).concat(this.eol):""}printBandwidth(w){let U="";for(const j of w)U+="b=".concat(j.bwtype,":").concat(j.bandwidth).concat(this.eol);return U}printTimeFields(w){let U="";for(const j of w){U+="t=".concat(j.time.startTime," ").concat(j.time.startTime).concat(this.eol);for(const de of j.repeats)U+="r=".concat(de.repeatInterval," ").concat(de.typedTimes.join(" ")).concat(this.eol);j.zoneAdjustments&&(U+="z=",U+="z=".concat(j.zoneAdjustments.map(de=>"".concat(de.time," ").concat(de.back?"-":""," ").concat(de.typedTime)).join(" ")).concat(this.eol),U+=this.eol)}return U}printKey(w){return w?"k=".concat(w).concat(this.eol):""}printAttributes(w){let U="";for(const j of w)U+="a=".concat(j.attField).concat(j.attValue?":".concat(j.attValue):"").concat(this.eol);return U}printMediaDescription(w){let U="";for(const j of w)U+=this.printMedia(j.media),U+=this.printInformation(j.information),U+=this.printConnections(j.connections),U+=this.printBandwidth(j.bandwidths),U+=this.printKey(j.key),U+=this.printMediaAttributes(j);return U}printConnections(w){let U="";for(const j of w)U+=this.printConnection(j);return U}printMedia(w){return"m=".concat(w.mediaType," ").concat(w.port," ").concat(w.protos.join("/")," ").concat(w.fmts.join(" ")).concat(this.eol)}printSessionAttributes(w){return new he(this.eol).print(w)}printMediaAttributes(w){return new Ae(this.eol).print(w)}}class se{constructor(w){Wt(this,"eol",void 0),this.eol=w}printIceUfrag(w){return w===void 0?"":"a=ice-ufrag:".concat(w).concat(this.eol)}printIcePwd(w){return w===void 0?"":"a=ice-pwd:".concat(w).concat(this.eol)}printIceOptions(w){return w===void 0?"":"a=ice-options:".concat(w.join(m)).concat(this.eol)}printFingerprints(w){return w.length>0?w.map(U=>"a=fingerprint:".concat(U.hashFunction).concat(m).concat(U.fingerprint)).join(this.eol)+this.eol:""}printExtmap(w){return w.map(U=>"a=extmap:".concat(U.entry).concat(U.direction?"/".concat(U.direction):"").concat(m).concat(U.extensionName).concat(U.extensionAttributes?"".concat(m).concat(U.extensionAttributes):"").concat(this.eol)).join("")}printSetup(w){return w===void 0?"":"a=setup:".concat(w).concat(this.eol)}printUnrecognized(w){return w.map(U=>"a=".concat(U.attField).concat(U.attValue?":".concat(U.attValue):"").concat(this.eol)).join("")}}class he extends se{print(w){let U="";return U+=this.printGroups(w.groups),U+=this.printMsidSemantic(w.msidSemantic),U+=this.printIceLite(w.iceLite),U+=this.printIceUfrag(w.iceUfrag),U+=this.printIcePwd(w.icePwd),U+=this.printIceOptions(w.iceOptions),U+=this.printFingerprints(w.fingerprints),U+=this.printSetup(w.setup),U+=this.printTlsId(w.tlsId),U+=this.printIdentity(w.identities),U+=this.printExtmap(w.extmaps),U+=this.printUnrecognized(w.unrecognized),U}printGroups(w){let U="";return w.length>0&&(U+=w.map(j=>"a=group:".concat(j.semantic).concat(j.identificationTag.map(de=>"".concat(m).concat(de)).join("")).concat(this.eol)).join("")),U}printIceLite(w){return w===void 0?"":"a=ice-lite"+this.eol}printTlsId(w){return w?"a=tls-id:".concat(w).concat(this.eol):""}printIdentity(w){return w.length===0?"":w.map(U=>"a=identity:".concat(U.assertionValue).concat(U.extensions.map(j=>"".concat(m).concat(j.name).concat(j.value?"=".concat(j.value):"")))).join(this.eol)+this.eol}printMsidSemantic(w){if(!w)return"";let U="a=msid-semantic:".concat(w.semantic);return w.applyForAll?U+="".concat(m,"*"):w.identifierList.length>0&&(U+=w.identifierList.map(j=>"".concat(m).concat(j))),U+this.eol}}class Ae extends se{print(w){const U=w.attributes;let j="";return j+=this.printRTCP(U.rtcp),j+=this.printIceUfrag(U.iceUfrag),j+=this.printIcePwd(U.icePwd),j+=this.printIceOptions(U.iceOptions),j+=this.printCandidates(U.candidates),j+=this.printRemoteCandidatesList(U.remoteCandidatesList),j+=this.printEndOfCandidates(U.endOfCandidates),j+=this.printFingerprints(U.fingerprints),j+=this.printSetup(U.setup),j+=this.printMid(U.mid),j+=this.printExtmap(U.extmaps),j+=this.printRTPRelated(U),j+=this.printPtime(U.ptime),j+=this.printMaxPtime(U.maxPtime),j+=this.printDirection(U.direction),j+=this.printSSRCGroups(U.ssrcGroups),j+=this.printSSRC(U.ssrcs),j+=this.printRTCPMux(U.rtcpMux),j+=this.printRTCPMuxOnly(U.rtcpMuxOnly),j+=this.printRTCPRsize(U.rtcpRsize),j+=this.printMSId(U.msids),j+=this.printImageattr(U.imageattr),j+=this.printRid(U.rids),j+=this.printSimulcast(U.simulcast),j+=this.printSCTPPort(U.sctpPort),j+=this.printMaxMessageSize(U.maxMessageSize),j+=this.printUnrecognized(U.unrecognized),j}printCandidates(w){return w.map(U=>"a=candidate:".concat(U.foundation).concat(m).concat(U.componentId).concat(m).concat(U.transport).concat(m).concat(U.priority).concat(m).concat(U.connectionAddress).concat(m).concat(U.port).concat(m,"typ").concat(m).concat(U.type).concat(U.relAddr?"".concat(m,"raddr").concat(m).concat(U.relAddr):"").concat(U.relPort?"".concat(m,"rport").concat(m).concat(U.relPort):"").concat(Object.keys(U.extension).map(j=>"".concat(m).concat(j).concat(m).concat(U.extension[j])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(w){return w.map(U=>"a=remote-candidates:".concat(U.join(m)).concat(this.eol)).join("")}printEndOfCandidates(w){return w===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(w){if(!w.payloads)return"";const U=w.payloads;let j="";j+=w.rtcpFeedbackWildcards.map(de=>this.printRTCPFeedback("*",de)).join("");for(const de of U)j+=this.printRtpMap(de.payloadType,de.rtpMap),j+=this.printFmtp(de.payloadType,de.fmtp),j+=de.rtcpFeedbacks.map(qe=>this.printRTCPFeedback(de.payloadType,qe)).join("");return j}printFmtp(w,U){if(!U)return"";const j=Object.keys(U.parameters);return j.length===1&&U.parameters[j[0]]===null?"a=fmtp:".concat(w).concat(m).concat(j[0]).concat(this.eol):"a=fmtp:".concat(w).concat(m).concat(Object.keys(U.parameters).map(de=>"".concat(de,"=").concat(U.parameters[de])).join(";")).concat(this.eol)}printRtpMap(w,U){return U?"a=rtpmap:".concat(w).concat(m).concat(U.encodingName,"/").concat(U.clockRate).concat(U.encodingParameters?"/".concat(U.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(w,U){let j="a=rtcp-fb:".concat(w).concat(m),de=U;return de.type==="trr-int"?j+="ttr-int".concat(m).concat(de.interval):(j+="".concat(de.type),de.parameter&&(j+="".concat(m).concat(de.parameter),de.additional&&(j+="".concat(m).concat(de.additional)))),j+this.eol}printPtime(w){return w===void 0?"":"a=ptime:".concat(w).concat(this.eol)}printMaxPtime(w){return w===void 0?"":"a=maxptime:".concat(w).concat(this.eol)}printDirection(w){return w===void 0?"":"a=".concat(w).concat(this.eol)}printSSRC(w){return w.map(U=>Object.keys(U.attributes).map(j=>"a=ssrc:".concat(U.ssrcId.toString(10)).concat(m).concat(j).concat(U.attributes[j]?":".concat(U.attributes[j]):"").concat(this.eol)).join("")).join("")}printRTCPMux(w){return w===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(w){return w===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(w){return w===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(w){if(w===void 0)return"";let U="a=rtcp:".concat(w.port);return w.netType&&(U+="".concat(m).concat(w.netType)),w.addressType&&(U+="".concat(m).concat(w.addressType)),w.address&&(U+="".concat(m).concat(w.address)),U+this.eol}printMSId(w){return w.map(U=>"a=msid:".concat(U.id).concat(U.appdata?"".concat(m).concat(U.appdata):"").concat(this.eol)).join("")}printImageattr(w){return w.map(U=>"a=imageattr:".concat(U).concat(this.eol)).join("")}printRid(w){return w.map(U=>{let j="a=rid:".concat(U.id).concat(m).concat(U.direction);return U.payloads&&(j+="".concat(m,"pt=").concat(U.payloads.join(","))),U.params.length>0&&(j+="".concat(m).concat(U.params.map(de=>de.type==="depend"?"depend=".concat(de.rids.join(",")):"".concat(de.type,"=").concat(de.val)).join(";"))),j+this.eol}).join("")}printSimulcast(w){return w===void 0?"":"a=simulcast:".concat(w).concat(this.eol)}printSCTPPort(w){return w===void 0?"":"a=sctp-port:".concat(w).concat(this.eol)}printMaxMessageSize(w){return w===void 0?"":"a=max-message-size:".concat(w).concat(this.eol)}printMid(w){return w===void 0?"":"a=mid:".concat(w).concat(this.eol)}printSSRCGroups(w){return w.map(U=>"a=ssrc-group:".concat(U.semantic).concat(U.ssrcIds.map(j=>"".concat(m).concat(j.toString(10))).join("")).concat(this.eol)).join("")}}function Ke(ve){return new Ye().parse(ve)}function _t(ve,w){return new Rr().print(ve,w)}}},i={};function o(a){if(i[a])return i[a].exports;var l=i[a]={exports:{}};return t[a](l,l.exports,o),l.exports}return o.d=(a,l)=>{for(var u in l)o.o(l,u)&&!o.o(a,u)&&Object.defineProperty(a,u,{enumerable:!0,get:l[u]})},o.o=(a,l)=>Object.prototype.hasOwnProperty.call(a,l),o.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},o(8)})()})(VL);var Yt=VL.exports;function js(n){if(Array.isArray(n))return n.map(t=>t);if(!FL(n))return n;const e={};for(const t in n){const i=n[t];FL(i)||Array.isArray(i)?e[t]=js(i):e[t]=i}return e}function FL(n){return!(typeof n!="object"||Array.isArray(n)||!n)}class K0{constructor(e){S(this,"input",[]),S(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const Bo={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Np={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Bo,remoteCandidate:Bo}},jL={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0},BL={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},GL={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},WL={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function HL(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}function KL(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?HL(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):HL(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}class z0{constructor(e,t){S(this,"onFirstVideoReceived",void 0),S(this,"onFirstVideoDecoded",void 0),S(this,"onFirstAudioReceived",void 0),S(this,"onFirstVideoDecodedTimeout",void 0),S(this,"onFirstAudioDecoded",void 0),S(this,"onSelectedLocalCandidateChanged",void 0),S(this,"onSelectedRemoteCandidateChanged",void 0),S(this,"videoIsReady",!1),S(this,"videoIsReady2",{}),S(this,"pc",void 0),S(this,"options",void 0),S(this,"intervalTimer",void 0),S(this,"stats",js(Np)),S(this,"isFirstVideoReceived",{}),S(this,"isFirstVideoDecoded",{}),S(this,"isFirstAudioReceived",{}),S(this,"isFirstAudioDecoded",{}),S(this,"isFirstVideoDecodedTimeout",{}),S(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new X(e=>{e({local:KL({},Bo),remote:KL({},Bo)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,i=["videoSend","audioSend","videoRecv","audioRecv"];let o=0,a=0,l=0,u=0;for(const h of i)e[h].forEach((f,m)=>{if(!this.lossRateWindowStats[t-1][h][m]||!this.lossRateWindowStats[0][h][m])return;const E=this.lossRateWindowStats[t-1][h][m].packets-this.lossRateWindowStats[0][h][m].packets,v=this.lossRateWindowStats[t-1][h][m].packetsLost-this.lossRateWindowStats[0][h][m].packetsLost;h==="videoSend"||h==="audioSend"?(o+=E,l+=v):(a+=E,u+=v),Number.isNaN(E)||Number.isNaN(E)?f.packetLostRate=0:f.packetLostRate=E<=0||v<=0?0:v/(E+v)});e.sendPacketLossRate=o<=0||l<=0?0:l/(o+l),e.recvPacketLossRate=a<=0||u<=0?0:u/(a+u)}}function zL(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}function J7(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?zL(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):zL(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}class X7 extends z0{constructor(){super(...arguments),S(this,"_stats",Np),S(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=js(Np);const i=t.filter(a=>a.type==="ssrc");this.processSSRCStats(i);const o=t.find(a=>a.type==="VideoBwe");o&&this.processBandwidthStats(o),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var i;const o=Ie(i=t.id).call(i,"send");switch("".concat(t.mediaType,"_").concat(o?"send":"recv")){case"video_send":{const a=js(BL);a.codec=t.googCodecName,a.adaptionChangeReason="none",t.googCpuLimitedResolution&&(a.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(a.adaptionChangeReason="bandwidth"),a.avgEncodeMs=Number(t.googAvgEncodeMs),a.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},a.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},a.firsCount=Number(t.googFirReceived),a.nacksCount=Number(t.googNacksReceived),a.plisCount=Number(t.googPlisReceived),a.frameCount=Number(t.framesEncoded),a.bytes=Number(t.bytesSent),a.packets=Number(t.packetsSent),a.packetsLost=Number(t.packetsLost),a.ssrc=Number(t.ssrc),a.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(a),this._stats.rtt=a.rttMs;break}case"video_recv":{const a=js(jL),l=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(a.codec=t.googCodecName,a.targetDelayMs=Number(t.googTargetDelayMs),a.renderDelayMs=Number(t.googRenderDelayMs),a.currentDelayMs=Number(t.googCurrentDelayMs),a.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),a.decodeMs=Number(t.googDecodeMs),a.maxDecodeMs=Number(t.googMaxDecodeMs),a.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},a.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},a.decodeFrameRate=Number(t.googFrameRateDecoded),a.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},a.jitterBufferMs=Number(t.googJitterBufferMs),a.firsCount=Number(t.googFirsSent),a.nacksCount=Number(t.googNacksSent),a.plisCount=Number(t.googPlisSent),a.framesDecodeCount=Number(t.framesDecoded),a.bytes=Number(t.bytesReceived),a.packets=Number(t.packetsReceived),a.packetsLost=Number(t.packetsLost),a.ssrc=Number(t.ssrc),a.packets>0&&!this.isFirstVideoReceived[a.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(a.ssrc),this.isFirstVideoReceived[a.ssrc]=!0),a.framesDecodeCount>0&&!this.isFirstVideoDecoded[a.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(a.ssrc,a.decodedFrame.width,a.decodedFrame.height),this.isFirstVideoDecoded[a.ssrc]=!0),l){const u=l.stats,h=Date.now()-l.lts;a.framesDecodeFreezeTime=u.framesDecodeFreezeTime,a.framesDecodeInterval=u.framesDecodeInterval,a.framesDecodeCount>u.framesDecodeCount&&this.isFirstVideoDecoded[a.ssrc]?(l.lts=Date.now(),a.framesDecodeInterval=h,a.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?a.framesDecodeFreezeTime+=a.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):a.framesDecodeCount<l.stats.framesDecodeCount&&(a.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(a.ssrc,{stats:J7({},a),lts:Date.now()}),this._stats.videoRecv.push(a);break}case"audio_recv":{const a=js(WL);a.codec=t.googCodecName,a.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,a.decodingCNG=Number(t.googDecodingCNG),a.decodingCTN=Number(t.googDecodingCTN),a.decodingCTSG=Number(t.googDecodingCTSG),a.decodingNormal=Number(t.googDecodingNormal),a.decodingPLC=Number(t.googDecodingPLC),a.decodingPLCCNG=Number(t.googDecodingPLCCNG),a.expandRate=Number(t.googExpandRate),a.accelerateRate=Number(t.googAccelerateRate),a.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),a.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),a.speechExpandRate=Number(t.googSpeechExpandRate),a.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),a.jitterBufferMs=Number(t.googJitterBufferMs),a.jitterMs=Number(t.googJitterReceived),a.bytes=Number(t.bytesReceived),a.packets=Number(t.packetsReceived),a.packetsLost=Number(t.packetsLost),a.ssrc=Number(t.ssrc),a.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),a.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),a.receivedFrames>0&&!this.isFirstAudioReceived[a.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(a.ssrc),this.isFirstAudioReceived[a.ssrc]=!0),a.decodingNormal>0&&!this.isFirstAudioDecoded[a.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(a.ssrc),this.isFirstAudioDecoded[a.ssrc]=!0),this._stats.audioRecv.push(a);break}case"audio_send":{const a=js(GL);a.codec=t.googCodecName,a.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,a.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),a.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),a.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),a.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),a.bytes=Number(t.bytesSent),a.packets=Number(t.packetsSent),a.packetsLost=Number(t.packetsLost),a.ssrc=Number(t.ssrc),a.rttMs=Number(t.googRtt||0),this._stats.rtt=a.rttMs,this._stats.audioSend.push(a);break}}})}_getStats(){return new X((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){const t=[];return e.result().forEach(i=>{const o={id:i.id,timestamp:i.timestamp.valueOf().toString(),type:i.type};i.names().forEach(a=>{o[a]=i.stat(a)}),t.push(o)}),t}}function YL(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}function Fl(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?YL(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):YL(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}class qL extends z0{constructor(){super(...arguments),S(this,"_stats",Np),S(this,"report",void 0),S(this,"lastDecodeVideoReceiverStats",new Map),S(this,"lastVideoFramesRecv",new Map),S(this,"lastVideoFramesSent",new Map),S(this,"lastVideoFramesDecode",new Map),S(this,"lastVideoJBDelay",new Map),S(this,"lastAudioJBDelay",new Map),S(this,"mediaBytesSent",new Map),S(this,"mediaBytesRetransmit",new Map),S(this,"mediaBytesTargetEncode",new Map),S(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=js(Np),this.report.forEach(e=>{switch(e.type){case sr.OUTBOUND:case sr.INBOUND:{const t=e.mediaType||e.kind,i=!t&&"frameWidth"in e,o=!t&&!("frameWidth"in e);e.type===sr.OUTBOUND?t==="audio"||o?this.processAudioOutboundStats(e):(t==="video"||i)&&this.processVideoOutboundStats(e):e.type===sr.INBOUND&&(t==="audio"||o?this.processAudioInboundStats(e):(t==="video"||i)&&this.processVideoInboundStats(e));break}case sr.TRANSPORT:{const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case sr.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:Fl({},Bo),remote:Fl({},Bo)};return e.forEach(i=>{let o;if(i.type===sr.TRANSPORT&&(o=e.get(i.selectedCandidatePairId)),i.type===sr.CANDIDATE_PAIR&&i.selected&&(o=i),o){const a=(l,u)=>{l.type=u.type,l.id=u.id,u.address&&(l.address=u.address),u.candidateType&&(l.candidateType=u.candidateType),u.port&&(l.port=u.port),u.priority&&(l.priority=u.priority),u.protocol&&(l.protocol=u.protocol),u.relayProtocol&&(l.relayProtocol=u.relayProtocol)};if(o.localCandidateId){const l=e.get(o.localCandidateId);l&&a(t.local,l)}if(o.remoteCandidateId){const l=e.get(o.remoteCandidateId);l&&a(t.remote,l)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===sr.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===sr.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===sr.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Fl({},t),Fl({},this.stats.selectedCandidatePair.localCandidate)),e.type===sr.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Fl({},t),Fl({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(i=>i.ssrc===e.ssrc);t||(t=js(WL),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,this.processAudioTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples)}processVideoInboundStats(e){let t=this._stats.videoRecv.find(l=>l.ssrc===e.ssrc);t||(t=js(jL),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay;const i=this.lastDecodeVideoReceiverStats.get(t.ssrc),o=this.lastVideoFramesDecode.get(t.ssrc),a=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const l=t.decodedFrame?t.decodedFrame.width:0,u=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,l,u),this.isFirstVideoDecoded[t.ssrc]=!0}if(i){const l=i.stats,u=a-i.lts;t.framesDecodeFreezeTime=l.framesDecodeFreezeTime,t.framesDecodeInterval=l.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&u>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>l.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(i.lts=Date.now(),t.framesDecodeInterval=u,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<l.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(i.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-i.qpSum)/(e.framesDecoded-i.stats.framesDecodeCount))}o&&a-o.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-o.count)/((a-o.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:a,rate:t.decodeFrameRate})):o?t.decodeFrameRate=o.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:a,rate:0}),e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:Fl({},t),lts:i?i.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(o=>o.ssrc===e.ssrc);t||(t=js(BL),this._stats.videoSend.push(t));const i=this.mediaBytesSent.get(e.ssrc);if(i)i.add(e.bytesSent);else{const o=new K0(10);o.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,o)}if(e.retransmittedBytesSent!==void 0){const o=this.mediaBytesRetransmit.get(e.ssrc);if(o)o.add(e.retransmittedBytesSent);else{const a=new K0(10);a.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,a)}}if(e.totalEncodedBytesTarget){const o=this.mediaBytesTargetEncode.get(e.ssrc);if(o)o.add(e.totalEncodedBytesTarget);else{const a=new K0(10);a.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,a)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,e.totalEncodeTime&&e.framesEncoded){const o=this.lastEncoderMs.get(e.ssrc);if(!o||o.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const a=e.framesEncoded-o.lastFrameCount,l=e.totalEncodeTime-o.lastEncoderTime;t.avgEncodeMs=1e3*l/a}}if(e.framesEncoded&&e.qpSum){const o=this.lastEncoderMs.get(e.ssrc);!o||o.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-o.lastQpSum)/(e.framesEncoded-o.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const o=this.findRemoteStatsId(e.ssrc,sr.REMOTE_INBOUND);o&&this.processRemoteInboundStats(o,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(i=>i.ssrc===e.ssrc);if(t||(t=js(GL),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const i=this.findRemoteStatsId(e.ssrc,sr.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,t)}}findRemoteStatsId(e,t){var i;const o=Array.from(no(i=this.report).call(i)).find(a=>a.type===t&&a.ssrc===e);return o?o.id:null}processVideoMediaSource(e,t){const i=this.report.get(e);i&&i.width&&i.height&&i.framesPerSecond&&(t.inputFrame={width:i.width,height:i.height,frameRate:i.framesPerSecond})}processAudioMediaSource(e,t){const i=this.report.get(e);i&&(t.inputLevel=i.audioLevel)}processVideoTrackSenderStats(e,t,i){var o,a,l,u;const h=t?this.report.get(t):void 0,f=(o=h==null?void 0:h.framesSent)!==null&&o!==void 0?o:e.framesSent;if(typeof f!="number")return;let m=(a=h==null?void 0:h.frameWidth)!==null&&a!==void 0?a:e.frameWidth,E=(l=h==null?void 0:h.frameHeight)!==null&&l!==void 0?l:e.frameHeight,v=(u=h==null?void 0:h.framesPerSecond)!==null&&u!==void 0?u:e.framesPerSecond;if(typeof m=="number"&&typeof E=="number"||(m=0,E=0),v==null){const T=Date.now(),A=this.lastVideoFramesSent.get(i.ssrc);A&&T-A.lts>=800?(v=Math.round((f-A.count)/((T-A.lts)/1e3)),this.lastVideoFramesSent.set(i.ssrc,{count:f,lts:T,rate:v})):A?v=A.rate:this.lastVideoFramesSent.set(i.ssrc,{count:f,lts:T,rate:0})}i.sentFrame={width:m,height:E,frameRate:Math.max(0,v)}}processVideoTrackReceiverStats(e,t,i){var o,a,l,u,h;const f=t?this.report.get(t):void 0,m=(o=f==null?void 0:f.framesReceived)!==null&&o!==void 0?o:e.framesReceived,E=(a=f==null?void 0:f.frameWidth)!==null&&a!==void 0?a:e.frameWidth,v=(l=f==null?void 0:f.frameHeight)!==null&&l!==void 0?l:e.frameHeight,T=(u=f==null?void 0:f.jitterBufferDelay)!==null&&u!==void 0?u:e.jitterBufferDelay,A=(h=f==null?void 0:f.jitterBufferEmittedCount)!==null&&h!==void 0?h:e.jitterBufferEmittedCount;if(typeof m=="number"){const C=this.lastVideoFramesRecv.get(i.ssrc),b=Date.now();i.framesReceivedCount=m;let D=0;C&&b-C.lts>=800?(D=Math.round((m-C.count)/((b-C.lts)/1e3)),this.lastVideoFramesRecv.set(i.ssrc,{count:m,lts:b,rate:D})):C?D=C.rate:this.lastVideoFramesRecv.set(i.ssrc,{count:m,lts:b,rate:0}),i.receivedFrame={width:E||0,height:v||0,frameRate:D||0},i.decodedFrame={width:E||0,height:v||0,frameRate:i.decodeFrameRate||0},i.outputFrame={width:E||0,height:v||0,frameRate:i.decodeFrameRate||0}}if(T&&A){const C=this.lastVideoJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let b=C.jitterBufferMs;const D=A-C.jitterBufferEmittedCount;D>0&&(b=1e3*(T-C.jitterBufferDelay)/D),i.jitterBufferMs=b,i.currentDelayMs=Math.round(b),this.lastVideoJBDelay.set(i.ssrc,{jitterBufferDelay:T,jitterBufferEmittedCount:A,jitterBufferMs:i.currentDelayMs})}}processAudioTrackSenderStats(e,t,i){var o,a,l,u;const h=t?this.report.get(t):void 0,f=(o=(a=h==null?void 0:h.echoReturnLoss)!==null&&a!==void 0?a:e.echoReturnLoss)!==null&&o!==void 0?o:0,m=(l=(u=h==null?void 0:h.echoReturnLossEnhancement)!==null&&u!==void 0?u:e.echoReturnLossEnhancement)!==null&&l!==void 0?l:0;i.aecReturnLoss=f,i.aecReturnLossEnhancement=m}processAudioTrackReceiverStats(e,t,i){var o,a,l,u,h,f,m;const E=t?this.report.get(t):void 0,v=(o=E==null?void 0:E.removedSamplesForAcceleration)!==null&&o!==void 0?o:e.removedSamplesForAcceleration,T=(a=E==null?void 0:E.totalSamplesReceived)!==null&&a!==void 0?a:e.totalSamplesReceived,A=(l=E==null?void 0:E.jitterBufferDelay)!==null&&l!==void 0?l:e.jitterBufferDelay,C=(u=E==null?void 0:E.jitterBufferEmittedCount)!==null&&u!==void 0?u:e.jitterBufferEmittedCount,b=(h=E==null?void 0:E.audioLevel)!==null&&h!==void 0?h:e==null?void 0:e.audioLevel,D=(f=E==null?void 0:E.totalSamplesDuration)!==null&&f!==void 0?f:e==null?void 0:e.totalSamplesDuration,M=(m=E==null?void 0:E.concealedSamples)!==null&&m!==void 0?m:e.concealedSamples;if(v&&T&&(i.accelerateRate=v/T),A&&C){const J=this.lastAudioJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let G=J.jitterBufferMs;const q=C-J.jitterBufferEmittedCount;q>0&&(G=1e3*(A-J.jitterBufferDelay)/q),i.jitterBufferMs=Math.round(G),this.lastAudioJBDelay.set(i.ssrc,{jitterBufferDelay:A,jitterBufferEmittedCount:C,jitterBufferMs:i.jitterBufferMs})}i.outputLevel=b;let B=1920;D&&T&&(B=T/D/50,i.receivedFrames=Math.round(T/B)),M&&(i.droppedFrames=Math.round(M/B))}processRemoteInboundStats(e,t){const i=this.report.get(e);i&&(t.packetsLost=i.packetsLost,i.roundTripTime&&(t.rttMs=1e3*i.roundTripTime),i.jitter&&(t.jitterMs=1e3*i.jitter),i.timestamp&&(t.timestamp=i.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const i=t.mimeType.match(/\/(.*)$/);return i&&i[1]?i[1]:""}updateSendBitrate(){let e=0,t=null,i=null;this.mediaBytesSent.forEach(a=>{e+=a.diffMean()}),this.mediaBytesRetransmit.forEach(a=>{t=t===null?a.diffMean():t+a.diffMean()}),this.mediaBytesTargetEncode.forEach(a=>{i=i===null?a.diffMean():i+a.diffMean()});const o=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*o/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),i!==null&&(this._stats.bitrate.targetEncoded=8*i/(this.options.updateInterval/1e3))}}class Q7 extends z0{updateStats(){return X.resolve()}}function aE(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const a=function(){const l=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return l&&l[0]?Number(l[0].split("/")[1]):null}();return a?a<76?new X7(n,{updateInterval:e,lossRateInterval:t,freezeRateLimit:i,firstVideoDecodedTimeout:o}):new qL(n,{updateInterval:e,lossRateInterval:t,freezeRateLimit:i,firstVideoDecodedTimeout:o}):function(l){return!!window.RTCStatsReport&&l.getStats()instanceof X}(n)?new qL(n,{updateInterval:e,lossRateInterval:t,freezeRateLimit:i,firstVideoDecodedTimeout:o}):new Q7(n,{updateInterval:e,lossRateInterval:t,freezeRateLimit:i,firstVideoDecodedTimeout:o})}function JL(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}function XL(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?JL(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):JL(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function Pp(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;const{filterRTX:o,filterVideoFec:a,filterAudioFec:l,filterAudioCodec:u,filterVideoCodec:h}=e,{useXR:f}=t;let m=[],E=[],v=[],T=[],A=!1,C=!1;if(Yt.parse(n).mediaDescriptions.forEach(D=>{i&&i!==D.attributes.direction||(D.media.mediaType!=="video"||A||(E=D.attributes.payloads,T=D.attributes.extmaps,A=!0),D.media.mediaType!=="audio"||C||(m=D.attributes.payloads,v=D.attributes.extmaps,C=!0))}),!T||E.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!v||m.length===0)throw new Error("Cannot get audio capabilities from SDP.");E.forEach(D=>{var M;(M=D.rtpMap)!==null&&M!==void 0&&M.clockRate&&(D.rtpMap.clockRate=parseInt(D.rtpMap.clockRate)),f&&D.rtcpFeedbacks.push({type:"rrtr"})}),m.forEach(D=>{var M;(M=D.rtpMap)!==null&&M!==void 0&&M.clockRate&&(D.rtpMap.clockRate=parseInt(D.rtpMap.clockRate)),f&&D.rtcpFeedbacks.push({type:"rrtr"})}),o&&(m=m.filter(D=>{var M;return((M=D.rtpMap)===null||M===void 0?void 0:M.encodingName.toLowerCase())!=="rtx"}),E=E.filter(D=>{var M;return((M=D.rtpMap)===null||M===void 0?void 0:M.encodingName.toLowerCase())!=="rtx"})),a&&(E=E.filter(D=>{var M;return!/(red)|(ulpfec)|(flexfec)/i.test(((M=D.rtpMap)===null||M===void 0?void 0:M.encodingName)||"")})),l&&(m=m.filter(D=>{var M;return!/(red)|(ulpfec)|(flexfec)/i.test(((M=D.rtpMap)===null||M===void 0?void 0:M.encodingName)||"")})),u&&(u==null?void 0:u.length)>0&&(m=m.filter(D=>{var M;return Ie(u).call(u,((M=D.rtpMap)===null||M===void 0?void 0:M.encodingName.toLowerCase())||"")})),h&&(h==null?void 0:h.length)>0&&(E=E.filter(D=>{var M;return Ie(h).call(h,((M=D.rtpMap)===null||M===void 0?void 0:M.encodingName.toLowerCase())||"")}));const b=V("UNSUPPORTED_VIDEO_CODEC");return b&&b.length>0&&(E=E.filter(D=>!(D.rtpMap&&Ie(b).call(b,D.rtpMap.encodingName.toLowerCase())))),{audioCodecs:m,videoCodecs:E,audioExtensions:v,videoExtensions:T}}function ao(n){const e=Yt.parse(n);let t,i;for(const o of e.mediaDescriptions){if(!t){const a=o.attributes.iceUfrag,l=o.attributes.icePwd;if(!a||!l)throw new Error("Cannot get iceUfrag or icePwd from SDP.");t={iceUfrag:a,icePwd:l}}if(!i){const a=o.attributes.fingerprints;a.length>0&&(i={fingerprints:a})}}if(!i&&e.attributes.fingerprints.length>0&&(i={fingerprints:e.attributes.fingerprints}),!i||!t)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:t,dtlsParameters:i}}function Y0(n,e){const t=[],i=n.attributes.ssrcGroups.filter(l=>l.semantic==="FID"),o=n.attributes.ssrcGroups.find(l=>l.semantic==="SIM"),a=n.attributes.ssrcs;if(o)o.ssrcIds.forEach(l=>{var u;const h=(u=i.find(f=>f.ssrcIds[0]===l))===null||u===void 0?void 0:u.ssrcIds[1];t.push({ssrcId:l,rtx:e?h:void 0})});else if(i.length>0){const l=i[0].ssrcIds[0],u=i[0].ssrcIds[1];t.push({ssrcId:l,rtx:e?u:void 0})}else{if(a.length===0)throw new Error("No ssrcs found on local media description.");t.push({ssrcId:a[0].ssrcId})}return t}function QL(n,e){const{cname:t}=n;let i;e&&e.ip&&typeof e.port=="number"?(i=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],y.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(i.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),y.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))):i=n.iceParameters.candidates.map(u=>({foundation:u.foundation,componentId:"1",transport:u.protocol,priority:u.priority.toString(),connectionAddress:u.ip,port:u.port.toString(),type:u.type,extension:{}}));const o={fingerprints:n.dtlsParameters.fingerprints.map(u=>({hashFunction:u.algorithm,fingerprint:u.fingerprint}))},a={iceUfrag:n.iceParameters.iceUfrag,icePwd:n.iceParameters.icePwd};let l;switch(n.dtlsParameters.role){case"server":l="passive";break;case"client":l="active";break;case"auto":l="actpass"}return{dtlsParameters:o,iceParameters:a,candidates:i,rtpCapabilities:mu(n.rtpCapabilities),setup:l,cname:t}}function cr(n,e,t){const i=[],o=[];return n.forEach(a=>{let{ssrcId:l,rtx:u}=a;const h=Lt(8,"track-"),f={ssrcId:l,attributes:XL({label:h,mslabel:t=t||Lt(10,""),msid:"".concat(t," ").concat(h)},e&&{cname:e})};if(i.push(f),u!==void 0){const m={ssrcId:u,attributes:XL({label:h,mslabel:t,msid:"".concat(t," ").concat(h)},e&&{cname:e})};i.push(m),o.push({semantic:"FID",ssrcIds:[l,u]})}}),n.length>1&&o.push({semantic:"SIM",ssrcIds:n.map(a=>{let{ssrcId:l}=a;return l})}),{ssrcs:i,ssrcGroups:o}}function Ic(n,e){e instanceof bt&&n.attributes.payloads.forEach(t=>{var i;const o=(i=t.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase();if(!o||["opus","pcmu","pcma","g722"].indexOf(o)===-1)return;t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.minptime="10",t.fmtp.parameters.useinbandfec="1";const a=e._encoderConfig;a&&o!=="pcmu"&&o!=="pcma"&&o!=="g722"&&(a.bitrate&&!Pt()&&(t.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*a.bitrate))),a.sampleRate&&(t.fmtp.parameters.maxplaybackrate="".concat(a.sampleRate),t.fmtp.parameters["sprop-maxcapturerate"]="".concat(a.sampleRate)),a.stereo&&(t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"))})}function cE(n){const e=n.attributes.unrecognized.findIndex(t=>t.attField==="x-google-flag"&&t.attValue==="conference");e!==-1&&n.attributes.unrecognized.splice(e,1)}function lE(n,e){var t;if(!(e instanceof et&&e._encoderConfig&&e._hints.indexOf(Ut.SCREEN_TRACK)===-1))return;const i=e._encoderConfig;mt().supportMinBitrate&&i.bitrateMin&&n.attributes.payloads.forEach(o=>{var a,l;Ie(a=["h264","h265","vp8","vp9","av1"]).call(a,((l=o.rtpMap)===null||l===void 0?void 0:l.encodingName.toLowerCase())||"")&&(o.fmtp||(o.fmtp={parameters:{}}),o.fmtp.parameters["x-google-min-bitrate"]="".concat(i.bitrateMin))}),mt().supportMinBitrate&&!Ie(t=e._hints).call(t,Ut.LOW_STREAM)&&i.bitrateMax&&n.attributes.payloads.forEach(o=>{var a,l;Ie(a=["h264","h265","vp8","vp9","av1"]).call(a,((l=o.rtpMap)===null||l===void 0?void 0:l.encodingName.toLowerCase())||"")&&(o.fmtp||(o.fmtp={parameters:{}}),o.fmtp.parameters["x-google-start-bitrate"]="".concat(V("X_GOOGLE_START_BITRATE")||Math.floor(i.bitrateMax)))})}function q0(n){if(n.media.mediaType!=="video")return;const e=ft();if(e.name!==St.SAFARI&&e.os!==Nn.IOS)return;const t=n.attributes.extmaps.findIndex(i=>/video-orientation/g.test(i.extensionName));t!==-1&&n.attributes.extmaps.splice(t,1)}function fu(n,e,t){if(!e)return;let i,o;if(n.media.mediaType==="video"?(i=t.videoExtensions,o=t.videoCodecs):(i=t.audioExtensions,o=t.audioCodecs),e.twcc===!0){const a=i.find(l=>l.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");a&&(n.attributes.extmaps.find(u=>u.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||n.attributes.extmaps.push({entry:a.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(u,h){return h.filter(f=>!!u.find(m=>m.payloadType===f.payloadType&&!!m.rtcpFeedbacks.find(E=>E.type==="transport-cc")))}(o,n.attributes.payloads).forEach(u=>{u.rtcpFeedbacks.find(h=>h.type==="transport-cc")||u.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(e.twcc===!1){const a=n.attributes.extmaps.findIndex(l=>l.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");a!==-1&&n.attributes.extmaps.splice(a,1),n.attributes.payloads.forEach(l=>{const u=l.rtcpFeedbacks.findIndex(h=>h.type==="transport-cc");u!==-1&&l.rtcpFeedbacks.splice(u,1)})}if(e.remb===!0){const a=i.find(l=>l.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");a&&(n.attributes.extmaps.find(u=>u.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||n.attributes.extmaps.push({entry:a.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(u,h){return h.filter(f=>!!u.find(m=>m.payloadType===f.payloadType&&!!m.rtcpFeedbacks.find(E=>E.type==="goog-remb")))}(o,n.attributes.payloads).forEach(u=>{u.rtcpFeedbacks.find(h=>h.type==="goog-remb")||u.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(e.remb===!1){const a=n.attributes.extmaps.findIndex(l=>l.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");a!==-1&&n.attributes.extmaps.splice(a,1),n.attributes.payloads.forEach(l=>{const u=l.rtcpFeedbacks.findIndex(h=>h.type==="goog-remb");u!==-1&&l.rtcpFeedbacks.splice(u,1)})}}function J0(n,e,t){if(Pt()||n.media.mediaType!=="video"||!(e instanceof et)||t!=="vp9"&&t!=="vp8"||t==="vp8"&&!V("SIMULCAST")||e._scalabilityMode===void 0||e._scalabilityMode.numSpatialLayers<=1)return;const i=t==="vp8"?2:e._scalabilityMode.numSpatialLayers,o=n.attributes.ssrcs[0],a=n.attributes.ssrcGroups.find(u=>u.semantic==="FID"&&u.ssrcIds[0]===o.ssrcId),l={semantic:"SIM",ssrcIds:[o.ssrcId]};for(let u=1;u<i;u++)n.attributes.ssrcs.push({ssrcId:o.ssrcId+u,attributes:xt(o.attributes)}),l.ssrcIds.push(o.ssrcId+u),a&&(n.attributes.ssrcs.push({ssrcId:a.ssrcIds[1]+u,attributes:xt(o.attributes)}),n.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[o.ssrcId+u,a.ssrcIds[1]+u]}));n.attributes.ssrcGroups.unshift(l)}async function X0(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=new RTCPeerConnection;t.addTransceiver("video",{direction:"sendonly"}),t.addTransceiver("audio",{direction:"sendonly"}),t.addTransceiver("video",{direction:"recvonly"}),t.addTransceiver("audio",{direction:"recvonly"});const i=(await t.createOffer()).sdp,{send:o,recv:a,sendrecv:l}=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},f=arguments.length>2?arguments[2]:void 0;const m=Pp(f,u,h,"sendonly"),E=Pp(f,u,h,"recvonly"),v={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},T={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},A={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Bs(m,E,"videoExtensions",v,T,A),Bs(m,E,"videoCodecs",v,T,A),Bs(m,E,"audioExtensions",v,T,A),Bs(m,E,"audioCodecs",v,T,A),V("RAISE_H264_BASELINE_PRIORITY")){const C=A.videoCodecs.findIndex(b=>{var D,M;return((D=b.rtpMap)===null||D===void 0?void 0:D.encodingName.toLocaleLowerCase())==="h264"&&((M=b.fmtp)===null||M===void 0?void 0:M.parameters["profile-level-id"])==="42001f"});if(C!==-1){const b=A.videoCodecs.findIndex(D=>{var M;return((M=D.rtpMap)===null||M===void 0?void 0:M.encodingName.toLocaleLowerCase())==="h264"});if(b<C){y.debug("raising H264 baseline profile priority");const D=A.videoCodecs[C];A.videoCodecs.splice(C,1),A.videoCodecs.splice(b,0,D)}b!==-1&&(T.videoCodecs=T.videoCodecs.filter(D=>{var M,B;return!(((M=D.rtpMap)===null||M===void 0?void 0:M.encodingName.toLocaleLowerCase())==="h264"&&((B=D.fmtp)===null||B===void 0?void 0:B.parameters["profile-level-id"])!=="42001f")})),b!==-1&&V("FILTER_SEND_H264_BASELINE")&&(v.videoCodecs=v.videoCodecs.filter(D=>{var M,B;return!(((M=D.rtpMap)===null||M===void 0?void 0:M.encodingName.toLocaleLowerCase())==="h264"&&((B=D.fmtp)===null||B===void 0?void 0:B.parameters["profile-level-id"])!=="42001f")}))}}return{send:v,recv:T,sendrecv:A}}(n,e,i);try{t.close()}catch{}return{send:o,recv:a,sendrecv:l}}function $L(){const n={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},e=Pp(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),t={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Bs(n,e,"videoExtensions",t,i,o),Bs(n,e,"videoCodecs",t,i,o),Bs(n,e,"audioExtensions",t,i,o),Bs(n,e,"audioCodecs",t,i,o),V("RAISE_H264_BASELINE_PRIORITY")){const a=o.videoCodecs.findIndex(l=>l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&l.fmtp&&l.fmtp.parameters["profile-level-id"]==="42001f");if(a!==-1){const l=o.videoCodecs.findIndex(u=>u.rtpMap&&u.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(l<a){y.debug("raising H264 baseline profile priority");const u=o.videoCodecs[a];o.videoCodecs.splice(a,1),o.videoCodecs.splice(l,0,u)}l!==-1&&(i.videoCodecs=i.videoCodecs.filter(u=>!(u.rtpMap&&u.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&u.fmtp&&u.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:t,recv:i,sendrecv:o}}function Bs(n,e,t,i,o,a){if(t==="videoExtensions"||t==="audioExtensions"){const l=[];return n[t].forEach(u=>{e[t].some((h,f)=>{if(u.entry===h.entry&&u.extensionName===h.extensionName)return l.push(f),!0})?a[t].push(u):i[t].push(u)}),void e[t].forEach((u,h)=>{l.indexOf(h)===-1&&o[t].push(u)})}if(t==="videoCodecs"||t==="audioCodecs"){const l=[];return n[t].forEach(u=>{e[t].some((h,f)=>{if(u.payloadType===h.payloadType&&JSON.stringify(u)===JSON.stringify(h))return l.push(f),!0})?a[t].push(u):i[t].push(u)}),void e[t].forEach((u,h)=>{l.indexOf(h)===-1&&o[t].push(u)})}}function mu(n){const{send:e,recv:t,sendrecv:i}=n;if(!i){if(!e||!t)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:e,recv:t}}let o,a;return e?(o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o.audioCodecs=[...e.audioCodecs,...i.audioCodecs],o.videoCodecs=[...e.videoCodecs,...i.videoCodecs],o.audioExtensions=[...e.audioExtensions,...i.audioExtensions],o.videoExtensions=[...e.videoExtensions,...i.videoExtensions]):o=i,t?(a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a.audioCodecs=[...t.audioCodecs,...i.audioCodecs],a.videoCodecs=[...t.videoCodecs,...i.videoCodecs],a.audioExtensions=[...t.audioExtensions,...i.audioExtensions],a.videoExtensions=[...t.videoExtensions,...i.videoExtensions]):a=i,{send:o,recv:a}}function co(n){n.media.mediaType==="audio"&&n.attributes.payloads.filter(e=>{var t;return((t=e.rtpMap)===null||t===void 0?void 0:t.encodingName.toLowerCase())==="opus"}).forEach(e=>{e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"})}function Dp(n){n.mediaDescriptions.forEach(e=>{e.media.mediaType!=="video"&&e.media.mediaType!=="audio"||e.attributes.payloads.forEach(t=>{t.rtcpFeedbacks.findIndex(i=>i.type==="rrtr")===-1&&t.rtcpFeedbacks.push({type:"rrtr"})})})}function jl(n,e,t,i){let o=[];if(n===be.VIDEO){if(V("H264_PROFILE_LEVEL_ID")&&i==="h264"&&(o=e.videoCodecs.filter(a=>{var l;return Ie(l=a.rtpMap&&a.rtpMap.encodingName.toLowerCase()||"").call(l,i)&&a&&a.fmtp&&a.fmtp.parameters["profile-level-id"]===V("H264_PROFILE_LEVEL_ID")})),!Array.isArray(o)||o.length===0){let a=[];const l=[],u=[];t.videoCodecs.forEach(h=>{var f,m,E;Ie(f=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(f,i)&&a.push(h),Ie(m=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(m,"vp8")&&l.push(h),Ie(E=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(E,"h264")&&u.push(h)}),a.length===0&&(l.length!==0?(a=l,y.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: vp8"))):u.length!==0&&(a=u,y.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: h264")))),a.length!==0&&(o=e.videoCodecs.filter(h=>a.some(f=>f.payloadType===h.payloadType)))}if(V("USE_PUB_RTX")){const a=o.map(u=>u.payloadType.toString()),l=e.videoCodecs.filter(u=>u.rtpMap&&u.rtpMap.encodingName==="rtx"&&Ie(a).call(a,u.fmtp&&u.fmtp.parameters.apt||""));o=[...o,...l]}o.length===0&&(y.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(e.videoCodecs[0].rtpMap&&e.videoCodecs[0].rtpMap.encodingName)),o=e.videoCodecs)}else o=e.audioCodecs.filter(a=>{var l;return Ie(l=a.rtpMap&&a.rtpMap.encodingName.toLowerCase()||"").call(l,i)}),o.length===0&&(y.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),o=e.audioCodecs.filter(a=>{var l;return Ie(l=a.rtpMap&&a.rtpMap.encodingName.toLowerCase()||"").call(l,"opus")}));return o}let ZL=class{get localCapabilities(){return xt(this._localCapabilities)}get rtpCapabilities(){return xt(this._rtpCapabilities)}get candidates(){return xt(this._candidates)}get iceParameters(){return xt(this._iceParameters)}get dtlsParameters(){return xt(this._dtlsParameters)}constructor(n){S(this,"sessionDesc",void 0),S(this,"_localCapabilities",void 0),S(this,"_rtpCapabilities",void 0),S(this,"_candidates",void 0),S(this,"_iceParameters",void 0),S(this,"_dtlsParameters",void 0),S(this,"setup",void 0),S(this,"currentMidIndex",void 0),S(this,"cname","o/i14u9pJrxRKAsu"),S(this,"firefoxSsrcMidMap",new Map),n=xt(n);const{remoteIceParameters:e,remoteDtlsParameters:t,candidates:i,remoteRTPCapabilities:o,localCapabilities:a,direction:l,setup:u,videoCodec:h,audioCodec:f}=n;let m;this.setup=u,m=l===Ii.RECEIVE_ONLY?Yt.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Yt.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=o,this._candidates=i,this._iceParameters=e,this._dtlsParameters=t,this._localCapabilities=a;const E=l===Ii.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,v=l===Ii.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,T=l===Ii.RECEIVE_ONLY?o.send.videoCodecs:jl(be.VIDEO,E,v,h),A=l===Ii.RECEIVE_ONLY?o.send.audioCodecs:jl(be.AUDIO,E,v,f);for(const C of m.mediaDescriptions){if(C.attributes.iceUfrag=e.iceUfrag,C.attributes.icePwd=e.icePwd,C.attributes.fingerprints=t.fingerprints,C.attributes.candidates=i,C.attributes.setup=this.setup,C.media.mediaType==="application"&&(C.attributes.sctpPort="5000"),C.media.mediaType==="video"&&(C.media.fmts=T.map(b=>b.payloadType.toString(10)),C.attributes.payloads=T,C.attributes.extmaps=E.videoExtensions,V("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:b,ssrcGroups:D}=cr([{ssrcId:4e4,rtx:V("USE_SUB_RTX")?40001:void 0}],this.cname);C.attributes.ssrcs=b,C.attributes.ssrcGroups=D}if(C.media.mediaType==="audio"&&(C.media.fmts=A.map(b=>b.payloadType.toString(10)),C.attributes.payloads=A,C.attributes.extmaps=E.audioExtensions,co(C),V("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:b,ssrcGroups:D}=cr([{ssrcId:2e4}],this.cname);C.attributes.ssrcs=b,C.attributes.ssrcGroups=D}}this.sessionDesc=m,this.currentMidIndex=m.mediaDescriptions.length-1}toString(){return Yt.print(this.sessionDesc)}hasMid(n){return Array.isArray(n)?n.every(e=>this.hasMid(e)):this.sessionDesc.mediaDescriptions.some(e=>e.attributes.mid===n)}send(n,e,t,i,o){t=t.replace(/ /g,"-");const{ssrcs:a,ssrcGroups:l}=cr(e,this.cname,V("SYNC_GROUP")?t:void 0),u=this.findPreloadMediaDesc(a);if(u){if(Pt()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,u.attributes.mid),o&&(o.twcc||o.remb)){const h=this.sessionDesc.mediaDescriptions.indexOf(u);return this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(u,o),{mid:u.attributes.mid,needExchangeSDP:!0}}return{mid:u.attributes.mid,needExchangeSDP:!1}}{const h=this.findAvailableMediaIndex(n,a,i);let f;return h===-1?(f=this.createOrRecycleSendMedia(n,a,l,"sendonly",i,o),this.updateBundleMids()):(f=xt(this.sessionDesc.mediaDescriptions[h]),f.attributes.direction="sendonly",f.attributes.ssrcs=a,f.attributes.ssrcGroups=l,this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(f,o)),Pt()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,f.attributes.mid),{needExchangeSDP:!0,mid:f.attributes.mid}}}stopSending(n){const e=this.sessionDesc.mediaDescriptions.filter(t=>t.attributes.mid&&n.indexOf(t.attributes.mid)!==-1);if(e.length!==n.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");e.forEach(t=>{t.attributes.ssrcs=[]}),this.updateBundleMids()}receive(n,e,t){const i=[];return n.forEach(o=>{const a=o._mediaStreamTrack.kind,l=this.findAvailableRecvMediaIndex(a);let u,h=!1;l===-1?(h=!0,u=this.createOrRecycleRecvMedia(o,[],"recvonly",e,t),this.updateBundleMids()):(u=xt(this.sessionDesc.mediaDescriptions[l]),u.attributes.direction="recvonly"),i.push({mid:u.attributes.mid,needCreateTransceiver:h})}),i}stopReceiving(n){const e=this.sessionDesc.mediaDescriptions.filter(t=>n.indexOf(t.attributes.mid)!==-1);if(e.length!==n.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");e.forEach(t=>{t.media.port="0",t.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(n){const{foundation:e,protocol:t,address:i,port:o,type:a,relatedAddress:l,relatedPort:u,priority:h}=new RTCIceCandidate(n),f={foundation:e??"",componentId:"1",transport:t??"",priority:h?h+"":"",connectionAddress:i??"",port:o?o+"":"",type:a?a+"":"",relAddr:l??"",relPort:u?u+"":"",extension:{}};this.candidates.some(m=>m.priority===f.priority&&m.connectionAddress===f.connectionAddress&&m.port===f.port)||(this._candidates.push(f),this.sessionDesc.mediaDescriptions.forEach(m=>{m.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(n,e,t,i,o){const a=n._mediaStreamTrack.kind,l=this.rtpCapabilities.recv,u=jl(a,l,this.localCapabilities.send,a===be.AUDIO?o:i),h=a===be.VIDEO?l.videoExtensions:l.audioExtensions,f="".concat(++this.currentMidIndex);let m={media:{mediaType:a,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map(v=>v.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:h,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:t,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(f)}};m=this.mungRecvMediaDsec(m,n);const E=this.findFirstClosedMedia(a);if(E){const v=this.sessionDesc.mediaDescriptions.indexOf(E);this.sessionDesc.mediaDescriptions[v]=m}else this.sessionDesc.mediaDescriptions.push(m);return m}muteRemote(n){const e=this.sessionDesc.mediaDescriptions.filter(t=>Ie(n).call(n,t.attributes.mid||""));if(e.length!==n.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(t=>{t.attributes.direction="inactive"})}unmuteRemote(n){const e=this.sessionDesc.mediaDescriptions.filter(t=>Ie(n).call(n,t.attributes.mid||""));if(e.length!==n.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(t=>{t.attributes.direction="recvonly"})}findAvailableMediaIndex(n,e,t){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const o=i.media.mediaType===n&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(Pt()){if(o){const a=this.firefoxSsrcMidMap.get(e[0].ssrcId);return!(a||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!a||a!==i.attributes.mid)}return!1}return o&&i.attributes.mid===t})}findAvailableRecvMediaIndex(n){return this.sessionDesc.mediaDescriptions.findIndex(e=>{const t=e.media.mediaType===n&&e.media.port!=="0"&&(e.attributes.direction==="recvonly"||e.attributes.direction==="sendrecv");return e.attributes.mid!=="0"&&e.attributes.mid!=="1"&&t})}predictReceivingMids(n){const e=[];for(let t=0;t<n;t++)e.push((this.currentMidIndex+t+1).toString(10));return e}restartICE(n){n=xt(n),this._iceParameters=n,this.sessionDesc.mediaDescriptions.forEach(e=>{e.attributes.iceUfrag=n.iceUfrag,e.attributes.icePwd=n.icePwd})}createOrRecycleSendMedia(n,e,t,i,o,a){const l=this.rtpCapabilities.send,u=n===be.VIDEO?l.videoCodecs:l.audioCodecs,h=n===be.VIDEO?l.videoExtensions:l.audioExtensions;Pt()&&(o="".concat(++this.currentMidIndex));let f={media:{mediaType:n,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map(E=>E.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:h,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:t,rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:o}};f=this.mungSendMediaDesc(f,a);const m=this.findFirstClosedMedia(n);if(m){const E=this.sessionDesc.mediaDescriptions.indexOf(m);this.sessionDesc.mediaDescriptions[E]=f}else this.sessionDesc.mediaDescriptions.push(f);return f}mungRecvMediaDsec(n,e,t){const i=xt(n);return cE(i),Ic(i,e),lE(i,e),q0(i),fu(i,t,this.localCapabilities.send),i}mungSendMediaDesc(n,e){const t=xt(n);return fu(t,e,this.localCapabilities.recv),co(t),t}updateRecvMedia(n,e){const t=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===n);if(t!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[t],e);this.sessionDesc.mediaDescriptions[t]=i}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(n=>n.media.port!=="0").map(n=>n.attributes.mid)}findPreloadMediaDesc(n){return this.sessionDesc.mediaDescriptions.find(e=>{var t;return((t=e.attributes)===null||t===void 0||(t=t.ssrcs[0])===null||t===void 0?void 0:t.ssrcId)===n[0].ssrcId})}findFirstClosedMedia(n){return this.sessionDesc.mediaDescriptions.find(e=>Pt()?e.media.port==="0"&&e.media.mediaType===n:e.media.port==="0")}};const $7=["sdp"];function eM(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}function wc(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?eM(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):eM(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}let Wr=class bu extends D1{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t;return(e=(t=this.peerConnection.getReceivers()[0])===null||t===void 0||(t=t.transport)===null||t===void 0?void 0:t.state)!==null&&e!==void 0?e:null}get localCodecs(){return[]}set isInRestartIce(e){this._isInRestartIce=e}get isInRestartIce(){return this._isInRestartIce}constructor(e,t,i){super(e,t),S(this,"direction",void 0),S(this,"name",void 0),S(this,"store",void 0),S(this,"spec",void 0),S(this,"peerConnection",void 0),S(this,"initialOffer",void 0),S(this,"transport",void 0),S(this,"statsFilter",void 0),S(this,"localCandidateCount",0),S(this,"allCandidatesReceived",!1),S(this,"localCandidateAddress",null),S(this,"useXR",V("USE_XR")),S(this,"filter",{filterRTX:!V("USE_PUB_RTX")&&!V("USE_SUB_RTX"),filterVideoFec:V("FILTER_VIDEO_FEC"),filterAudioFec:V("FILTER_AUDIO_FEC")}),S(this,"extension",{useXR:this.useXR}),S(this,"_isInRestartIce",!1),S(this,"mutex",new Qn("P2PConnection-mutex")),S(this,"onLocalCandidate",void 0),S(this,"remoteSDP",void 0),S(this,"pendingCandidates",[]),S(this,"localCapabilities",void 0),S(this,"isReady",!1),S(this,"restartCnt",0),S(this,"curTurnServerIndex",0),this.store=t,this.spec=e,this.peerConnection=new RTCPeerConnection(bu.resolvePCConfiguration(e,t.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=i??Ii.SEND_ONLY,this.name=this.direction===Ii.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=aE(this.peerConnection,V("STATS_UPDATE_INTERVAL"),void 0,Pt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(e){try{const t=await X0(this.filter,this.extension);if(this.localCapabilities=mu(t),e){const{sdp:i}=e,o=q7(e,$7),a=function(){const m={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},E=Pp(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),v={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},T={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},A={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Bs(E,m,"videoExtensions",v,T,A),Bs(E,m,"videoCodecs",v,T,A),Bs(E,m,"audioExtensions",v,T,A),Bs(E,m,"audioCodecs",v,T,A),V("RAISE_H264_BASELINE_PRIORITY")){const C=A.videoCodecs.findIndex(b=>b.rtpMap&&b.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&b.fmtp&&b.fmtp.parameters["profile-level-id"]==="42001f");if(C!==-1){const b=A.videoCodecs.findIndex(D=>D.rtpMap&&D.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(b<C){y.debug("raising H264 baseline profile priority");const D=A.videoCodecs[C];A.videoCodecs.splice(C,1),A.videoCodecs.splice(b,0,D)}b!==-1&&V("FILTER_SEND_H264_BASELINE")&&(v.videoCodecs=v.videoCodecs.filter(D=>!(D.rtpMap&&D.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&D.fmtp&&D.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:v,recv:T,sendrecv:A}}(this.filter,this.extension,i);this.remoteSDP=new ZL({remoteIceParameters:o.iceParameters,remoteDtlsParameters:o.dtlsParameters,candidates:[],remoteRTPCapabilities:a,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const l=await this.peerConnection.createAnswer();if(!l.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const u=ao(l.sdp);await this.peerConnection.setLocalDescription(l);const h=await $L(this.filter,this.extension,l.sdp);this.localCapabilities=mu(h);const f=this.peerConnection.getTransceivers()[0];return f!=null&&f.receiver&&f.receiver.transport&&this.tryBindTransportEvents(f.receiver.transport),wc(wc({},u),{},{sdp:l.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const o=ao(i.sdp);return this.initialOffer=i,wc(wc({},o),{},{sdp:i.sdp})}}catch(t){throw new ne(N.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:t,iceParameters:i,dtlsParameters:o}=e,a=await $L(this.filter,this.extension,t);this.remoteSDP=new ZL({remoteIceParameters:i,remoteDtlsParameters:o,candidates:[],remoteRTPCapabilities:a,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const l=this.peerConnection.getTransceivers()[0];l!=null&&l.sender&&l.sender.transport&&this.tryBindTransportEvents(l.sender.transport)}catch(t){throw new ne(N.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(t.toString()))}}async addRemoteCandidate(e){try{e&&this.pendingCandidates.push(e),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(t=>{this.peerConnection.addIceCandidate(t)}),this.pendingCandidates=[])}catch(t){throw new ne(N.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(t.toString()))}}send(e,t,i){var o=this;return Tr(function*(){const a=yield Qe(o.mutex.lock("From P2PConnection.send"));try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const l=[],u=o.remoteSDP.receive(e,t,i);e.forEach((b,D)=>{if(u[D].needCreateTransceiver){const M=o.peerConnection.addTransceiver(b._mediaStreamTrack,{direction:"sendonly"});l.push(M),b._updateRtpTransceiver(M)}else{const M=o.peerConnection.getTransceivers().find(B=>B.mid===u[D].mid);if(!M)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(u[D].mid));l.push(M),b._updateRtpTransceiver(M)}}),Pt()&&V("SIMULCAST")===!0&&(yield Qe(o.applySimulcastForFirefox(l,e)));const h=u.map(b=>b.mid),f=yield Qe(o.peerConnection.createOffer()),m=o.mungSendOfferSDP(f.sdp,e,h),E=Yt.parse(m),v=h.map(b=>{const D=E.mediaDescriptions.find(M=>M.attributes.mid===b);if(!D)throw new Error("Cannot extract ssrc from mediaDescription.");return Y0(D,V("USE_PUB_RTX"))}),T=l.map((b,D)=>{const M=h[D];return{localSSRC:v[D],id:M}});yield Qe(o.peerConnection.setLocalDescription({type:"offer",sdp:m}));try{yield T}catch(b){const D=o.remoteSDP.toString();throw yield Qe(o.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield Qe(o.peerConnection.setRemoteDescription({type:"answer",sdp:D})),yield Qe(o.stopSending(h,!0)),b}yield Qe(o.applySimulcastEncodings(l,e)),yield Qe(o.applySendEncodings(l,e));const A=o.remoteSDP.toString(),C=o.logSDPExchange(m,"offer","local","send");return C==null||C(A),yield Qe(o.setRemoteDescription({type:"answer",sdp:A})),l.map((b,D)=>{const M=h[D];return{localSSRC:v[D],id:M}})}catch(l){throw l instanceof ne?l:new ne(N.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(l.toString()))}finally{a()}})()}async stopSending(e,t){const i=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const o=this.peerConnection.getTransceivers().filter(h=>e.indexOf(h.mid)!==-1);if(o.length!==e.length)throw new Error("Transceivers' length (".concat(o.length,") doesn't match mids' length (").concat(e.length,") when trying to call P2PConnection.stopSending."));o.map(h=>{var f;h.direction="inactive",(f=h.stop)===null||f===void 0||f.call(h)});const a=await this.peerConnection.createOffer(),l=this.logSDPExchange(a.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(e);const u=this.remoteSDP.toString();l==null||l(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new ne(N.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(o.toString()))}finally{i&&i()}}async receive(e,t,i,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:a,needExchangeSDP:l}=this.remoteSDP.send(e,t,i,o);if(l){const h=this.remoteSDP.toString(),f=this.logSDPExchange(h,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:h});const m=await this.peerConnection.createAnswer(),E=this.mungReceiveAnswerSDP(m.sdp,a,e);f==null||f(E||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:E}),y.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else y.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));const u=this.peerConnection.getTransceivers().find(h=>h.mid===a);if(!u||u.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,mid:u.mid,transceiver:u}}catch(a){throw new ne(N.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async mockReceive(e,t,i,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:a,needExchangeSDP:l}=this.remoteSDP.send(e,t,i,o);if(l){const u=this.remoteSDP.toString(),h=this.logSDPExchange(u,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:u});const f=await this.peerConnection.createAnswer(),m=this.mungReceiveAnswerSDP(f.sdp,a,e);h==null||h(m||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:m}),y.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else y.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."))}catch(a){throw new ne(N.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString(),i=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:t});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(t){throw new ne(N.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(t.toString()))}}async restartICE(e){try{if(this.store.p2pTransport===da.Auto&&(this.store.p2pTransport=da.SdRtn,mt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(bu.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,mt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(bu.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!e){this.restartCnt++,this.isReady=!1;const t=await this.peerConnection.createOffer({iceRestart:!0});if(!t.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:i}=ao(t.sdp);return this.store.descriptionStart(),this.direction===Ii.SEND_ONLY&&await this.peerConnection.setLocalDescription(t),i}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(e),this.store.descriptionStart(),this.direction===Ii.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const t=await this.peerConnection.createAnswer();if(!t.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:i}=ao(t.sdp);return await this.peerConnection.setLocalDescription(t),i}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(t){throw new ne(N.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(t.toString()))}}close(){var e;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(i.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);const a=this.remoteSDP.toString(),l=this.logSDPExchange(o,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),l==null||l(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new ne(N.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,t){const i=this.peerConnection.getTransceivers().filter(o=>o.mid===e);i.length===1&&(this.isVP8Simulcast(t)?Pt()||await this.applySimulcastEncodings(i,[t]):await this.applySendEncodings(i,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const i=this.peerConnection.getTransceivers().find(o=>o.mid===t);i&&await i.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const t=e[0].transport.iceTransport,{local:i,remote:o}=t.getSelectedCandidatePair();return{local:wc(wc({},Bo),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:wc(wc({},Bo),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e,t;Ie(e=["connected","completed"]).call(e,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=e=>{if(e.candidate){var t;e.candidate.candidate&&(this.localCandidateAddress=e.candidate.address,(t=this.onLocalCandidate)===null||t===void 0||t.call(this,e.candidate.toJSON())),this.localCandidateCount+=1}else this.allCandidatesReceived=!0,y.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const o={iceServers:[]};var a;return e.iceServers?o.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(xd(e.turnServer.servers)?o.iceServers=e.turnServer.servers:(o.iceServers&&o.iceServers.push(...bu.turnServerConfigToIceServers(e.turnServer.servers,t,i)),V("USE_TURN_SERVER_OF_GATEWAY")&&o.iceServers&&e.turnServer.serversFromGateway&&o.iceServers.push(...bu.turnServerConfigToIceServers(e.turnServer.serversFromGateway,t,i)),Ie(a=[da.Relay,da.SdRtn]).call(a,t)&&(o.iceTransportPolicy="relay"),V("FORCE_TURN_TCP")?o.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(l=>{l.forceturn&&(o.iceTransportPolicy="relay")}))),V("ENABLE_ENCODED_TRANSFORM")&&mt().supportWebRTCEncodedTransform&&(o.encodedInsertableStreams=!0),y.debug("P2PConnection p2pTransport is ".concat(t)),o}static turnServerConfigToIceServers(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const o=[],a=e.filter(u=>u.tcpport);y.debug("P2PConnection turnServers is ".concat(a,", current index is ").concat(i));const l=a.length>i?a[i]:a[0];switch(t){case da.SdRtn:const u=e.filter(f=>{var m;return Ie(m=f.username).call(m,"glb:")&&f.turnServerURL==f.turnServerURL}),h=u.length>i?u[i]:u[0];h&&(o.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(uc(h.turnServerURL),":").concat(h.tcpport,"?transport=udp")}),o.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(uc(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;case da.Relay:l&&(o.push({username:l.username,credential:l.password,credentialType:"password",urls:"turn:".concat(l.turnServerURL,":").concat(l.tcpport,"?transport=udp")}),o.push({username:l.username,credential:l.password,credentialType:"password",urls:"turns:".concat(uc(l.turnServerURL),":").concat(l.tcpport,"?transport=tcp")}));break;default:l&&(o.push({username:l.username,credential:l.password,credentialType:"password",urls:"turn:".concat(l.turnServerURL,":").concat(l.tcpport,"?transport=udp")}),o.push({username:l.username,credential:l.password,credentialType:"password",urls:"turns:".concat(uc(l.turnServerURL),":").concat(l.tcpport,"?transport=tcp")}),o.push({username:l.username,credential:l.password,credentialType:"password",urls:"stun:".concat(l.turnServerURL,":").concat(l.tcpport)}))}return o}tryBindTransportEvents(e){if(e){this.transport=e,e.onstatechange=()=>{var i;e!=null&&e.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,e.state))},e.onerror=i=>{var o;(o=this.onDTLSTransportError)===null||o===void 0||o.call(this,"error"in i?i.error:i)};const t=e.iceTransport;t&&(t.onstatechange=()=>{const i=e==null?void 0:e.iceTransport.state;var o;i&&((o=this.onICETransportStateChange)===null||o===void 0||o.call(this,i))},t.getSelectedCandidatePair&&(t.onselectedcandidatepairchange=()=>{if(t.getSelectedCandidatePair()){const{local:i,remote:o}=t.getSelectedCandidatePair();y.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:i.type,protocol:i.protocol}),", remote ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,t){var i;if(t||(t=this.peerConnection.getSenders().find(m=>m.track===e._mediaStreamTrack)),!t)return y.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return y.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!mt().supportSetRtpSenderParameters)return y.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const o={},a={};switch(e._optimizationMode){case"motion":o.degradationPreference="maintain-framerate";break;case"detail":o.degradationPreference="maintain-resolution";break;default:o.degradationPreference="balanced"}if(e._encoderConfig){var l;const{bitrateMax:m,frameRate:E,scaleResolutionDownBy:v}=e._encoderConfig;m&&(a.maxBitrate=1e3*m),Ie(l=e._hints).call(l,Ut.LOW_STREAM)&&(E&&(a.maxFramerate=xr(E)),v&&v>=1&&(a.scaleResolutionDownBy=v))}if(V("DSCP_TYPE")&&nc()){var u;const m=V("DSCP_TYPE");Ie(u=["very-low","low","medium","high"]).call(u,m)&&(a.networkPriority=m)}const h=t.getParameters(),f=(i=h.encodings)===null||i===void 0?void 0:i[0];Pt()&&!f&&(o.encodings=[a]),f&&Object.assign(f,a),Object.assign(h,o),y.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(h.encodings))),await t.setParameters(h)}async applySendEncodings(e,t){try{if(!mt().supportSetRtpSenderParameters||e.length!==t.length)return;for(let i=0;i<e.length;i++){const o=e[i],a=t[i];a instanceof et&&!this.isVP8Simulcast(a)&&await this.updateRtpSenderEncodings(a,o.sender)}}catch{y.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,i){const o=Yt.parse(e);return t.forEach((a,l)=>{const u=i[l],h=o.mediaDescriptions.find(f=>f.attributes.mid===u);h&&(Ic(h,a),J0(h,a,this.store.codec))}),Yt.print(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;(t=this.onFirstAudioReceived)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;(t=this.onFirstVideoReceived)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;(t=this.onFirstAudioDecoded)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,i)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,e,t,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;(t=this.onFirstVideoDecodedTimeout)===null||t===void 0||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let h=0;h<e.length;h++){var i,o,a,l,u;const f=e[h],m=t[h];if(m instanceof et&&!Ie(i=m._hints).call(i,Ut.LOW_STREAM)&&(o=m._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((a=m._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(l=m._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((u=m._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1&&this.store.codec==="vp8"){const E={},v={high:1e3*(m._encoderConfig.bitrateMax-50),medium:5e4};E.encodings=[{rid:"m",active:!0,maxBitrate:v.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:v.high}];const T=f.sender.getParameters();await f.sender.setParameters(Object.assign(T,E))}}}async applySimulcastEncodings(e,t){if(!Pt()&&e.length===t.length)for(let i=0;i<e.length;i++){const o=t[i];if(o instanceof et&&this.isVP8Simulcast(o)){const a=e[i],l={},u={high:1e3*(o._encoderConfig.bitrateMax-50),medium:5e4};l.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:u.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:u.medium,scaleResolutionDownBy:4}];const h=a.sender.getParameters();await a.sender.setParameters(Object.assign(h,l))}}}isVP8Simulcast(e){var t,i,o,a,l;return!!(e instanceof et&&V("SIMULCAST")&&this.store.codec==="vp8"&&!Ie(t=e._hints).call(t,Ut.LOW_STREAM)&&(i=e._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((o=e._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(a=e._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((l=e._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1)}logSDPExchange(e,t,i,o){if(V("SDP_LOGGING"))return y.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(t," SDP during P2PConnection.").concat(o,`
`),e),t==="offer"?a=>{this.logSDPExchange(a,"answer",i==="local"?"remote":"local",o)}:void 0}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter(l=>l.mid&&e.indexOf(l.mid)!==-1);if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(l=>{l.direction="inactive"});const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(e);const a=this.remoteSDP.toString();o==null||o(a),await this.setRemoteDescription({type:"answer",sdp:a})}catch(t){throw new ne(N.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(t.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter(l=>l.mid&&e.indexOf(l.mid)!==-1);if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(async l=>{l.direction="sendonly"});const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(e);const a=this.remoteSDP.toString();o==null||o(a),await this.setRemoteDescription({type:"answer",sdp:a})}catch(t){throw new ne(N.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(t.toString()))}}async getRemoteSSRC(e,t){var i,o;if(t=(i=t)!==null&&i!==void 0?i:(o=this.currentRemoteDescription)===null||o===void 0?void 0:o.sdp){var a;const l=(a=Yt.parse(t).mediaDescriptions.find(u=>u.attributes.mid===e))===null||a===void 0?void 0:a.attributes.ssrcs;return l==null?void 0:l[0].ssrcId}}async setRemoteDescription(e){var t;await this.peerConnection.setRemoteDescription(e),Ie(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(e,t,i){const o=Yt.parse(e),a=o.mediaDescriptions.find(l=>l.attributes.mid===t);return a&&(i===be.AUDIO&&a.media.mediaType==="audio"&&co(a),this.useXR&&Dp(o)),Yt.print(o)}};function Gs(n,e,t){const i=n[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return t.value=async function(){const o=this.mutex,a=await o.lock("From P2PConnection.".concat(e));try{for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return await i.apply(this,u)}finally{a()}},t}function Q0(n,e){let t=document.createElement("video"),i=document.createElement("canvas");t.setAttribute("style","display:none"),i.setAttribute("style","display:none"),t.setAttribute("muted",""),t.muted=!0,t.setAttribute("autoplay",""),t.autoplay=!0,t.setAttribute("playsinline",""),i.width=xr(e.width),i.height=xr(e.height);const o=xr(e.framerate||15);document.body.append(t),document.body.append(i);let a=n._mediaStreamTrack;t.srcObject=new MediaStream([a]),t.play();const l=i.getContext("2d");if(!l)throw new W(N.UNEXPECTED_ERROR,"can not get canvas context");const u=mt(),h=i.captureStream(u.supportRequestFrame?0:o).getVideoTracks()[0];h.canvas||(h.canvas=i),i.startCapture=()=>{if(!t)return i.stopCapture&&i.stopCapture();if(t.paused&&t.play(),t.videoHeight>2&&t.videoWidth>2){const m=t.videoWidth,E=t.videoHeight/m,v=i.width*E;Math.abs(v-i.height)>=2&&(y.debug("adjust low stream resolution","".concat(i.width,"x").concat(i.height," -> ").concat(i.width,"x").concat(v)),i.height=v)}l.drawImage(t,0,0,i.width,i.height),h.requestFrame&&h.requestFrame(),a!==n._mediaStreamTrack&&(a=n._mediaStreamTrack,t.srcObject=new MediaStream([a]))},i.stopCapture=Ly(()=>i.startCapture&&i.startCapture(),o);const f=h.stop;return h.stop=()=>{f.call(h),t&&(t.remove(),t.srcObject=null,t=null),i&&(i.width=0,i.remove(),i.stopCapture&&i.stopCapture(),i.startCapture=void 0,i.stopCapture=void 0,i=null),y.debug("clean low stream renderer")},h}var kp,tM,Bn,bc,gi,_u,$0,Ta,os,Z0,Hr;ie([Gs,O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",X)],Wr.prototype,"establish",null),ie([Gs,O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",X)],Wr.prototype,"connect",null),ie([Gs,O("design:type",Function),O("design:paramtypes",[String,Array,String,String]),O("design:returntype",X)],Wr.prototype,"receive",null),ie([Gs,O("design:type",Function),O("design:paramtypes",[String,Array,String,String]),O("design:returntype",X)],Wr.prototype,"mockReceive",null),ie([Gs,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",X)],Wr.prototype,"stopReceiving",null),ie([Gs,O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",X)],Wr.prototype,"restartICE",null),ie([Gs,O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],Wr.prototype,"close",null),ie([Gs,O("design:type",Function),O("design:paramtypes",[String,_i]),O("design:returntype",X)],Wr.prototype,"updateEncoderConfig",null),ie([Gs,O("design:type",Function),O("design:paramtypes",[String,_i]),O("design:returntype",X)],Wr.prototype,"updateSendParameters",null),ie([Gs,O("design:type",Function),O("design:paramtypes",[_i,String]),O("design:returntype",X)],Wr.prototype,"replaceTrack",null),ie([Gs,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",X)],Wr.prototype,"muteLocal",null),ie([Gs,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",X)],Wr.prototype,"unmuteLocal",null),function(n){n[n.HEIGHT=2033]="HEIGHT",n[n.FRAME_RATE=2034]="FRAME_RATE",n[n.WIDTH=2035]="WIDTH"}(kp||(kp={})),function(n){n[n.HEIGHT=2072]="HEIGHT",n[n.FRAME_RATE=2074]="FRAME_RATE",n[n.WIDTH=2076]="WIDTH"}(tM||(tM={})),function(n){n[n.FRAME_RATE=2002]="FRAME_RATE",n[n.WIDTH=2003]="WIDTH",n[n.HEIGHT=2004]="HEIGHT",n[n.PACKAGE_LOST=2005]="PACKAGE_LOST",n[n.AVG_ENCODE=2007]="AVG_ENCODE",n[n.NACKS=2009]="NACKS",n[n.PLIS=2010]="PLIS",n[n.FIRS=2011]="FIRS",n[n.BITRATE=2012]="BITRATE",n[n.PACKAGE_RATE=2031]="PACKAGE_RATE",n[n.ADAPTATION=2032]="ADAPTATION",n[n.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",n[n.BANDWIDTH=2061]="BANDWIDTH",n[n.RETRANSMIT=2062]="RETRANSMIT",n[n.TARGET_ENCODED=2064]="TARGET_ENCODED",n[n.TRANSMIT=2066]="TRANSMIT",n[n.FREEZE=2082]="FREEZE",n[n.DISABLED=2095]="DISABLED",n[n.PLAYER_STATUS=2128]="PLAYER_STATUS",n[n.QP_SUM=2143]="QP_SUM"}(Bn||(Bn={})),function(n){n[n.BITRATE=2069]="BITRATE",n[n.PACKAGE_LOST=2070]="PACKAGE_LOST",n[n.PACKAGE_RATE=2071]="PACKAGE_RATE",n[n.HEIGHT=2073]="HEIGHT",n[n.FRAME_RATE=2075]="FRAME_RATE",n[n.WIDTH=2077]="WIDTH"}(bc||(bc={})),function(n){n[n.JITTER=-1]="JITTER",n[n.PACKAGE_LOST=2014]="PACKAGE_LOST",n[n.WIDTH=2018]="WIDTH",n[n.HEIGHT=2019]="HEIGHT",n[n.FRAME_RATE=2020]="FRAME_RATE",n[n.JITTER_BUFFER=2023]="JITTER_BUFFER",n[n.CURRENT_DELAY=2024]="CURRENT_DELAY",n[n.NACKS=2026]="NACKS",n[n.PLIS=2027]="PLIS",n[n.FIRS=2028]="FIRS",n[n.BITRATE=2029]="BITRATE",n[n.PACKAGE_RATE=2078]="PACKAGE_RATE",n[n.FREEZE=2084]="FREEZE",n[n.DISABLED=2101]="DISABLED",n[n.PLAYER_STATUS=2129]="PLAYER_STATUS",n[n.QP_SUM=2144]="QP_SUM",n[n.I_FRAME_DELAY=2149]="I_FRAME_DELAY"}(gi||(gi={})),function(n){n[n.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",n[n.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",n[n.FREEZE_TIME=2109]="FREEZE_TIME",n[n.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER"}(_u||(_u={})),function(n){n[n.PCM_LEVEL=2104]="PCM_LEVEL"}($0||($0={})),function(n){n[n.PACKAGE_LOST=-1]="PACKAGE_LOST",n[n.LEVEL=2038]="LEVEL",n[n.BITRATE=2039]="BITRATE",n[n.PACKAGE_RATE=2040]="PACKAGE_RATE",n[n.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",n[n.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",n[n.FREEZE=2081]="FREEZE",n[n.DISABLED=2096]="DISABLED"}(Ta||(Ta={})),function(n){n[n.BITRATE=2044]="BITRATE",n[n.PACKAGE_LOST=2045]="PACKAGE_LOST",n[n.PACKAGE_RATE=2046]="PACKAGE_RATE",n[n.CURRENT_DELAY=2047]="CURRENT_DELAY",n[n.JITTER_BUFFER=2054]="JITTER_BUFFER",n[n.JITTER=2055]="JITTER",n[n.FREEZE=2083]="FREEZE",n[n.DISABLED=2102]="DISABLED",n[n.PCM_LEVEL=2105]="PCM_LEVEL",n[n.PLAYER_STATUS=2130]="PLAYER_STATUS",n[n.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES"}(os||(os={})),function(n){n[n.FREEZE_TIME=-1]="FREEZE_TIME",n[n.LEVEL=2043]="LEVEL"}(Z0||(Z0={})),function(n){n[n.RTT=2006]="RTT",n[n.CONN_TYPE=801]="CONN_TYPE"}(Hr||(Hr={}));const ya=1e3,Bl=3;function rt(n,e,t){t!=null&&Number.isFinite(t)&&(n[e]=Math.round(Math.max(0,t)))}function nM(n){const e={[Hr.CONN_TYPE]:0,[Hr.RTT]:n.rtt};switch(n.selectedCandidatePair.localCandidate.candidateType){case"relay":{const t=n.selectedCandidatePair.localCandidate.relayProtocol;t==="udp"&&(e[Hr.CONN_TYPE]=1),t==="tcp"&&(e[Hr.CONN_TYPE]=3),t==="tls"&&(e[Hr.CONN_TYPE]=4);break}case"srflx":e[Hr.CONN_TYPE]=2}return e}class iM extends zt{constructor(e){super(),S(this,"store",void 0),S(this,"uploadWRTCStatsTimer",void 0),S(this,"uploadOutboundDenoiserStatsTimer",void 0),S(this,"uploadExtStatsTimer",void 0),S(this,"uploadExtUsageStatsTimer",void 0),S(this,"uploadInboundExtStatsTimer",void 0),S(this,"requestStats",void 0),S(this,"requestTransportStats",void 0),S(this,"requestLocalMedia",void 0),S(this,"requestRemoteMedia",void 0),S(this,"requestAllTracks",void 0),S(this,"requestVideoIsReady",void 0),S(this,"requestUploadStats",void 0),S(this,"requestUpload",void 0),S(this,"uploadOutboundStarted",!1),S(this,"uploadInboundStarted",!1),S(this,"uploadTransportStarted",!1),S(this,"uploadExtensionUsageStarted",!1),S(this,"lastRecvStats",void 0),S(this,"lastSendStats",void 0),S(this,"lastFullRecvStats",void 0),S(this,"lastFullSendStats",void 0),S(this,"needUploadRenderFreezeTime",!0),this.store=e}uploadWRTCStats(e){if(!this.requestStats||!this.requestUploadStats)return;let t,i;if(this.uploadTransportStarted&&(t=this.requestStats(),this.store.useP2P&&(i=this.requestStats(!0))),!t&&this.uploadOutboundStarted&&(t=this.requestStats()),!i&&this.uploadInboundStarted&&(i=this.requestStats(!0)),t||i){const o={};if(this.uploadTransportStarted&&t){const a=this.getTransportStats(t,i,e);a&&(o.misc=[a])}if(this.uploadOutboundStarted&&t){const a=this.getOutboundStats(t,e?this.lastSendStats:this.lastFullSendStats,e);a&&(o.outbound=[a])}if(this.uploadInboundStarted&&i){const a=this.getInboundStats(i,e?this.lastRecvStats:this.lastFullRecvStats,e);a&&(o.inbound=a)}this.requestUploadStats(o)}this.lastRecvStats=i,this.lastSendStats=t,e||(this.lastFullRecvStats=i,this.lastFullSendStats=t)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;let e=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted)return this.stopUploadWRTCStats();this.uploadWRTCStats(e!==Bl),++e===Bl+1&&(e=1)},ya)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(e,t,i){if(!this.requestStats)return;if(i)return e.rtt==null?void 0:{addition:{[Hr.RTT]:e.rtt,[Hr.CONN_TYPE]:void 0}};const o=nM(e);if(this.store.useP2P){if(t){const a=nM(t);o[Hr.CONN_TYPE]+=a[Hr.CONN_TYPE]<<3}o[Hr.CONN_TYPE]+=110}else o[Hr.CONN_TYPE]+=100;return{addition:o}}getOutboundStats(e,t,i){if(!this.requestUploadStats||!this.requestLocalMedia)return;const o=this.requestLocalMedia();if(!o||o.length===0)return;let a,l,u;return o.forEach(h=>{let[f,{track:m,ssrcs:E}]=h;switch(f){case ce.LocalVideoLowTrack:case ce.LocalVideoTrack:if(f===ce.LocalVideoTrack){const v=function(C,b,D,M,B){const J=b.videoSend.find(ue=>ue.ssrc===C);if(!J)return;const G={},{sentFrame:q,inputFrame:Q}=J;if(Q&&q){const ue=Q.frameRate,Ee=q.frameRate;G[Bn.FREEZE]=function(Ye,st){let Vt=!0;return Vt=!(Ye<=5)&&(Ye<=10?st<3:Ye<=20?st<4:st<5),Vt}(ue,Ee)?1:0}if(rt(G,Bn.QP_SUM,J.qpSumPerFrame),B)return G;switch(q&&(rt(G,Bn.HEIGHT,q.height),rt(G,Bn.WIDTH,q.width),rt(G,Bn.FRAME_RATE,q.frameRate)),G[Bn.DISABLED]=M._originMediaStreamTrack&&!M._originMediaStreamTrack.enabled||M._mediaStreamTrack&&!M._mediaStreamTrack.enabled?1:0,J.adaptionChangeReason){case"none":G[Bn.ADAPTATION]=0;break;case"cpu":G[Bn.ADAPTATION]=1;break;case"bandwidth":G[Bn.ADAPTATION]=2;break;case"other":G[Bn.ADAPTATION]=3}G[Bn.PLAYER_STATUS]=Dy[M._player?M._player.videoElementStatus:"uninit"],rt(G,Bn.NACKS,J.nacksCount),rt(G,Bn.PLIS,J.plisCount),rt(G,Bn.FIRS,J.firsCount),rt(G,Bn.AVG_ENCODE,J.avgEncodeMs);const $=D&&D.videoSend.find(ue=>ue.ssrc===C);if($){let ue=B?ya:ya*Bl;$.timestamp&&J.timestamp&&(ue=J.timestamp-$.timestamp),$.packets!=null&&J.packets!=null&&rt(G,Bn.PACKAGE_RATE,1e3*(J.packets-$.packets)/ue),J.packetsLost!=null&&$.packetsLost!=null&&rt(G,Bn.PACKAGE_LOST,J.packetsLost-$.packetsLost),$.bytes!=null&&J.bytes!=null&&rt(G,Bn.BITRATE,8*(J.bytes-$.bytes)/ue)}return G}(E[0].ssrcId,e,t,m,i),T=i?null:function(C,b,D){const M=b.videoSend.find($=>$.ssrc===C);if(!M)return null;const B={},J=M.inputFrame,G=J&&J.height||D&&D._videoHeight||0,q=J&&J.width||D&&D._videoWidth||0,Q=J&&J.frameRate||0;return rt(B,kp.HEIGHT,G),rt(B,kp.WIDTH,q),rt(B,kp.FRAME_RATE,Q),B}(E[0].ssrcId,e,m),A=i?null:function(C){const b={};return rt(b,Bn.RETRANSMIT,C.bitrate.retransmit),rt(b,Bn.TARGET_ENCODED,C.bitrate.targetEncoded),rt(b,Bn.ACTUAL_ENCODED,C.bitrate.actualEncoded),rt(b,Bn.TRANSMIT,C.bitrate.transmit),rt(b,Bn.BANDWIDTH,C.sendBandwidth),b}(e);l=Object.assign({},v,T,A)}else u=i?void 0:function(v,T,A){const C=T.videoSend.find(M=>M.ssrc===v);if(!C)return;const b={},D=C.sentFrame;if(D&&(rt(b,bc.HEIGHT,D.height),rt(b,bc.WIDTH,D.width),rt(b,bc.FRAME_RATE,D.frameRate)),A){const M=A.videoSend.find(B=>B.ssrc===v);if(M){let B=ya*Bl;M.timestamp&&C.timestamp&&(B=C.timestamp-M.timestamp),M.packets!=null&&C.packets!=null&&rt(b,bc.PACKAGE_RATE,1e3*(C.packets-M.packets)/B),C.packetsLost!=null&&M.packetsLost!=null&&rt(b,bc.PACKAGE_LOST,C.packetsLost-M.packetsLost),M.bytes!=null&&C.bytes!=null&&rt(b,bc.BITRATE,8*(C.bytes-M.bytes)/B)}}return b}(E[0].ssrcId,e,t);break;case ce.LocalAudioTrack:a=i?void 0:function(v,T,A,C){const b=T.audioSend.find(G=>G.ssrc===v);if(!b)return;const D={};D[Ta.DISABLED]=C._originMediaStreamTrack&&!C._originMediaStreamTrack.enabled||C._mediaStreamTrack&&!C._mediaStreamTrack.enabled?1:0;const M=C._source.getAccurateVolumeLevel(),B=b.inputLevel;rt(D,Ta.LEVEL,100*(B??M)),rt(D,$0.PCM_LEVEL,100*M),rt(D,Ta.AEC_RETURN_LOSS,b.aecReturnLoss),rt(D,Ta.AEC_RETURN_LOSS_ENH,b.aecReturnLossEnhancement),D[Ta.FREEZE]=0;const J=A&&A.audioSend.find(G=>G.ssrc===v);if(J){let G=ya*Bl;J.timestamp&&b.timestamp&&(G=b.timestamp-J.timestamp),J.bytes!=null&&b.bytes!=null&&rt(D,Ta.BITRATE,8*(b.bytes-J.bytes)/G),J.packets!=null&&b.packets!=null&&rt(D,Ta.PACKAGE_RATE,1e3*(b.packets-J.packets)/G)}return D}(E[0].ssrcId,e,t,m)}}),{high:l,low:u,audio:a}}getInboundStats(e,t,i){if(!this.requestRemoteMedia)return;const o=this.requestRemoteMedia()||[],a=[];return o.forEach(l=>{let[u,h]=l;const f={peer:u.uid};if(h.has(be.VIDEO)&&u.videoTrack){const m=u._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(u._videoSSRC)||!1,E=u.videoTrack?function(v,T,A,C,b,D,M){const B=T.videoRecv.find(ue=>ue.ssrc===v);if(!B)return;const J={},{receivedFrame:G,outputFrame:q,decodeFrameRate:Q}=B,$=A&&A.videoRecv.find(ue=>ue.ssrc===v);if(J[gi.FREEZE]=b&&Lp.isRemoteVideoFreeze(C,B,$)?1:0,rt(J,_u.FRAME_RATE_DECODE,Q),rt(J,gi.QP_SUM,B.qpSumPerFrame),B.framesRateFirefox&&rt(J,gi.FRAME_RATE,B.framesRateFirefox),G&&rt(J,gi.FRAME_RATE,G.frameRate),$){const ue=T.timestamp-A.timestamp||(M?ya:Bl*ya);B.packetsLost!=null&&$.packetsLost!=null&&rt(J,gi.PACKAGE_LOST,B.packetsLost-$.packetsLost),$.bytes!=null&&B.bytes!=null&&rt(J,gi.BITRATE,8*(B.bytes-$.bytes)/ue),$.packets!=null&&B.packets!=null&&rt(J,gi.PACKAGE_RATE,1e3*(B.packets-$.packets)/ue)}if(M)return J;if(G?(rt(J,gi.HEIGHT,G.height),rt(J,gi.WIDTH,G.width)):C&&(rt(J,gi.HEIGHT,C._videoHeight||0),rt(J,gi.WIDTH,C._videoWidth||0)),q&&rt(J,_u.FRAME_RATE_RENDER,q.frameRate),rt(J,gi.JITTER_BUFFER,B.jitterBufferMs),rt(J,gi.CURRENT_DELAY,B.currentDelayMs),rt(J,gi.FIRS,B.firsCount),rt(J,gi.NACKS,B.nacksCount),rt(J,gi.PLIS,B.plisCount),C){J[gi.DISABLED]=C._originMediaStreamTrack.enabled&&C._mediaStreamTrack.enabled?0:1;const ue=C._player;if(ue){const{freezeTimeCounterList:Ee,renderFreezeAccTime:Ye}=ue;if(Ee&&Ee.length>0&&rt(J,_u.FREEZE_TIME,Ee.splice(0,1)[0]),D&&ma.visibility==="visible"){const st=Math.min(6e3,Ye);ue.renderFreezeAccTime=Math.max(0,Ye-st),rt(J,_u.FREEZE_TIME_RENDER,st)}}}if(J[gi.PLAYER_STATUS]=Dy[C._player?C._player.videoElementStatus:"uninit"],$&&B.totalInterFrameDelay!==void 0&&B.totalSquaredInterFrameDelay!==void 0&&$.totalInterFrameDelay!==void 0&&$.totalSquaredInterFrameDelay!==void 0){const ue=B.totalInterFrameDelay-$.totalInterFrameDelay,Ee=B.totalSquaredInterFrameDelay-$.totalSquaredInterFrameDelay,Ye=B.framesDecodeCount-$.framesDecodeCount,st=ue/Ye*1e3,Vt=Math.round(1e3*Math.sqrt((Ee-Math.pow(ue,2)/Ye)/Ye));!isNaN(Vt)&&st+Vt>Math.max(3*st,st+150)&&(J[gi.I_FRAME_DELAY]=Vt)}return J}(u._videoSSRC,e,t,u.videoTrack,m===!0,this.needUploadRenderFreezeTime,i):void 0;E&&(f.video=E)}if(h.has(be.AUDIO)&&u.audioTrack){const m=u.audioTrack?function(E,v,T,A,C){const b=v.audioRecv.find(ue=>ue.ssrc===E);if(!b)return;const D={},M=T&&T.audioRecv.find(ue=>ue.ssrc===E),{receivedFrames:B,droppedFrames:J}=b;var G,q;if(rt(D,os.JITTER,b.jitterMs),B!=null&&J!=null&&(D[os.FREEZE]=(q=J,(G=B)===0||100*q/G>20?1:0)),M){const ue=v.timestamp-T.timestamp||(C?ya:ya*Bl);b.packets!=null&&M.packets!=null&&rt(D,os.PACKAGE_RATE,1e3*(b.packets-M.packets)/ue),M.bytes!=null&&b.bytes!=null&&rt(D,os.BITRATE,8*(b.bytes-M.bytes)/ue),b.packetsLost!=null&&M.packetsLost!=null&&rt(D,os.PACKAGE_LOST,b.packetsLost-M.packetsLost)}if(C)return D;const Q=A._source.getAccurateVolumeLevel(),$=b.outputLevel;if(rt(D,Z0.LEVEL,100*($??Q)),rt(D,os.PCM_LEVEL,100*Q),A&&(D[os.DISABLED]=A._originMediaStreamTrack.enabled&&A._mediaStreamTrack.enabled?0:1),rt(D,os.JITTER_BUFFER,b.jitterBufferMs),rt(D,os.CURRENT_DELAY,b.jitterBufferMs),D[os.PLAYER_STATUS]=Dy[qi.getPlayerState(A.getTrackId())],M){const ue=b.concealedSamples-M.concealedSamples;ue>0&&rt(D,os.CONCEALED_SAMPLES,ue)}return D}(u._audioSSRC,e,t,u.audioTrack,i):void 0;m&&(f.audio=m)}(f.video||f.audio)&&a.push(f)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,a}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const e=(this.requestAllTracks()||[]).find(t=>t instanceof Al);if(e&&e._external.getDenoiserStats){const t=e._external.getDenoiserStats();t&&this.requestUpload(ua.DENOISER_STATS,t)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(e=>{e.getProcessorStats().forEach(t=>{this.requestUpload&&this.requestUpload(t.type,t.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(e=>{let[t,i]=e;i.has(be.VIDEO)&&t.videoTrack&&t.videoTrack.getProcessorStats().forEach(o=>{this.requestUpload&&this.requestUpload(o.type,o.stats)}),i.has(be.AUDIO)&&t.audioTrack&&t.audioTrack.getProcessorStats().forEach(o=>{this.requestUpload&&this.requestUpload(o.type,o.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const e=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const t=Date.now(),i={connectionInterval:V("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:t};let o=[];const a=this.requestAllTracks&&this.requestAllTracks()||[];for(const f of a)!f.muted&&f.enabled&&(o=o.concat(await f.getProcessorUsage()));const l=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[f,m]of l)m.has(be.VIDEO)&&f.videoTrack&&(o=o.concat(await f.videoTrack.getProcessorUsage())),m.has(be.AUDIO)&&f.audioTrack&&(o=o.concat(await f.audioTrack.getProcessorUsage()));if(o.length===0)return;i.details=function(f,m){const E={};for(const{id:C,value:b,level:D,direction:M}of f){var v;const B=(v=m.get(C))!==null&&v!==void 0?v:0,J=b===2?B+V("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:B;var T,A;m.set(C,J),E[C]?(b===2&&(E[C].value=b),D>E[C].level&&(E[C].level=D),M==="remote"&&(E[C].remoteUidCount+=1),E[C].totalTs=(T=m.get(C))!==null&&T!==void 0?T:0):E[C]={value:b,level:D,remoteUidCount:M==="local"?0:1,totalTs:(A=m.get(C))!==null&&A!==void 0?A:0}}return Object.keys(E).map(C=>{const{level:b,value:D,totalTs:M}=E[C];return{id:C,level:b,value:D,totalTs:M}})}(o,e);const u=Date.now(),h=u>t?u:t+1;this.requestUpload&&this.requestUpload(ua.EXTENSION_USAGE_STATS,{usageStats:i,sendTs:h})},V("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}}class si{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,t){S(this,"uid",void 0),S(this,"_uintid",void 0),S(this,"_trust_in_room_",!0),S(this,"_trust_audio_enabled_state_",!0),S(this,"_trust_video_enabled_state_",!0),S(this,"_trust_audio_mute_state_",!0),S(this,"_trust_video_mute_state_",!0),S(this,"_audio_muted_",!1),S(this,"_video_muted_",!1),S(this,"_audio_enabled_",!0),S(this,"_video_enabled_",!0),S(this,"_audio_added_",!1),S(this,"_video_added_",!1),S(this,"_is_pre_created",!1),S(this,"_video_pre_subscribed",!1),S(this,"_audio_pre_subscribed",!1),S(this,"_trust_video_stream_added_state_",!0),S(this,"_trust_audio_stream_added_state_",!0),S(this,"_audioTrack",void 0),S(this,"_videoTrack",void 0),S(this,"_dataChannels",[]),S(this,"_audioSSRC",void 0),S(this,"_videoSSRC",void 0),S(this,"_audioOrtc",void 0),S(this,"_videoOrtc",void 0),S(this,"_cname",void 0),S(this,"_rtxSsrcId",void 0),S(this,"_videoMid",void 0),S(this,"_audioMid",void 0),this.uid=e,this._uintid=t}}var as;function Z7(n,e){var t;let i;switch(e){case ce.LocalAudioTrack:i=vt.Audio;break;case ce.LocalVideoTrack:i=Ie(t=n._hints).call(t,Ut.SCREEN_TRACK)?vt.Screen:vt.High;break;case ce.LocalVideoLowTrack:i=vt.Low}return i}function eR(n){const e=mt();if(n.some(t=>t._bypassWebAudio))throw new ne(N.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!e.webAudioMediaStreamDest)throw new ne(N.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function tR(n,e){eR(n);const t=e||new In;return n.forEach(i=>t.addAudioTrack(i)),t}function rM(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}function dE(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?rM(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):rM(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}(function(n){n.SEND_ONLY="SEND_ONLY",n.RECEIVE_ONLY="RECEIVE_ONLY"})(as||(as={}));class Mn extends zt{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Me.StateChange,t,this._state)}constructor(e,t){super(),S(this,"store",void 0),S(this,"statsUploader",void 0),S(this,"sendConnection",void 0),S(this,"recvConnection",void 0),S(this,"localTrackMap",new Map),S(this,"remoteUserMap",new Map),S(this,"localDataChannels",[]),S(this,"pendingLocalTracks",[]),S(this,"pendingRemoteTracks",[]),S(this,"statsCollector",void 0),S(this,"dtlsFailedCount",0),S(this,"sendMutex",new Qn("P2PChannel2-send-mutex")),S(this,"recvMutex",new Qn("P2PChannel2-recv-mutex")),S(this,"_state",Tt.Disconnected),S(this,"_restartStates",["disconnected","failed"]),S(this,"reconnectInterval",void 0),S(this,"uploadUnplinkStarted",!1),S(this,"uploadDownlinkStarted",!1),S(this,"uplinkStateUploadInterval",void 0),S(this,"downlinkStatsUploadInterval",void 0),S(this,"handleMuteLocalTrack",async(i,o,a)=>{const l=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Tt.Connected)return void a(new ne(N.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const f=this.filterTobeMutedTracks(i);if(f.length===0)return void o();const m=f.find(A=>A[0]==="videoLowTrack");m&&m[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(f.map(A=>{let[,{id:C}]=A;return C}));let E=!1;var u,h;i.trackMediaType==="video"?E=!((u=this.localTrackMap.get(ce.LocalAudioTrack))===null||u===void 0||!u.track._muted):E=((h=this.localTrackMap.get(ce.LocalVideoTrack))===null||h===void 0?void 0:h.id)===void 0;const v=this.createMuteMessage(f);await Dt(this,Me.RequestMuteLocal,v);const T=i.trackMediaType==="video"?Do.MUTE_LOCAL_VIDEO:Do.MUTE_LOCAL_AUDIO;await Dt(this,Me.RequestP2PMuteLocal,{action:T,message:v,isMuteAll:E}),o()}catch(f){a(f)}finally{l()}}),S(this,"handleUnmuteLocalTrack",async(i,o,a)=>{const l=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Tt.Connected)return void a(new ne(N.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const u=this.filterTobeUnmutedTracks(i);if(u.length===0)return void o();await this.sendConnection.unmuteLocal(u.map(m=>{let[,{id:E}]=m;return E}));const h=this.createUnmuteMessage(u),f=i.trackMediaType==="video"?Do.UNMUTE_LOCAL_VIDEO:Do.UNMUTE_LOCAL_AUDIO;await Dt(this,Me.RequestP2PMuteLocal,{action:f,message:h}),o()}catch(u){a(u)}finally{l()}}),S(this,"handleUpdateVideoEncoder",async(i,o,a)=>{const l=await this.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{const u=this.localTrackMap.get(ce.LocalVideoTrack);if(!this.sendConnection||!u||u.track!==i||this.state!==Tt.Connected)return void o();const{id:h,track:f}=u;h&&(await this.sendConnection.updateSendParameters(h,f),await this.sendConnection.updateEncoderConfig(h,f),this.emit(Me.UpdateVideoEncoder,f)),o()}catch(u){a(u)}finally{l()}}),S(this,"handleSetOptimizationMode",async(i,o,a)=>{const l=await this.sendMutex.lock("Locking from P2PChannel2.handleSetOptimizationMode");try{const u=this.localTrackMap.get(ce.LocalVideoTrack);if(!this.sendConnection||!u||u.track!==i||this.state!==Tt.Connected)return;const{id:h,track:f}=u;h&&await this.sendConnection.updateSendParameters(h,f),o()}catch(u){a(u)}finally{l()}}),S(this,"handleReplaceTrack",async(i,o,a,l)=>{let u;y.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof l=="boolean"&&l||(u=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var h;const m=Array.from(this.localTrackMap.entries()).find(E=>{let[,{track:v}]=E;return i===v});if(!this.sendConnection||!m||m[1].id===void 0||this.state!==Tt.Connected)return void o();if(await((h=this.sendConnection)===null||h===void 0?void 0:h.replaceTrack(i,m[1].id)),m[0]===ce.LocalVideoTrack&&mt().supportDualStreamEncoding){const E=this.localTrackMap.get(ce.LocalVideoLowTrack);if(E){const v=i._mediaStreamTrack.clone();E.track._originMediaStreamTrack.stop(),E.track._mediaStreamTrack=v,E.track._originMediaStreamTrack=v,await new X((T,A)=>{this.handleReplaceTrack(E.track,T,A,!0)})}}o()}catch(m){a(m)}finally{var f;(f=u)===null||f===void 0||f()}}),S(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),S(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),S(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),S(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new iM(e),this.bindStatsUploaderEvents(),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(i=>{i&&(i.iceConnectionState!=="disconnected"&&i.iceConnectionState!=="failed"||this.handleDisconnect(i.direction))})},V("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new ne(N.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e,t,i,o,a,l){throw new ne(N.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let i;try{if(t){this.recvConnection&&(y.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),i=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new Wr(e,this.store,Ii.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const o=await this.recvConnection.establish(t);return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}{this.state=Tt.New,this.sendConnection&&(y.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),i=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new Wr(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const o=await this.sendConnection.establish();return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}}finally{i&&i()}}async p2pConnect(e){if(!this.sendConnection)throw new ne(N.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Tt.Connected}async addRemoteCandidate(e,t){if(t===Ii.RECEIVE_ONLY){if(!this.sendConnection)throw new ne(N.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new ne(N.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,i){var o=this;return Tr(function*(){const a=yield Qe(o.sendMutex.lock("From P2PChannel.publish"));try{if(!o.sendConnection||o.state!==Tt.Connected){o.throwIfTrackTypeNotMatch(e);const m=e.filter(E=>o.pendingLocalTracks.indexOf(E)===-1);return void(o.pendingLocalTracks=o.pendingLocalTracks.concat(m))}o.store.pubId=o.store.pubId+1,Ei.markPublishStart(o.store.clientId,o.store.pubId);const l=o.filterTobePublishedTracks(e,t,i);if(l.length===0)return void(yield Qe(o.tryToUnmuteAudio(e)));l.forEach(m=>{let{track:E,type:v}=m;const T=Date.now();o.store.publish(E.getTrackId(),v===ce.LocalAudioTrack?"audio":"video",T)}),o.bindLocalTrackEvents(l);const u=yield Qe(o.sendConnection.send(l.map(m=>{let{track:E}=m;return E}),o.store.codec,o.store.audioCodec)),h=(yield Qe(u.next())).value,f=o.createGatewayPublishMessage(l,h);try{yield f}catch(m){throw u.throw(m),(m==null?void 0:m.code)===N.WS_ABORT&&l.forEach(E=>{let{track:v}=E;o.pendingLocalTracks.indexOf(v)===-1&&o.pendingLocalTracks.push(v)}),o.unbindLocalTrackEvents(l),m}yield Qe(u.next()),l.forEach(m=>{let{type:E}=m;o.statsCollector.addLocalStats(E)}),o.statsUploader.startUploadOutboundStats(),o.assignLocalTracks(l,h),l.forEach(m=>{let{track:E,type:v}=m;const T=Date.now();o.store.publish(E.getTrackId(),v===ce.LocalAudioTrack?"audio":"video",void 0,T)}),o.startUploadUplinkState()}finally{a()}})()}async unpublish(e){if(!this.sendConnection||this.state!==Tt.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(a=>!Ie(e).call(e,a)));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const i=t.find(a=>a[0]==="videoLowTrack");i&&i[1].track.close();const o=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(a=>{let[,{id:l}]=a;return l})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(a=>{let[l,{track:u}]=a;return{type:l,track:u}})),t.forEach(a=>{let[l]=a;this.statsCollector.removeLocalStats(l)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Tt.Connected)return i&&i[1].track.close(),o;e.forEach(a=>{const l=this.pendingLocalTracks.indexOf(a);l!==-1&&this.pendingLocalTracks.splice(l,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const t=[],i=[];Array.from(this.localTrackMap.entries()).forEach(o=>{let[a,{track:l,ssrcs:u}]=o;const h={stream_type:Z7(l,a),ssrcs:u};l._muted||!l._enabled?t.push(h):i.push(h)}),t.length>0&&t.forEach(o=>{Dt(this,Me.RequestMuteLocal,[o])}),i.length>0&&i.forEach(o=>{Dt(this,Me.RequestUnmuteLocal,[o])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return Tr(function*(){throw new ne(N.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(y.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Sn(this,Me.RequestRePublish,this.pendingLocalTracks),this.emit(Me.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new ne(N.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,i,o){var a;if(!this.recvConnection)throw new ne(N.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((a=this.remoteUserMap.get(e))!==null&&a!==void 0&&a.has(t))return;const{track:l,mid:u,transceiver:h}=await this.recvConnection.receive(t,[{ssrcId:i}],String(e.uid),o);t===be.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(l):(e._audioTrack=new Ps(l,e.uid,e._uintid,this.store),y.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),h&&e._audioTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=i,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(l):(e._videoTrack=new Lo(l,e.uid,e._uintid,this.store),y.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),h&&e._videoTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(e,e._videoTrack));const f=this.remoteUserMap.get(e);f?f.set(t,u):this.remoteUserMap.set(e,new Map([[t,u]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const m=this.pendingRemoteTracks.findIndex(E=>{let{user:v,kind:T}=E;return v.uid===e.uid&&t===T});m!==-1&&(this.pendingRemoteTracks.splice(m,1),this.emit(Me.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,i,o){if(!this.recvConnection)throw new ne(N.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:i}],String(e.uid),o)}async unsubscribe(e,t,i){const o=this.pendingRemoteTracks.filter(l=>{let{user:u,kind:h}=l;return t!==void 0?u.uid===e.uid&&t===h:u.uid===e.uid});if(o.forEach(l=>{const u=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(u,1)}),this.recvConnection||i||o.forEach(l=>{let{kind:u}=l;var h;if(u===be.AUDIO)(h=e._audioTrack)===null||h===void 0||h._destroy(),e._audioTrack=void 0;else if(u===be.VIDEO){var f;(f=e._videoTrack)===null||f===void 0||f._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const a=this.filterTobeUnSubscribedTracks(e,t);a.length!==0&&(await this.recvConnection.stopReceiving(a.map(l=>{let[,{id:u}]=l;return u})),this.withdrawRemoteTracks(a),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),a.forEach(l=>{let[u,{kind:h}]=l;var f,m;if(h===be.VIDEO&&u._videoSSRC&&((f=this.recvConnection)===null||f===void 0||f.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),h===be.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),i||((m=u._videoTrack)===null||m===void 0||m._destroy(),u._videoTrack=void 0);else if(h===be.AUDIO){var E;this.unbindRemoteTrackEvents(u._audioTrack),!i&&((E=u._audioTrack)===null||E===void 0||E._destroy(),u._audioTrack=void 0)}}),a.forEach(l=>{let[,{kind:u}]=l;Dt(this,Me.RequestP2PMuteRemote,u)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,i]=t;[be.VIDEO,be.AUDIO].forEach(o=>{i.has(o)?Dt(this,Me.RequestP2PUnmuteRemote,o):Dt(this,Me.RequestP2PMuteRemote,o)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new ne(N.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new ne(N.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new ne(N.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new ne(N.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const i=this.remoteUserMap.get(e);if(!i)return void y.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(t))return void y.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const o=t===be.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const i=this.remoteUserMap.get(e);if(!i)return void y.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(t)||y.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(ce.LocalAudioTrack);if((t==null?void 0:t.track)instanceof In){const i=t.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[a]=o;return a!==ce.LocalAudioTrack}).filter(o=>{let[a]=o;return!(e&&a===ce.LocalVideoLowTrack)}).map(o=>{let[,{track:a}]=o;return a}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return!(e&&o===ce.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o})}reportPublishEvent(e,t,i,o,a){if(e){const u=this.localTrackMap.get(ce.LocalAudioTrack),h=o?this.localTrackMap.get(ce.LocalVideoLowTrack):this.localTrackMap.get(ce.LocalVideoTrack);Oe.publish(this.store.sessionId,{eventElapse:Ei.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:u==null?void 0:u.track.getTrackLabel(),videoName:h==null?void 0:h.track.getTrackLabel(),screenshare:(h==null?void 0:h.track._hints.indexOf(Ut.SCREEN_TRACK))!==-1,audio:!!u,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}else{var l;i||(i=[]);const u=i.find(f=>f instanceof bt),h=o?(l=this.localTrackMap.get(ce.LocalVideoTrack))===null||l===void 0?void 0:l.track:i.find(f=>f instanceof et);Oe.publish(this.store.sessionId,{eventElapse:Ei.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:u==null?void 0:u.getTrackLabel(),videoName:h==null?void 0:h.getTrackLabel(),screenshare:(h==null?void 0:h._hints.indexOf(Ut.SCREEN_TRACK))!==-1,audio:!!u,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}}reportSubscribeEvent(e,t,i,o){const a=o===be.VIDEO?i._videoSSRC:i._audioSSRC;a&&Oe.subscribe(this.store.sessionId,{succ:e,ec:t,video:o===be.VIDEO,audio:o===be.AUDIO,peerid:i.uid,subscribeRequestid:o===be.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:Ei.measureFromSubscribeStart(this.store.clientId,a)})}reset(){y.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Qn("P2PChannel2-send-mutex"),this.sendMutex=new Qn("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(ce.LocalAudioTrack);if((e==null?void 0:e.track)instanceof In){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(i=>{t.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Tt.Disconnected}getStats(e){var t,i;return e?(i=this.recvConnection)===null||i===void 0?void 0:i.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(ce.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(ce.LocalVideoTrack);if(e)return{width:e.track._videoWidth||0,height:e.track._videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof et||t&&t.track instanceof bt?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!t||i.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!t||i.has(t))}getRemoteMedia(e){var t;const i=Array.from(Dr(t=this.remoteUserMap).call(t)).find(o=>o.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[o]=i;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(ce.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=kh(e).call(e,(i,o)=>i.level-o.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(y.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Tt.Reconnecting,V("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var i;t._videoTrack&&t._videoTrack._player&&((i=t._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[i,{track:o}]=e;switch(i){case ce.LocalVideoTrack:Ie(t=o._hints).call(t,Ut.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case ce.LocalAudioTrack:o instanceof In?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case ce.LocalVideoLowTrack:}}),this.emit(Me.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,i]=e;Array.from(Dr(i).call(i)).forEach(o=>{this.setPendingRemoteMedia(t,o)}),this.emit(Me.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),y.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const i of this.pendingRemoteTracks){const{user:o,kind:a}=i;if((e instanceof si?e.uid:e)===o.uid&&t===a)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let i,o;if(e===Ii.SEND_ONLY){if(!this.sendConnection)throw new ne(N.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");i=await this.sendMutex.lock("From P2PChannel.restartICE"),o=this.sendConnection}else{if(!this.recvConnection)throw new ne(N.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");i=await this.recvMutex.lock("From P2PChannel.restartICE"),o=this.recvConnection}try{if(t){const a=await o.restartICE(t);return o.isInRestartIce=!1,a}{const a=await o.restartICE();if(a){const l=await Sn(this,Me.RequestP2PRestartICE,{direction:Ii.RECEIVE_ONLY,iceParameter:a});await o.restartICE(l),o.isInRestartIce=!1}}}finally{i()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(ce.LocalVideoTrack),i=this.localTrackMap.get(ce.LocalAudioTrack),o=e.videoSend.find(A=>{var C;return A.ssrc===(t==null||(C=t.ssrcs)===null||C===void 0?void 0:C[0].ssrcId)}),a=e.audioSend.find(A=>{var C;return A.ssrc===(i==null||(C=i.ssrcs)===null||C===void 0?void 0:C[0].ssrcId)});if(!o||!a)return 1;const l=Er(this,Me.NeedSignalRTT),u=o?o.rttMs:void 0,h=a?a.rttMs:void 0,f=u&&h?(u+h)/2:u||h,m=(f&&l?(f+l)/2:f||l)||0,E=100*e.sendPacketLossRate*.7/50+.3*m/1500,v=E<.17?1:E<.36?2:E<.59?3:E<.1?4:5,T=t==null?void 0:t.track;if(T&&T._encoderConfig&&T._hints.indexOf(Ut.SCREEN_TRACK)===-1){const A=T._encoderConfig.bitrateMax,C=e.bitrate.actualEncoded;if(A&&C){const b=(1e3*A-C)/(1e3*A);return R1[b<.15?0:b<.3?1:b<.45?2:b<.6?3:4][v]}}return v}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[o]=i;const a=o._audioSSRC,l=o._videoSSRC,u=e.audioRecv.find(C=>C.ssrc===a),h=e.videoRecv.find(C=>C.ssrc===l);if(!u&&!h)return void(t+=1);const f=Er(this,Me.NeedSignalRTT),m=e.rtt,E=(m&&f?(m+f)/2:m||f)||0,v=u?u.jitterMs:void 0,T=e.recvPacketLossRate;let A=.7*T*100/50+.3*E/1500;v&&(A=.6*T*100/50+.2*E/1500+.2*v/400),t+=A<.1?1:A<.17?2:A<.36?3:A<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new X((t,i)=>{this.handleMuteLocalTrack(e,t,i)})}filterTobePublishedTracks(e,t,i){const o=[],a=mt(),l=this.getAllTracks();e=Ud(e=e.filter(f=>l.indexOf(f)===-1));let u=!1,h=!1;for(const f of e){if(f instanceof et&&(this.localTrackMap.has(ce.LocalVideoTrack)||u?new ne(N.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:f,type:ce.LocalVideoTrack}),u=!0),t)){const m=this.getLowVideoTrack(f,i);o.push({track:m,type:ce.LocalVideoLowTrack})}if(f instanceof bt){const m=this.localTrackMap.get(ce.LocalAudioTrack);if(m){if(!(m.track instanceof In))throw new ne(N.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(f._bypassWebAudio)throw new ne(N.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");m.track.addAudioTrack(f),this.bindLocalAudioTrackEvents(f,!0)}else if(h){const E=o.find(v=>{let{type:T}=v;return T===ce.LocalAudioTrack});if(!(E.track instanceof In))throw new ne(N.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(f._bypassWebAudio)throw new ne(N.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");E.track.addAudioTrack(f)}else{if(!a.webAudioMediaStreamDest||f instanceof In||f._bypassWebAudio)o.push({track:f,type:ce.LocalAudioTrack});else{const E=new In;E.addAudioTrack(f),o.push({track:E,type:ce.LocalAudioTrack})}h=!0}}}return o}filterTobeUnpublishedTracks(e){const t=[],i=this.getAllTracks();e=Ud(e=e.filter(o=>i.indexOf(o)!==-1));for(const o of e){if(o instanceof bt){const a=this.localTrackMap.get(ce.LocalAudioTrack);if(!a)continue;a.track instanceof In?(a.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),a.track.trackList.length===0&&(t.push([ce.LocalAudioTrack,a]),a.track.close())):t.push([ce.LocalAudioTrack,a])}if(o instanceof et){const a=this.localTrackMap.get(ce.LocalVideoTrack);if(!a)continue;t.push([ce.LocalVideoTrack,a]);const l=this.localTrackMap.get(ce.LocalVideoLowTrack);l&&t.push([ce.LocalVideoLowTrack,l])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:i,type:o}=t;switch(o){case ce.LocalVideoTrack:i.addListener(Te.GET_STATS,this.handleGetLocalVideoStats),i.addListener(Te.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(Te.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(Te.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(Te.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),i.addListener(Te.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(Te.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(Te.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ce.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case ce.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof In?e.trackList.forEach(i=>{i.addListener(Te.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(Te.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(Te.GET_STATS,this.handleGetLocalAudioStats),i.addListener(Te.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(Te.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Te.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Te.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Te.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Te.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Te.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(Te.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[i,{track:o}]=t;return{track:o,type:i}})),e.forEach(t=>{let{track:i,type:o}=t;switch(o){case ce.LocalVideoTrack:i.off(Te.GET_STATS,this.handleGetLocalVideoStats),i.off(Te.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(Te.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(Te.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(Te.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),i.off(Te.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(Te.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(Te.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ce.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case ce.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof In?e.trackList.forEach(t=>{t.off(Te.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Te.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Te.GET_STATS,this.handleGetLocalAudioStats),t.off(Te.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Te.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Te.GET_STATS,this.handleGetLocalAudioStats),e.off(Te.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Te.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Te.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Te.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Te.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Lo&&t.addListener(Te.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),t instanceof Ps&&t.addListener(Te.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Te.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,i]=e;i.has(be.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),i.has(be.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((i,o)=>{var a;let l,{track:u,type:h}=i;switch(h){case ce.LocalAudioTrack:l=vt.Audio;break;case ce.LocalVideoTrack:l=Ie(a=u._hints).call(a,Ut.SCREEN_TRACK)?vt.Screen:vt.High;break;case ce.LocalVideoLowTrack:l=vt.Low}return{kind:h===ce.LocalAudioTrack?be.AUDIO:be.VIDEO,stream_type:l,mid:t[o].id,ssrcs:t[o].localSSRC,isMuted:u.muted||!u.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var i;let o,[a,{track:l,ssrcs:u,id:h}]=t;switch(a){case ce.LocalVideoTrack:o=Ie(i=l._hints).call(i,Ut.SCREEN_TRACK)?vt.Screen:vt.High;break;case ce.LocalAudioTrack:o=vt.Audio;break;case ce.LocalVideoLowTrack:o=vt.Low}return{stream_type:o,ssrcs:u,mid:h}})}assignLocalTracks(e,t){e.forEach((i,o)=>{let{track:a,type:l}=i;this.localTrackMap.set(l,{track:a,id:t[o].id,ssrcs:t[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[i]=t;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var i;y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(Me.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),Ie(i=this._restartStates).call(i,t)&&!e.isInRestartIce&&(t==="disconnected"&&await Xn(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),Oe.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Qt.TRACER}).onSuccess(),this.emit(Me.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var i;const o=Array.from(Dr(i=this.remoteUserMap).call(i)).find(l=>l._audioSSRC===t);var a;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(a=o.audioTrack)===null||a===void 0||a.emit(_c.FIRST_FRAME_DECODED),Oe.firstRemoteFrame(this.store.sessionId,Dn.FIRST_AUDIO_DECODE,Gt.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:Ei.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var i;const o=Array.from(Dr(i=this.remoteUserMap).call(i)).find(a=>a._audioSSRC===t);o&&Oe.firstRemoteFrame(this.store.sessionId,Dn.FIRST_AUDIO_RECEIVED,Gt.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:Ei.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,i,o)=>{this.reportVideoFirstFrameDecoded(t,i,o)},e.onFirstVideoReceived=t=>{var i;const o=Array.from(Dr(i=this.remoteUserMap).call(i)).find(a=>a._videoSSRC===t);o&&Oe.firstRemoteFrame(this.store.sessionId,Dn.FIRST_VIDEO_RECEIVED,Gt.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:Ei.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,i)=>{const o=t.candidateType==="relay",a=i.candidateType==="relay";i.candidateType!=="unknown"&&o===a||this.emit(Me.ConnectionTypeChange,o),y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(hc(i))," -> ").concat(JSON.stringify(hc(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,i)=>{y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(hc(i))," -> ").concat(JSON.stringify(hc(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(Me.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===Ii.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,y.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===Ii.SEND_ONLY?this.restartICE(e):Sn(this,Me.RequestP2PRestartICE,{direction:Ii.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const i=this.localTrackMap.get(ce.LocalAudioTrack);if(e instanceof bt&&(i==null?void 0:i.track)instanceof In)return i.track.isActive||t.push([ce.LocalAudioTrack,i]),t;const o=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:l}]=a;return e===l});if(o&&(t.push(o),o[0]===ce.LocalVideoTrack)){const a=this.localTrackMap.get(ce.LocalVideoLowTrack);a&&t.push([ce.LocalVideoLowTrack,a])}return t}filterTobeUnmutedTracks(e){const t=[],i=this.localTrackMap.get(ce.LocalAudioTrack);if(e instanceof bt&&(i==null?void 0:i.track)instanceof In)return i.track.isActive&&t.push([ce.LocalAudioTrack,i]),t;const o=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:l}]=a;return e===l});if(o)if(o[0]===ce.LocalVideoTrack){t.push(o);const a=this.localTrackMap.get(ce.LocalVideoLowTrack);a&&t.push([ce.LocalVideoLowTrack,a])}else t.push(o);return t}createMuteMessage(e){return e.map(t=>{var i;let o,[a,{track:l,ssrcs:u,id:h}]=t;switch(a){case ce.LocalAudioTrack:o=vt.Audio;break;case ce.LocalVideoTrack:o=Ie(i=l._hints).call(i,Ut.SCREEN_TRACK)?vt.Screen:vt.High;break;case ce.LocalVideoLowTrack:o=vt.Low}return{stream_type:o,ssrcs:u,mid:h}})}createUnmuteMessage(e){return e.map(t=>{var i;let o,[a,{track:l,ssrcs:u,id:h}]=t;switch(a){case ce.LocalAudioTrack:o=vt.Audio;break;case ce.LocalVideoTrack:o=Ie(i=l._hints).call(i,Ut.SCREEN_TRACK)?vt.Screen:vt.High;break;case ce.LocalVideoLowTrack:o=vt.Low}return{stream_type:o,ssrcs:u,mid:h}})}filterTobeUnSubscribedTracks(e,t){const i=[],o=this.remoteUserMap.get(e);if(!o)return i;if(t){const a=o.get(t);if(!a)return i;i.push([e,{kind:t,id:a}])}else Array.from(o.entries()).forEach(a=>{let[l,u]=a;i.push([e,{kind:l,id:u}])});return i}createUnsubscribeMessage(e){const t=[];return e.forEach(i=>{let[o,{kind:a,id:l}]=i;switch(a){case be.VIDEO:return void(o._videoSSRC&&t.push({stream_type:be.VIDEO,ssrcId:o._videoSSRC}));case be.AUDIO:return void(o._audioSSRC&&t.push({stream_type:be.AUDIO,ssrcId:o._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[i,{kind:o}]=t;const a=this.remoteUserMap.get(i);a&&(a.delete(o),Array.from(a.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(ce.LocalVideoTrack),i=this.localTrackMap.get(ce.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),i&&e.low_stream_uplink&&await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof bt){const i=this.filterTobeUnmutedTracks(e[t]);if(i.length===0)continue;const o=this.createUnmuteMessage(i);return void await Dt(this,Me.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Me.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Me.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Xn(n_(this.dtlsFailedCount,yn)),this.emit(Me.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(ce.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof et)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof et).length>1)throw new ne(N.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof bt).length>1&&(e.some(t=>t instanceof bt&&t._bypassWebAudio)||!mt().webAudioMediaStreamDest))throw new ne(N.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof et&&this.pendingLocalTracks.some(i=>i instanceof et))throw new ne(N.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof bt&&this.pendingLocalTracks.some(i=>i instanceof bt)&&(!mt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof bt&&i._bypassWebAudio)))throw new ne(N.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const i=!V("DISABLE_DUAL_STREAM_USE_ENCODING")&&mt().supportDualStreamEncoding,o=dE(dE({},{width:160,height:120,framerate:15,bitrate:50}),t);let a;a=i?e._mediaStreamTrack.clone():Q0(e,o);const l=Lt(8,"track-low-"),u=new et(a,dE(dE({},i&&{scaleResolutionDownBy:Ey(o,e)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,l);return u.on(fc.TRANSCEIVER_UPDATED,h=>{e._updateRtpTransceiver(h,pc.LOW_STREAM)}),u._hints.push(Ut.LOW_STREAM),e.addListener(Te.NEED_CLOSE,()=>{u.close()}),u}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,i,o){var a;const l=Array.from(Dr(a=this.remoteUserMap).call(a)).find(u=>u._videoSSRC===e);if(l){o||this.store.subscribe(l.uid,"video",void 0,void 0,void 0,void 0,Date.now());const u=this.store.keyMetrics,h=u.subscribe.find(f=>f.userId===l.uid&&f.type==="video");Oe.firstRemoteVideoDecode(this.store.sessionId,Dn.FIRST_VIDEO_DECODE,Gt.FIRST_VIDEO_DECODE,{peer:l._uintid,videowidth:t,videoheight:i,subscribeElapse:Ei.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:u.requestAPEnd||0,apStart:u.requestAPStart||0,joinGwEnd:u.joinGatewayEnd||0,joinGwStart:u.joinGatewayStart||0,pcEnd:u.peerConnectionEnd||0,pcStart:u.peerConnectionStart||0,subscriberEnd:(h==null?void 0:h.subscribeEnd)||0,subscriberStart:(h==null?void 0:h.subscribeStart)||0,videoAddNotify:(h==null?void 0:h.streamAdded)||0,state:o?1:0})}}async remoteMediaSsrcChanged(e,t,i){if(!this.recvConnection)return!1;const o=this.remoteUserMap.get(e);if(!o)return!1;const a=o.get(t);if(!a)return!1;const l=await this.recvConnection.getRemoteSSRC(a);return l!==void 0&&l!==i}resetConnection(e){y.debug("[".concat(this.store.clientId,"] [P2PChannel2] reset connection to ").concat(e)),this.state===Tt.Connected?(y.debug("[".concat(this.store.clientId,"] [P2PChannel2] fallback to websocket but P2PChannel2 state still connected, disconnect first")),this.disconnectForReconnect()):(this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0))}async publishDataChannel(e){throw new ne(N.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new ne(N.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new ne(N.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new ne(N.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new ne(N.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new ne(N.NOT_SUPPORTED)}async preConnect(e,t,i,o,a,l){throw new ne(N.NOT_SUPPORTED)}getEstablishParams(){throw new ne(N.NOT_SUPPORTED)}async reSubscribe(e){throw new ne(N.NOT_SUPPORTED)}async updateVideoStreamParameter(e,t){throw new ne(N.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:i}]=e;t===ce.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,pc.LOW_STREAM):i._updateRtpTransceiver(void 0)})}}function lo(n){return function(e,t,i){const o=e[t];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){for(var a=arguments.length,l=new Array(a),u=0;u<a;u++)l[u]=arguments[u];switch(n){case as.SEND_ONLY:{const h=await this.sendMutex.lock("From P2PChannel2.".concat(t));try{return await o.apply(this,l)}finally{h()}}case as.RECEIVE_ONLY:{const h=await this.recvMutex.lock("From P2PChannel2.".concat(t));try{return await o.apply(this,l)}finally{h()}}default:{const h=await this.sendMutex.lock("From P2PChannel2.".concat(t)),f=await this.recvMutex.lock("From P2PChannel2.".concat(t));try{return await o.apply(this,l)}finally{h(),f()}}}},i}}function sM(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}function Gl(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?sM(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):sM(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}ie([lo(as.SEND_ONLY),O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",X)],Mn.prototype,"p2pConnect",null),ie([lo(as.SEND_ONLY),O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",X)],Mn.prototype,"unpublish",null),ie([lo(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",X)],Mn.prototype,"unpublishLowStream",null),ie([lo(as.RECEIVE_ONLY),O("design:type",Function),O("design:paramtypes",[si,String,Number,String]),O("design:returntype",X)],Mn.prototype,"subscribe",null),ie([lo(as.RECEIVE_ONLY),O("design:type",Function),O("design:paramtypes",[si,String,Number,String]),O("design:returntype",X)],Mn.prototype,"mockSubscribe",null),ie([lo(as.RECEIVE_ONLY),O("design:type",Function),O("design:paramtypes",[si,String,Boolean]),O("design:returntype",X)],Mn.prototype,"unsubscribe",null),ie([lo(as.RECEIVE_ONLY),O("design:type",Function),O("design:paramtypes",[si,String]),O("design:returntype",X)],Mn.prototype,"muteRemote",null),ie([lo(as.RECEIVE_ONLY),O("design:type",Function),O("design:paramtypes",[si,String]),O("design:returntype",X)],Mn.prototype,"unmuteRemote",null),ie([lo(as.RECEIVE_ONLY),O("design:type",Function),O("design:paramtypes",[si,String]),O("design:returntype",X)],Mn.prototype,"hasRemoteMediaWithLock",null),ie([lo(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",X)],Mn.prototype,"disconnectForReconnect",null),ie([lo(as.RECEIVE_ONLY),O("design:type",Function),O("design:paramtypes",[si,String,Number]),O("design:returntype",X)],Mn.prototype,"remoteMediaSsrcChanged",null);class Lp{constructor(e){S(this,"store",void 0),S(this,"onStatsException",void 0),S(this,"onUploadPublishDuration",void 0),S(this,"onStatsChanged",void 0),S(this,"localStats",new Map),S(this,"remoteStats",new Map),S(this,"updateStatsInterval",void 0),S(this,"trafficStats",void 0),S(this,"trafficStatsPeerList",[]),S(this,"uplinkStats",void 0),S(this,"exceptionMonitor",void 0),S(this,"p2pChannel",void 0),S(this,"scalabilityMode",ry.L1T1),S(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=e,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new L7,this.exceptionMonitor.on("exception",(t,i,o)=>{this.onStatsException&&this.onStatsException(t,i,o)})}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(ce.LocalAudioTrack)||Gl({},Ny)}getLocalVideoTrackStats(){return this.localStats.get(ce.LocalVideoTrack)||Gl({},Py)}getRemoteAudioTrackStats(e){const t=(a,l)=>{if(!this.trafficStats)return l;const u=this.trafficStats.peer_delay.find(h=>h.peer_uid===a);return u&&(l.publishDuration=u.B_ppad+(Date.now()-this.trafficStats.timestamp)),l},i={};if(e){var o;const a=(o=this.remoteStats.get(e))===null||o===void 0?void 0:o.audioStats;a&&(i[e]=t(e,a))}else Array.from(this.remoteStats.entries()).forEach(a=>{let[l,{audioStats:u}]=a;u&&(i[l]=t(l,u))});return i}getRemoteNetworkQualityStats(e){const t={};if(e){var i;const o=(i=this.remoteStats.get(e))===null||i===void 0?void 0:i.networkStats;o&&(t[e]=o)}else Array.from(this.remoteStats.entries()).forEach(o=>{let[a,{networkStats:l}]=o;l&&(t[a]=l)});return t}getRemoteVideoTrackStats(e){const t=(a,l)=>{if(!this.trafficStats)return l;const u=this.trafficStats.peer_delay.find(h=>h.peer_uid===a);return u&&(l.publishDuration=u.B_ppvd+(Date.now()-this.trafficStats.timestamp)),l},i={};if(e){var o;const a=(o=this.remoteStats.get(e))===null||o===void 0?void 0:o.videoStats;a&&(i[e]=t(e,a))}else Array.from(this.remoteStats.entries()).forEach(a=>{let[l,{videoStats:u}]=a;u&&(i[l]=t(l,u))});return i}getRTCStats(){let e=0,t=0,i=0,o=0;const a=this.localStats.get(ce.LocalAudioTrack);a&&(e+=a.sendBytes,t+=a.sendBitrate);const l=this.localStats.get(ce.LocalVideoTrack);l&&(e+=l.sendBytes,t+=l.sendBitrate);const u=this.localStats.get(ce.LocalVideoLowTrack);u&&(e+=u.sendBytes,t+=u.sendBitrate),this.remoteStats.forEach(f=>{let{audioStats:m,videoStats:E}=f;m&&(i+=m.receiveBytes,o+=m.receiveBitrate),E&&(i+=E.receiveBytes,o+=E.receiveBitrate)});let h=1;return this.trafficStats&&(h+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:h,SendBitrate:t,SendBytes:e,RecvBytes:i,RecvBitrate:o,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){e.peer_delay=e.peer_delay.filter(t=>t.B_ppad!==void 0||t.B_ppvd!==void 0),e.peer_delay.filter(t=>this.trafficStatsPeerList.indexOf(t.peer_uid)===-1).forEach(t=>{var i;const o=(i=this.p2pChannel)===null||i===void 0?void 0:i.getRemoteMedia(t.peer_uid),a=o!=null&&o.videoSSRC?Ei.measureFromSubscribeStart(this.store.clientId,o.videoSSRC):0,l=o!=null&&o.audioSSRC?Ei.measureFromSubscribeStart(this.store.clientId,o.audioSSRC):0;t.B_ppad!==void 0&&t.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(t.peer_uid,t.B_ppad,t.B_ppvd,a>l?a:l),this.trafficStatsPeerList.push(t.peer_uid))}),this.trafficStats=e}updateUplinkStats(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&y.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,t,i){if(!e)return!1;const o=!!i&&t.framesDecodeFreezeTime>i.framesDecodeFreezeTime,a=!i||t.framesDecodeCount>i.framesDecodeCount;return o||!a}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){Array.from(this.localStats.entries()).forEach(t=>{let[i,o]=t;switch(i){case ce.LocalVideoTrack:case ce.LocalVideoLowTrack:{const l=o,u=Gl({},Py),h=e.getStats(),f=e.getLocalMedia(i);if(h){const m=h.videoSend.find(E=>E.ssrc===(f==null?void 0:f.ssrcs[0].ssrcId));if(m){const E=e.getLocalVideoSize(),v=e.getEncoderConfig(ce.LocalVideoTrack);m.codec!=="H264"&&m.codec!=="H265"&&m.codec!=="VP8"&&m.codec!=="VP9"&&m.codec!=="AV1X"&&m.codec!=="AV1"||(u.codecType=m.codec),u.sendBytes=m.bytes,u.sendBitrate=l?8*Math.max(0,u.sendBytes-l.sendBytes):0,m.inputFrame?(u.captureFrameRate=m.inputFrame.frameRate,u.captureResolutionHeight=m.inputFrame.height,u.captureResolutionWidth=m.inputFrame.width):E&&(u.captureResolutionWidth=E.width,u.captureResolutionHeight=E.height),m.sentFrame?(u.sendFrameRate=m.sentFrame.frameRate,u.sendResolutionHeight=m.sentFrame.height,u.sendResolutionWidth=m.sentFrame.width):E&&(u.sendResolutionWidth=E.width,u.sendResolutionHeight=E.height),m.avgEncodeMs&&(u.encodeDelay=m.avgEncodeMs),v&&v.bitrateMax&&(u.targetSendBitrate=1e3*v.bitrateMax),u.sendPackets=m.packets,u.sendPacketsLost=m.packetsLost,u.sendJitterMs=m.jitterMs,u.sendRttMs=m.rttMs,u.totalDuration=l?l.totalDuration+1:1,u.totalFreezeTime=l?l.totalFreezeTime:0,this.isLocalVideoFreeze(m)&&(u.totalFreezeTime+=1),m.scalabilityMode&&this.scalabilityMode!==m.scalabilityMode&&(y.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(m.scalabilityMode)),this.scalabilityMode=m.scalabilityMode)}this.trafficStats&&(u.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var a;this.localStats.set(i,u),((l==null?void 0:l.sendResolutionWidth)!==u.sendResolutionWidth||(l==null?void 0:l.sendResolutionHeight)!==u.sendResolutionHeight)&&((a=this.onStatsChanged)===null||a===void 0||a.call(this,"resolution",{width:u.sendResolutionWidth,height:u.sendResolutionHeight})),u&&f&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,f.track,u);break}case ce.LocalAudioTrack:{const l=o,u=Gl({},Ny),h=e.getStats(),f=e.getLocalMedia(i);if(h){const m=h.audioSend.find(E=>E.ssrc===(f==null?void 0:f.ssrcs[0].ssrcId));if(m){if(m.codec!=="opus"&&m.codec!=="aac"&&m.codec!=="PCMU"&&m.codec!=="PCMA"&&m.codec!=="G722"||(u.codecType=m.codec),m.inputLevel)u.sendVolumeLevel=Math.round(32767*m.inputLevel);else{const E=e.getLocalAudioVolume();E&&(u.sendVolumeLevel=Math.round(32767*E))}u.sendBytes=m.bytes,u.sendPackets=m.packets,u.sendPacketsLost=m.packetsLost,u.sendJitterMs=m.jitterMs,u.sendRttMs=m.rttMs,u.sendBitrate=l?8*Math.max(0,u.sendBytes-l.sendBytes):0}}this.trafficStats&&(u.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(ce.LocalAudioTrack,u),u&&f&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,f.track,u);break}}})}updateRemoteStats(e){Array.from(this.remoteStats.entries()).forEach(t=>{var i,o;let[a,{videoStats:l,audioStats:u,videoPcStats:h}]=t;const f=u,m=l,E=h,v=Gl({},hD),T=Gl({},pD),A=Gl({},Lz),{audioTrack:C,videoTrack:b,audioSSRC:D,videoSSRC:M}=e.getRemoteMedia(a);let B;B=e instanceof Mn?e.getStats(!0):e.getStats();const J=(i=B)===null||i===void 0?void 0:i.audioRecv.find(Q=>Q.ssrc===D),G=(o=B)===null||o===void 0?void 0:o.videoRecv.find(Q=>Q.ssrc===M),q=this.trafficStats&&this.trafficStats.peer_delay.find(Q=>Q.peer_uid===a);if(J&&(J.codec!=="opus"&&J.codec!=="aac"&&J.codec!=="PCMU"&&J.codec!=="PCMA"&&J.codec!=="G722"||(v.codecType=J.codec),J.outputLevel?v.receiveLevel=Math.round(32767*J.outputLevel):C&&(v.receiveLevel=Math.round(32767*C.getVolumeLevel())),v.receiveBytes=J.bytes,v.receivePackets=J.packets,v.receivePacketsLost=J.packetsLost,v.packetLossRate=v.receivePacketsLost/(v.receivePackets+v.receivePacketsLost),v.receiveBitrate=f?8*Math.max(0,v.receiveBytes-f.receiveBytes):0,v.totalDuration=f?f.totalDuration+1:1,v.totalFreezeTime=f?f.totalFreezeTime:0,v.freezeRate=v.totalFreezeTime/v.totalDuration,v.receiveDelay=J.jitterBufferMs,v.totalDuration>10&&Lp.isRemoteAudioFreeze(C)&&(v.totalFreezeTime+=1)),G){G.codec!=="H264"&&G.codec!=="H265"&&G.codec!=="VP8"&&G.codec!=="VP9"&&G.codec!=="AV1X"&&G.codec!=="AV1"||(T.codecType=G.codec),T.receiveBytes=G.bytes,T.receiveBitrate=m?8*Math.max(0,T.receiveBytes-m.receiveBytes):0,T.decodeFrameRate=G.decodeFrameRate<0?0:G.decodeFrameRate,T.renderFrameRate=G.decodeFrameRate<0?0:G.decodeFrameRate,G.outputFrame&&(T.renderFrameRate=G.outputFrame.frameRate),G.receivedFrame?(T.receiveFrameRate=G.receivedFrame.frameRate,T.receiveResolutionHeight=G.receivedFrame.height,T.receiveResolutionWidth=G.receivedFrame.width):b&&(T.receiveResolutionHeight=b._videoHeight||0,T.receiveResolutionWidth=b._videoWidth||0),G.framesRateFirefox!==void 0&&(T.receiveFrameRate=Math.round(G.framesRateFirefox)),T.receivePackets=G.packets,T.receivePacketsLost=G.packetsLost,T.packetLossRate=T.receivePacketsLost/(T.receivePackets+T.receivePacketsLost),T.totalDuration=m?m.totalDuration+1:1,T.totalFreezeTime=m?m.totalFreezeTime:0,T.receiveDelay=G.jitterBufferMs||0;const Q=!!M&&e.getRemoteVideoIsReady(M);b&&Q&&Lp.isRemoteVideoFreeze(b,G,E)&&(T.totalFreezeTime+=1),T.freezeRate=T.totalFreezeTime/T.totalDuration}q&&(v.end2EndDelay=q.B_ad,T.end2EndDelay=q.B_vd,v.transportDelay=q.B_ed,T.transportDelay=q.B_ed,v.currentPacketLossRate=q.B_ealr4/100,T.currentPacketLossRate=q.B_evlr4/100,A.uplinkNetworkQuality=q.B_punq?q.B_punq:0,A.downlinkNetworkQuality=q.B_pdnq?q.B_pdnq:0),this.remoteStats.set(a,{audioStats:v,videoStats:T,videoPcStats:G,networkStats:A}),C&&this.exceptionMonitor.setRemoteAudioStats(C,v),b&&this.exceptionMonitor.setRemoteVideoStats(b,T)})}}function oM(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}function Mp(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?oM(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):oM(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}class eq extends zt{constructor(e,t,i,o){super(),S(this,"spec",void 0),S(this,"token",void 0),S(this,"websocket",void 0),S(this,"pingpongTimer",void 0),S(this,"reconnectMode","retry"),S(this,"serviceMode",void 0),S(this,"reqId",0),S(this,"commandReqId",0),S(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),S(this,"handleWebSocketMessage",a=>{if(!a.data)return;const l=JSON.parse(a.data);l.requestId?this.emit("@".concat(l.requestId,"-").concat(l.sid),l):this.serviceMode===kn.INJECT?this.emit(ws.INJECT_STREAM_STATUS,l):(Oe.workerEvent(this.spec.sid,{actionType:"status",serverCode:l.code,workerType:this.serviceMode===kn.TRANSCODE?1:2}),this.emit(ws.PUBLISH_STREAM_STATUS,l))}),this.spec=t,this.token=e,this.serviceMode=o,this.websocket=new tp("live-streaming",i),this.websocket.on(je.CONNECTED,this.handleWebSocketOpen),this.websocket.on(je.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(je.REQUEST_NEW_URLS,(a,l)=>{Sn(this,ws.REQUEST_NEW_ADDRESS).then(a).catch(l)}),this.websocket.on(je.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(e){return this.websocket.init(e)}async request(e,t,i,o){this.reqId+=1,e==="request"&&(this.commandReqId+=1);const a=this.commandReqId,l=this.reqId;if(!l||!this.websocket)throw new W(N.UNEXPECTED_ERROR);const u=Mp({command:e,sdkVersion:es==="4.20.2"?"0.0.1":es,seq:l,requestId:l,allocate:i,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},t);if(this.websocket.state==="closed")throw new W(N.WS_DISCONNECT);const h=()=>new X((v,T)=>{this.websocket.once(je.CLOSED,()=>T(new W(N.WS_ABORT))),this.websocket.once(je.CONNECTED,v)});this.websocket.state!=="connected"&&await h(),u.clientRequest&&(u.clientRequest.workerToken=this.token);const f=new X((v,T)=>{const A=()=>{T(new W(N.WS_ABORT))};this.websocket.once(je.RECONNECTING,A),this.websocket.once(je.CLOSED,A),this.once("@".concat(l,"-").concat(this.spec.sid),C=>{v(C)})});o&&Oe.workerEvent(this.spec.sid,Mp(Mp({},o),{},{requestId:a,actionType:"request",payload:JSON.stringify(t.clientRequest),serverCode:0,code:0}));const m=Date.now();this.websocket.sendMessage(u);let E=null;try{E=await f}catch(v){if(this.websocket.state==="closed")throw v;return await h(),await this.request(e,t,i)}return o&&Oe.workerEvent(this.spec.sid,Mp(Mp({},o),{},{requestId:a,actionType:"response",payload:JSON.stringify(E.serverResponse),serverCode:E.code,success:E.code===200,responseTime:Date.now()-m})),E.code!==200&&this.handleResponseError(E),E}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const e=es==="4.20.2"?"0.0.1":es;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case fn.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void y.warning("live stream response already exists stream");case fn.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case fn.LIVE_STREAM_RESPONSE_BAD_STREAM:case fn.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new W(N.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case fn.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(e.serverResponse.command==="UnpublishStream"||e.serverResponse.command==="UninjectStream")return;throw new W(N.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case fn.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new W(N.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case fn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const t=new W(N.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(ws.WARNING,t,e.serverResponse.url)}case fn.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const t=new W(N.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(ws.WARNING,t,e.serverResponse.url)}case fn.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new W(N.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case fn.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new W(N.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case fn.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const t=new W(N.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(ws.WARNING,t,e.serverResponse.url)}case fn.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new W(N.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case fn.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new W(N.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case fn.LIVE_STREAM_RESPONSE_WORKER_LOST:case fn.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(e.serverResponse.command==="UnpublishStream"||e.serverResponse.command==="UninjectStream")return;throw new W(N.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case fn.ERROR_FAIL_SEND_MESSAGE:if(e.serverResponse.command==="UnpublishStream"||e.serverResponse.command==="UninjectStream")return;if(e.serverResponse.command==="UpdateTranscoding"||e.serverResponse.command==="ControlStream")return new W(N.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new W(N.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case fn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case fn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case fn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case fn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new W(N.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(e_)},6e3)}}function aM(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}function Xi(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?aM(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):aM(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}class tq extends zt{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:yn,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:yn;super(),S(this,"onLiveStreamWarning",void 0),S(this,"onLiveStreamError",void 0),S(this,"onInjectStatusChange",void 0),S(this,"spec",void 0),S(this,"retryTimeout",1e4),S(this,"connection",void 0),S(this,"httpRetryConfig",void 0),S(this,"wsRetryConfig",void 0),S(this,"streamingTasks",new Map),S(this,"isStartingStreamingTask",!1),S(this,"taskMutex",new Qn("live-streaming")),S(this,"cancelToken",rr.CancelToken.source()),S(this,"transcodingConfig",void 0),S(this,"injectConfig",Xi({},QK)),S(this,"injectLoopTimes",0),S(this,"uapResponse",void 0),S(this,"lastTaskId",1),S(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=i,this.wsRetryConfig=t}async setTranscodingConfig(e){const t=Xi(Xi({},XK),e);t.videoCodecProfile!==66&&t.videoCodecProfile!==77&&t.videoCodecProfile!==100&&(y.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(t.videoCodecProfile," -> 100")),t.videoCodecProfile=100),t.transcodingUsers||(t.transcodingUsers=t.userConfigs),t.transcodingUsers&&(t.transcodingUsers=t.transcodingUsers.map(l=>Xi(Xi(Xi({},JK),l),{},{zOrder:l.zOrder?l.zOrder+1:1}))),function(l){tn(l.width)||Ot(l.width,"config.width",0,1e4),tn(l.height)||Ot(l.height,"config.height",0,1e4),tn(l.videoBitrate)||Ot(l.videoBitrate,"config.videoBitrate",1,1e6),tn(l.videoFrameRate)||Ot(l.videoFrameRate,"config.videoFrameRate"),tn(l.lowLatency)||sa(l.lowLatency,"config.lowLatency"),tn(l.audioSampleRate)||Pn(l.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),tn(l.audioBitrate)||Ot(l.audioBitrate,"config.audioBitrate",1,128),tn(l.audioChannels)||Pn(l.audioChannels,"config.audioChannels",[1,2,3,4,5]),tn(l.videoGop)||Ot(l.videoGop,"config.videoGop"),tn(l.videoCodecProfile)||Pn(l.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),tn(l.userCount)||Ot(l.userCount,"config.userCount",0,17),tn(l.backgroundColor)||Ot(l.backgroundColor,"config.backgroundColor",0,16777215),tn(l.userConfigExtraInfo)||fi(l.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),l.transcodingUsers&&!tn(l.transcodingUsers)&&(oa(l.transcodingUsers,"config.transcodingUsers"),l.transcodingUsers.forEach((u,h)=>{ay(u.uid),tn(u.x)||Ot(u.x,"transcodingUser[".concat(h,"].x"),0,1e4),tn(u.y)||Ot(u.y,"transcodingUser[".concat(h,"].y"),0,1e4),tn(u.width)||Ot(u.width,"transcodingUser[".concat(h,"].width"),0,1e4),tn(u.height)||Ot(u.height,"transcodingUser[".concat(h,"].height"),0,1e4),tn(u.zOrder)||Ot(u.zOrder-1,"transcodingUser[".concat(h,"].zOrder"),0,100),tn(u.alpha)||Ot(u.alpha,"transcodingUser[".concat(h,"].alpha"),0,1,!1)})),tn(l.watermark)||ly(l.watermark,"watermark"),tn(l.backgroundImage)||ly(l.backgroundImage,"backgroundImage"),l.images&&!tn(l.images)&&(oa(l.images,"config.images"),l.images.forEach((u,h)=>{ly(u,"images[".concat(h,"]"))}))}(t);const i=[];t.images&&i.push(...t.images.map(l=>Xi(Xi(Xi({},cy),l),{},{zOrder:255}))),t.backgroundImage&&(i.push(Xi(Xi(Xi({},cy),t.backgroundImage),{},{zOrder:0})),delete t.backgroundImage),t.watermark&&(i.push(Xi(Xi(Xi({},cy),t.watermark),{},{zOrder:255})),delete t.watermark),t.images=i,t.transcodingUsers&&(t.userConfigs=t.transcodingUsers.map(l=>Xi({},l)),t.userCount=t.transcodingUsers.length,delete t.transcodingUsers);const o=(t.userConfigs||[]).map(l=>typeof l.uid=="number"?X.resolve(l.uid):sD(l.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await X.all(o)).forEach((l,u)=>{t.userConfigs&&t.userConfigs[u]&&(t.userConfigs[u].uid=l)}),this.transcodingConfig=t,this.connection)try{var a;const l=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(no(a=this.streamingTasks).call(a)).map(u=>u.taskId).join("#")});y.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(l.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(l){if(!l.data||!l.data.retry)throw l;l.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(u=>{y.warning("[".concat(this.spec.clientId,"] live streaming receive error"),l.toString(),"try to republish",u.url),this.startLiveStreamingTask(u.url,u.mode,l).then(()=>{y.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(u.url," success"))}).catch(h=>{y.error("[".concat(this.spec.clientId,"] live streaming republish failed"),u.url,h.toString()),this.onLiveStreamError&&this.onLiveStreamError(u.url,h)})})}}setInjectStreamConfig(e,t){this.injectConfig=Object.assign({},this.injectConfig,e),this.injectLoopTimes=t}async startLiveStreamingTask(e,t,i){var o;if(Array.from(no(o=this.streamingTasks).call(o)).find(h=>h.mode===kn.INJECT)&&t===kn.INJECT)return new W(N.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&t===kn.TRANSCODE)throw new W(N.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let a={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};y.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(t));const l=await this.taskMutex.lock();if(!this.connection&&i)return void l();if(this.streamingTasks.get(e)&&!i)return l(),new W(N.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(t))}catch(h){throw l(),h}switch(t){case kn.TRANSCODE:a.transcodingConfig=Xi({},this.transcodingConfig);break;case kn.RAW:break;case kn.INJECT:a={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:Date.now(),url:e,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(a.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const u=this.lastTaskId++;try{const h=new X((m,E)=>{Xn(this.retryTimeout).then(()=>{if(i)return E(i);const v=this.statusError.get(e);return v?(this.statusError.delete(e),E(v)):void 0})}),f=await X.race([this.connection.request("request",{clientRequest:a},!0,{url:e,command:"PublishStream",workerType:t===kn.TRANSCODE?1:2,requestByUser:!i,tid:u.toString()}),h]);this.isStartingStreamingTask=!1,y.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(f.code)),this.streamingTasks.set(e,{clientRequest:a,mode:t,url:e,taskId:u}),l()}catch(h){if(l(),this.isStartingStreamingTask=!1,!h.data||!h.data.retry||i)throw h;return h.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,t,h)):await this.startLiveStreamingTask(e,t,h)}}stopLiveStreamingTask(e){return new X((t,i)=>{const o=this.streamingTasks.get(e);if(!o||!this.connection)return new W(N.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const a=o.mode;o.abortTask=()=>{y.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),t()},this.connection.request("request",{clientRequest:{command:a===kn.INJECT?"UninjectStream":"UnpublishStream",url:o.url}},!1,{url:e,command:"UnPublishStream",workerType:a===kn.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(l=>{y.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(l.code)),this.streamingTasks.delete(e),this.streamingTasks.size===0&&a!==kn.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),t(),a===kn.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(ac.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,e)}).catch(i)})}async controlInjectStream(e,t,i,o){const a=this.streamingTasks.get(e);if(!a||!this.connection||a.mode!==kn.INJECT)throw new W(N.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:e,control:t,audioVolume:i,position:o}})).serverResponse}resetAllTask(){var e;const t=Array.from(no(e=this.streamingTasks).call(e));this.terminate();for(const i of t)this.startLiveStreamingTask(i.url,i.mode).catch(o=>{this.onLiveStreamError&&this.onLiveStreamError(i.url,o)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=rr.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new W(N.UNEXPECTED_ERROR,"live streaming connection has already connected");const t=await Sn(this,Kd.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=t,this.connection=new eq(t.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(ws.WARNING,(i,o)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(o,i)),this.connection.on(ws.PUBLISH_STREAM_STATUS,i=>this.handlePublishStreamServer(i)),this.connection.on(ws.INJECT_STREAM_STATUS,i=>this.handleInjectStreamServerStatus(i)),this.connection.on(ws.REQUEST_NEW_ADDRESS,(i,o)=>{if(!this.connection)return o(new W(N.UNEXPECTED_ERROR,"can not get new live streaming address list"));Sn(this,Kd.REQUEST_WORKER_MANAGER_LIST,e).then(a=>{this.uapResponse=a,i(a.addressList)}).catch(o)}),await this.connection.init(t.addressList),this.connection}handlePublishStreamServer(e){const t=e.serverStatus&&e.serverStatus.url||"empty_url",i=this.streamingTasks.get(t),o=e.reason;switch(e.code){case fn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case fn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case fn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case fn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const l=new W(N.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(i)return y.error(l.toString()),this.onLiveStreamError&&this.onLiveStreamError(t,l);if(!this.isStartingStreamingTask)return;this.statusError.set(t,l)}case fn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const l=new W(N.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,o);return this.onLiveStreamWarning&&this.onLiveStreamWarning(t,l)}case fn.LIVE_STREAM_RESPONSE_WORKER_LOST:case fn.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var a;if(!this.connection)return;this.connection.tryNextAddress();const l=Array.from(no(a=this.streamingTasks).call(a));for(const u of l)u.abortTask?u.abortTask():(y.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",u.url),this.startLiveStreamingTask(u.url,u.mode,new W(N.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then(()=>{y.debug("[".concat(this.spec.clientId,"] republish live stream success"),u.url)}).catch(h=>{y.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(u.url,h)}));return}}}handleInjectStreamServerStatus(e){const t=Number(e.uid),i=e.serverStatus&&e.serverStatus.url;switch(e.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(ac.INJECT_STREAM_STATUS_START_SUCCESS,t,i));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(ac.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,t,i),void this.streamingTasks.delete(i);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(ac.INJECT_STREAM_STATUS_START_UNAUTHORIZED,t,i),void this.streamingTasks.delete(i);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(ac.INJECT_STREAM_STATUS_BROKEN,t,i),void this.streamingTasks.delete(i);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(ac.INJECT_STREAM_STATUS_START_TIMEOUT,t,i),void this.streamingTasks.delete(i);default:return void y.debug("inject stream server status",e)}}hasUrl(e){return this.streamingTasks.has(e)}}class uE{constructor(){S(this,"destChannelMediaInfos",new Map),S(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){w1(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){w1(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){oy(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function cM(n){if(!(n instanceof uE))return new W(N.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const e=n.getSrcChannelMediaInfo(),t=n.getDestChannelMediaInfo();if(!e)return new W(N.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(t.size===0)return new W(N.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class nq extends zt{constructor(e,t,i){super(),S(this,"ws",void 0),S(this,"requestId",1),S(this,"heartBeatTimer",void 0),S(this,"joinInfo",void 0),S(this,"clientId",void 0),S(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),S(this,"onClose",o=>{this.emit("close"),this.dispose()}),S(this,"onMessage",o=>{const a=JSON.parse(o.data);if(!a||a.command!=="serverResponse"||!a.requestId)return a&&a.command==="serverStatus"&&a.serverStatus&&a.serverStatus.command?(this.emit("status",a.serverStatus),void this.emit(a.serverStatus.command,a.serverStatus)):void 0;this.emit("req_".concat(a.requestId),a)}),this.joinInfo=e,this.clientId=t,this.ws=new tp("cross-channel-".concat(this.clientId),i),this.ws.on(je.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(je.CONNECTED,this.onOpen),this.ws.on(je.ON_MESSAGE,this.onMessage),this.ws.on(je.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(e){const t=this.requestId++;return e.requestId=t,e.seq=t,this.ws.sendMessage(e),t}waitStatus(e){return new X((t,i)=>{const o=window.setTimeout(()=>{i(new W(N.TIMEOUT,"wait status timeout, status: ".concat(e)))},5e3);this.once(e,a=>{window.clearTimeout(o),a.state&&a.state!==0?i(new W(N.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):t(void 0)}),this.once("dispose",()=>{window.clearTimeout(o),i(new W(N.WS_ABORT))})})}async request(e){if(this.ws.state==="closed")throw new W(N.WS_DISCONNECT);const t=()=>new X((l,u)=>{this.ws.once(je.CLOSED,()=>u(new W(N.WS_ABORT))),this.ws.once(je.CONNECTED,l)});this.ws.state!=="connected"&&await t();const i=this.sendMessage(e),o=new X((l,u)=>{const h=()=>{u(new W(N.WS_ABORT))};this.ws.once(je.RECONNECTING,h),this.ws.once(je.CLOSED,h),this.once("req_".concat(i),l),Xn(3e3).then(()=>{this.removeAllListeners("req_".concat(i)),this.ws.off(je.RECONNECTING,h),this.ws.off(je.CLOSED,h),u(new W(N.TIMEOUT,"cross channel ws request timeout"))})}),a=await o;if(!a||a.code!==200)throw new W(N.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(a)));return a}async connect(e){this.ws.removeAllListeners(je.REQUEST_NEW_URLS),this.ws.on(je.REQUEST_NEW_URLS,t=>{t(e)}),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){const t=this.requestId++;return e.requestId=t,this.ws.sendMessage(e),t}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class iq extends zt{set state(e){e!==this._state&&(e!==Hi.RELAY_STATE_FAILURE&&(this.errorCode=cc.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,t,i,o,a){super(),S(this,"joinInfo",void 0),S(this,"sid",void 0),S(this,"clientId",void 0),S(this,"cancelToken",rr.CancelToken.source()),S(this,"workerToken",void 0),S(this,"requestId",0),S(this,"signal",void 0),S(this,"prevChannelMediaConfig",void 0),S(this,"httpRetryConfig",void 0),S(this,"_resolution",void 0),S(this,"_state",Hi.RELAY_STATE_IDLE),S(this,"errorCode",cc.RELAY_OK),S(this,"onStatus",l=>{y.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(l))),l&&l.command&&(l.command==="onAudioPacketReceived"&&this.emit("event",io.PACKET_RECEIVED_AUDIO_FROM_SRC),l.command==="onVideoPacketReceived"&&this.emit("event",io.PACKET_RECEIVED_VIDEO_FROM_SRC),l.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=cc.SRC_TOKEN_EXPIRED,this.state=Hi.RELAY_STATE_FAILURE),l.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=cc.DEST_TOKEN_EXPIRED,this.state=Hi.RELAY_STATE_FAILURE))}),S(this,"onReconnect",async()=>{y.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",io.NETWORK_DISCONNECTED),this.state=Hi.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(l=>{this.state!==Hi.RELAY_STATE_IDLE&&(y.error("auto restart channel media relay failed",l.toString()),this.errorCode=cc.SERVER_CONNECTION_LOST,this.state=Hi.RELAY_STATE_FAILURE)})}),this.joinInfo=e,this.clientId=t,this.sid=LT(),this.signal=new nq(this.joinInfo,this.clientId,i),this.httpRetryConfig=o,this._resolution=a}async startChannelMediaRelay(e){if(this.state!==Hi.RELAY_STATE_IDLE)throw new W(N.INVALID_OPERATION);this.state=Hi.RELAY_STATE_CONNECTING,await this.connect(),y.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(t){throw t.data&&t.data.serverResponse&&t.data.serverResponse.command==="SetSourceChannel"?new W(N.CROSS_CHANNEL_FAILED_JOIN_SRC):t.data&&t.data.serverResponse&&t.serverResponse.command==="SetDestChannelStatus"?new W(N.CROSS_CHANNEL_FAILED_JOIN_DEST):t.data&&t.data.serverResponse&&t.serverResponse.command==="StartPacketTransfer"?new W(N.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):t}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==Hi.RELAY_STATE_RUNNING)throw new W(N.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==Hi.RELAY_STATE_RUNNING)throw new W(N.INVALID_OPERATION);const t=this.genMessage(wi.SetVideoProfile);await this.signal.request(t),y.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),y.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Hi.RELAY_STATE_IDLE,this.dispose()}dispose(){y.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=rr.CancelToken.source(),this.state=Hi.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const e=await bz(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",io.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){const t=this.genMessage(wi.StopPacketTransfer);await this.signal.request(t),await this.signal.waitStatus("Normal Quit"),y.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const i=this.genMessage(wi.SetSdkProfile,e);await this.signal.request(i),y.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const o=this.genMessage(wi.SetSourceChannel,e);await this.signal.request(o),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",io.PACKET_JOINED_SRC_CHANNEL),y.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const a=this.genMessage(wi.SetSourceUserId,e);await this.signal.request(a),y.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const l=this.genMessage(wi.SetDestChannel,e);await this.signal.request(l),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",io.PACKET_JOINED_DEST_CHANNEL),y.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const u=this.genMessage(wi.StartPacketTransfer,e);await this.signal.request(u),this.emit("event",io.PACKET_SENT_TO_DEST_CHANNEL),this.state=Hi.RELAY_STATE_RUNNING,y.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){const t=this.genMessage(wi.UpdateDestChannel,e);await this.signal.request(t),this.emit("event",io.PACKET_UPDATE_DEST_CHANNEL),y.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const e=this.genMessage(wi.StopPacketTransfer);await this.signal.request(e),y.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,t){const i=[],o=[],a=[];this.requestId+=1;const l={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:es,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};l.sdkVersion==="4.20.2"&&(l.sdkVersion="0.0.1");let u=null,h=null;switch(e){case wi.SetSdkProfile:return l.clientRequest={command:"SetSdkProfile",type:"multi_channel"},l;case wi.SetSourceChannel:if(h=t&&t.getSrcChannelMediaInfo(),!h)throw new W(N.UNEXPECTED_ERROR,"can not find source config");return l.clientRequest={command:"SetSourceChannel",uid:"0",channelName:h.channelName,token:h.token||this.joinInfo.appId},l;case wi.SetSourceUserId:if(h=t&&t.getSrcChannelMediaInfo(),!h)throw new W(N.UNEXPECTED_ERROR,"can not find source config");return l.clientRequest={command:"SetSourceUserId",uid:h.uid+""},l;case wi.SetDestChannel:if(u=t&&t.getDestChannelMediaInfo(),!u)throw new W(N.UNEXPECTED_ERROR,"can not find dest config");return u.forEach(f=>{i.push(f.channelName),o.push(f.uid+""),a.push(f.token||this.joinInfo.appId)}),l.clientRequest={command:"SetDestChannel",channelName:i,uid:o,token:a},l;case wi.StartPacketTransfer:return l.clientRequest={command:"StartPacketTransfer"},l;case wi.Reconnect:return l.clientRequest={command:"Reconnect"},l;case wi.StopPacketTransfer:return l.clientRequest={command:"StopPacketTransfer"},l;case wi.UpdateDestChannel:if(u=t&&t.getDestChannelMediaInfo(),!u)throw new W(N.UNEXPECTED_ERROR,"can not find dest config");return u.forEach(f=>{i.push(f.channelName),o.push(f.uid+""),a.push(f.token||this.joinInfo.appId)}),l.clientRequest={command:"UpdateDestChannel",channelName:i,uid:o,token:a},l;case wi.SetVideoProfile:l.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return l}}function hE(n){var e={},t=!1;function i(o,a){return t=!0,{done:!1,value:new B0(a=new G0(function(l){l(n[o](a))}),1)}}return e[bd!==void 0&&BO||"@@iterator"]=function(){return this},e.next=function(o){return t?(t=!1,o):i("next",o)},typeof n.throw=="function"&&(e.throw=function(o){if(t)throw t=!1,o;return i("throw",o)}),typeof n.return=="function"&&(e.return=function(o){return t?(t=!1,o):i("return",o)}),e}var lM=p(kL);function dM(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}function uM(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?dM(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):dM(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function hM(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}function pM(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?hM(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):hM(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}class ei extends g_{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var t;return Ie(t=Object.keys(sc)).call(t,e)}))]}constructor(e,t){super(e,t),S(this,"store",void 0),S(this,"peerConnection",void 0),S(this,"remoteSDP",void 0),S(this,"initialOffer",void 0),S(this,"statsFilter",void 0),S(this,"useRTX",!1),S(this,"localCapabilities",void 0),S(this,"localCandidateCount",0),S(this,"allCandidatesReceived",!1),S(this,"establishPromise",void 0),S(this,"mutex",new Qn("P2PConnection-mutex")),this.store=t,this.peerConnection=new RTCPeerConnection(ei.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.statsFilter=aE(this.peerConnection,V("STATS_UPDATE_INTERVAL"),void 0,Pt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const t=ao(e.sdp),i=Pp(e.sdp,{filterRTX:!this.useRTX,filterVideoFec:V("FILTER_VIDEO_FEC"),filterAudioFec:V("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=i,this.initialOffer=e,pM(pM({},t),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:i},offerSDP:e.sdp})}catch(e){throw new ne(N.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e,t,i,o,a,l){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{constructor(h){S(this,"sessionDesc",void 0),S(this,"localCapabilities",void 0),S(this,"rtpCapabilities",void 0),S(this,"candidates",void 0),S(this,"iceParameters",void 0),S(this,"dtlsParameters",void 0),S(this,"setup",void 0),S(this,"currentMidIndex",void 0),S(this,"cname",void 0),h=xt(h);const{remoteIceParameters:f,remoteDtlsParameters:m,candidates:E,remoteRTPCapabilities:v,remoteSetup:T,localCapabilities:A,sdkCodec:C,cname:b}=h,D=Yt.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=v,this.candidates=E,this.iceParameters=f,this.dtlsParameters=m,this.setup=T,this.localCapabilities=A,this.cname=b;for(let M=0;M<D.mediaDescriptions.length;M++){const B=D.mediaDescriptions[M];if(B.attributes.iceUfrag=f.iceUfrag,B.attributes.icePwd=f.icePwd,B.attributes.fingerprints=m.fingerprints,B.attributes.candidates=E,B.attributes.setup=T,B.media.mediaType==="video"){B.media.fmts=v.videoCodecs.map(G=>G.payloadType.toString(10));let J=v.videoCodecs.filter(G=>{var q,Q;return(q=G.rtpMap)===null||q===void 0?void 0:Ie(Q=q.encodingName.toLowerCase()).call(Q,C)});J.length===0&&(J=v.videoCodecs),B.attributes.payloads=J,B.attributes.extmaps=v.videoExtensions}B.media.mediaType==="audio"&&(B.media.fmts=v.audioCodecs.map(J=>J.payloadType.toString(10)),B.attributes.payloads=v.audioCodecs,B.attributes.extmaps=v.audioExtensions),D.mediaDescriptions[M]=this.mungMediaDesc(B)}this.sessionDesc=D,this.currentMidIndex=D.mediaDescriptions.length-1}toString(){return Yt.print(this.sessionDesc)}send(h,f,m){const{ssrcs:E,ssrcGroups:v}=cr(f,this.cname),T=this.sessionDesc.mediaDescriptions.find(b=>h===be.VIDEO?b.media.mediaType==="video":b.media.mediaType==="audio"),A=E[0].attributes.label,C=E[0].attributes.mslabel;return T.attributes.ssrcs=T.attributes.ssrcs.concat(E),T.attributes.ssrcGroups=T.attributes.ssrcGroups.concat(v),{id:A,mslabel:C}}batchSend(h){return h.map(f=>{let{kind:m,ssrcMsg:E}=f;return this.send(m,E,void 0)})}stopSending(h){this.sessionDesc.mediaDescriptions.forEach(f=>{const m=[],E=[],v=[];f.attributes.ssrcs.forEach(T=>{Ie(h).call(h,T.attributes.label||"")?v.push(T):m.push(T)}),f.attributes.ssrcGroups.forEach(T=>{var A;Ie(A=v.map(C=>C.ssrcId)).call(A,T.ssrcIds[0])||E.push(T)}),f.attributes.ssrcs=m,f.attributes.ssrcGroups=E})}mute(h){const f=this.sessionDesc.mediaDescriptions.find(m=>m.attributes.mid===h);if(!f)throw new Error("mediaDescription not found with ".concat(h," in remote SDP when calling RemoteSDP.mute."));f.attributes.direction="inactive"}unmute(h){const f=this.sessionDesc.mediaDescriptions.find(m=>m.attributes.mid===h);if(!f)throw new Error("mediaDescription not found with ".concat(h," in remote SDP when calling RemoteSDP.unmute."));f.attributes.direction="sendonly"}receive(h,f,m){h.forEach((E,v)=>{const T=E._mediaStreamTrack,A=this.sessionDesc.mediaDescriptions.findIndex(b=>b.attributes.mid===T.kind),C=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[A],E);this.sessionDesc.mediaDescriptions[A]=C})}stopReceiving(h){}updateCandidates(h){h===mi.TCP?this.candidates.forEach(f=>{this.candidates.findIndex(m=>m.transport==="tcp"&&m.connectionAddress===f.connectionAddress&&m.port===f.port)===-1&&this.candidates.push(uM(uM({},f),{},{foundation:"tcpcandidate",priority:Number(f.priority)-1+"",transport:"tcp",port:Number(f.port)+90+""}))}):this.candidates=this.candidates.filter(f=>f.transport!=="tcp");for(const f of this.sessionDesc.mediaDescriptions)f.attributes.candidates=this.candidates}restartICE(h){h=xt(h),this.iceParameters=h,this.sessionDesc.mediaDescriptions.forEach(f=>{f.attributes.iceUfrag=h.iceUfrag,f.attributes.icePwd=h.icePwd})}predictReceivingMids(h){const f=[];for(let m=0;m<h;m++)f.push((this.currentMidIndex+m+1).toString(10));return f}mungRecvMediaDsec(h,f){const m=xt(h);return Ic(m,f),lE(m,f),m}updateRecvMedia(h,f){const m=this.sessionDesc.mediaDescriptions.findIndex(E=>E.attributes.mid===h);if(m!==-1){const E=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],f);this.sessionDesc.mediaDescriptions[m]=E}}bumpMid(h){this.currentMidIndex+=h}updateTrackLabel(h,f,m){const E=this.sessionDesc.mediaDescriptions.find(T=>h===be.VIDEO?T.attributes.mid==="video":T.attributes.mid==="audio");if(E){const T=E.attributes.ssrcs.find(A=>A.attributes.label===f);var v;T&&(T.attributes.label=m,(v=T.attributes.msid)===null||v===void 0||v.replace(f,m))}}mungMediaDesc(h){const f=xt(h);return cE(f),function(m){const E=m.attributes.extmaps.find(v=>v.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");E&&m.attributes.extmaps.splice(m.attributes.extmaps.indexOf(E),1),m.attributes.payloads.forEach(v=>{const T=v.rtcpFeedbacks.findIndex(A=>A.type==="transport-cc");T!==-1&&v.rtcpFeedbacks.splice(T,1)})}(f),f}getSSRC(h){for(const f of this.sessionDesc.mediaDescriptions)for(const m of f.attributes.ssrcs)if(m.attributes.label===h)return[m]}}({remoteIceParameters:e,remoteDtlsParameters:t,candidates:i,remoteRTPCapabilities:o.send,remoteSetup:a,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec,cname:l});const u=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(u){throw new ne(N.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(u.toString()))}}async updateRemoteRTPCapabilities(e,t){throw new ne(N.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}send(e,t){var i=this;return Tr(function*(){const o=yield Qe(i.mutex.lock());try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const a=e.map(v=>i.peerConnection.addTrack(v._mediaStreamTrack)),l=yield Qe(i.peerConnection.createOffer()),u=Yt.parse(l.sdp),h=e.map(v=>{const T=v._mediaStreamTrack,A=u.mediaDescriptions.find(C=>C.attributes.mid===T.kind);if(!A)throw new Error("Cannot extract ssrc from mediaDescription.");return function(C,b,D){const M=C.attributes.ssrcs.filter(J=>J.attributes.label===b),B=C.attributes.ssrcGroups;if(M.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(B&&M.length>1){const J=B.find(G=>G.ssrcIds.indexOf(M[0].ssrcId)!==-1);return J?[{ssrcId:J.ssrcIds[0],rtx:D?J.ssrcIds[1]:void 0}]:[{ssrcId:M[0].ssrcId}]}return[{ssrcId:M[0].ssrcId}]}(A,T.id,i.useRTX)});let f;try{f=yield h}catch(v){throw a.forEach(T=>{ii()&&T.replaceTrack(null),i.peerConnection.removeTrack(T)}),v}const m=i.mungSendOfferSDP(l.sdp,e);i.remoteSDP.receive(e,t,f);const E=i.remoteSDP.toString();return yield Qe(i.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield Qe(i.applySendEncodings(a,e)),yield Qe(i.peerConnection.setRemoteDescription({type:"answer",sdp:E})),e.map((v,T)=>{const A=v._mediaStreamTrack.id;return{localSSRC:h[T],id:A}})}catch(a){throw new ne(N.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(a.toString()))}finally{o()}})()}async stopSending(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const t=this.peerConnection.getSenders().filter(a=>{var l;return e.indexOf(((l=a.track)===null||l===void 0?void 0:l.id)||"")!==-1});if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");t.map(a=>{ii()&&a.replaceTrack(null),this.peerConnection.removeTrack(a)});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i),this.remoteSDP.stopReceiving(e);const o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(t){throw new ne(N.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(t.toString()))}}async receive(e,t,i,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{id:a,mslabel:l}=this.remoteSDP.send(e,t,o),u=new X((m,E)=>{const v=setTimeout(()=>{E(new Error("Cannot receive track, id: ".concat(a)))},1e4),T=A=>{const C=ft();if((C.name==="Safari"&&Number(C.version)===11||xi())&&A.track.id!==a&&A.streams[0].id===l){var b;const D=A.streams[0].getTracks()[0];return(b=this.remoteSDP)===null||b===void 0||b.updateTrackLabel(e,a,A.track.id),this.peerConnection.removeEventListener("track",T),clearTimeout(v),void m(D)}if(A.track.id===a)return this.peerConnection.removeEventListener("track",T),clearTimeout(v),void m(A.track)};this.peerConnection.addEventListener("track",T)}),h=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:h});const f=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(f),{track:await u,id:a}}catch(a){throw new ne(N.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const i=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(i)}catch(t){throw new ne(N.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(t.toString()))}}async muteRemote(e){}async unmuteRemote(e){}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getSenders().filter(i=>{var o;return e.indexOf(((o=i.track)===null||o===void 0?void 0:o.id)||"")!==-1});if(t.length!==e.length)throw new Error("sender' length doesn't match mids' length.");t.map(i=>{if(ii()&&i.track)i.track.enabled=!1;else{const o=i.getParameters();o.encodings.forEach(a=>a.active=!1),i.setParameters(o)}})}catch(t){throw new ne(N.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(t.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getSenders().filter(a=>{var l;return e.indexOf(((l=a.track)===null||l===void 0?void 0:l.id)||"")!==-1});if(t.length!==e.length)throw new Error("Senders' length doesn't match mids' length.");t.map(async a=>{if(ii()&&a.track)a.track.enabled=!0;else{const l=a.getParameters();l.encodings.forEach(u=>u.active=!0),await a.setParameters(l)}});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i);const o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(t){throw new ne(N.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(t.toString()))}}restartICE(e){var t=this;return Tr(function*(){const i=yield Qe(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(mt().supportPCSetConfiguration){const h=t.peerConnection.getConfiguration(),f=e===mi.RELAY?"relay":"all";h.iceTransportPolicy!==f&&(y.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(h.iceTransportPolicy,"] to [").concat(f,"]")),h.iceTransportPolicy=f,t.peerConnection.setConfiguration(h))}else if(e===mi.RELAY)return;e!==mi.RELAY&&t.remoteSDP.updateCandidates(e);const o=yield Qe(t.peerConnection.createOffer({iceRestart:!0}));if(!o.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const a=ao(o.sdp),{remoteIceParameters:l}=yield a.iceParameters;t.remoteSDP.restartICE(l);const u=t.remoteSDP.toString();yield Qe(t.peerConnection.setLocalDescription(o)),yield Qe(t.peerConnection.setRemoteDescription({type:"answer",sdp:u}))}catch(o){y.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),o)}finally{i()}})()}close(){var e;this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(i.sdp,[t]);this.remoteSDP.updateRecvMedia(t._mediaStreamTrack.kind,t);const a=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new ne(N.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,t){const i=this.peerConnection.getSenders().filter(o=>{var a;return((a=o.track)===null||a===void 0?void 0:a.id)===e});i.length===1&&await this.applySendEncodings(i,[t])}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const i=this.peerConnection.getSenders().find(o=>{var a;return((a=o.track)===null||a===void 0?void 0:a.id)===t});i&&await i.replaceTrack(e._mediaStreamTrack)}createDataChannels(e,t){throw new ne(N.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(e){throw new ne(N.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,y.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,y.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},V("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const t={iceServers:[],sdpSemantics:"plan-b"};return e.iceServers?t.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(xd(e.turnServer.servers)?t.iceServers=e.turnServer.servers:(t.iceServers&&t.iceServers.push(...ei.turnServerConfigToIceServers(e.turnServer.servers)),V("USE_TURN_SERVER_OF_GATEWAY")&&t.iceServers&&e.turnServer.serversFromGateway&&t.iceServers.push(...ei.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(t.iceTransportPolicy="relay")}))),t}static turnServerConfigToIceServers(e){const t=[];return e.forEach(i=>{i.security?i.tcpport&&t.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&t.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&t.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),t}async updateRtpSenderEncodings(e,t){var i;if(t||(t=this.peerConnection.getSenders().find(f=>{var m;return((m=f.track)===null||m===void 0?void 0:m.id)===e._mediaStreamTrack.id})),!t)return y.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(!mt().supportSetRtpSenderParameters)return y.warn("Browser not support set rtp-sender parameters");const o={},a={};if(e instanceof et)switch(e._optimizationMode){case"motion":o.degradationPreference="maintain-framerate";break;case"detail":o.degradationPreference="maintain-resolution";break;default:o.degradationPreference="balanced"}if(V("DSCP_TYPE")&&nc()){var l;const f=V("DSCP_TYPE");Ie(l=["very-low","low","medium","high"]).call(l,f)&&(a.networkPriority=f)}const u=t.getParameters(),h=(i=u.encodings)===null||i===void 0?void 0:i[0];h&&Object.assign(h,a),Object.assign(u,o),y.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(u.encodings))),await t.setParameters(u)}async applySendEncodings(e,t){try{if(!mt().supportSetRtpSenderParameters||e.length!==t.length)return;for(let i=0;i<e.length;i++){const o=e[i],a=t[i];o&&a&&await this.updateRtpSenderEncodings(a,o)}}catch{y.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t){const i=Yt.parse(e);return t.forEach((o,a)=>{const l=o._mediaStreamTrack,u=i.mediaDescriptions.find(h=>h.attributes.mid===l.kind);u&&Ic(u,o)}),Yt.print(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;(t=this.onFirstAudioReceived)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;(t=this.onFirstVideoReceived)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;(t=this.onFirstAudioDecoded)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,i)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,e,t,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const t=this.remoteSDP.batchSend(e).map((a,l)=>{let{id:u,mslabel:h}=a;const{kind:f}=e[l];return new X((m,E)=>{const v=setTimeout(()=>{E(new Error("Cannot receive track, id: ".concat(u)))},1e4),T=A=>{const C=ft();if(C.name==="Safari"&&Number(C.version)===11&&A.track.id!==u&&A.streams[0].id===h){var b;const D=A.streams[0].getTracks()[0];return(b=this.remoteSDP)===null||b===void 0||b.updateTrackLabel(f,u,A.track.id),this.peerConnection.removeEventListener("track",T),clearTimeout(v),void m({track:D,id:u})}if(A.track.id===u)return this.peerConnection.removeEventListener("track",T),clearTimeout(v),void m({track:A.track,id:u})};this.peerConnection.addEventListener("track",T)})}),i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const o=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(o),await X.all(t)}catch(t){throw new ne(N.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(t.toString()))}}async getRemoteSSRC(e){if(!this.remoteSDP)return;const t=this.remoteSDP.getSSRC(e);return t==null?void 0:t[0].ssrcId}setConfiguration(e){if(mt().supportPCSetConfiguration){const t=ei.resolvePCConfiguration(e);this.peerConnection.setConfiguration(t)}}}function cs(n,e,t){const i=n[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return t.value=async function(){const o=this.mutex,a=await o.lock("Locking from P2PConnection.".concat(e));try{for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return await i.apply(this,u)}finally{a()}},t}function fM(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}function Ac(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?fM(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):fM(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}ie([cs,O("design:type",Function),O("design:paramtypes",[Object,Object,Array,Object,String,String]),O("design:returntype",X)],ei.prototype,"connect",null),ie([cs,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",X)],ei.prototype,"stopSending",null),ie([cs,O("design:type",Function),O("design:paramtypes",[String,Array,String,Object]),O("design:returntype",X)],ei.prototype,"receive",null),ie([cs,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",X)],ei.prototype,"stopReceiving",null),ie([cs,O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",X)],ei.prototype,"muteRemote",null),ie([cs,O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",X)],ei.prototype,"unmuteRemote",null),ie([cs,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",X)],ei.prototype,"muteLocal",null),ie([cs,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",X)],ei.prototype,"unmuteLocal",null),ie([cs,O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],ei.prototype,"close",null),ie([cs,O("design:type",Function),O("design:paramtypes",[String,_i]),O("design:returntype",X)],ei.prototype,"updateEncoderConfig",null),ie([cs,O("design:type",Function),O("design:paramtypes",[String,_i]),O("design:returntype",X)],ei.prototype,"updateSendParameters",null),ie([cs,O("design:type",Function),O("design:paramtypes",[_i,String]),O("design:returntype",X)],ei.prototype,"replaceTrack",null),ie([cs,O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",X)],ei.prototype,"getRemoteSSRC",null);const xp="9",mM=4e4;function _M(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}function Eu(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?_M(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):_M(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}class cn extends g_{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t;return(e=(t=this.peerConnection.getReceivers()[0])===null||t===void 0||(t=t.transport)===null||t===void 0?void 0:t.state)!==null&&e!==void 0?e:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var t;return Ie(t=Object.keys(sc)).call(t,e)}))]}constructor(e,t){super(e,t),S(this,"store",void 0),S(this,"peerConnection",void 0),S(this,"remoteSDP",void 0),S(this,"initialOffer",void 0),S(this,"transportEventReceiver",void 0),S(this,"statsFilter",void 0),S(this,"useXR",V("USE_XR")),S(this,"localCapabilities",void 0),S(this,"remoteCodecs",void 0),S(this,"localCandidateCount",0),S(this,"allCandidatesReceived",!1),S(this,"dataStreamChannelMap",new Map),S(this,"establishPromise",void 0),S(this,"recoveredDataChannelIds",[]),S(this,"currentDataChannelId",1),S(this,"mutex",new Qn("P2PConnection-mutex")),this.store=t,this.peerConnection=new RTCPeerConnection(cn.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.statsFilter=aE(this.peerConnection,V("STATS_UPDATE_INTERVAL"),void 0,Pt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async updateRemoteRTPCapabilities(e,t){if(this.remoteCodecs=t,!this.remoteSDP)return void y.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(t));if(this.remoteSDP.updateRemoteCodec(e,t,this.store.codec)){const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i);const a=this.remoteSDP.toString();o==null||o(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}else y.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const e=await this.peerConnection.createOffer();if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const t=ao(e.sdp),i=await X0({filterRTX:!V("USE_PUB_RTX")&&!V("USE_SUB_RTX"),filterVideoFec:V("FILTER_VIDEO_FEC"),filterAudioFec:V("FILTER_AUDIO_FEC"),filterVideoCodec:V("FILTER_VIDEO_CODEC")},{useXR:this.useXR});return this.localCapabilities=mu(i),this.initialOffer=e,Eu(Eu({},t),{},{rtpCapabilities:i,offerSDP:e.sdp})}catch(e){throw new ne(N.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e,t,i,o,a,l){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{get localCapabilities(){return xt(this._localCapabilities)}get rtpCapabilities(){return xt(this._rtpCapabilities)}get candidates(){return xt(this._candidates)}get iceParameters(){return xt(this._iceParameters)}get dtlsParameters(){return xt(this._dtlsParameters)}constructor(T){S(this,"sessionDesc",void 0),S(this,"_localCapabilities",void 0),S(this,"_rtpCapabilities",void 0),S(this,"_candidates",void 0),S(this,"_iceParameters",void 0),S(this,"_dtlsParameters",void 0),S(this,"setup",void 0),S(this,"currentMidIndex",void 0),S(this,"cname",void 0),S(this,"firefoxSsrcMidMap",new Map),T=xt(T);const{remoteIceParameters:A,remoteDtlsParameters:C,candidates:b,remoteRTPCapabilities:D,remoteSetup:M,localCapabilities:B,cname:J}=T,G=Yt.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=D,this._candidates=b,this._iceParameters=A,this._dtlsParameters=C,this._localCapabilities=B,this.setup=M,this.cname=J;const q=this.rtpCapabilities.send;for(const Q of G.mediaDescriptions){if(Q.attributes.iceUfrag=A.iceUfrag,Q.attributes.icePwd=A.icePwd,Q.attributes.fingerprints=C.fingerprints,Q.attributes.candidates=b,Q.attributes.setup=M,Q.media.mediaType==="video"&&(Q.media.fmts=q.videoCodecs.map($=>$.payloadType.toString(10)),Q.attributes.payloads=q.videoCodecs,Q.attributes.extmaps=q.videoExtensions,V("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:$,ssrcGroups:ue}=cr([{ssrcId:mM,rtx:V("USE_SUB_RTX")?40001:void 0}],this.cname);Q.attributes.ssrcs=$,Q.attributes.ssrcGroups=ue}if(Q.media.mediaType==="audio"&&(Q.media.fmts=q.audioCodecs.map($=>$.payloadType.toString(10)),Q.attributes.payloads=q.audioCodecs,Q.attributes.extmaps=q.audioExtensions,co(Q),V("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:$,ssrcGroups:ue}=cr([{ssrcId:2e4}],this.cname);Q.attributes.ssrcs=$,Q.attributes.ssrcGroups=ue}}this.sessionDesc=G,this.currentMidIndex=G.mediaDescriptions.length-1}preloadRemoteMedia(){const T=V("PRELOAD_MEDIA_COUNT");this.rtpCapabilities;const A=this.candidates,C=this.dtlsParameters,b=this.iceParameters,D=this.rtpCapabilities.send;for(let M=1;M<T;M++){const B=2*M+2e4,J=2*M+mM,{ssrcs:G,ssrcGroups:q}=cr([{ssrcId:B}],this.cname),{ssrcs:Q,ssrcGroups:$}=cr([{ssrcId:J,rtx:V("USE_SUB_RTX")?J+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:xp,protos:["UDP","TLS","RTP","SAVPF"],fmts:D.videoCodecs.map(ue=>ue.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:b.iceUfrag,icePwd:b.icePwd,unrecognized:[],candidates:A,extmaps:D.videoExtensions,fingerprints:C.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:Q,ssrcGroups:$,rtcpFeedbackWildcards:[],payloads:D.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*M)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:xp,protos:["UDP","TLS","RTP","SAVPF"],fmts:D.audioCodecs.map(ue=>ue.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:b.iceUfrag,icePwd:b.icePwd,unrecognized:[],candidates:A,extmaps:D.audioExtensions,fingerprints:C.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:G,ssrcGroups:q,rtcpFeedbackWildcards:[],payloads:D.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*M+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Yt.print(this.sessionDesc)}send(T,A,C,b){const{ssrcs:D,ssrcGroups:M}=cr(A,this.cname,V("SYNC_GROUP")?C:void 0),B=this.findPreloadMediaDesc(D);if(B){if(Pt()&&this.firefoxSsrcMidMap.set(D[0].ssrcId,B.attributes.mid),b&&(b.twcc||b.remb)){const J=this.sessionDesc.mediaDescriptions.indexOf(B);return this.sessionDesc.mediaDescriptions[J]=this.mungSendMediaDesc(B,b),{mid:B.attributes.mid,needExchangeSDP:!0}}return{mid:B.attributes.mid,needExchangeSDP:!1}}{const J=this.findAvailableMediaIndex(T,D);let G;return J===-1||J===1&&(ii()||lP())||J===0&&V("USE_SUB_RTX")||dP()?(G=this.createOrRecycleSendMedia(T,D,M,"sendonly",b),this.updateBundleMids()):(G=xt(this.sessionDesc.mediaDescriptions[J]),G.attributes.direction="sendonly",G.attributes.ssrcs=D,G.attributes.ssrcGroups=M,this.sessionDesc.mediaDescriptions[J]=this.mungSendMediaDesc(G,b)),Pt()&&this.firefoxSsrcMidMap.set(D[0].ssrcId,G.attributes.mid),{mid:G.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:T,needExchangeSDP:A}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:T.attributes.mid,needExchangeSDP:A}}batchSend(T){const A=T.map(D=>{let{kind:M,ssrcMsg:B,mslabel:J}=D;return this.send(M,B,J)}),C=[];let b=!1;return A.forEach(D=>{let{mid:M,needExchangeSDP:B}=D;B&&(b=!0),C.push(M)}),{mids:C,needExchangeSDP:b}}stopSending(T){const A=this.sessionDesc.mediaDescriptions.filter(C=>C.attributes.mid&&T.indexOf(C.attributes.mid)!==-1);if(A.length!==T.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");A.forEach(C=>{C.attributes.mid==="0"||Pt()||dP()?C.attributes.ssrcs=[]:(C.attributes.ssrcs=[],C.attributes.direction="inactive",C.media.port="0")}),this.updateBundleMids()}mute(T){const A=this.sessionDesc.mediaDescriptions.find(C=>C.attributes.mid===T);if(!A)throw new Error("mediaDescription not found with ".concat(T," in remote SDP when calling RemoteSDP.mute."));A.attributes.direction="inactive"}unmute(T){const A=this.sessionDesc.mediaDescriptions.find(C=>C.attributes.mid===T);if(!A)throw new Error("mediaDescription not found with ".concat(T," in remote SDP when calling RemoteSDP.unmute."));A.attributes.direction="sendonly"}muteRemote(T){const A=this.sessionDesc.mediaDescriptions.filter(C=>Ie(T).call(T,C.attributes.mid||""));if(A.length!==T.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");A.forEach(C=>{C.attributes.direction="inactive"})}unmuteRemote(T){const A=this.sessionDesc.mediaDescriptions.filter(C=>Ie(T).call(T,C.attributes.mid||""));if(A.length!==T.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");A.forEach(C=>{C.attributes.direction="recvonly"})}receive(T,A,C,b){T.forEach((D,M)=>{this.createOrRecycleRecvMedia(D,[],"recvonly",A,C,b[M])}),this.updateBundleMids()}stopReceiving(T){const A=this.sessionDesc.mediaDescriptions.filter(C=>T.indexOf(C.attributes.mid)!==-1);if(A.length!==T.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");A.forEach(C=>{C.media.port="0",C.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(T){const A=this._candidates.filter(C=>C.transport==="udp");if(T===mi.TCP){if(A.length===0)return;if(V("TCP_CANDIDATE_ONLY")){const C=this._candidates.filter(b=>b.transport==="tcp");A.forEach(b=>{C.findIndex(D=>D.connectionAddress===b.connectionAddress)===-1&&C.push(Ac(Ac({},b),{},{foundation:"tcpcandidate",priority:Number(b.priority)-1+"",transport:"tcp",port:Number(b.port)+90+""}))}),this._candidates=C}else{const C=[];A.forEach(b=>{C.push(Ac(Ac({},b),{},{foundation:"tcpcandidate",priority:Number(b.priority)-1+"",transport:"tcp",port:Number(b.port)+90+""}))}),this._candidates=[...A,...C]}}else if(T===mi.RELAY){if(A.length!==0)return;{const C=this._candidates.filter(b=>b.transport==="tcp");C.forEach(b=>{A.push(Ac(Ac({},b),{},{foundation:"udpcandidate",priority:Number(b.priority)+1+"",transport:"udp",port:Number(b.port)-90+""}))}),this._candidates=[...A,...C]}}else A.length===0?(this._candidates.filter(C=>C.transport==="tcp").forEach(C=>{A.push(Ac(Ac({},C),{},{foundation:"udpcandidate",priority:Number(C.priority)+1+"",transport:"udp",port:Number(C.port)-90+""}))}),this._candidates=A):this._candidates=this._candidates.filter(C=>C.transport!=="tcp");for(const C of this.sessionDesc.mediaDescriptions)C.attributes.candidates=this.candidates}restartICE(T){T=xt(T),this._iceParameters=T,this.sessionDesc.mediaDescriptions.forEach(A=>{A.attributes.iceUfrag=T.iceUfrag,A.attributes.icePwd=T.icePwd})}predictReceivingMids(T){const A=[];for(let C=0;C<T;C++)A.push((this.currentMidIndex+C+1).toString(10));return A}findAvailableMediaIndex(T,A){return this.sessionDesc.mediaDescriptions.findIndex(C=>{const b=C.media.mediaType===T&&C.media.port!=="0"&&(C.attributes.direction==="sendonly"||C.attributes.direction==="sendrecv")&&C.attributes.ssrcs.length===0;if(Pt()){if(b){const D=this.firefoxSsrcMidMap.get(A[0].ssrcId);return!(D||C.attributes.mid!=="0"&&C.attributes.mid!=="1")||!(!D||D!==C.attributes.mid)}return!1}return b})}createOrRecycleDataChannel(){for(const C of this.sessionDesc.mediaDescriptions)if(C.media.mediaType==="application")return{mediaDesc:C,needExchangeSDP:!1};this.currentMidIndex+=1;const T="".concat(this.currentMidIndex),A={media:{mediaType:"application",port:xp,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(T),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(A),{mediaDesc:A,needExchangeSDP:!0}}createOrRecycleRecvMedia(T,A,C,b,D,M){const B=T._mediaStreamTrack.kind,J=this.rtpCapabilities.recv,G=jl(B,J,this.localCapabilities.send,B===be.VIDEO?b:D),q=B===be.VIDEO?J.videoExtensions:J.audioExtensions;this.currentMidIndex+=1;const Q="".concat(this.currentMidIndex);let $={media:{mediaType:B,port:xp,protos:["UDP","TLS","RTP","SAVPF"],fmts:G.map(Ee=>Ee.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:q,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:A,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:G,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:C,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Q)}};$=this.mungRecvMediaDsec($,T,M);const ue=this.findFirstClosedMedia(B);if(ue){const Ee=this.sessionDesc.mediaDescriptions.indexOf(ue);this.sessionDesc.mediaDescriptions[Ee]=$}else this.sessionDesc.mediaDescriptions.push($);return $}updateRemoteCodec(T,A,C){const b=[...new Set(this._rtpCapabilities.recv.videoCodecs.map($=>$.rtpMap&&$.rtpMap.encodingName.toLowerCase()||"").filter($=>{var ue;return Ie(ue=Object.keys(sc)).call(ue,$)}))],D=new Set(A);if(b.every($=>D.has($)))return y.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(A)),!1;const M=this._rtpCapabilities.recv.videoCodecs.filter($=>A.some(ue=>{var Ee;return Ie(Ee=$.rtpMap&&$.rtpMap.encodingName.toLowerCase()||"").call(Ee,ue)}));if(M.length===0)return y.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(b," codecs: ").concat(A)),!1;const B=[...new Set(M.map($=>$.rtpMap&&$.rtpMap.encodingName.toLowerCase()||""))];let J;if(y.debug("updateRemoteCodec, from ".concat(b," to ").concat(B)),T.length===0)J=this.sessionDesc.mediaDescriptions.filter($=>$.media.mediaType==="video"&&$.attributes.direction==="recvonly");else if(J=this.sessionDesc.mediaDescriptions.filter($=>$.attributes.mid&&Ie(T).call(T,$.attributes.mid)&&$.attributes.direction==="recvonly"),J.length!==T.length)return y.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(T,", codecs: ").concat(A)),!1;this._rtpCapabilities.recv.videoCodecs=M;const G=this.localCapabilities.send,q=this.rtpCapabilities.recv,Q=jl(be.VIDEO,q,G,C);return J.forEach($=>{const ue=Q.map(Ee=>Ee.payloadType.toString(10));y.debug("updateRemoteCodec mid: ".concat($.attributes.mid,", from ").concat($.attributes.payloads," to ").concat(Q)),$.attributes.payloads=Q,$.media.fmts=ue}),!0}createOrRecycleSendMedia(T,A,C,b,D){const M=this.rtpCapabilities.send,B=T===be.VIDEO?M.videoCodecs:M.audioCodecs,J=T===be.VIDEO?M.videoExtensions:M.audioExtensions;this.currentMidIndex+=1;const G="".concat(this.currentMidIndex);let q={media:{mediaType:T,port:xp,protos:["UDP","TLS","RTP","SAVPF"],fmts:B.map($=>$.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:J,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:A,ssrcGroups:C,rtcpFeedbackWildcards:[],payloads:B,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:b,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(G)}};q=this.mungSendMediaDesc(q,D);const Q=this.findFirstClosedMedia(T);if(Q){const $=this.sessionDesc.mediaDescriptions.indexOf(Q);this.sessionDesc.mediaDescriptions[$]=q}else this.sessionDesc.mediaDescriptions.push(q);return q}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(T=>T.media.port!=="0").map(T=>T.attributes.mid)}mungRecvMediaDsec(T,A,C){const b=xt(T);return cE(b),Ic(b,A),lE(b,A),q0(b),fu(b,C,this.localCapabilities.send),b}mungSendMediaDesc(T,A){const C=xt(T);return fu(C,A,this.localCapabilities.recv),co(C),C}updateRecvMedia(T,A){const C=this.sessionDesc.mediaDescriptions.findIndex(b=>b.attributes.mid===T);if(C!==-1){const b=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[C],A);this.sessionDesc.mediaDescriptions[C]=b}}bumpMid(T){this.currentMidIndex+=T}findFirstClosedMedia(T){return this.sessionDesc.mediaDescriptions.find(A=>Pt()?A.media.port==="0"&&A.media.mediaType===T:A.media.port==="0")}findPreloadMediaDesc(T){return this.sessionDesc.mediaDescriptions.find(A=>{var C;return((C=A.attributes)===null||C===void 0||(C=C.ssrcs[0])===null||C===void 0?void 0:C.ssrcId)===T[0].ssrcId})}getSSRC(T){var A;return(A=this.sessionDesc.mediaDescriptions.find(C=>C.attributes.mid===T))===null||A===void 0?void 0:A.attributes.ssrcs}}({remoteIceParameters:e,remoteDtlsParameters:t,candidates:i,remoteRTPCapabilities:o,remoteSetup:a,localCapabilities:this.localCapabilities,cname:l}),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const u=this.remoteSDP.toString(),h=Yt.parse(this.initialOffer.sdp),f=h.mediaDescriptions.find(T=>T.media.mediaType==="audio");f&&co(f),this.useXR&&Dp(h);const m=Yt.print(h),E=this.logSDPExchange(m||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:m}),E==null||E(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u});const v=this.peerConnection.getTransceivers()[0];if(v!=null&&v.receiver&&this.tryBindTransportEvents(v.receiver),V("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia();const T=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:T});const A=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(A)}}catch(u){throw new ne(N.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(u.toString()))}}send(e,t,i){var o=this;return Tr(function*(){const a=yield Qe(o.mutex.lock("From P2PConnection.send"));try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const l=[];e.forEach(C=>{const b=o.peerConnection.addTransceiver(C._mediaStreamTrack,{direction:"sendonly"});l.push(b),C._updateRtpTransceiver(b)}),Pt()&&V("SIMULCAST")===!0&&(yield Qe(o.applySimulcastForFirefox(l,e)));const u=yield Qe(o.peerConnection.createOffer()),h=o.remoteSDP.predictReceivingMids(e.length),f=o.mungSendOfferSDP(u.sdp,e,h),m=Yt.parse(f),E=h.map(C=>{const b=m.mediaDescriptions.find(D=>D.attributes.mid===C);if(!b)throw new Error("Cannot extract ssrc from mediaDescription.");return Y0(b,V("USE_PUB_RTX"))});let v;try{v=yield E}catch(C){v=[],o.remoteSDP.receive(e,t,i,v);const b=o.remoteSDP.toString();throw yield Qe(o.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield Qe(o.peerConnection.setRemoteDescription({type:"answer",sdp:b})),yield Qe(o.stopSending(h,!0)),C}o.remoteSDP.receive(e,t,i,v);const T=o.remoteSDP.toString(),A=o.logSDPExchange(f,"offer","local","send");return yield Qe(o.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield Qe(o.applySimulcastEncodings(l,e)),yield Qe(o.applySendEncodings(l,e)),A==null||A(T),yield Qe(o.peerConnection.setRemoteDescription({type:"answer",sdp:T})),l.map((C,b)=>{const D=h[b];return{localSSRC:E[b],id:D,transceiver:C}})}catch(l){throw l instanceof ne?l:new ne(N.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(l.toString()))}finally{a()}})()}async createDataChannels(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(e);if(i&&i.readyState==="open")y.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const a=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof a!="number")throw new Error("create DataChannel error, because cannot get dc id");i=this.peerConnection.createDataChannel("datastream-channel",{id:a,negotiated:!0,ordered:!1,maxRetransmits:V("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,i)}t.forEach(a=>{a._updateOriginDataChannel(i)});const{needExchangeSDP:o}=this.remoteSDP.sendDataChannel();if(o){const a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const l=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(l),y.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else y.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(i){throw i instanceof ne?i:new ne(N.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(e){try{const t=this.dataStreamChannelMap.get(e);return t&&(t.id&&this.recoveredDataChannelIds.push(t.id),t.close()),void this.dataStreamChannelMap.delete(e)}catch(t){throw t instanceof ne?t:new ne(N.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(t.toString()))}}async stopSending(e,t){const i=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const o=this.peerConnection.getTransceivers().filter(h=>e.indexOf(h.mid)!==-1);if(o.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");o.map(h=>{var f;h.direction="inactive",(f=h.stop)===null||f===void 0||f.call(h)});const a=await this.peerConnection.createOffer(),l=this.logSDPExchange(a.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(e);const u=this.remoteSDP.toString();l==null||l(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new ne(N.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(o.toString()))}finally{i&&i()}}async receive(e,t,i,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:a,needExchangeSDP:l}=this.remoteSDP.send(e,t,i,o);if(l){const h=this.remoteSDP.toString(),f=this.logSDPExchange(h,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:h});const m=await this.peerConnection.createAnswer(),E=this.mungReceiveAnswerSDP(m.sdp,a,e);f==null||f(E||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:E}),y.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else y.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));const u=this.peerConnection.getTransceivers().find(h=>h.mid===a);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:a,transceiver:u}}catch(a){throw new ne(N.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:t,needExchangeSDP:i}=this.remoteSDP.batchSend(e);if(i){const o=this.remoteSDP.toString(),a=this.logSDPExchange(o,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const l=await this.peerConnection.createAnswer();a==null||a(l.sdp||""),await this.peerConnection.setLocalDescription(l),y.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))}else y.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive no need to exchange SDP."));return t.map(o=>{const a=this.peerConnection.getTransceivers().find(l=>l.mid===o);if(!a)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:o,transceiver:a}})}catch(t){throw new ne(N.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(t.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString(),i=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(t){throw new ne(N.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(t.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const t=this.remoteSDP.toString(),i=this.logSDPExchange(t,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(t){throw new ne(N.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(t.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const t=this.remoteSDP.toString(),i=this.logSDPExchange(t,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(t){throw new ne(N.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(t.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter(l=>l.mid&&e.indexOf(l.mid)!==-1);if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(l=>{l.direction="inactive"});const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(e);const a=this.remoteSDP.toString();o==null||o(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(t){throw new ne(N.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(t.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter(l=>l.mid&&e.indexOf(l.mid)!==-1);if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(async(l,u)=>{l.direction="sendonly"});const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(e);const a=this.remoteSDP.toString();o==null||o(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(t){throw new ne(N.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(t.toString()))}}restartICE(e){var t=this;return Tr(function*(){const i=yield Qe(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(mt().supportPCSetConfiguration){const f=t.peerConnection.getConfiguration(),m=e===mi.RELAY?"relay":"all";f.iceTransportPolicy!==m&&(y.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(f.iceTransportPolicy,"] to [").concat(m,"]")),f.iceTransportPolicy=m,t.peerConnection.setConfiguration(f))}else if(e===mi.RELAY)return;t.remoteSDP.updateCandidates(e);const o=yield Qe(t.peerConnection.createOffer({iceRestart:!0}));if(!o.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const a=ao(o.sdp),{remoteIceParameters:l}=yield a.iceParameters;t.remoteSDP.restartICE(l);const u=t.remoteSDP.toString(),h=t.logSDPExchange(o.sdp||"","offer","local","restartICE");t.store.descriptionStart(),yield Qe(t.peerConnection.setLocalDescription(o)),h==null||h(u),yield Qe(t.peerConnection.setRemoteDescription({type:"answer",sdp:u}))}catch(o){y.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),o)}finally{i()}})()}close(){var e;this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(i.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);const a=this.remoteSDP.toString(),l=this.logSDPExchange(o,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),l==null||l(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new ne(N.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,t){const i=this.peerConnection.getTransceivers().filter(o=>o.mid===e);i.length===1&&(this.isVP8Simulcast(t)?Pt()||await this.applySimulcastEncodings(i,[t]):await this.applySendEncodings(i,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const i=this.peerConnection.getTransceivers().find(o=>o.mid===t);i&&await i.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const t=e[0].transport.iceTransport,{local:i,remote:o}=t.getSelectedCandidatePair();return{local:Eu(Eu({},Bo),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:Eu(Eu({},Bo),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,y.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,y.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},V("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const t={iceServers:[]};return e.iceServers?t.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(xd(e.turnServer.servers)?t.iceServers=e.turnServer.servers:(t.iceServers&&t.iceServers.push(...cn.turnServerConfigToIceServers(e.turnServer.servers)),V("USE_TURN_SERVER_OF_GATEWAY")&&t.iceServers&&e.turnServer.serversFromGateway&&t.iceServers.push(...cn.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),V("FORCE_TURN_TCP")?t.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(t.iceTransportPolicy="relay")}))),V("ENABLE_ENCODED_TRANSFORM")&&mt().supportWebRTCEncodedTransform&&(t.encodedInsertableStreams=!0),t}static turnServerConfigToIceServers(e){const t=[];return e.forEach(i=>{i.security?i.tcpport&&t.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(uc(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!V("FORCE_TURN_TCP")&&t.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&t.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),t}tryBindTransportEvents(e){const t=e.transport;if(t){this.transportEventReceiver=e,t.onstatechange=()=>{var o;t!=null&&t.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,t.state))},t.onerror=o=>{var a;(a=this.onDTLSTransportError)===null||a===void 0||a.call(this,"error"in o?o.error:o)};const i=t.iceTransport;i&&(i.onstatechange=()=>{const o=t==null?void 0:t.iceTransport.state;var a;o&&((a=this.onICETransportStateChange)===null||a===void 0||a.call(this,o))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:o,remote:a}=i.getSelectedCandidatePair();y.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol}),", remote ").concat(JSON.stringify({candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,t){var i;if(t||(t=this.peerConnection.getSenders().find(m=>m.track===e._mediaStreamTrack)),!t)return y.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return y.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!mt().supportSetRtpSenderParameters)return y.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const o={},a={};switch(e._optimizationMode){case"motion":o.degradationPreference="maintain-framerate";break;case"detail":o.degradationPreference="maintain-resolution";break;default:o.degradationPreference="balanced"}if(e._encoderConfig){var l;const{bitrateMax:m,frameRate:E,scaleResolutionDownBy:v}=e._encoderConfig;m&&(a.maxBitrate=1e3*m),(Ie(l=e._hints).call(l,Ut.LOW_STREAM)||e.isUseScaleResolutionDownBy)&&(E&&(a.maxFramerate=xr(E)),v&&v>=1&&(a.scaleResolutionDownBy=v))}if(V("DSCP_TYPE")&&nc()){var u;const m=V("DSCP_TYPE");Ie(u=["very-low","low","medium","high"]).call(u,m)&&(a.networkPriority=m)}const h=t.getParameters(),f=(i=h.encodings)===null||i===void 0?void 0:i[0];Pt()&&!f&&(o.encodings=[a]),f&&Object.assign(f,a),Object.assign(h,o),y.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(h.encodings))),await t.setParameters(h)}async applySendEncodings(e,t){try{if(!mt().supportSetRtpSenderParameters||e.length!==t.length)return;for(let i=0;i<e.length;i++){const o=e[i],a=t[i];a instanceof et&&!this.isVP8Simulcast(a)&&await this.updateRtpSenderEncodings(a,o.sender)}}catch{y.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,i){const o=Yt.parse(e);return t.forEach((a,l)=>{const u=i[l],h=o.mediaDescriptions.find(f=>f.attributes.mid===u);h&&(Ic(h,a),J0(h,a,this.store.codec))}),Yt.print(o)}mungReceiveAnswerSDP(e,t,i){const o=Yt.parse(e),a=o.mediaDescriptions.find(l=>l.attributes.mid===t);return a&&(i===be.AUDIO&&a.media.mediaType==="audio"&&co(a),this.useXR&&Dp(o)),Yt.print(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;(t=this.onFirstAudioReceived)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;(t=this.onFirstVideoReceived)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;(t=this.onFirstAudioDecoded)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,i)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,e,t,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;(t=this.onFirstVideoDecodedTimeout)===null||t===void 0||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let h=0;h<e.length;h++){var i,o,a,l,u;const f=e[h],m=t[h];if(m instanceof et&&!Ie(i=m._hints).call(i,Ut.LOW_STREAM)&&(o=m._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((a=m._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(l=m._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((u=m._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1&&this.store.codec==="vp8"){const E={},v={high:1e3*(m._encoderConfig.bitrateMax-50),medium:5e4};E.encodings=[{rid:"m",active:!0,maxBitrate:v.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:v.high}];const T=f.sender.getParameters();await f.sender.setParameters(Object.assign(T,E))}}}async applySimulcastEncodings(e,t){if(!Pt()&&e.length===t.length)for(let i=0;i<e.length;i++){const o=t[i];if(o instanceof et&&this.isVP8Simulcast(o)){const a=e[i],l={},u={high:1e3*(o._encoderConfig.bitrateMax-50),medium:5e4};l.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:u.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:u.medium,scaleResolutionDownBy:4}];const h=a.sender.getParameters();await a.sender.setParameters(Object.assign(h,l))}}}isVP8Simulcast(e){var t,i,o,a,l;return!!(e instanceof et&&V("SIMULCAST")&&this.store.codec==="vp8"&&!Ie(t=e._hints).call(t,Ut.LOW_STREAM)&&(i=e._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((o=e._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(a=e._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((l=e._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1)}logSDPExchange(e,t,i,o){if(V("SDP_LOGGING"))return y.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(t," SDP during P2PConnection.").concat(o,`
`),e),t==="offer"?a=>{this.logSDPExchange(a,"answer",i==="local"?"remote":"local",o)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const t=this.remoteSDP.getSSRC(e);return t==null?void 0:t[0].ssrcId}setConfiguration(e){if(mt().supportPCSetConfiguration){const t=cn.resolvePCConfiguration(e);this.peerConnection.setConfiguration(t)}}}function yr(n,e,t){const i=n[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return t.value=async function(){const o=this.mutex,a=await o.lock("From P2PConnection.".concat(e));try{for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return await i.apply(this,u)}finally{a()}},t}function EM(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}function gM(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?EM(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):EM(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}ie([yr,O("design:type",Function),O("design:paramtypes",[Array,Array]),O("design:returntype",X)],cn.prototype,"updateRemoteRTPCapabilities",null),ie([yr,O("design:type",Function),O("design:paramtypes",[Object,Object,Array,Object,String,String]),O("design:returntype",X)],cn.prototype,"connect",null),ie([yr,O("design:type",Function),O("design:paramtypes",[Object,Array]),O("design:returntype",X)],cn.prototype,"createDataChannels",null),ie([yr,O("design:type",Function),O("design:paramtypes",[String,Array,String,Object]),O("design:returntype",X)],cn.prototype,"receive",null),ie([yr,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",X)],cn.prototype,"batchReceive",null),ie([yr,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",X)],cn.prototype,"stopReceiving",null),ie([yr,O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",X)],cn.prototype,"muteRemote",null),ie([yr,O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",X)],cn.prototype,"unmuteRemote",null),ie([yr,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",X)],cn.prototype,"muteLocal",null),ie([yr,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",X)],cn.prototype,"unmuteLocal",null),ie([yr,O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],cn.prototype,"close",null),ie([yr,O("design:type",Function),O("design:paramtypes",[String,_i]),O("design:returntype",X)],cn.prototype,"updateEncoderConfig",null),ie([yr,O("design:type",Function),O("design:paramtypes",[String,_i]),O("design:returntype",X)],cn.prototype,"updateSendParameters",null),ie([yr,O("design:type",Function),O("design:paramtypes",[_i,String]),O("design:returntype",X)],cn.prototype,"replaceTrack",null),ie([yr,O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",X)],cn.prototype,"getRemoteSSRC",null);const vM=`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0
a=msid-semantic: WMS
a=ice-lite
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:0
`,pE="9",nR=2e4,iR=4e4;class rq{get localCapabilities(){return xt(this._localCapabilities)}get rtpCapabilities(){return xt(this._rtpCapabilities)}get candidates(){return xt(this._candidates)}get iceParameters(){return xt(this._iceParameters)}get dtlsParameters(){return xt(this._dtlsParameters)}constructor(e){S(this,"sessionDesc",void 0),S(this,"_localCapabilities",void 0),S(this,"_rtpCapabilities",void 0),S(this,"_candidates",void 0),S(this,"_iceParameters",void 0),S(this,"_dtlsParameters",void 0),S(this,"setup",void 0),S(this,"currentMidIndex",void 0),S(this,"cname",void 0),S(this,"firefoxSsrcMidMap",new Map),e=xt(e);const{remoteIceParameters:t,remoteDtlsParameters:i,candidates:o,remoteRTPCapabilities:a,remoteSetup:l,localCapabilities:u,cname:h}=e,f=Yt.parse(vM);this._rtpCapabilities=a,this._candidates=o,this._iceParameters=t,this._dtlsParameters=i,this._localCapabilities=u,this.setup=l,this.cname=h;const m=this.rtpCapabilities.send;for(const E of f.mediaDescriptions){if(E.attributes.iceUfrag=t.iceUfrag,E.attributes.icePwd=t.icePwd,E.attributes.fingerprints=i.fingerprints,E.attributes.candidates=o,E.attributes.setup=l,E.media.mediaType==="application"&&(E.attributes.sctpPort="5000"),E.media.mediaType==="video"&&(E.media.fmts=m.videoCodecs.map(v=>v.payloadType.toString(10)),E.attributes.payloads=m.videoCodecs,E.attributes.extmaps=m.videoExtensions,V("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:v,ssrcGroups:T}=cr([{ssrcId:iR,rtx:V("USE_SUB_RTX")?40001:void 0}],this.cname);E.attributes.ssrcs=v,E.attributes.ssrcGroups=T}if(E.media.mediaType==="audio"&&(E.media.fmts=m.audioCodecs.map(v=>v.payloadType.toString(10)),E.attributes.payloads=m.audioCodecs,E.attributes.extmaps=m.audioExtensions,co(E),V("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:v,ssrcGroups:T}=cr([{ssrcId:nR}],this.cname);E.attributes.ssrcs=v,E.attributes.ssrcGroups=T}}this.sessionDesc=f,this.currentMidIndex=f.mediaDescriptions.length-1}updateRemoteRTPCapabilities(e){const t=Yt.parse(vM);this._rtpCapabilities=e;const i=this.rtpCapabilities.send;for(const o of t.mediaDescriptions){if(o.attributes.iceUfrag=this._iceParameters.iceUfrag,o.attributes.icePwd=this._iceParameters.icePwd,o.attributes.fingerprints=this._dtlsParameters.fingerprints,o.attributes.candidates=this._candidates,o.attributes.setup=this.setup,o.media.mediaType==="application"&&(o.attributes.sctpPort="5000"),o.media.mediaType==="video"&&(o.media.fmts=i.videoCodecs.map(a=>a.payloadType.toString(10)),o.attributes.payloads=i.videoCodecs,o.attributes.extmaps=i.videoExtensions,V("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:a,ssrcGroups:l}=cr([{ssrcId:iR,rtx:V("USE_SUB_RTX")?40001:void 0}],this.cname);o.attributes.ssrcs=a,o.attributes.ssrcGroups=l}if(o.media.mediaType==="audio"&&(o.media.fmts=i.audioCodecs.map(a=>a.payloadType.toString(10)),o.attributes.payloads=i.audioCodecs,o.attributes.extmaps=i.audioExtensions,V("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:a,ssrcGroups:l}=cr([{ssrcId:nR}],this.cname);o.attributes.ssrcs=a,o.attributes.ssrcGroups=l}}this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1}preloadRemoteMedia(e){this.rtpCapabilities;const t=this.candidates,i=this.dtlsParameters,o=this.iceParameters,a=this.rtpCapabilities.send;for(let l=1;l<e;l++){const u=2*l+nR,h=2*l+iR,{ssrcs:f,ssrcGroups:m}=cr([{ssrcId:u}],this.cname),{ssrcs:E,ssrcGroups:v}=cr([{ssrcId:h,rtx:V("USE_SUB_RTX")?h+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:pE,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.videoCodecs.map(T=>T.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:o.iceUfrag,icePwd:o.icePwd,unrecognized:[],candidates:t,extmaps:a.videoExtensions,fingerprints:i.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:E,ssrcGroups:v,rtcpFeedbackWildcards:[],payloads:a.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*l-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:pE,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.audioCodecs.map(T=>T.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:o.iceUfrag,icePwd:o.icePwd,unrecognized:[],candidates:t,extmaps:a.audioExtensions,fingerprints:i.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:f,ssrcGroups:m,rtcpFeedbackWildcards:[],payloads:a.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*l)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Yt.print(this.sessionDesc)}send(e,t,i,o){const{ssrcs:a,ssrcGroups:l}=cr(t,this.cname,V("SYNC_GROUP")?i:void 0),u=this.findPreloadMediaDesc(a);if(u){if(Pt()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,u.attributes.mid),o&&(o.twcc||o.remb)){const h=this.sessionDesc.mediaDescriptions.indexOf(u);return this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(u,o),{mid:u.attributes.mid,needExchangeSDP:!0}}return{mid:u.attributes.mid,needExchangeSDP:!1}}{const h=this.findAvailableMediaIndex(e,a);let f;return h===-1||ii()||xi()||lP()||h===0&&V("USE_SUB_RTX")?(f=this.createOrRecycleSendMedia(e,a,l,"sendonly",o),this.updateBundleMids()):(f=xt(this.sessionDesc.mediaDescriptions[h]),f.attributes.direction="sendonly",f.attributes.ssrcs=a,f.attributes.ssrcGroups=l,this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(f,o)),Pt()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,f.attributes.mid),{mid:f.attributes.mid,needExchangeSDP:!0}}}batchSend(e){const t=e.map(a=>{let{kind:l,ssrcMsg:u,mslabel:h}=a;return this.send(l,u,h)}),i=[];let o=!1;return t.forEach(a=>{let{mid:l,needExchangeSDP:u}=a;u&&(o=!0),i.push(l)}),{mids:i,needExchangeSDP:o}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&e.indexOf(i.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(i=>{i.attributes.mid==="0"||Pt()||ii()||xi()?i.attributes.ssrcs=[]:(i.attributes.ssrcs=[],i.attributes.direction="inactive",i.media.port="0")}),this.updateBundleMids()}mute(e){const t=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(i=>Ie(e).call(e,i.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(i=>Ie(e).call(e,i.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(i=>{i.attributes.direction="recvonly"})}receive(e,t,i,o){e.forEach((a,l)=>{this.createOrRecycleRecvMedia(a,[],"recvonly",t,i,o[l])}),this.updateBundleMids()}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(i=>e.indexOf(i.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(e){e===mi.TCP?this._candidates.forEach(t=>{this._candidates.findIndex(i=>i.transport==="tcp"&&i.connectionAddress===t.connectionAddress&&i.port===t.port)===-1&&this._candidates.push(gM(gM({},t),{},{foundation:"tcpcandidate",priority:Number(t.priority)-1+"",transport:"tcp",port:Number(t.port)+90+""}))}):this._candidates=this._candidates.filter(t=>t.transport!=="tcp");for(const t of this.sessionDesc.mediaDescriptions)t.attributes.candidates=this.candidates}restartICE(e){e=xt(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const t=[];for(let i=0;i<e;i++)t.push((this.currentMidIndex+i+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const o=i.media.mediaType===e&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(Pt()){if(o){const a=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(a||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!a||a!==i.attributes.mid)}return!1}return o})}createOrRecycleRecvMedia(e,t,i,o,a,l){const u=e._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,f=jl(u,h,this.localCapabilities.send,u===be.VIDEO?o:a),m=u===be.VIDEO?h.videoExtensions:h.audioExtensions;this.currentMidIndex+=1;const E="".concat(this.currentMidIndex);let v={media:{mediaType:u,port:pE,protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(A=>A.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(E)}};v=this.mungRecvMediaDsec(v,e,l);const T=this.findFirstClosedMedia(u);if(T){const A=this.sessionDesc.mediaDescriptions.indexOf(T);this.sessionDesc.mediaDescriptions[A]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}updateRemoteCodec(e,t,i){const o=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(v=>v.rtpMap&&v.rtpMap.encodingName.toLowerCase()||"").filter(v=>{var T;return Ie(T=Object.keys(sc)).call(T,v)}))],a=new Set(t);if(o.every(v=>a.has(v)))return y.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t)),!1;const l=this._rtpCapabilities.recv.videoCodecs.filter(v=>t.some(T=>{var A;return Ie(A=v.rtpMap&&v.rtpMap.encodingName.toLowerCase()||"").call(A,T)}));if(l.length===0)return y.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(o," codecs: ").concat(t)),!1;const u=[...new Set(l.map(v=>v.rtpMap&&v.rtpMap.encodingName.toLowerCase()||""))];let h;if(y.debug("updateRemoteCodec, from ".concat(o," to ").concat(u)),e.length===0)h=this.sessionDesc.mediaDescriptions.filter(v=>v.media.mediaType==="video"&&v.attributes.direction==="recvonly");else if(h=this.sessionDesc.mediaDescriptions.filter(v=>v.attributes.mid&&Ie(e).call(e,v.attributes.mid)&&v.attributes.direction==="recvonly"),h.length!==e.length)return y.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(t)),!1;this._rtpCapabilities.recv.videoCodecs=l;const f=this.localCapabilities.send,m=this.rtpCapabilities.recv,E=jl(be.VIDEO,m,f,i);return h.forEach(v=>{const T=E.map(A=>A.payloadType.toString(10));y.debug("updateRemoteCodec mid: ".concat(v.attributes.mid,", from ").concat(v.attributes.payloads," to ").concat(E)),v.attributes.payloads=E,v.media.fmts=T}),!0}createOrRecycleSendMedia(e,t,i,o,a){const l=this.rtpCapabilities.send,u=e===be.VIDEO?l.videoCodecs:l.audioCodecs,h=e===be.VIDEO?l.videoExtensions:l.audioExtensions;this.currentMidIndex+=1;const f="".concat(this.currentMidIndex);let m={media:{mediaType:e,port:pE,protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map(v=>v.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:h,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(f)}};m=this.mungSendMediaDesc(m,a);const E=this.findFirstClosedMedia(e);if(E){const v=this.sessionDesc.mediaDescriptions.indexOf(E);this.sessionDesc.mediaDescriptions[v]=m}else this.sessionDesc.mediaDescriptions.push(m);return m}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}mungRecvMediaDsec(e,t,i){const o=xt(e);return cE(o),Ic(o,t),lE(o,t),q0(o),fu(o,i,this.localCapabilities.send),o}mungSendMediaDesc(e,t){const i=xt(e);return fu(i,t,this.localCapabilities.recv),co(i),i}updateRecvMedia(e,t){const i=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===e);if(i!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],t);this.sessionDesc.mediaDescriptions[i]=o}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>Pt()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var i;return((i=t.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===e[0].ssrcId})}getSSRC(e){var t;return(t=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===e))===null||t===void 0?void 0:t.attributes.ssrcs}}function SM(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}function fE(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?SM(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):SM(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}class vi extends g_{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){let e;return this.localCapabilities&&(e=mu(this.localCapabilities)),[...new Set(e&&e.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var i;return Ie(i=Object.keys(sc)).call(i,t)}))]}constructor(e,t,i){super(e,t),S(this,"store",void 0),S(this,"peerConnection",void 0),S(this,"remoteSDP",void 0),S(this,"initialOffer",void 0),S(this,"transportEventReceiver",void 0),S(this,"statsFilter",void 0),S(this,"useXR",V("USE_XR")),S(this,"localCapabilities",void 0),S(this,"localCandidateCount",0),S(this,"allCandidatesReceived",!1),S(this,"remoteCodecs",void 0),S(this,"dataStreamChannelMap",new Map),S(this,"establishPromise",void 0),S(this,"mutex",new Qn("NVExtentionsConnection-mutex")),S(this,"rtcMedia",void 0),this.store=t,this.peerConnection=i,this.statsFilter=aE(this.peerConnection,V("STATS_UPDATE_INTERVAL"),void 0,Pt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(e){try{const t=await this.peerConnection.createOffer();if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=ao(t.sdp),o=await X0({filterRTX:!V("USE_PUB_RTX")&&!V("USE_SUB_RTX"),filterVideoFec:V("FILTER_VIDEO_FEC"),filterAudioFec:V("FILTER_AUDIO_FEC"),filterVideoCodec:V("FILTER_VIDEO_CODEC")},{useXR:this.useXR});return this.localCapabilities=o,this.initialOffer=t,fE(fE({},i),{},{rtpCapabilities:o,offerSDP:t.sdp})}catch(t){throw new W(N.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(e,t,i,o,a,l){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");this.remoteSDP=new rq({remoteIceParameters:e,remoteDtlsParameters:t,candidates:i,remoteRTPCapabilities:o,remoteSetup:a,localCapabilities:mu(this.localCapabilities),cname:l});const u=this.remoteSDP.toString(),h=Yt.parse(this.initialOffer.sdp),f=h.mediaDescriptions.find(v=>v.media.mediaType==="audio");f&&co(f),this.useXR&&Dp(h);const m=Yt.print(h),E=this.logSDPExchange(m||"","offer","local","connect");await this.peerConnection.setLocalDescription({type:"offer",sdp:m}),E==null||E(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(u){throw new W(N.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(u.toString()))}}async updateRemoteRTPCapabilities(e,t){if(this.remoteCodecs=t,!this.remoteSDP)return void y.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(t));if(this.remoteSDP.updateRemoteCodec(e,t,this.store.codec)){const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i);const a=this.remoteSDP.toString();o==null||o(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}else y.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async updateRemoteConnect(e){var t,i,o,a;(t=this.remoteSDP)===null||t===void 0||t.updateRemoteRTPCapabilities(e),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&((a=this.remoteSDP)===null||a===void 0||a.updateRemoteCodec([],this.remoteCodecs,this.store.codec)),(i=this.remoteSDP)===null||i===void 0||i.preloadRemoteMedia(2);const l=(o=this.remoteSDP)===null||o===void 0?void 0:o.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const u=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(u),y.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")}send(e,t,i){var o=this;return Tr(function*(){const a=yield Qe(o.mutex.lock("From NVExtentionsConnection.send"));try{if(!o.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");const l=[];e.forEach(C=>{const b=o.peerConnection.addTransceiver(C._mediaStreamTrack,{direction:"sendonly"});l.push(b)}),Pt()&&V("SIMULCAST")===!0&&(yield Qe(o.applySimulcastForFirefox(l,e)));const u=yield Qe(o.peerConnection.createOffer()),h=o.remoteSDP.predictReceivingMids(e.length),f=o.mungSendOfferSDP(u.sdp,e,h),m=Yt.parse(f),E=h.map(C=>{const b=m.mediaDescriptions.find(D=>D.attributes.mid===C);if(!b)throw new Error("Cannot extract ssrc from mediaDescription.");return Y0(b,V("USE_PUB_RTX"))});let v;try{v=yield E}catch(C){v=[],o.remoteSDP.receive(e,t,i,v);const b=o.remoteSDP.toString();throw yield Qe(o.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield Qe(o.peerConnection.setRemoteDescription({type:"answer",sdp:b})),yield Qe(o.stopSending(h,!0)),C}o.remoteSDP.receive(e,t,i,v);const T=o.remoteSDP.toString(),A=o.logSDPExchange(f,"offer","local","send");return yield Qe(o.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield Qe(o.applySimulcastEncodings(l,e)),yield Qe(o.applySendEncodings(l,e)),A==null||A(T),yield Qe(o.peerConnection.setRemoteDescription({type:"answer",sdp:T})),l.map((C,b)=>{const D=h[b];return{localSSRC:E[b],id:D,transceiver:C}})}catch(l){throw l instanceof W?l:new W(N.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(l.toString()))}finally{a()}})()}async stopSending(e,t){const i=t?void 0:await this.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");const o=this.peerConnection.getTransceivers().filter(h=>e.indexOf(h.mid)!==-1);if(o.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");o.map(h=>{var f;h.direction="inactive",(f=h.stop)===null||f===void 0||f.call(h)});const a=await this.peerConnection.createOffer(),l=this.logSDPExchange(a.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(e);const u=this.remoteSDP.toString();l==null||l(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new W(N.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(o.toString()))}finally{i&&i()}}async createDataChannels(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(e);return i&&i.readyState==="open"?y.debug("[P2PConnection] Channels are already available and can be reused directly."):(i=this.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:V("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,i)),void t.forEach(o=>{o._updateOriginDataChannel(i)})}catch(i){throw i instanceof W?i:new W(N.DATACHANNEL_FAILED,"NVExtentionsConnection.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(e){try{const t=this.dataStreamChannelMap.get(e);return t==null||t.close(),void this.dataStreamChannelMap.delete(e)}catch(t){throw t instanceof W?t:new W(N.DATACHANNEL_FAILED,"NVExtentionsConnection.stopDataChannels failed; ".concat(t.toString()))}}async receive(e,t,i,o){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(e," before remoteSDP created."));const{mid:a,needExchangeSDP:l}=this.remoteSDP.send(e,t,i,o);if(l){const h=this.remoteSDP.toString(),f=this.logSDPExchange(h,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:h});const m=await this.peerConnection.createAnswer(),E=this.mungReceiveAnswerSDP(m.sdp,a,e);f==null||f(E||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:E}),y.debug("[NVExtentionsConnection] receive ".concat(e," by exchanging SDP."))}else y.debug("[NVExtentionsConnection] receive ".concat(e," no need to exchange SDP."));const u=this.peerConnection.getTransceivers().find(h=>h.mid===a);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:a}}catch(a){throw new W(N.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(a.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");const{mids:t,needExchangeSDP:i}=this.remoteSDP.batchSend(e);if(i){const o=this.remoteSDP.toString(),a=this.logSDPExchange(o,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const l=await this.peerConnection.createAnswer();a==null||a(l.sdp||""),await this.peerConnection.setLocalDescription(l),y.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else y.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return t.map(o=>{const a=this.peerConnection.getTransceivers().find(l=>l.mid===o);if(!a)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:o}})}catch(t){throw new W(N.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(t.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString(),i=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(t){throw new W(N.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(t.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const t=this.remoteSDP.toString(),i=this.logSDPExchange(t,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(t){throw new W(N.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(t.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const t=this.remoteSDP.toString(),i=this.logSDPExchange(t,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(t){throw new W(N.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(t.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter(l=>l.mid&&e.indexOf(l.mid)!==-1);if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(l=>{l.direction="inactive"});const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(e);const a=this.remoteSDP.toString();o==null||o(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(t){throw new W(N.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(t.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter(l=>l.mid&&e.indexOf(l.mid)!==-1);if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(async(l,u)=>{l.direction="sendonly"});const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(e);const a=this.remoteSDP.toString();o==null||o(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(t){throw new W(N.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(t.toString()))}}restartICE(e){var t=this;return Tr(function*(){const i=yield Qe(t.mutex.lock("From NVExtentionsConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(mt().supportPCSetConfiguration){const f=t.peerConnection.getConfiguration(),m=e===mi.RELAY?"relay":"all";f.iceTransportPolicy!==m&&(y.debug("restartICE change iceTransportPolicy from [".concat(f.iceTransportPolicy,"] to [").concat(m,"]")),f.iceTransportPolicy=m,t.peerConnection.setConfiguration(f))}else if(e===mi.RELAY)return;e!==mi.RELAY&&t.remoteSDP.updateCandidates(e);const o=yield Qe(t.peerConnection.createOffer({iceRestart:!0}));if(!o.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const a=ao(o.sdp),{remoteIceParameters:l}=yield a.iceParameters;t.remoteSDP.restartICE(l);const u=t.remoteSDP.toString(),h=t.logSDPExchange(o.sdp||"","offer","local","restartICE");yield Qe(t.peerConnection.setLocalDescription(o)),h==null||h(u),yield Qe(t.peerConnection.setRemoteDescription({type:"answer",sdp:u}))}catch(o){y.warning("restart ICE failed, abort operation",o)}finally{i()}})()}close(){var e;(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(i.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);const a=this.remoteSDP.toString(),l=this.logSDPExchange(o,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),l==null||l(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new W(N.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,t){const i=this.peerConnection.getTransceivers().filter(o=>o.mid===e);i.length===1&&(this.isVP8Simulcast(t)?Pt()||await this.applySimulcastEncodings(i,[t]):await this.applySendEncodings(i,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const i=this.peerConnection.getTransceivers().find(o=>o.mid===t);i&&await i.sender.replaceTrack(e._mediaStreamTrack)}getP2PConnectionParams(){var e;if((e=this.peerConnection.currentLocalDescription)===null||e===void 0||!e.sdp||!this.localCapabilities)throw new Error;return fE(fE({},ao(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,y.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,y.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},V("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const t={iceServers:[]};return e.iceServers?t.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(xd(e.turnServer.servers)?t.iceServers=e.turnServer.servers:(t.iceServers&&t.iceServers.push(...vi.turnServerConfigToIceServers(e.turnServer.servers)),V("USE_TURN_SERVER_OF_GATEWAY")&&t.iceServers&&e.turnServer.serversFromGateway&&t.iceServers.push(...vi.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),V("FORCE_TURN_TCP")?t.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(t.iceTransportPolicy="relay")}))),t}static turnServerConfigToIceServers(e){const t=[];return e.forEach(i=>{i.security?i.tcpport&&t.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(uc(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!V("FORCE_TURN_TCP")&&t.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&t.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),t}async applySendEncodings(e,t){try{if(!mt().supportSetRtpSenderParameters||e.length!==t.length)return;for(let E=0;E<e.length;E++){const v=e[E],T=t[E];if(T&&T instanceof et){var i,o,a;if(this.isVP8Simulcast(T))continue;const A={},C={};switch(T._optimizationMode){case"motion":A.degradationPreference="maintain-framerate";break;case"detail":A.degradationPreference="maintain-resolution";break;default:A.degradationPreference="balanced"}var l,u,h,f;if((i=T._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&(C.maxBitrate=1e3*((l=T._encoderConfig)===null||l===void 0?void 0:l.bitrateMax)),Ie(o=T._hints).call(o,Ut.LOW_STREAM)&&((u=T._encoderConfig)!==null&&u!==void 0&&u.frameRate&&(C.maxFramerate=xr(T._encoderConfig.frameRate)),(h=T._encoderConfig)!==null&&h!==void 0&&h.scaleResolutionDownBy&&((f=T._encoderConfig)===null||f===void 0?void 0:f.scaleResolutionDownBy)>1&&(C.scaleResolutionDownBy=T._encoderConfig.scaleResolutionDownBy)),V("DSCP_TYPE")&&nc()){var m;const M=V("DSCP_TYPE");Ie(m=["very-low","low","medium","high"]).call(m,M)&&(C.networkPriority=M)}const b=v.sender.getParameters(),D=(a=b.encodings)===null||a===void 0?void 0:a[0];Pt()&&!D&&(A.encodings=[C]),D&&Object.assign(D,C),Object.assign(b,A),await v.sender.setParameters(b)}}}catch{y.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(e,t,i){const o=Yt.parse(e);return t.forEach((a,l)=>{const u=i[l],h=o.mediaDescriptions.find(f=>f.attributes.mid===u);h&&(Ic(h,a),J0(h,a,this.store.codec))}),Yt.print(o)}mungReceiveAnswerSDP(e,t,i){const o=Yt.parse(e),a=o.mediaDescriptions.find(l=>l.attributes.mid===t);return a&&i===be.AUDIO&&a.media.mediaType==="audio"&&co(a),this.useXR&&Dp(o),Yt.print(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;(t=this.onFirstAudioReceived)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;(t=this.onFirstVideoReceived)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;(t=this.onFirstAudioDecoded)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,i)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,e,t,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;(t=this.onFirstVideoDecodedTimeout)===null||t===void 0||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let h=0;h<e.length;h++){var i,o,a,l,u;const f=e[h],m=t[h];if(m instanceof et&&!Ie(i=m._hints).call(i,Ut.LOW_STREAM)&&(o=m._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((a=m._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(l=m._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((u=m._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1&&this.store.codec==="vp8"){const E={},v={high:1e3*(m._encoderConfig.bitrateMax-50),medium:5e4};E.encodings=[{rid:"m",active:!0,maxBitrate:v.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:v.high}];const T=f.sender.getParameters();await f.sender.setParameters(Object.assign(T,E))}}}async applySimulcastEncodings(e,t){if(!Pt()&&e.length===t.length)for(let i=0;i<e.length;i++){const o=t[i];if(o instanceof et&&this.isVP8Simulcast(o)){const a=e[i],l={},u={high:1e3*(o._encoderConfig.bitrateMax-50),medium:5e4};l.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:u.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:u.medium,scaleResolutionDownBy:4}];const h=a.sender.getParameters();await a.sender.setParameters(Object.assign(h,l))}}}isVP8Simulcast(e){var t,i,o,a,l;return!!(e instanceof et&&V("SIMULCAST")&&this.store.codec==="vp8"&&!Ie(t=e._hints).call(t,Ut.LOW_STREAM)&&(i=e._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((o=e._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(a=e._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((l=e._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1)}logSDPExchange(e,t,i,o){if(V("SDP_LOGGING"))return y.upload("exchanging ".concat(i," ").concat(t," SDP during NVExtentionsConnection.").concat(o,`
`),e),t==="offer"?a=>{this.logSDPExchange(a,"answer",i==="local"?"remote":"local",o)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const t=this.remoteSDP.getSSRC(e);return t==null?void 0:t[0].ssrcId}setConfiguration(e){if(mt().supportPCSetConfiguration){const t=vi.resolvePCConfiguration(e);this.peerConnection.setConfiguration(t)}}}function lr(n,e,t){const i=n[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return t.value=async function(){const o=this.mutex,a=await o.lock("From NVExtentionsConnection.".concat(e));try{for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return await i.apply(this,u)}finally{a()}},t}function TM(n){var e,t,i,o=2;for(typeof Symbol<"u"&&(t=lM,i=Symbol.iterator);o--;){if(t&&(e=n[t])!=null)return e.call(n);if(i&&(e=n[i])!=null)return new mE(e.call(n));t="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function mE(n){function e(t){if(Object(t)!==t)return X.reject(new TypeError(t+" is not an object."));var i=t.done;return X.resolve(t.value).then(function(o){return{value:o,done:i}})}return mE=function(t){this.s=t,this.n=t.next},mE.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(t){var i=this.s.return;return i===void 0?X.resolve({value:t,done:!0}):e(i.apply(this.s,arguments))},throw:function(t){var i=this.s.return;return i===void 0?X.reject(t):e(i.apply(this.s,arguments))}},new mE(n)}ie([lr,O("design:type",Function),O("design:paramtypes",[Object,Object,Array,Object,String,String]),O("design:returntype",X)],vi.prototype,"connect",null),ie([lr,O("design:type",Function),O("design:paramtypes",[Array,Array]),O("design:returntype",X)],vi.prototype,"updateRemoteRTPCapabilities",null),ie([lr,O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",X)],vi.prototype,"updateRemoteConnect",null),ie([lr,O("design:type",Function),O("design:paramtypes",[Object,Array]),O("design:returntype",X)],vi.prototype,"createDataChannels",null),ie([lr,O("design:type",Function),O("design:paramtypes",[String,Array,String,Object]),O("design:returntype",X)],vi.prototype,"receive",null),ie([lr,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",X)],vi.prototype,"batchReceive",null),ie([lr,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",X)],vi.prototype,"stopReceiving",null),ie([lr,O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",X)],vi.prototype,"muteRemote",null),ie([lr,O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",X)],vi.prototype,"unmuteRemote",null),ie([lr,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",X)],vi.prototype,"muteLocal",null),ie([lr,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",X)],vi.prototype,"unmuteLocal",null),ie([lr,O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],vi.prototype,"close",null),ie([lr,O("design:type",Function),O("design:paramtypes",[String,_i]),O("design:returntype",X)],vi.prototype,"updateEncoderConfig",null),ie([lr,O("design:type",Function),O("design:paramtypes",[String,_i]),O("design:returntype",X)],vi.prototype,"updateSendParameters",null),ie([lr,O("design:type",Function),O("design:paramtypes",[_i,String]),O("design:returntype",X)],vi.prototype,"replaceTrack",null),ie([lr,O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",X)],vi.prototype,"getRemoteSSRC",null);class xn extends g_{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){return this._p2pConnection.localCodecs}constructor(e,t){super(e,t),S(this,"store",void 0),S(this,"peerConnection",void 0),S(this,"cname",void 0),S(this,"mutex",new Qn("DataChannelConnection-mutex")),S(this,"dataChannel",void 0),S(this,"_p2pConnection",void 0),S(this,"establishPromise",void 0),S(this,"_nvMedia",void 0),this.store=t,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(xn.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new vi(e,t,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}async establish(){var e;const t=(e=this._nvMedia)===null||e===void 0?void 0:e.getLocalRtpCapabilities();return await this._p2pConnection.establish(t)}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}async connect(e,t,i,o,a,l){return this.cname=l,await this._p2pConnection.connect(e,t,i,o,a,l),await new X((u,h)=>{const f=setTimeout(()=>{this.closeSignal(),h(new W(N.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(i))))},2e3);this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(f),void u()},this.dataChannel.onerror=m=>{this.closeSignal(),h(m)}}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}async updateRemoteRTPCapabilities(e,t){return this._p2pConnection.updateRemoteRTPCapabilities(e,t)}send(e,t,i){var o=this;return Tr(function*(){const a=yield Qe(o.mutex.lock("From DataChannelConnection.send"));try{return yield*hE(TM(o._p2pConnection.send(e,t,i)))}finally{a()}})()}async stopSending(e,t){return this._p2pConnection.stopSending(e,t)}async createDataChannels(e,t){return this._p2pConnection.createDataChannels(e,t)}async stopDataChannels(e){return this._p2pConnection.stopDataChannels(e)}async receive(e,t,i,o){return this._nvMedia?(y.debug("[DataChannelConnection] receive ".concat(e," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(e,t,this.cname)):(y.debug("[DataChannelConnection] receive ".concat(e," by WebRTC.")),await this._p2pConnection.receive(e,t,i,o))}async batchReceive(e){return[...await this._p2pConnection.batchReceive(e)]}async stopReceiving(e){return await this._p2pConnection.stopReceiving(e)}async muteRemote(e){return await this._p2pConnection.muteRemote(e)}async unmuteRemote(e){return await this._p2pConnection.unmuteRemote(e)}async muteLocal(e){return await this._p2pConnection.muteLocal(e)}async unmuteLocal(e){return await this._p2pConnection.unmuteLocal(e)}restartICE(e){var t=this;return Tr(function*(){return yield*hE(TM(t._p2pConnection.restartICE(e)))})()}close(){var e;(e=this._nvMedia)===null||e===void 0||e.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(e){return this._p2pConnection.getRemoteVideoIsReady(e)}updateRemoteConnect(e){var t;(t=this._nvMedia)===null||t===void 0||t.setRemoteRtpCapabilities(e),this._p2pConnection.updateRemoteConnect(e)}async updateEncoderConfig(e,t){return await this._p2pConnection.updateEncoderConfig(e,t)}async updateSendParameters(e,t){return await this._p2pConnection.updateSendParameters(e,t)}setStatsRemoteVideoIsReady(e,t){this._p2pConnection.setStatsRemoteVideoIsReady(e,t)}async replaceTrack(e,t){return await this._p2pConnection.replaceTrack(e,t)}async getRemoteSSRC(e){return this._p2pConnection.getRemoteSSRC(e)}logSDPExchange(e,t,i,o){if(V("SDP_LOGGING"))return y.upload("exchanging ".concat(i," ").concat(t," SDP during DataChannelConnection.").concat(o,`
`),e),t==="offer"?a=>{this.logSDPExchange(a,"answer",i==="local"?"remote":"local",o)}:void 0}static resolvePCConfiguration(e){const t={iceServers:[]};return e.iceServers?t.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(xd(e.turnServer.servers)?t.iceServers=e.turnServer.servers:(t.iceServers&&t.iceServers.push(...xn.turnServerConfigToIceServers(e.turnServer.servers)),V("USE_TURN_SERVER_OF_GATEWAY")&&t.iceServers&&e.turnServer.serversFromGateway&&t.iceServers.push(...xn.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),V("FORCE_TURN_TCP")?t.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(t.iceTransportPolicy="relay")}))),t}static turnServerConfigToIceServers(e){const t=[];return e.forEach(i=>{i.security?i.tcpport&&t.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(uc(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!V("FORCE_TURN_TCP")&&t.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&t.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),t}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=e=>{var t;return(t=this.onICEConnectionStateChange)===null||t===void 0?void 0:t.call(this,e)},this._p2pConnection.onConnectionStateChange=e=>{var t;return(t=this.onConnectionStateChange)===null||t===void 0?void 0:t.call(this,e)},this._p2pConnection.onDTLSTransportStateChange=e=>{var t;return(t=this.onDTLSTransportStateChange)===null||t===void 0?void 0:t.call(this,e)},this._p2pConnection.onDTLSTransportError=e=>{var t;return(t=this.onDTLSTransportError)===null||t===void 0?void 0:t.call(this,e)},this._p2pConnection.onICETransportStateChange=e=>{var t;return(t=this.onICETransportStateChange)===null||t===void 0?void 0:t.call(this,e)},this._p2pConnection.onFirstAudioReceived=e=>{var t;return(t=this.onFirstAudioReceived)===null||t===void 0?void 0:t.call(this,e)},this._p2pConnection.onFirstVideoReceived=e=>{var t;return(t=this.onFirstVideoReceived)===null||t===void 0?void 0:t.call(this,e)},this._p2pConnection.onFirstAudioDecoded=e=>{var t;return(t=this.onFirstAudioDecoded)===null||t===void 0?void 0:t.call(this,e)},this._p2pConnection.onFirstVideoDecoded=(e,t,i)=>{var o;return(o=this.onFirstVideoDecoded)===null||o===void 0?void 0:o.call(this,e,t,i)},this._p2pConnection.onFirstVideoDecodedTimeout=e=>{var t;return(t=this.onFirstVideoDecodedTimeout)===null||t===void 0?void 0:t.call(this,e)},this._p2pConnection.onSelectedLocalCandidateChanged=(e,t)=>{var i;return(i=this.onSelectedLocalCandidateChanged)===null||i===void 0?void 0:i.call(this,e,t)},this._p2pConnection.onSelectedRemoteCandidateChanged=(e,t)=>{var i;return(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0?void 0:i.call(this,e,t)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0}setConfiguration(e){this._p2pConnection.setConfiguration(e)}}function Kr(n,e,t){const i=n[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return t.value=async function(){const o=this.mutex,a=await o.lock("From DataChannelConnection.".concat(e));try{for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return await i.apply(this,u)}finally{a()}},t}function yM(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}function Oc(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?yM(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):yM(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function RM(n){var e,t,i,o=2;for(typeof Symbol<"u"&&(t=lM,i=Symbol.iterator);o--;){if(t&&(e=n[t])!=null)return e.call(n);if(i&&(e=n[i])!=null)return new _E(e.call(n));t="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function _E(n){function e(t){if(Object(t)!==t)return X.reject(new TypeError(t+" is not an object."));var i=t.done;return X.resolve(t.value).then(function(o){return{value:o,done:i}})}return _E=function(t){this.s=t,this.n=t.next},_E.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(t){var i=this.s.return;return i===void 0?X.resolve({value:t,done:!0}):e(i.apply(this.s,arguments))},throw:function(t){var i=this.s.return;return i===void 0?X.reject(t):e(i.apply(this.s,arguments))}},new _E(n)}ie([Kr,O("design:type",Function),O("design:paramtypes",[Object,Object,Array,Object,String,String]),O("design:returntype",X)],xn.prototype,"connect",null),ie([Kr,O("design:type",Function),O("design:paramtypes",[Array,Array]),O("design:returntype",X)],xn.prototype,"updateRemoteRTPCapabilities",null),ie([Kr,O("design:type",Function),O("design:paramtypes",[Object,Array]),O("design:returntype",X)],xn.prototype,"createDataChannels",null),ie([Kr,O("design:type",Function),O("design:paramtypes",[String,Array,String,Object]),O("design:returntype",X)],xn.prototype,"receive",null),ie([Kr,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",X)],xn.prototype,"stopReceiving",null),ie([Kr,O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",X)],xn.prototype,"muteRemote",null),ie([Kr,O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",X)],xn.prototype,"unmuteRemote",null),ie([Kr,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",X)],xn.prototype,"muteLocal",null),ie([Kr,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",X)],xn.prototype,"unmuteLocal",null),ie([Kr,O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],xn.prototype,"close",null),ie([Kr,O("design:type",Function),O("design:paramtypes",[String,_i]),O("design:returntype",X)],xn.prototype,"updateEncoderConfig",null),ie([Kr,O("design:type",Function),O("design:paramtypes",[String,_i]),O("design:returntype",X)],xn.prototype,"updateSendParameters",null),ie([Kr,O("design:type",Function),O("design:paramtypes",[_i,String]),O("design:returntype",X)],xn.prototype,"replaceTrack",null),ie([Kr,O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",X)],xn.prototype,"getRemoteSSRC",null);class ti extends zt{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Me.StateChange,t,this._state)}constructor(e,t){super(),S(this,"store",void 0),S(this,"statsUploader",void 0),S(this,"connection",void 0),S(this,"localTrackMap",new Map),S(this,"remoteUserMap",new Map),S(this,"localDataChannels",[]),S(this,"remoteDataChannelMap",new Map),S(this,"pendingLocalTracks",[]),S(this,"pendingRemoteTracks",[]),S(this,"pendingLocalDataChannels",[]),S(this,"pendingRemoteDataChannels",[]),S(this,"statsCollector",void 0),S(this,"isPlanB",!1),S(this,"shouldForwardP2PCreation",void 0),S(this,"iceFailedCount",0),S(this,"dtlsFailedCount",0),S(this,"mutex",new Qn("P2PChannel-mutex")),S(this,"_state",Tt.Disconnected),S(this,"_pcStatsUploadType",V("NEW_ICE_RESTART")?ro.FIRST_CONNECTION:ro.OLD_FIRST_CONNECTION),S(this,"_isInRestartIce",!1),S(this,"_isStartRestartIce",!1),S(this,"_restartStates",["disconnected","failed"]),S(this,"_restartTimer",void 0),S(this,"_isFirstConnected",!0),S(this,"handleMuteLocalTrack",async(i,o,a)=>{const l=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Tt.Connected)return void a(new ne(N.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const u=this.filterTobeMutedTracks(i);if(u.length===0)return void o();const h=u.find(m=>m[0]==="videoLowTrack");h&&h[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(u.map(m=>{let[,{id:E}]=m;return E}));const f=this.createMuteMessage(u);await Dt(this,Me.RequestMuteLocal,f),o()}catch(u){a(u)}finally{l()}}),S(this,"handleUnmuteLocalTrack",async(i,o,a)=>{const l=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Tt.Connected)return void a(new ne(N.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const u=this.filterTobeUnmutedTracks(i);if(u.length===0)return void o();const h=u.find(m=>m[0]==="videoLowTrack");if(h){const m=h[1];if(m.track._originMediaStreamTrack.stop(),!V("DISABLE_DUAL_STREAM_USE_ENCODING")&&mt().supportDualStreamEncoding){const E=i._mediaStreamTrack.clone();m.track._mediaStreamTrack=E,m.track._originMediaStreamTrack=E}else{const E=Q0(i,vl(this,Me.RequestLowStreamParameter));m.track._mediaStreamTrack=E,m.track._originMediaStreamTrack=E}await new X((E,v)=>{this.handleReplaceTrack(m.track,E,v,!0)})}await this.connection.unmuteLocal(u.map(m=>{let[,{id:E}]=m;return E}));const f=this.createUnmuteMessage(u);await Dt(this,Me.RequestUnmuteLocal,f),o()}catch(u){a(u)}finally{l()}}),S(this,"handleUpdateVideoEncoder",async(i,o,a)=>{const l=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const u=this.localTrackMap.get(ce.LocalVideoTrack);if(!this.connection||!u||u.track!==i||this.state!==Tt.Connected)return void o();const{id:h,track:f}=u;await this.connection.updateSendParameters(h,f),await this.connection.updateEncoderConfig(h,f),this.emit(Me.UpdateVideoEncoder,f),o()}catch(u){a(u)}finally{l()}}),S(this,"handleSetOptimizationMode",async(i,o,a)=>{const l=await this.mutex.lock("Locking from P2PChannel.handleSetOptimizationMode");try{const u=this.localTrackMap.get(ce.LocalVideoTrack);if(!this.connection||!u||u.track!==i||this.state!==Tt.Connected)return;const{id:h,track:f}=u;await this.connection.updateSendParameters(h,f),o()}catch(u){a(u)}finally{l()}}),S(this,"handleReplaceMixingTrack",async(i,o,a,l)=>{if(!this.connection||this.state!==Tt.Connected)return void o();const u=tR([i]);let h;y.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(u.getTrackId(),"]")),typeof l=="boolean"&&l||(h=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(i,u),o()}catch(m){a(m)}finally{var f;(f=h)===null||f===void 0||f()}}),S(this,"handleReplaceTrack",async(i,o,a,l)=>{let u;y.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof l=="boolean"&&l||(u=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var h;const m=Array.from(this.localTrackMap.entries()).find(E=>{let[,{track:v}]=E;return i===v});if(!this.connection||!m||this.state!==Tt.Connected)return void o();if(await((h=this.connection)===null||h===void 0?void 0:h.replaceTrack(i,m[1].id)),this.isPlanB){const E=m[1];E.id=i._mediaStreamTrack.id,this.localTrackMap.set(m[0],E)}if(m[0]===ce.LocalVideoTrack&&!V("DISABLE_DUAL_STREAM_USE_ENCODING")&&mt().supportDualStreamEncoding){const E=this.localTrackMap.get(ce.LocalVideoLowTrack);if(E){const v=i._mediaStreamTrack.clone();E.track._originMediaStreamTrack.stop(),E.track._mediaStreamTrack=v,E.track._originMediaStreamTrack=v,await new X((T,A)=>{this.handleReplaceTrack(E.track,T,A,!0)})}}o()}catch(m){a(m)}finally{var f;(f=u)===null||f===void 0||f()}}),S(this,"handleGetRTCStats",i=>{i(this.statsCollector.getRTCStats())}),S(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),S(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),S(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),S(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new iM(this.store),this.bindStatsUploaderEvents(),this.isPlanB=!mt().supportUnifiedPlan||V("CHROME_FORCE_PLAN_B")&&nc(),this.shouldForwardP2PCreation=V("FORWARD_P2P_CREATION")&&mt().supportPCSetConfiguration&&function(){const i=qm();return i===Nn.ANDROID||i===Nn.IOS||i===Nn.HARMONY_OS}(),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new xn({},this.store):this.isPlanB?new ei({},this.store):new cn({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var i;this.state=Tt.New;const o=this.shouldForwardP2PCreation&&((i=this.connection)===null||i===void 0?void 0:i.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!o||(o&&this.connection&&(y.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.store.useDataChannel?new xn(e,this.store):this.isPlanB?new ei(e,this.store):new cn(e,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new ne(N.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=V("NEW_ICE_RESTART")?ro.FIRST_CONNECTION:ro.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e,t,i,o,a,l){if(!this.connection)throw new ne(N.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.connection instanceof xn?this.connection.updateRemoteConnect(o):(this.store.peerConnectionStart(),await this.connection.connect(e,t,i,o,a,l),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Tt.Connected)}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter(a=>{var l;let[u]=a;return Ie(l=[ce.LocalVideoLowTrack,ce.LocalVideoTrack]).call(l,u)}),i=t.map(a=>{let[,{id:l}]=a;return l}),o=t.map(a=>{let[l]=a;return l});if(this.connection instanceof cn){if(Oe.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(o),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!Ie(e).call(e,this.store.codec)){const a=["vp8","h264"].find(l=>Ie(e).call(e,l));a&&(this.store.codec=a,y.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(a,".")))}this.connection.updateRemoteRTPCapabilities(i,e)}}async preConnect(e,t,i,o,a,l){if(!this.connection)throw new ne(N.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.store.peerConnectionStart();const u=await this.connection.connect(e,t,i,o,a,l);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Tt.Connected,u}getEstablishParams(){if(this.connection instanceof xn)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}async publishDataChannel(e){if(!this.connection||this.state!==Tt.Connected){if(this.state===Tt.Disconnected)throw new ne(N.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return void e.forEach(i=>{var o;Ie(o=this.pendingLocalDataChannels).call(o,i)||this.pendingLocalDataChannels.push(i)})}const t=this.filterTobePublishedDataChannels(e);t.length!==0&&(t.forEach(i=>{const o=Date.now();this.store.publish(i.id.toString(),"datachannel",o)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(i=>{this.localDataChannels.push(i);const o=Date.now();this.store.publish(i.id+"","datachannel",void 0,o)}))}publish(e,t,i){var o=this;return Tr(function*(){const a=yield Qe(o.mutex.lock("From P2PChannel.publish"));try{if(!o.connection||o.state!==Tt.Connected){if(o.state===Tt.Disconnected)throw new ne(N.UNEXPECTED_ERROR,"PeerConnection already disconnected.");o.throwIfTrackTypeNotMatch(e);const u=e.filter(h=>o.pendingLocalTracks.indexOf(h)===-1);return void(o.pendingLocalTracks=o.pendingLocalTracks.concat(u))}o.store.pubId=o.store.pubId+1,Ei.markPublishStart(o.store.clientId,o.store.pubId);const l=o.filterTobePublishedTracks(e,t,i);if(l.length===0)return void(yield Qe(o.tryToUnmuteAudio(e)));yield*hE(RM(o.doPublish(o.connection,l)))}finally{a()}})()}doPublish(e,t){var i=this;return Tr(function*(){t.forEach(v=>{let{track:T,type:A}=v;const C=Date.now();i.store.publish(T.getTrackId(),A===ce.LocalAudioTrack?"audio":"video",C)}),i.bindLocalTrackEvents(t);const o=t.map(v=>{let{track:T}=v;return T}),a=yield Qe(e.send(t.map(v=>{let{track:T}=v;return T}),i.store.codec,i.store.audioCodec)),l=(yield Qe(a.next())).value,u=i.createGatewayPublishMessage(t,l);let h;try{h=yield u}catch(v){throw a.throw(v),(v==null?void 0:v.code)===N.WS_ABORT&&t.forEach(T=>{let{track:A}=T;i.pendingLocalTracks.indexOf(A)===-1&&i.pendingLocalTracks.push(A)}),i.unbindLocalTrackEvents(t),v}const f=i.mapPubResToRemoteConfig(u,h),m=(yield Qe(a.next(f))).value,E=V("ENABLE_VIDEO_SEI");o.forEach(async v=>{const T=v.getRTCRtpTransceiver();T&&E&&(v.trackMediaType===be.VIDEO?await async function(A,C){if(!mt().supportWebRTCEncodedTransform)return void y.warning("browser not support video encoded transform");if(oE.has(A)||!A.track)return;const b={track:A.track};if(ra()){if(!A.createEncodedStreams)return void y.warning("browser not support createEncodedStreams() API");let M=null;try{M=A.createEncodedStreams()}catch(G){return void y.error("create video-encoded-streams error",G&&G.message)}let B=[];C.on("sei-to-send",G=>{B.push(G)});const J=new TransformStream({transform(G,q){b.controller||(b.controller=q),A.track&&A.track.id!==b.track.id&&(y.debug("video track changed: ".concat(b.track.id," => ").concat(A.track.id)),b.track.removeEventListener("ended",D),b.track=A.track,b.track.addEventListener("ended",D));const Q=B.shift();Q&&(G.data=D7(G.data,Q)),q.enqueue(G)}});M.readable.pipeThrough(J).pipeTo(M.writable)}else{if(!ii())return;{if(typeof RTCRtpScriptTransform>"u")return void y.warning("browser not support RTCRtpScriptTransform");const M=iE(),B=new MessageChannel;await new X(G=>M.onmessage=q=>{q.data==="registered"&&G(void 0)});const J=new RTCRtpScriptTransform(M,{name:"tx",port:B.port2},[B.port2]);A.transform=J,await new X(G=>M.onmessage=q=>{q.data==="started"&&G(void 0)}),C.on("sei-to-send",G=>{B.port1.postMessage({sei:G})}),B.port1.onmessage=G=>{var q;G.data.transformed&&A.track&&((q=A.track)===null||q===void 0?void 0:q.id)!==b.track.id&&(y.debug("video track changed: ".concat(b.track.id," => ").concat(A.track.id)),b.track.removeEventListener("ended",D),b.track=A.track,b.track.addEventListener("ended",D))},b.worker=M}}function D(){if(A.track){if(this.id!==A.track.id)return;A.track.removeEventListener("ended",D)}const M=oE.get(A);if(M){oE.delete(A);try{var B,J;(B=M.controller)===null||B===void 0||B.terminate(),(J=M.worker)===null||J===void 0||J.terminate()}catch(G){y.warning(G&&G.message)}}}oE.set(A,b),A.track.addEventListener("ended",D)}(T.sender,v):v.trackMediaType===be.AUDIO&&await async function(A){if(!mt().supportWebRTCEncodedTransform)return void y.warning("browser not support audio encoded transform");if(rE.has(A)||!A.track)return;const C={track:A.track};if(ra()){if(!A.createEncodedStreams)return void y.warning("browser not support createEncodedStreams() API");let D=null;try{D=A.createEncodedStreams()}catch(B){return void y.error("create audio-encoded-streams error",B&&B.message)}const M=new TransformStream({transform(B,J){C.controller||(C.controller=J),A.track&&A.track.id!==C.track.id&&(y.debug("audio track changed: ".concat(C.track.id," => ").concat(A.track.id)),C.track.removeEventListener("ended",b),C.track=A.track,C.track.addEventListener("ended",b)),J.enqueue(B)}});D.readable.pipeThrough(M).pipeTo(D.writable)}else if(ii()){if(typeof RTCRtpScriptTransform>"u")return void y.warning("browser not support RTCRtpScriptTransform");const D=iE(),M=new MessageChannel;await new X(J=>D.onmessage=G=>{G.data==="registered"&&J(void 0)});const B=new RTCRtpScriptTransform(D,{name:"tx",port:M.port2},[M.port2]);A.transform=B,await new X(J=>D.onmessage=G=>{G.data==="started"&&J(void 0)}),M.port1.onmessage=J=>{var G;J.data.transformed&&A.track&&((G=A.track)===null||G===void 0?void 0:G.id)!==C.track.id&&(y.debug("audio track changed: ".concat(C.track.id," => ").concat(A.track.id)),C.track.removeEventListener("ended",b),C.track=A.track,C.track.addEventListener("ended",b))},C.worker=D}function b(){if(A.track){if(this.id!==A.track.id)return;A.track.removeEventListener("ended",b)}const D=rE.get(A);if(D){rE.delete(A);try{var M,B;(M=D.controller)===null||M===void 0||M.terminate(),(B=D.worker)===null||B===void 0||B.terminate()}catch(J){y.warning(J&&J.message)}}}rE.set(A,C),A.track.addEventListener("ended",b)}(T.sender))}),t.forEach(v=>{let{type:T}=v;i.statsCollector.addLocalStats(T)}),i.assignLocalTracks(t,m),i.statsUploader.startUploadOutboundStats(),t.forEach(v=>{let{track:T,type:A}=v;const C=Date.now();i.store.publish(T.getTrackId(),A===ce.LocalAudioTrack?"audio":"video",void 0,C)})})()}async updateVideoStreamParameter(e,t){const i=this.localTrackMap.get(t);if(!i)return;if(!(i.track instanceof et))return y.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(this.connection instanceof cn||this.connection instanceof ei))return y.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");const{track:o}=i,a=function(l,u){const h={};return l.height&&l.width&&(h.scaleResolutionDownBy=Ey(l,u)),h.maxFramerate=l.framerate?xr(l.framerate):void 0,h.maxBitrate=l.bitrate?1e3*l.bitrate:void 0,h}(e,o);if(o._encoderConfig||(o._encoderConfig={}),t!==ce.LocalVideoLowTrack||!V("DISABLE_DUAL_STREAM_USE_ENCODING")&&mt().supportDualStreamEncoding)a.scaleResolutionDownBy!=null&&(o._encoderConfig.scaleResolutionDownBy=a.scaleResolutionDownBy);else{const l=o._originMediaStreamTrack;if(!l.canvas)return y.warn("[".concat(o.getTrackId(),"] no canvas on track"));(function(u,h){const f=u.canvas;h.width&&(f.width=xr(h.width)),h.height&&(f.height=xr(h.height)),h.framerate&&(f.stopCapture&&f.stopCapture(),f.stopCapture=Ly(()=>{!f.startCapture&&f.stopCapture&&f.stopCapture(),f.startCapture&&f.startCapture()},xr(h.framerate)))})(l,e)}a.maxBitrate!=null&&(o._encoderConfig.bitrateMax=a.maxBitrate/1e3),a.maxFramerate!=null&&(o._encoderConfig.frameRate&&typeof o._encoderConfig.frameRate=="object"?o._encoderConfig.frameRate.max=a.maxFramerate:o._encoderConfig.frameRate={max:a.maxFramerate}),y.debug("[".concat(o.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(o._encoderConfig))),await this.connection.updateRtpSenderEncodings(o)}publishLowStream(e){var t=this;return Tr(function*(){if(!t.connection||t.state!==Tt.Connected)return;const i=yield Qe(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const a=t.localTrackMap.get(ce.LocalVideoTrack);if(!a)throw new ne(N.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(ce.LocalVideoLowTrack))throw new ne(N.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const l=[{track:t.getLowVideoTrack(a.track,e),type:ce.LocalVideoLowTrack}];if(yield*hE(RM(t.doPublish(t.connection,l))),a.track.muted||!a.track.enabled){var o;const u=(o=t.localTrackMap.get(ce.LocalVideoLowTrack))===null||o===void 0?void 0:o.id;u!==void 0&&(yield Qe(t.connection.muteLocal([u])))}}finally{i()}})()}async republish(){this.pendingLocalTracks.length>0&&(y.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Sn(this,Me.RequestRePublish,this.pendingLocalTracks),this.emit(Me.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(y.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Sn(this,Me.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[])}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:i,kind:o}=this.pendingRemoteTracks[t];(o!==be.AUDIO||i._audio_added_&&i._audioSSRC)&&(o!==be.VIDEO||i._video_added_&&i._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await Sn(this,Me.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:i}of this.pendingRemoteTracks)await this.subscribe(t,i,i===be.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:i}=t;this.emit(Me.MediaReconnectEnd,i.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Tt.Connected)return void e.forEach(o=>{const a=this.pendingLocalTracks.indexOf(o);a!==-1&&this.pendingLocalTracks.splice(a,1)});const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const i=t.find(o=>o[0]==="videoLowTrack");return i&&i[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==Tt.Connected)return void e.forEach(i=>{const o=this.pendingLocalDataChannels.indexOf(i);o!==-1&&this.pendingLocalDataChannels.splice(o,1)});const t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(i=>{const o=this.localDataChannels.indexOf(i);o!==-1&&this.localDataChannels.splice(o,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(i=>i.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Tt.Connected)return;const e=this.localTrackMap.get(ce.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[ce.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const i=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(o=>{let[,{id:a}]=o;return a})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(o=>{let[a,{track:l}]=o;return{type:a,track:l}})),t.forEach(o=>{let[a]=o;this.statsCollector.removeLocalStats(a)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),i}async subscribeDataChannel(e,t){if(!this.connection||this.state!==Tt.Connected)throw new ne(N.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const i=t.filter(o=>{var a;return!((a=this.remoteDataChannelMap.get(e))!==null&&a!==void 0&&a.get(o.id))});if(i.length!==0)return await this.connection.createDataChannels(e.uid,i),i.forEach(o=>{var a;this.remoteDataChannelMap.has(e)?(a=this.remoteDataChannelMap.get(e))===null||a===void 0||a.set(o.id,o):this.remoteDataChannelMap.set(e,new Map([[o.id,o]]));const l=this.pendingRemoteDataChannels.findIndex(u=>{let{user:h,id:f}=u;return h.uid===e.uid&&f===o.id});l!==-1&&this.pendingRemoteDataChannels.splice(l,1)}),i.map(o=>o.id)}async subscribe(e,t,i,o,a){var l;if(!this.connection||this.state!==Tt.Connected)throw new ne(N.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((l=this.remoteUserMap.get(e))!==null&&l!==void 0&&l.has(t))return;let u,h,f;if(a){const v=a.find(A=>{let{stream_type:C}=A;return C===t});if(!v)throw new ne(N.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const T=await this.connection.receive(t,v.ssrcs,String(e._uintid),v.attributes);this.connection instanceof cn&&(f=T.transceiver),u=T.track,h=T.id}else{const v=await this.connection.receive(t,[{ssrcId:i,rtx:o}],String(e._uintid),void 0);this.connection instanceof cn&&(f=v.transceiver),u=v.track,h=v.id}t===be.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(u):(e._audioTrack=new Ps(u,e.uid,e._uintid,this.store),y.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),f&&e._audioTrack._updateRtpTransceiver(f),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(u):(e._videoTrack=new Lo(u,e.uid,e._uintid,this.store),y.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),f&&e._videoTrack._updateRtpTransceiver(f),this.bindRemoteTrackEvents(e,e._videoTrack)),V("ENABLE_VIDEO_SEI")&&f&&(t==be.VIDEO?await k7(f.receiver,{onSei:v=>{var T;(T=e._videoTrack)===null||T===void 0||T._onSei(v)}}):t==be.AUDIO&&await N7(f.receiver));const m=this.remoteUserMap.get(e);m?m.set(t,h):this.remoteUserMap.set(e,new Map([[t,h]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const E=this.pendingRemoteTracks.findIndex(v=>{let{user:T,kind:A}=v;return T.uid===e.uid&&t===A});E!==-1&&(this.pendingRemoteTracks.splice(E,1),this.emit(Me.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Tt.Connected)throw new ne(N.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(i=>{var o;let{user:a,mediaType:l}=i;return!((o=this.remoteUserMap.get(a))!==null&&o!==void 0&&o.has(l))});const t=await this.connection.batchReceive(e.map(i=>{let{user:o,mediaType:a,ssrcId:l,rtxSsrcId:u}=i;return{kind:a,ssrcMsg:[{ssrcId:l,rtx:u}],mslabel:String(o._uintid)}}));e.forEach((i,o)=>{let{user:a,mediaType:l}=i;const{track:u,id:h,transceiver:f}=t[o];l===be.AUDIO?(a._audioTrack?a._audioTrack._updateOriginMediaStreamTrack(u):(a._audioTrack=new Ps(u,a.uid,a._uintid,this.store),y.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(a._audioTrack.getTrackId()))),f&&a._audioTrack._updateRtpTransceiver(f),this.bindRemoteTrackEvents(a,a._audioTrack)):(a._videoTrack?a._videoTrack._updateOriginMediaStreamTrack(u):(a._videoTrack=new Lo(u,a.uid,a._uintid,this.store),y.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(a._videoTrack.getTrackId()))),f&&a._videoTrack._updateRtpTransceiver(f),this.bindRemoteTrackEvents(a,a._videoTrack));const m=this.remoteUserMap.get(a);m?m.set(l,h):this.remoteUserMap.set(a,new Map([[l,h]])),this.statsCollector.addRemoteStats(a.uid),this.statsUploader.startUploadInboundStats();const E=this.pendingRemoteTracks.findIndex(v=>{let{user:T,kind:A}=v;return T.uid===a.uid&&l===A});E!==-1&&(this.pendingRemoteTracks.splice(E,1),this.emit(Me.MediaReconnectEnd,a.uid))})}async unsubscribe(e,t,i){const o=this.pendingRemoteTracks.filter(u=>{let{user:h,kind:f}=u;return t!==void 0?h.uid===e.uid&&t===f:h.uid===e.uid});if(o.forEach(u=>{const h=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(h,1)}),this.connection&&this.state===Tt.Connected||i||o.forEach(u=>{let{kind:h}=u;var f;if(h===be.AUDIO)(f=e._audioTrack)===null||f===void 0||f._destroy(),e._audioTrack=void 0;else if(h===be.VIDEO){var m;(m=e._videoTrack)===null||m===void 0||m._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==Tt.Connected)return;const a=this.filterTobeUnSubscribedTracks(e,t);if(a.length===0)return;await this.connection.stopReceiving(a.map(u=>{let[,{id:h}]=u;return h}));const l=this.createUnsubscribeMessage(a);return this.withdrawRemoteTracks(a),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),a.forEach(u=>{let[h,{kind:f}]=u;var m,E;if(f===be.VIDEO&&h._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),f===be.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),i||((E=h._videoTrack)===null||E===void 0||E._destroy(),h._videoTrack=void 0);else if(f===be.AUDIO){var v;this.unbindRemoteTrackEvents(h._audioTrack),!i&&((v=h._audioTrack)===null||v===void 0||v._destroy(),h._audioTrack=void 0)}}),l}async unsubscribeDataChannel(e,t){if(t.forEach(a=>{const l=this.pendingRemoteDataChannels.findIndex(u=>u.id===a.id);l!==-1&&this.pendingRemoteDataChannels.splice(l,1)}),!this.connection)return;const i=this.filterTobeUnSubscribedDataChannels(e,t);if(i.length===0)return;t.forEach(a=>{a._close()});const o=this.remoteDataChannelMap.get(e);return i.forEach(a=>{o&&o.delete(a.id)}),o&&o.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),i.map(a=>a.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:a,mediaType:l}of e){const u=this.pendingRemoteTracks.filter(h=>{let{user:f,kind:m}=h;return l!==void 0?f.uid===a.uid&&l===m:f.uid===a.uid});u.forEach(h=>{const f=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(f,1)}),t=t.concat(u)}if(!this.connection||this.state!==Tt.Connected)return void t.forEach(a=>{let{user:l,kind:u}=a;var h;if(u===be.AUDIO)(h=l._audioTrack)===null||h===void 0||h._destroy(),l._audioTrack=void 0;else if(u===be.VIDEO){var f;(f=l._videoTrack)===null||f===void 0||f._destroy(),l._videoTrack=void 0}});const i=ca(e).call(e,(a,l)=>{let{user:u,mediaType:h}=l;const f=this.filterTobeUnSubscribedTracks(u,h);return a.concat(f)},[]);if(i.length===0)return;await this.connection.stopReceiving(i.map(a=>{let[,{id:l}]=a;return l}));const o=this.createUnsubscribeAllMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(a=>{let[l,{kind:u}]=a;var h,f;if(u===be.VIDEO&&l._videoSSRC&&((h=this.connection)===null||h===void 0||h.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),u===be.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),(f=l._videoTrack)===null||f===void 0||f._destroy(),l._videoTrack=void 0;else if(u===be.AUDIO){var m;this.unbindRemoteTrackEvents(l._audioTrack),(m=l._audioTrack)===null||m===void 0||m._destroy(),l._audioTrack=void 0}}),o}async muteRemote(e,t){if(!this.connection)return;const i=this.remoteUserMap.get(e);if(!i)return void y.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(t))return void y.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const o=t===be.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.connection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const i=this.remoteUserMap.get(e);if(!i)return void y.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(t)||y.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(ce.LocalAudioTrack);if((t==null?void 0:t.track)instanceof In){const i=t.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[a]=o;return a!==ce.LocalAudioTrack}).filter(o=>{let[a]=o;return!(e&&a===ce.LocalVideoLowTrack)}).map(o=>{let[,{track:a}]=o;return a}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return!(e&&o===ce.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,i,o,a){if(e){const u=this.localTrackMap.get(ce.LocalAudioTrack),h=o?this.localTrackMap.get(ce.LocalVideoLowTrack):this.localTrackMap.get(ce.LocalVideoTrack);Oe.publish(this.store.sessionId,{eventElapse:Ei.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:u==null?void 0:u.track.getTrackLabel(),videoName:h==null?void 0:h.track.getTrackLabel(),screenshare:(h==null?void 0:h.track._hints.indexOf(Ut.SCREEN_TRACK))!==-1,audio:!!u,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}else{var l;i||(i=[]);const u=i.find(f=>f instanceof bt),h=o?(l=this.localTrackMap.get(ce.LocalVideoTrack))===null||l===void 0?void 0:l.track:i.find(f=>f instanceof et);Oe.publish(this.store.sessionId,{eventElapse:Ei.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:u==null?void 0:u.getTrackLabel(),videoName:h==null?void 0:h.getTrackLabel(),screenshare:(h==null?void 0:h._hints.indexOf(Ut.SCREEN_TRACK))!==-1,audio:!!u,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}}reportSubscribeEvent(e,t,i,o){const a=o===be.VIDEO?i._videoSSRC:i._audioSSRC;a&&Oe.subscribe(this.store.sessionId,{succ:e,ec:t,video:o===be.VIDEO,audio:o===be.AUDIO,peerid:i.uid,subscribeRequestid:o===be.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:Ei.measureFromSubscribeStart(this.store.clientId,a)})}reset(){y.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Qn("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new xn({},this.store):this.isPlanB?new ei({},this.store):new cn({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(ce.LocalAudioTrack);if((e==null?void 0:e.track)instanceof In){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(i=>{t.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Tt.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(ce.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(ce.LocalVideoTrack);if(e)return{width:e.track._videoWidth||0,height:e.track._videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof et||t&&t.track instanceof bt?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!t||i.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!t||i.has(t))}getRemoteMedia(e){var t;const i=Array.from(Dr(t=this.remoteUserMap).call(t)).find(o=>o.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[o]=i;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(ce.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=kh(e).call(e,(i,o)=>i.level-o.level),e}async disconnectForReconnect(){this.connection&&(y.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Tt.Reconnecting,V("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var i;t._videoTrack&&t._videoTrack._player&&((i=t._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new xn({},this.store):this.isPlanB?new ei({},this.store):new cn({},this.store),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[i,{track:o}]=e;switch(i){case ce.LocalVideoTrack:Ie(t=o._hints).call(t,Ut.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case ce.LocalAudioTrack:o instanceof In?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case ce.LocalVideoLowTrack:}}),this.emit(Me.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,i]=e;Array.from(Dr(i).call(i)).forEach(o=>{this.setPendingRemoteMedia(t,o)}),this.emit(Me.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,i]=e;Array.from(Dr(i).call(i)).forEach(o=>{this.setPendingRemoteDataChannel(t,o)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),y.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const i of this.pendingRemoteDataChannels){const{user:o,id:a}=i;if((e instanceof si?e.uid:e)===o.uid&&a===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const i of this.pendingRemoteTracks){const{user:o,kind:a}=i;if((e instanceof si?e.uid:e)===o.uid&&t===a)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return Tr(function*(){if(!t.connection||t.state!==Tt.Connected||t.connection instanceof xn)return;const i=yield Qe(t.mutex.lock("From P2PChannel.restartICE"));let o;try{o=yield Qe(t.connection.restartICE(e));const l=yield Qe(o.next());if(l.done)return;const u=l.value,h=yield u;switch(t.reportPCDisconnectedOrFailed(e),e){case mi.TCP:t._pcStatsUploadType=ro.TCP_RESTART;break;case mi.RELAY:t._pcStatsUploadType=ro.RELAY_RESTART;break;default:t._pcStatsUploadType=ro.OLD_RESTART}t._isInRestartIce=!0,o.next(h)}catch(l){var a;(a=o)===null||a===void 0||a.throw(l)}finally{i()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(ce.LocalVideoTrack),i=this.localTrackMap.get(ce.LocalAudioTrack),o=e.videoSend.find(A=>A.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),a=e.audioSend.find(A=>A.ssrc===(i==null?void 0:i.ssrcs[0].ssrcId));if(!o||!a)return 1;const l=Er(this,Me.NeedSignalRTT),u=o?o.rttMs:void 0,h=a?a.rttMs:void 0,f=u&&h?(u+h)/2:u||h,m=(f&&l?(f+l)/2:f||l)||0,E=100*e.sendPacketLossRate*.7/50+.3*m/1500,v=E<.17?1:E<.36?2:E<.59?3:E<.1?4:5,T=t==null?void 0:t.track;if(T&&T._encoderConfig&&T._hints.indexOf(Ut.SCREEN_TRACK)===-1){const A=T._encoderConfig.bitrateMax,C=e.bitrate.actualEncoded;if(A&&C){const b=(1e3*A-C)/(1e3*A);return R1[b<.15?0:b<.3?1:b<.45?2:b<.6?3:4][v]}}return v}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[o]=i;const a=o._audioSSRC,l=o._videoSSRC,u=e.audioRecv.find(C=>C.ssrc===a),h=e.videoRecv.find(C=>C.ssrc===l);if(!u&&!h)return void(t+=1);const f=Er(this,Me.NeedSignalRTT),m=e.rtt,E=(m&&f?(m+f)/2:m||f)||0,v=u?u.jitterMs:void 0,T=e.recvPacketLossRate;let A=.7*T*100/50+.3*E/1500;v&&(A=.6*T*100/50+.2*E/1500+.2*v/400),t+=A<.1?1:A<.17?2:A<.36?3:A<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new X((t,i)=>{this.handleMuteLocalTrack(e,t,i)})}async replaceTrack(e,t){var i;if(y.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==Tt.Connected)return;const o=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:u}]=l;return e===u});if(!o)return;const a=o[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:a}]),this.bindLocalTrackEvents([{track:t,type:a}]),o[1].track=t),await((i=this.connection)===null||i===void 0?void 0:i.replaceTrack(t,o[1].id)),this.isPlanB){const l=o[1];l.id=t._mediaStreamTrack.id,this.localTrackMap.set(a,l)}if(a===ce.LocalVideoTrack&&!V("DISABLE_DUAL_STREAM_USE_ENCODING")&&mt().supportDualStreamEncoding){const l=this.localTrackMap.get(ce.LocalVideoLowTrack);if(l){const u=e._mediaStreamTrack.clone();l.track._originMediaStreamTrack.stop(),l.track._mediaStreamTrack=u,l.track._originMediaStreamTrack=u,await new X((h,f)=>{this.handleReplaceTrack(l.track,h,f,!0)})}}}filterTobePublishedTracks(e,t,i){const o=[],a=this.getAllTracks();e=Ud(e=e.filter(f=>a.indexOf(f)===-1));let l,u=!1;const h=this.localTrackMap.get(ce.LocalAudioTrack);for(const f of e){if(f instanceof et&&(this.localTrackMap.has(ce.LocalVideoTrack)||u?new ne(N.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:f,type:ce.LocalVideoTrack}),u=!0),t)){const m=this.getLowVideoTrack(f,i);o.push({track:m,type:ce.LocalVideoLowTrack})}if(f instanceof bt)if(h){const m=h.track;if(m instanceof In)eR([f]),m.addAudioTrack(f),this.bindLocalAudioTrackEvents(f,!0);else{const E=tR([m,f]);y.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(E.getTrackId(),"]")),this.replaceTrack(m,E)}}else l instanceof In?(eR([f]),l.addAudioTrack(f)):l||!f._useAudioElement&&mt().webAudioMediaStreamDest&&!f._bypassWebAudio?l=tR(l?[f,l]:[f]):l=f}return l&&(y.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(l.getTrackId(),"]")),o.push({track:l,type:ce.LocalAudioTrack})),o}filterTobeUnpublishedTracks(e){const t=[],i=this.getAllTracks();e=Ud(e=e.filter(o=>i.indexOf(o)!==-1));for(const o of e){if(o instanceof bt){const a=this.localTrackMap.get(ce.LocalAudioTrack);if(!a)continue;a.track instanceof In?(a.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),a.track.trackList.length===0&&(t.push([ce.LocalAudioTrack,a]),a.track.close())):t.push([ce.LocalAudioTrack,a])}if(o instanceof et){const a=this.localTrackMap.get(ce.LocalVideoTrack);if(!a)continue;t.push([ce.LocalVideoTrack,a]);const l=this.localTrackMap.get(ce.LocalVideoLowTrack);l&&t.push([ce.LocalVideoLowTrack,l])}}return t}filterTobePublishedDataChannels(e){return e=(e=Ud(e)).filter(t=>this.localDataChannels.findIndex(i=>i.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=Ud(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:i,type:o}=t;switch(o){case ce.LocalVideoTrack:i.addListener(Te.GET_STATS,this.handleGetLocalVideoStats),i.addListener(Te.GET_RTC_STATS,this.handleGetRTCStats),i.addListener(Te.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(Te.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(Te.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(Te.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),i.addListener(Te.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(Te.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(Te.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ce.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case ce.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof In?e.trackList.forEach(i=>{i.addListener(Te.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(Te.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(Te.GET_STATS,this.handleGetLocalAudioStats),i.addListener(Te.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(Te.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Te.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Te.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Te.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Te.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Te.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(Te.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(Te.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[i,{track:o}]=t;return{track:o,type:i}})),e.forEach(t=>{let{track:i,type:o}=t;switch(o){case ce.LocalVideoTrack:i.off(Te.GET_STATS,this.handleGetLocalVideoStats),i.off(Te.GET_RTC_STATS,this.handleGetRTCStats),i.off(Te.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(Te.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(Te.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(Te.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),i.off(Te.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(Te.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(Te.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ce.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case ce.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof In?e.trackList.forEach(t=>{t.off(Te.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Te.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Te.GET_STATS,this.handleGetLocalAudioStats),t.off(Te.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Te.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Te.GET_STATS,this.handleGetLocalAudioStats),e.off(Te.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Te.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Te.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Te.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(Te.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Te.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Lo&&t.addListener(Te.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),t instanceof Ps&&t.addListener(Te.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Te.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,i]=e;i.has(be.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),i.has(be.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((i,o)=>{var a;let l,u,{track:h,type:f}=i;switch(f){case ce.LocalAudioTrack:l=vt.Audio,u={dtx:h instanceof Al&&h._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case ce.LocalVideoTrack:l=Ie(a=h._hints).call(a,Ut.SCREEN_TRACK)?vt.Screen:vt.High,u=Oc(Oc({},H1(h)),{},{codec:this.store.codec});break;case ce.LocalVideoLowTrack:l=vt.Low,u=Oc(Oc({},H1(h)),{},{codec:this.store.codec})}return{stream_type:l,attributes:u,ssrcs:t[o]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var i;let o,[a,{track:l,ssrcs:u,id:h}]=t;switch(a){case ce.LocalVideoTrack:o=Ie(i=l._hints).call(i,Ut.SCREEN_TRACK)?vt.Screen:vt.High;break;case ce.LocalAudioTrack:o=vt.Audio;break;case ce.LocalVideoLowTrack:o=vt.Low}return{stream_type:o,ssrcs:u,mid:h}})}assignLocalTracks(e,t){e.forEach((i,o)=>{let{track:a,type:l}=i;this.localTrackMap.set(l,{track:a,id:t[o].id,ssrcs:t[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[i]=t;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(Me.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),V("NEW_ICE_RESTART")){var i;if(Ie(i=this._restartStates).call(i,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const o=u=>{(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")&&(y.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(u)),Er(this,Me.QueryClientConnectionState)==="CONNECTED"&&this.emit(Me.RequestRestartICE,u))},a=()=>{e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="checking"&&e.iceConnectionState!=="failed"||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),y.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Me.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},l=V("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout(()=>{if(V("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&mt().supportPCSetConfiguration)o(mi.RELAY),this._restartTimer=window.setTimeout(a,l);else if(Pt())o(mi.UDP),this._restartTimer=window.setTimeout(a,4e3);else{if(o(mi.TCP),mt().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout(()=>{o(mi.RELAY),this._restartTimer=window.setTimeout(a,l)},l));this._restartTimer=window.setTimeout(a,l)}},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&V("ICE_RESTART")&&Er(this,Me.QueryClientConnectionState)==="CONNECTED"&&this.emit(Me.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(y.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout(()=>this.emit(Me.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(y.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout(()=>this.emit(Me.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),Oe.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Qt.TRACER}).onSuccess(),this.emit(Me.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var i;const o=Array.from(Dr(i=this.remoteUserMap).call(i)).find(l=>l._audioSSRC===t);var a;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(a=o.audioTrack)===null||a===void 0||a.emit(_c.FIRST_FRAME_DECODED),Oe.firstRemoteFrame(this.store.sessionId,Dn.FIRST_AUDIO_DECODE,Gt.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:Ei.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var i;const o=Array.from(Dr(i=this.remoteUserMap).call(i)).find(a=>a._audioSSRC===t);o&&Oe.firstRemoteFrame(this.store.sessionId,Dn.FIRST_AUDIO_RECEIVED,Gt.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:Ei.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,i,o)=>{this.reportVideoFirstFrameDecoded(t,i,o)},e.onFirstVideoReceived=t=>{var i;const o=Array.from(Dr(i=this.remoteUserMap).call(i)).find(a=>a._videoSSRC===t);o&&Oe.firstRemoteFrame(this.store.sessionId,Dn.FIRST_VIDEO_RECEIVED,Gt.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:Ei.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,i)=>{const o=t.candidateType==="relay",a=i.candidateType==="relay";i.candidateType!=="unknown"&&o===a||this.emit(Me.ConnectionTypeChange,o),y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(hc(i))," -> ").concat(JSON.stringify(hc(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,i)=>{y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(hc(i))," -> ").concat(JSON.stringify(hc(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const i=this.localTrackMap.get(ce.LocalAudioTrack);if(e instanceof bt&&(i==null?void 0:i.track)instanceof In)return i.track.isActive||t.push([ce.LocalAudioTrack,i]),t;const o=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:l}]=a;return e===l});if(o&&(t.push(o),o[0]===ce.LocalVideoTrack)){const a=this.localTrackMap.get(ce.LocalVideoLowTrack);a&&t.push([ce.LocalVideoLowTrack,a])}return t}filterTobeUnmutedTracks(e){const t=[],i=this.localTrackMap.get(ce.LocalAudioTrack);if(e instanceof bt&&(i==null?void 0:i.track)instanceof In)return i.track.isActive&&t.push([ce.LocalAudioTrack,i]),t;const o=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:l}]=a;return e===l});if(o)if(o[0]===ce.LocalVideoTrack){t.push(o);const a=this.localTrackMap.get(ce.LocalVideoLowTrack);a&&t.push([ce.LocalVideoLowTrack,a])}else t.push(o);return t}createMuteMessage(e){return e.map(t=>{var i;let o,[a,{track:l,ssrcs:u,id:h}]=t;switch(a){case ce.LocalAudioTrack:o=vt.Audio;break;case ce.LocalVideoTrack:o=Ie(i=l._hints).call(i,Ut.SCREEN_TRACK)?vt.Screen:vt.High;break;case ce.LocalVideoLowTrack:o=vt.Low}return{stream_type:o,ssrcs:u,mid:h}})}createUnmuteMessage(e){return e.map(t=>{var i;let o,[a,{track:l,ssrcs:u,id:h}]=t;switch(a){case ce.LocalAudioTrack:o=vt.Audio;break;case ce.LocalVideoTrack:o=Ie(i=l._hints).call(i,Ut.SCREEN_TRACK)?vt.Screen:vt.High;break;case ce.LocalVideoLowTrack:o=vt.Low}return{stream_type:o,ssrcs:u,mid:h}})}filterTobeUnSubscribedTracks(e,t){const i=[],o=this.remoteUserMap.get(e);if(!o)return i;if(t){const a=o.get(t);if(!a)return i;i.push([e,{kind:t,id:a}])}else Array.from(o.entries()).forEach(a=>{let[l,u]=a;i.push([e,{kind:l,id:u}])});return i}filterTobeUnSubscribedDataChannels(e,t){const i=[];return t.forEach(o=>{var a;(a=this.remoteDataChannelMap.get(e))!==null&&a!==void 0&&a.has(o.id)&&i.push(o)}),i}createUnsubscribeMessage(e){const t=[];return e.forEach(i=>{let[o,{kind:a,id:l}]=i;switch(a){case be.VIDEO:return void(o._videoSSRC&&t.push({stream_type:be.VIDEO,ssrcId:o._videoSSRC}));case be.AUDIO:return void(o._audioSSRC&&t.push({stream_type:be.AUDIO,ssrcId:o._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(i=>{let[o,{kind:a}]=i;if(t.has(o)){let l=t.get(o);a===be.VIDEO?l|=Cn.Video:l|=Cn.Audio,t.set(o,l)}else a===be.VIDEO?t.set(o,Cn.Video):t.set(o,Cn.Audio)}),{users:Array.from(t.entries()).map(i=>{let[o,a]=i;return{stream_id:o.uid,stream_type:a}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[i,{kind:o}]=t;const a=this.remoteUserMap.get(i);a&&(a.delete(o),Array.from(a.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(ce.LocalVideoTrack),i=this.localTrackMap.get(ce.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),i&&e.low_stream_uplink&&await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,t){return e.map((i,o)=>{var a;let{stream_type:l}=i;return(a=t.find(u=>{let{stream_type:h}=u;return l===h}))===null||a===void 0?void 0:a.attributes})}async tryToUnmuteAudio(e){for(let i=0;i<e.length;i++)if(e[i]instanceof bt){var t;const o=this.filterTobeUnmutedTracks(e[i]);if(o.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(o.map(l=>{let[,{id:u}]=l;return u})));const a=this.createUnmuteMessage(o);return void await Dt(this,Me.RequestUnmuteLocal,a)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Me.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Me.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Xn(n_(this.dtlsFailedCount,yn)),this.emit(Me.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await Sn(this,Me.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(Me.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(ce.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof et)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof et).length>1)throw new ne(N.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof bt).length>1&&(e.some(t=>t instanceof bt&&t._bypassWebAudio)||!mt().webAudioMediaStreamDest))throw new ne(N.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof et&&this.pendingLocalTracks.some(i=>i instanceof et))throw new ne(N.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof bt&&this.pendingLocalTracks.some(i=>i instanceof bt)&&(!mt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof bt&&i._bypassWebAudio)))throw new ne(N.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const i=!V("DISABLE_DUAL_STREAM_USE_ENCODING")&&mt().supportDualStreamEncoding,o=Oc(Oc({},{width:160,height:120,framerate:15,bitrate:50}),t);let a;a=i?e._mediaStreamTrack.clone():Q0(e,o);const l=Lt(8,"track-low-"),u=new et(a,Oc(Oc({},i&&{scaleResolutionDownBy:Ey(o,e)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,l);return u.on(fc.TRANSCEIVER_UPDATED,h=>{e._updateRtpTransceiver(h,pc.LOW_STREAM)}),u._hints.push(Ut.LOW_STREAM),e.on("sei-to-send",h=>{u.emit("sei-to-send",h)}),e.addListener(Te.NEED_CLOSE,()=>{u.close()}),u}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,i){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof cn){var a,l,u,h;const f=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:m,dtlsTransportState:E,peerConnectionState:v}=this.connection,{local:T,remote:A}=await this.connection.getSelectedCandidatePair();Oe.pcStats(this.store.sessionId,{startTime:f,eventElapse:e-f||0,iceconnectionsate:m,dtlsstate:E,connectionstate:v,intSucc:t?1:2,error:o,selectedLocalCandidateProtocol:(a=T==null?void 0:T.protocol)!==null&&a!==void 0?a:"",selectedLocalCandidateType:(l=T.candidateType)!==null&&l!==void 0?l:"",selectedLocalCandidateAddress:"".concat(T.address,":").concat(T.port),selectedRemoteCandidateProtocol:(u=A.protocol)!==null&&u!==void 0?u:"",selectedRemoteCandidateType:(h=A.candidateType)!==null&&h!==void 0?h:"",selectedRemoteCandidateAddress:"".concat(A.address,":").concat(A.port),restartCnt:i})}}reportVideoFirstFrameDecoded(e,t,i,o){var a;const l=Array.from(Dr(a=this.remoteUserMap).call(a)).find(u=>u._videoSSRC===e);if(l){o||this.store.subscribe(l.uid,"video",void 0,void 0,void 0,void 0,Date.now());const u=this.store.keyMetrics,h=u.subscribe.find(f=>f.userId===l.uid&&f.type==="video");Oe.firstRemoteVideoDecode(this.store.sessionId,Dn.FIRST_VIDEO_DECODE,Gt.FIRST_VIDEO_DECODE,{peer:l._uintid,videowidth:t,videoheight:i,subscribeElapse:Ei.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:u.requestAPEnd||0,apStart:u.requestAPStart||0,joinGwEnd:u.joinGatewayEnd||0,joinGwStart:u.joinGatewayStart||0,pcEnd:u.peerConnectionEnd||0,pcStart:u.peerConnectionStart||0,subscriberEnd:(h==null?void 0:h.subscribeEnd)||0,subscriberStart:(h==null?void 0:h.subscribeStart)||0,videoAddNotify:(h==null?void 0:h.streamAdded)||0,state:o?1:0})}}async remoteMediaSsrcChanged(e,t,i){if(!this.connection)return!1;const o=this.remoteUserMap.get(e);if(!o)return!1;const a=o.get(t);if(!a)return!1;const l=await this.connection.getRemoteSSRC(a);return l!==void 0&&l!==i}resetConnection(e){y.debug("[".concat(this.store.clientId,"] [P2PChannel] reset connection to ").concat(e)),this.state===Tt.Connected?(y.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=e===__.datachannel?new xn({},this.store):this.isPlanB?new ei({},this.store):new cn({},this.store),this.bindConnectionEvents(this.connection)))}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:i}]=e;t===ce.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,pc.LOW_STREAM):i._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(e){this.connection&&this.connection instanceof cn&&(this.connection.iceConnectionState!=="disconnected"&&this.connection.iceConnectionState!=="checking"&&this.connection.iceConnectionState!=="failed"||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===ro.TCP_RESTART&&e===mi.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,ro.DISCONNECTED_OR_FAILED)))}}function Ni(n,e,t){const i=n[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return t.value=async function(){const o=this.mutex,a=await o.lock("From P2PChannel.".concat(e));try{for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return await i.apply(this,u)}finally{a()}},t}function sq(n){let e=wM();return function(t,i){let o=t.appId;o!==void 0&&(Rt(i,10),Go(i,o));let a=t.cid;a!==void 0&&(Rt(i,16),Rt(i,a));let l=t.cname;l!==void 0&&(Rt(i,26),Go(i,l));let u=t.deviceId;u!==void 0&&(Rt(i,34),Go(i,u));let h=t.elapse;h!==void 0&&(Rt(i,40),Nc(i,h));let f=t.fileSize;f!==void 0&&(Rt(i,48),Nc(i,gu(f)));let m=t.height;m!==void 0&&(Rt(i,56),Nc(i,gu(m)));let E=t.jpg;E!==void 0&&(Rt(i,66),Rt(i,E.length),function(Rr,se){let he=vu(Rr,se.length);Rr.bytes.set(se,he)}(i,E));let v=t.networkType;v!==void 0&&(Rt(i,72),Nc(i,gu(v)));let T=t.osType;T!==void 0&&(Rt(i,80),Nc(i,gu(T)));let A=t.requestId;A!==void 0&&(Rt(i,90),Go(i,A));let C=t.sdkVersion;C!==void 0&&(Rt(i,98),Go(i,C));let b=t.sequence;b!==void 0&&(Rt(i,104),Nc(i,gu(b)));let D=t.sid;D!==void 0&&(Rt(i,114),Go(i,D));let M=t.timestamp;M!==void 0&&(Rt(i,120),Nc(i,M));let B=t.uid;B!==void 0&&(Rt(i,128),Rt(i,B));let J=t.vid;J!==void 0&&(Rt(i,136),Rt(i,J));let G=t.width;G!==void 0&&(Rt(i,144),Nc(i,gu(G)));let q=t.service;q!==void 0&&(Rt(i,152),Rt(i,q));let Q=t.callbackData;Q!==void 0&&(Rt(i,162),Go(i,Q));let $=t.jpgEncryption;$!==void 0&&(Rt(i,168),Rt(i,$));let ue=t.requestType;ue!==void 0&&(Rt(i,176),Rt(i,ue));let Ee=t.scorePorn;Ee!==void 0&&(Rt(i,185),cR(i,Ee));let Ye=t.scoreSexy;Ye!==void 0&&(Rt(i,193),cR(i,Ye));let st=t.scoreNeutral;st!==void 0&&(Rt(i,201),cR(i,st));let Vt=t.scene;Vt!==void 0&&(Rt(i,208),Rt(i,Vt));let wn=t.ossFilePrefix;wn!==void 0&&(Rt(i,218),Go(i,wn));let Wt=t.serviceVendor;if(Wt!==void 0)for(let Rr of Wt){Rt(i,226);let se=wM();cq(Rr,se),Rt(i,se.limit),hq(i,se),uq(se)}}(n,e),function(t){let i=t.bytes,o=t.limit;return i.length===o?i:i.subarray(0,o)}(e)}function oq(n){return function(t){let i={};e:for(;!bM(t);){let o=Wo(t);switch(o>>>3){case 0:break e;case 1:i.code=Wo(t);break;case 2:i.msg=AM(t,Wo(t));break;case 3:{let a=lq(t);i.data=aq(t),t.limit=a;break}default:CM(t,7&o)}}return i}({bytes:e=n,offset:0,limit:e.length});var e}function aq(n){let e={};e:for(;!bM(n);){let t=Wo(n);switch(t>>>3){case 0:break e;case 1:e.requestId=AM(n,Wo(n));break;case 2:e.requestType=Wo(n)>>>0;break;case 3:e.scorePorn=aR(n);break;case 4:e.scoreSexy=aR(n);break;case 5:e.scoreNeutral=aR(n);break;case 6:e.requestScene=Wo(n)>>>0;break;case 7:e.scene=Wo(n)>>>0;break;default:CM(n,7&t)}}return e}function cq(n,e){let t=n.service;t!==void 0&&(Rt(e,8),Rt(e,t));let i=n.vendor;i!==void 0&&(Rt(e,16),Rt(e,i));let o=n.token;o!==void 0&&(Rt(e,26),Go(e,o));let a=n.callbackUrl;a!==void 0&&(Rt(e,34),Go(e,a))}function lq(n){let e=Wo(n),t=n.limit;return n.limit=n.offset+e,t}function CM(n,e){switch(e){case 0:for(;128&OM(n););break;case 2:sR(n,Wo(n));break;case 5:sR(n,4);break;case 1:sR(n,8);break;default:throw new Error("Unimplemented type: "+e)}}ie([Ni,O("design:type",Function),O("design:paramtypes",[Object,Boolean]),O("design:returntype",X)],ti.prototype,"startP2PConnection",null),ie([Ni,O("design:type",Function),O("design:paramtypes",[Object,Object,Array,Object,String,String]),O("design:returntype",X)],ti.prototype,"connect",null),ie([Ni,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",void 0)],ti.prototype,"updateRemoteRTPCapabilities",null),ie([Ni,O("design:type",Function),O("design:paramtypes",[Object,Object,Array,Object,String,String]),O("design:returntype",X)],ti.prototype,"preConnect",null),ie([Ni,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",X)],ti.prototype,"publishDataChannel",null),ie([Ni,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",X)],ti.prototype,"unpublish",null),ie([Ni,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",X)],ti.prototype,"unpublishDataChannel",null),ie([Ni,O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",X)],ti.prototype,"unpublishLowStream",null),ie([Ni,O("design:type",Function),O("design:paramtypes",[si,Array]),O("design:returntype",X)],ti.prototype,"subscribeDataChannel",null),ie([Ni,O("design:type",Function),O("design:paramtypes",[si,String,Number,Number,Array]),O("design:returntype",X)],ti.prototype,"subscribe",null),ie([Ni,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",X)],ti.prototype,"massSubscribe",null),ie([Ni,O("design:type",Function),O("design:paramtypes",[si,String,Boolean]),O("design:returntype",X)],ti.prototype,"unsubscribe",null),ie([Ni,O("design:type",Function),O("design:paramtypes",[si,Array]),O("design:returntype",X)],ti.prototype,"unsubscribeDataChannel",null),ie([Ni,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",X)],ti.prototype,"massUnsubscribe",null),ie([Ni,O("design:type",Function),O("design:paramtypes",[si,String]),O("design:returntype",X)],ti.prototype,"muteRemote",null),ie([Ni,O("design:type",Function),O("design:paramtypes",[si,String]),O("design:returntype",X)],ti.prototype,"unmuteRemote",null),ie([Ni,O("design:type",Function),O("design:paramtypes",[si,String]),O("design:returntype",X)],ti.prototype,"hasRemoteMediaWithLock",null),ie([Ni,O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",X)],ti.prototype,"disconnectForReconnect",null),ie([Ni,O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",X)],ti.prototype,"updateBitrateLimit",null),ie([Ni,O("design:type",Function),O("design:paramtypes",[si,String,Number]),O("design:returntype",X)],ti.prototype,"remoteMediaSsrcChanged",null);let dq=new Float32Array(1);new Uint8Array(dq.buffer);let rR=new Float64Array(1),dr=new Uint8Array(rR.buffer);function gu(n){return{low:n|=0,high:n>>31,unsigned:n>=0}}let IM=[];function wM(){const n=IM.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}function uq(n){IM.push(n)}function sR(n,e){if(n.offset+e>n.limit)throw new Error("Skip past limit");n.offset+=e}function bM(n){return n.offset>=n.limit}function vu(n,e){let t=n.bytes,i=n.offset,o=n.limit,a=i+e;if(a>t.length){let l=new Uint8Array(2*a);l.set(t),n.bytes=l}return n.offset=a,a>o&&(n.limit=a),i}function oR(n,e){let t=n.offset;if(t+e>n.limit)throw new Error("Read past limit");return n.offset+=e,t}function AM(n,e){let t=oR(n,e),i=String.fromCharCode,o=n.bytes,a="",l="";for(let u=0;u<e;u++){let h,f,m,E,v=o[u+t];128&v?(224&v)==192?u+1>=e?l+=a:(h=o[u+t+1],(192&h)!=128?l+=a:(E=(31&v)<<6|63&h,E<128?l+=a:(l+=i(E),u++))):(240&v)==224?u+2>=e?l+=a:(h=o[u+t+1],f=o[u+t+2],(49344&(h|f<<8))!=32896?l+=a:(E=(15&v)<<12|(63&h)<<6|63&f,E<2048||E>=55296&&E<=57343?l+=a:(l+=i(E),u+=2))):(248&v)==240?u+3>=e?l+=a:(h=o[u+t+1],f=o[u+t+2],m=o[u+t+3],(12632256&(h|f<<8|m<<16))!=8421504?l+=a:(E=(7&v)<<18|(63&h)<<12|(63&f)<<6|63&m,E<65536||E>1114111?l+=a:(E-=65536,l+=i(55296+(E>>10),56320+(1023&E)),u+=3))):l+=a:l+=i(v)}return l}function Go(n,e){let t=e.length,i=0;for(let l=0;l<t;l++){let u=e.charCodeAt(l);u>=55296&&u<=56319&&l+1<t&&(u=(u<<10)+e.charCodeAt(++l)-56613888),i+=u<128?1:u<2048?2:u<65536?3:4}Rt(n,i);let o=vu(n,i),a=n.bytes;for(let l=0;l<t;l++){let u=e.charCodeAt(l);u>=55296&&u<=56319&&l+1<t&&(u=(u<<10)+e.charCodeAt(++l)-56613888),u<128?a[o++]=u:(u<2048?a[o++]=u>>6&31|192:(u<65536?a[o++]=u>>12&15|224:(a[o++]=u>>18&7|240,a[o++]=u>>12&63|128),a[o++]=u>>6&63|128),a[o++]=63&u|128)}}function hq(n,e){let t=vu(n,e.limit),i=n.bytes,o=e.bytes;for(let a=0,l=e.limit;a<l;a++)i[a+t]=o[a]}function OM(n){return n.bytes[oR(n,1)]}function NM(n,e){let t=vu(n,1);n.bytes[t]=e}function aR(n){let e=oR(n,8),t=n.bytes;return dr[0]=t[e++],dr[1]=t[e++],dr[2]=t[e++],dr[3]=t[e++],dr[4]=t[e++],dr[5]=t[e++],dr[6]=t[e++],dr[7]=t[e++],rR[0]}function cR(n,e){let t=vu(n,8),i=n.bytes;rR[0]=e,i[t++]=dr[0],i[t++]=dr[1],i[t++]=dr[2],i[t++]=dr[3],i[t++]=dr[4],i[t++]=dr[5],i[t++]=dr[6],i[t++]=dr[7]}function Wo(n){let e,t=0,i=0;do e=OM(n),t<32&&(i|=(127&e)<<t),t+=7;while(128&e);return i}function Rt(n,e){for(e>>>=0;e>=128;)NM(n,127&e|128),e>>>=7;NM(n,e)}function Nc(n,e){let t=e.low>>>0,i=(e.low>>>28|e.high<<4)>>>0,o=e.high>>>24,a=o===0?i===0?t<16384?t<128?1:2:t<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:o<128?9:10,l=vu(n,a),u=n.bytes;switch(a){case 10:u[l+9]=o>>>7&1;case 9:u[l+8]=a!==9?128|o:127&o;case 8:u[l+7]=a!==8?i>>>21|128:i>>>21&127;case 7:u[l+6]=a!==7?i>>>14|128:i>>>14&127;case 6:u[l+5]=a!==6?i>>>7|128:i>>>7&127;case 5:u[l+4]=a!==5?128|i:127&i;case 4:u[l+3]=a!==4?t>>>21|128:t>>>21&127;case 3:u[l+2]=a!==3?t>>>14|128:t>>>14&127;case 2:u[l+1]=a!==2?t>>>7|128:t>>>7&127;case 1:u[l]=a!==1?128|t:127&t}}function PM(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}const pq=new Map([["moderation",1],["supervise",2]]);class EE extends zt{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const t=this._connectionState;this._connectionState=e,this.emit(Ln.CONNECTION_STATE_CHANGE,t,e)}get inspectType(){return this._inspectType}set inspectType(e){var t;this._inspectMode=ca(t=e.map(i=>pq.get(i)||0)).call(t,(i,o)=>i+o),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(e){super(),S(this,"name","AgoraRTCVideoContentInspect"),S(this,"_connectionState",Lr.CONNECTING),S(this,"_innerConnectionState",void 0),S(this,"sequence",0),S(this,"inspectStartTime",void 0),S(this,"workerManagerConnection",void 0),S(this,"workerConnection",void 0),S(this,"workerMessageLengthLimit",void 0),S(this,"inspectIntervalMinimum",void 0),S(this,"qualityRatio",void 0),S(this,"_connectInfo",void 0),S(this,"_cancelTokenSource",rr.CancelToken.source()),S(this,"_retryConfig",void 0),S(this,"wmSequence",0),S(this,"inspectInterval",void 0),S(this,"inspectTimer",null),S(this,"ossFilePrefix",void 0),S(this,"extraInfo",void 0),S(this,"_inspectType",void 0),S(this,"_inspectMode",void 0),S(this,"_quality",1),S(this,"qualityTimer",null),S(this,"_inspectId",void 0),S(this,"_needWorkUrlOnly",!1),S(this,"inspectImage",()=>{if(this.connectionState!==Lr.CONNECTED)throw new W(N.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Lr.CONNECTED?this.requestToInspectImage():y.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Lt(5,"inspect-"),this.workerMessageLengthLimit=V("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=V("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=V("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new tp("worker-manager-"+this._inspectId,yn),this.on(Ln.STATE_CHANGE,(t,i)=>{this._innerConnectionState=t,y.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Mr[t]," ").concat(i||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new tp("worker-"+this._inspectId,yn),this.handleWorkerEvents()}async init(e,t){this.emit(Ln.STATE_CHANGE,Mr.CONNECT_AP),this._connectInfo=e;const i=this._cancelTokenSource.token;return this._retryConfig=t,new X((o,a)=>{this.on(Ln.CONNECTION_STATE_CHANGE,(l,u)=>{u===Lr.CONNECTED&&o()}),this.requestAP(e,i,t).then(l=>{this.connectWorkerManager(l)}).catch(l=>{a(l)})})}async requestAP(e,t,i){const o=V("WEBCS_DOMAIN").map(u=>"https://".concat(u,"/api/v1")),a=await function(u,h,f,m){let{appId:E,areaCode:v,cname:T,sid:A,token:C,uid:b}=h;zd++;const D="image_moderation_api",M={service_name:D,json_body:JSON.stringify({appId:E,areaCode:v,cname:T,command:"allocateEdge",requestId:zd,seq:zd,sid:A,token:C,ts:Date.now(),uid:b+""})};let B,J,G=u[0];return to(async()=>{B=Date.now();const q=await pa(G,{data:M,cancelToken:f,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(J=Date.now()-B,q.code!==0){const Ee=new W(N.UNEXPECTED_RESPONSE,"image inspect ap error, code"+q.code,{retry:!0,responseTime:J});throw y.error(Ee.toString()),Ee}const Q=JSON.parse(q.json_body);if(Q.code!==200){const Ee=new W(N.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Q.code,", reason: ").concat(Q.reason),{code:Q.code,responseTime:J});throw y.error(Ee.toString()),Ee}if(!Q.servers||!Array.isArray(Q.servers)||Q.servers.length===0){const Ee=new W(N.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Q.code,responseTime:J});throw y.error(Ee.toString()),Ee}const $=V("VIDEO_INSPECT_WORKER_MANAGER_HOST"),ue=V("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Q.servers.map(Ee=>{let{address:Ye,wss:st}=Ee;if(Ye&&st)return"wss://".concat(Ye.replace(/\./g,"-"),".").concat($,":").concat(ue||st)}).filter(Ee=>!!Ee),workerToken:Q.workerToken,vid:Q.vid,responseTime:J}},(q,Q)=>(Oe.apworkerEvent(A,{success:!0,sc:200,serviceName:D,responseDetail:JSON.stringify(q.addressList),firstSuccess:Q===0,responseTime:J,serverIp:u[Q%u.length]}),!1),(q,Q)=>(Oe.apworkerEvent(A,{success:!1,sc:q.data&&q.data.code||200,serviceName:D,responseTime:J,serverIp:u[Q%u.length]}),!!(q.code!==N.OPERATION_ABORTED&&q.code!==N.UNEXPECTED_RESPONSE||q.data&&q.data.retry)&&(G=u[(Q+1)%u.length],!0)),m)}(o,e,t,i);this.emit(Ln.STATE_CHANGE,Mr.AP_CONNECTED);const{addressList:l}=a;return this.wmSequence++,l}async connectWorkerManager(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=t,this.emit(Ln.STATE_CHANGE,Mr.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(je.CONNECTED,async()=>{this.emit(Ln.STATE_CHANGE,Mr.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.20.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(je.CLOSED,()=>{this._innerConnectionState<Mr.GET_WORKER_MANAGER_RESPONSE&&y.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(je.FAILED,()=>{this._innerConnectionState<Mr.GET_WORKER_MANAGER_RESPONSE&&y.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(je.RECONNECTING,()=>{this._innerConnectionState<Mr.GET_WORKER_MANAGER_RESPONSE&&y.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(je.ON_MESSAGE,async e=>{this.emit(Ln.STATE_CHANGE,Mr.GET_WORKER_MANAGER_RESPONSE);const t=this.workerManagerConnection.url;this.workerManagerConnection.close();const i=JSON.parse(e.data);if(i.code!==200)throw y.error("[".concat(this._inspectId,"] Unexpected code ").concat(i.code," from worker manager")),new W(N.UNEXPECTED_RESPONSE,"response code of worker is unexpected",i);if(!(i.serverResponse&&i.serverResponse.portWss&&t))throw y.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(i))),new W(N.UNEXPECTED_RESPONSE,"response content of worker is unexpected",i);{const o=V("VIDEO_INSPECT_WORKER_PORT")||i.serverResponse.portWss,a=t.replace(/:\d+\/?$/,":".concat(o));this.emit(Ln.STATE_CHANGE,Mr.CONNECT_WORKER,a),this._needWorkUrlOnly?this.emit(Ln.REQUEST_NEW_WORKER_URL,a):await this.connectWorker(a)}}),this.workerManagerConnection.on(je.WILL_RECONNECT,(e,t,i)=>{i(e)}),this.workerManagerConnection.on(je.REQUEST_NEW_URLS,(e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)})}handleWorkerEvents(){this.workerConnection.on(je.CONNECTED,async()=>{this.emit(Ln.STATE_CHANGE,Mr.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Lr.CONNECTED}),this.workerConnection.on(je.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const i=oq(new Uint8Array(e.data));if(V("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&y.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(i)),i.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Ln.INSPECT_RESULT,void 0,void 0);if(i.data&&i.data.scorePorn&&i.data.scoreSexy&&i.data.scoreNeutral){var t;const o={porn:i.data.scorePorn,sexy:i.data.scoreSexy,neutral:i.data.scoreNeutral},a=ca(t=Object.keys(o)).call(t,(u,h)=>o[u]>o[h]?u:h,"porn"),l=Object.keys(o).find(u=>u===a);this.emit(Ln.INSPECT_RESULT,l)}else this.emit(Ln.INSPECT_RESULT,void 0,new W(N.UNEXPECTED_RESPONSE,i.code+"","There is an unexpected data on message"))}else this.emit(Ln.INSPECT_RESULT,void 0,new W(N.UNEXPECTED_RESPONSE,i.code+"",i.msg))}else y.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Ln.INSPECT_RESULT,void 0,new W(N.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(je.CLOSED,()=>{this.connectionState=Lr.CLOSED}),this.workerConnection.on(je.FAILED,()=>{this.connectionState=Lr.CLOSED}),this.workerConnection.on(je.RECONNECTING,()=>{this.connectionState=this.connectionState===Lr.CONNECTED?Lr.RECONNECTING:Lr.CONNECTING}),this.workerConnection.on(je.WILL_RECONNECT,(e,t,i)=>{e==="recover"&&i(e),i("tryNext")}),this.workerConnection.on(je.REQUEST_NEW_URLS,(e,t)=>{this.workerManagerConnection.close(),this.once(Ln.REQUEST_NEW_WORKER_URL,i=>{e([i])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i=>{this.connectWorkerManager(i,!0)}).catch(i=>{t(i)})})}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){this.sequence++;const e=Er(this,Ln.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(Ln.INSPECT_RESULT,void 0,new W(N.INVALID_OPERATION,"Only the track being played can be inspected"));const i=await this.generateRequestData(e,t);this.workerConnection.sendMessage(i,!0,!0)}else this.emit(Ln.INSPECT_RESULT,void 0,new W(N.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,t){let{appId:i,cname:o,cid:a,vid:l,sid:u,uid:h}=t;const f=Date.now(),m=await e.getCurrentFrameImage("image/jpeg",this.quality),E=await WD(m,i,o),v=this.sequence+"-"+a+"-"+h+"-"+f+"-"+Lt(12,""),T={appId:i,cid:a,cname:o,deviceId:"",elapse:EE.intToLong(Number(f-this.inspectStartTime)),fileSize:E.byteLength,jpgEncryption:2,height:m.height,width:m.width,jpg:E,networkType:6,osType:7,requestId:v,sdkVersion:"4.20.2",sequence:this.sequence,sid:u,timestamp:EE.intToLong(f),uid:h,vid:l,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};this.extraInfo===void 0&&delete T.callbackData,this.ossFilePrefix===void 0&&delete T.ossFilePrefix;const A=sq(T);if(A.byteLength<this.workerMessageLengthLimit){if(V("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const C=function(b){for(var D=1;D<arguments.length;D++){var M=arguments[D]!=null?arguments[D]:{};D%2?PM(Object(M),!0).forEach(function(B){S(b,B,M[B])}):Object.getOwnPropertyDescriptors?Object.defineProperties(b,Object.getOwnPropertyDescriptors(M)):PM(Object(M)).forEach(function(B){Object.defineProperty(b,B,Object.getOwnPropertyDescriptor(M,B))})}return b}({},T);delete C.jpg,y.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(C))}return A}{const C=this.quality*this.qualityRatio;return this.quality=C,await this.generateRequestData(e,{appId:i,cname:o,cid:a,vid:l,sid:u,uid:h})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=rr.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Lr.CLOSED,this.emit(Ln.STATE_CHANGE,Mr.CLOSED)}}function fq(n){let e=function(){const t=Eq.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(t,i){let o=t.appId;o!==void 0&&(mn(i,10),Pc(i,o));let a=t.cid;a!==void 0&&(mn(i,16),mn(i,a));let l=t.cname;l!==void 0&&(mn(i,26),Pc(i,l));let u=t.deviceId;u!==void 0&&(mn(i,34),Pc(i,u));let h=t.elapse;h!==void 0&&(mn(i,40),Dc(i,h));let f=t.fileSize;f!==void 0&&(mn(i,48),Dc(i,Su(f)));let m=t.height;m!==void 0&&(mn(i,56),Dc(i,Su(m)));let E=t.jpg;E!==void 0&&(mn(i,66),mn(i,E.length),kM(i,E));let v=t.networkType;v!==void 0&&(mn(i,72),Dc(i,Su(v)));let T=t.osType;T!==void 0&&(mn(i,80),Dc(i,Su(T)));let A=t.requestId;A!==void 0&&(mn(i,90),Pc(i,A));let C=t.sdkVersion;C!==void 0&&(mn(i,98),Pc(i,C));let b=t.sequence;b!==void 0&&(mn(i,104),Dc(i,Su(b)));let D=t.sid;D!==void 0&&(mn(i,114),Pc(i,D));let M=t.timestamp;M!==void 0&&(mn(i,120),Dc(i,M));let B=t.uid;B!==void 0&&(mn(i,128),mn(i,B));let J=t.vid;J!==void 0&&(mn(i,136),mn(i,J));let G=t.width;G!==void 0&&(mn(i,144),Dc(i,Su(G)));let q=t.service;q!==void 0&&(mn(i,152),mn(i,q));let Q=t.callbackData;Q!==void 0&&(mn(i,162),mn(i,Q.length),kM(i,Q));let $=t.ticket;$!==void 0&&(mn(i,170),Pc(i,$));let ue=t.vendorConfigs;ue!==void 0&&(mn(i,178),Pc(i,ue))}(n,e),function(t){let i=t.bytes,o=t.limit;return i.length===o?i:i.subarray(0,o)}(e)}function mq(n){return function(t){let i={};e:for(;!gq(t);){let o=Up(t);switch(o>>>3){case 0:break e;case 1:i.code=Up(t);break;case 2:i.msg=LM(t,Up(t));break;case 3:i.requestId=LM(t,Up(t));break;case 4:i.timestamp=vq(t,!1);break;default:_q(t,7&o)}}return i}({bytes:e=n,offset:0,limit:e.length});var e}function _q(n,e){switch(e){case 0:for(;128&Ws(n););break;case 2:lR(n,Up(n));break;case 5:lR(n,4);break;case 1:lR(n,8);break;default:throw new Error("Unimplemented type: "+e)}}function Su(n){return{low:n|=0,high:n>>31,unsigned:n>=0}}let Eq=[];function lR(n,e){if(n.offset+e>n.limit)throw new Error("Skip past limit");n.offset+=e}function gq(n){return n.offset>=n.limit}function gE(n,e){let t=n.bytes,i=n.offset,o=n.limit,a=i+e;if(a>t.length){let l=new Uint8Array(2*a);l.set(t),n.bytes=l}return n.offset=a,a>o&&(n.limit=a),i}function DM(n,e){let t=n.offset;if(t+e>n.limit)throw new Error("Read past limit");return n.offset+=e,t}function kM(n,e){let t=gE(n,e.length);n.bytes.set(e,t)}function LM(n,e){let t=DM(n,e),i=String.fromCharCode,o=n.bytes,a="",l="";for(let u=0;u<e;u++){let h,f,m,E,v=o[u+t];128&v?(224&v)==192?u+1>=e?l+=a:(h=o[u+t+1],(192&h)!=128?l+=a:(E=(31&v)<<6|63&h,E<128?l+=a:(l+=i(E),u++))):(240&v)==224?u+2>=e?l+=a:(h=o[u+t+1],f=o[u+t+2],(49344&(h|f<<8))!=32896?l+=a:(E=(15&v)<<12|(63&h)<<6|63&f,E<2048||E>=55296&&E<=57343?l+=a:(l+=i(E),u+=2))):(248&v)==240?u+3>=e?l+=a:(h=o[u+t+1],f=o[u+t+2],m=o[u+t+3],(12632256&(h|f<<8|m<<16))!=8421504?l+=a:(E=(7&v)<<18|(63&h)<<12|(63&f)<<6|63&m,E<65536||E>1114111?l+=a:(E-=65536,l+=i(55296+(E>>10),56320+(1023&E)),u+=3))):l+=a:l+=i(v)}return l}function Pc(n,e){let t=e.length,i=0;for(let l=0;l<t;l++){let u=e.charCodeAt(l);u>=55296&&u<=56319&&l+1<t&&(u=(u<<10)+e.charCodeAt(++l)-56613888),i+=u<128?1:u<2048?2:u<65536?3:4}mn(n,i);let o=gE(n,i),a=n.bytes;for(let l=0;l<t;l++){let u=e.charCodeAt(l);u>=55296&&u<=56319&&l+1<t&&(u=(u<<10)+e.charCodeAt(++l)-56613888),u<128?a[o++]=u:(u<2048?a[o++]=u>>6&31|192:(u<65536?a[o++]=u>>12&15|224:(a[o++]=u>>18&7|240,a[o++]=u>>12&63|128),a[o++]=u>>6&63|128),a[o++]=63&u|128)}}function Ws(n){return n.bytes[DM(n,1)]}function MM(n,e){let t=gE(n,1);n.bytes[t]=e}function Up(n){let e,t=0,i=0;do e=Ws(n),t<32&&(i|=(127&e)<<t),t+=7;while(128&e);return i}function mn(n,e){for(e>>>=0;e>=128;)MM(n,127&e|128),e>>>=7;MM(n,e)}function vq(n,e){let t,i=0,o=0,a=0;return t=Ws(n),i=127&t,128&t&&(t=Ws(n),i|=(127&t)<<7,128&t&&(t=Ws(n),i|=(127&t)<<14,128&t&&(t=Ws(n),i|=(127&t)<<21,128&t&&(t=Ws(n),o=127&t,128&t&&(t=Ws(n),o|=(127&t)<<7,128&t&&(t=Ws(n),o|=(127&t)<<14,128&t&&(t=Ws(n),o|=(127&t)<<21,128&t&&(t=Ws(n),a=127&t,128&t&&(t=Ws(n),a|=(127&t)<<7))))))))),{low:i|o<<28,high:o>>>4|a<<24,unsigned:e}}function Dc(n,e){let t=e.low>>>0,i=(e.low>>>28|e.high<<4)>>>0,o=e.high>>>24,a=o===0?i===0?t<16384?t<128?1:2:t<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:o<128?9:10,l=gE(n,a),u=n.bytes;switch(a){case 10:u[l+9]=o>>>7&1;case 9:u[l+8]=a!==9?128|o:127&o;case 8:u[l+7]=a!==8?i>>>21|128:i>>>21&127;case 7:u[l+6]=a!==7?i>>>14|128:i>>>14&127;case 6:u[l+5]=a!==6?i>>>7|128:i>>>7&127;case 5:u[l+4]=a!==5?128|i:127&i;case 4:u[l+3]=a!==4?t>>>21|128:t>>>21&127;case 3:u[l+2]=a!==3?t>>>14|128:t>>>14&127;case 2:u[l+1]=a!==2?t>>>7|128:t>>>7&127;case 1:u[l]=a!==1?128|t:127&t}}const xM={},UM={},vE=4294967296,VM=vE*vE,FM=VM/2,dR=BM(0,!0),jM=BM(0),Sq=Tu(0,-2147483648,!1),Tq=Tu(-1,2147483647,!1),yq=Tu(-1,-1,!0);function BM(n,e){let t,i,o;return e?(o=0<=(n>>>=0)&&n<256)&&(i=UM[n],i)?i:(t=Tu(n,0,!0),o&&(UM[n]=t),t):(o=-128<=(n|=0)&&n<128)&&(i=xM[n],i)?i:(t=Tu(n,n<0?-1:0,!1),o&&(xM[n]=t),t)}function Tu(n,e,t){return{low:0|n,high:0|e,unsigned:!!t}}function Rq(n,e){if(isNaN(n))return e?dR:jM;if(e){if(n<0)return dR;if(n>=VM)return yq}else{if(n<=-FM)return Sq;if(n+1>=FM)return Tq}return n<0?e?dR:jM:Tu(n%vE|0,n/vE|0,e)}function GM(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}class uR extends zt{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const t=this._connectionState;this._connectionState=e,this.emit(ns.CONNECTION_STATE_CHANGE,e,t)}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(e){var t;super(),S(this,"name","AgoraRTCImageModeration"),S(this,"_connectionState",gr.CONNECTING),S(this,"_sequence",0),S(this,"_moderationStartTime",void 0),S(this,"_workerConnection",void 0),S(this,"_workerMessageLengthLimit",void 0),S(this,"_qualityRatio",void 0),S(this,"_connectInfo",void 0),S(this,"_cancelTokenSource",rr.CancelToken.source()),S(this,"_retryConfig",void 0),S(this,"_moderationInterval",void 0),S(this,"_moderationTimer",null),S(this,"_moderationMode",1),S(this,"_quality",1),S(this,"_qualityTimer",null),S(this,"_ticket",void 0),S(this,"_moderationIntervalMinimum",void 0),S(this,"_uploadFailedNum",0),S(this,"_uploadNum",0),S(this,"_uploadTimer",null),S(this,"_extraInfo",void 0),S(this,"_vendor",""),S(this,"_encoder",new TextEncoder),S(this,"_moderationId",void 0),S(this,"inspectImage",()=>{if(this.connectionState!==gr.CONNECTED)throw new W(N.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===gr.CONNECTED?this.requestToInspectImage():y.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Lt(5,"image-moderation-"),this._workerMessageLengthLimit=V("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=V("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(t=e.interval)!==null&&t!==void 0?t:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),this._qualityRatio=V("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new tp("worker-"+this._moderationId,yn),this.on(ns.STATE_CHANGE,(i,o)=>{y.debug("[".concat(this._moderationId,"] Moderation operation :").concat(lc[i]," ").concat(o||""))}),this.handleWorkerEvents()}async init(e,t){this.emit(ns.STATE_CHANGE,lc.CONNECT_AP),this._connectInfo=e;const i=this._cancelTokenSource.token;return this._retryConfig=t,new X((o,a)=>{this.on(ns.CONNECTION_STATE_CHANGE,(l,u)=>{l===gr.CONNECTED&&o()}),this.requestAP(e,i,t).then(l=>{this.connectWorker(l)}).catch(l=>{a(l)})})}updateConfig(e){var t;this._moderationInterval=(t=e.interval)!==null&&t!==void 0?t:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),y.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===gr.CONNECTED&&this.inspectImage()}async requestAP(e,t,i){const o=V("WEBCS_DOMAIN").map(h=>"https://".concat(h,"/api/v1")),a=await function(h,f,m,E){let{appId:v,areaCode:T,cname:A,sid:C,token:b,uid:D}=f;zd++;const M="moderation_plugin",B={service_name:M,json_body:JSON.stringify({appId:v,areaCode:T,cname:A,command:"allocateEdge",requestId:zd,seq:zd,sid:C,appToken:b,ts:Date.now(),uid:D+""})};let J,G,q=h[0];return to(async()=>{J=Date.now();const Q=await pa(q,{data:B,cancelToken:m,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(G=Date.now()-J,Q.code!==0){const Ee=new W(N.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Q.code,{retry:!0,responseTime:G});throw y.error(Ee.toString()),Ee}const $=JSON.parse(Q.json_body);if($.code!==200){const Ee=new W(N.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat($.code,", reason: ").concat($.reason),{code:$.code,responseTime:G});throw y.error(Ee.toString()),Ee}if(!$.servers||!Array.isArray($.servers)||$.servers.length===0){const Ee=new W(N.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:$.code,responseTime:G});throw y.error(Ee.toString()),Ee}if(!$.servers.some(Ee=>!!Ee.wss)){const Ee=new W(N.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:$.code,responseTime:G});throw y.error(Ee.toString()),Ee}const ue=V("IMAGE_MODERATION_WORKER_HOST");return{addressList:$.servers.map(Ee=>{let{address:Ye,wss:st}=Ee;if(Ye&&st)return"wss://".concat(Ye.replace(/\./g,"-"),".").concat(ue,":").concat(st,"/moderation")}).filter(Ee=>!!Ee),workerToken:$.workerToken,vid:$.vid,ticket:$.appTicket,responseTime:G}},(Q,$)=>(Oe.apworkerEvent(C,{success:!0,sc:200,serviceName:M,responseDetail:JSON.stringify(Q.addressList),firstSuccess:$===0,responseTime:G,serverIp:h[$%h.length]}),!1),(Q,$)=>(Oe.apworkerEvent(C,{success:!1,sc:Q.data&&Q.data.code||200,serviceName:M,responseTime:G,serverIp:h[$%h.length]}),!!(Q.code!==N.OPERATION_ABORTED&&Q.code!==N.UNEXPECTED_RESPONSE||Q.data&&Q.data.retry)&&(q=h[($+1)%h.length],!0)),E)}(o,e,t,i);this.emit(ns.STATE_CHANGE,lc.AP_CONNECTED);const{addressList:l,ticket:u}=a;return this._ticket=u,l}async connectWorker(e){this.emit(ns.STATE_CHANGE,lc.CONNECT_WORKER),await this._workerConnection.init(e,1e4)}handleWorkerEvents(){this._workerConnection.on(je.CONNECTED,async()=>{this.emit(ns.STATE_CHANGE,lc.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=gr.CONNECTED}),this._workerConnection.on(je.CLOSED,()=>{this.connectionState=gr.CLOSED}),this._workerConnection.on(je.FAILED,()=>{this.connectionState=gr.CLOSED}),this._workerConnection.on(je.RECONNECTING,()=>{this.connectionState=this.connectionState===gr.CONNECTED?gr.RECONNECTING:gr.CONNECTING}),this._workerConnection.on(je.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const t=mq(new Uint8Array(e.data));V("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&y.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(t)),this._uploadNum++,t.code===void 0||t.code===0||(this._uploadFailedNum++,y.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(t.code,", msg is ").concat(t.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Oe.reportApiInvoke(this._connectInfo.sid||null,{name:vn.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,t.code],tag:Qt.TRACER}).onError(new W(N.IMAGE_MODERATION_UPLOAD_FAILED,t.msg)),this._uploadTimer=null},V("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else y.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(je.WILL_RECONNECT,(e,t,i)=>{e==="recover"&&i(e),i("tryNext")}),this._workerConnection.on(je.REQUEST_NEW_URLS,(e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)})}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){const e=Er(this,ns.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void(V("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&y.debug("Only the track being played can be inspected"));this._sequence++;const i=await this.generateRequestData(e,t);this._workerConnection.sendMessage(i,!0,!0)}else V("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&y.debug("Only the track being published can be inspected")}async generateRequestData(e,t){let{appId:i,cname:o,cid:a,vid:l,sid:u,uid:h}=t;const f=Date.now(),m=await e.getCurrentFrameImage("image/jpeg",this.quality),E=await WD(m,i,o),v=this._sequence+"-"+a+"-"+h+"-"+f+"-"+Lt(12,""),T={appId:i,cid:a,cname:o,deviceId:"",elapse:uR.intToLong(Number(f-this._moderationStartTime)),fileSize:m.buffer.byteLength,height:m.height,width:m.width,jpg:E,networkType:6,osType:7,requestId:v,sdkVersion:"4.20.2",sequence:this._sequence,sid:u,timestamp:Rq(f),uid:h,vid:l,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete T.callbackData;const A=fq(T);if(A.byteLength<this._workerMessageLengthLimit){if(V("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const C=function(b){for(var D=1;D<arguments.length;D++){var M=arguments[D]!=null?arguments[D]:{};D%2?GM(Object(M),!0).forEach(function(B){S(b,B,M[B])}):Object.getOwnPropertyDescriptors?Object.defineProperties(b,Object.getOwnPropertyDescriptors(M)):GM(Object(M)).forEach(function(B){Object.defineProperty(b,B,Object.getOwnPropertyDescriptor(M,B))})}return b}({},T);delete C.jpg,y.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(C))}return A}{const C=this.quality*this._qualityRatio;return this.quality=C,await this.generateRequestData(e,{appId:i,cname:o,cid:a,vid:l,sid:u,uid:h})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=rr.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=gr.CLOSED,this.emit(ns.STATE_CHANGE,lc.CLOSED)}}function WM(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}function HM(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?WM(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):WM(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}const Cq=Date.now(),Iq=20,hR=new Map,SE=new Map;async function KM(n){const e=hR.get(n),t=Array.isArray(e)&&e[e.length-1],i=SE.get(n);if(!t)return void(i.isSyncing=!1);const o={uid:t.uid,payload:t.payload};i.firstRecvTs===0&&(i.firstRecvTs=t.recvTs,i.firstSendTs=t.sendTs);const a=t.sendTs-i.firstSendTs,l=a-(Date.now()-i.firstRecvTs);l>0&&(i.firstRecvTs=Date.now()-a);let u=t.mediaDelay+l;u<=0?(e.pop(),zM(t.context,o),u=0):u=Math.min(u,Iq),setTimeout(()=>e.length&&KM(n),u)}function zM(n,e){n.safeEmit(at.STREAM_MESSAGE,e.uid,e.payload),n.onStreamMessage&&n.onStreamMessage(e)}function wq(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2?arguments[2]:void 0;if(!n.syncWithAudio)return zM(t,{uid:n.uid,payload:n.payload});const i="".concat(t.id,"-").concat(n.uid),o=hR.get(i)||[],a=o.findIndex(f=>n.sendTs>=f.sendTs),l=HM(HM({},n),{},{context:t,mediaDelay:e,recvTs:Date.now()});a===-1?o.push(l):o.splice(a,0,l),hR.set(i,o);let u=!1;var h;SE.has(i)?u=!((h=SE.get(i))===null||h===void 0||!h.isSyncing):SE.set(i,{isSyncing:u,firstRecvTs:0,firstSendTs:0}),u||KM(i)}const bq=ft().name;function Aq(){return!function(n,e,t){const i=ft();if(i.os!==Nn.IOS||!i.osVersion)return!1;const o=i.osVersion.split(".");return t?e&&Number(o[0])===n&&Number(o[1])<e||Number(o[0])<n:e?Number(o[0])===n&&Number(o[1])<=e||Number(o[0])<n:Number(o[0])<=n}(16,0,!0)&&!function(n,e,t){const i=ft();if(i.name!==St.SAFARI||!i.osVersion)return!1;const o=i.version.split(".");return t?e&&Number(o[0])===n&&Number(o[1])<e||Number(o[0])<n:e?Number(o[0])===n&&Number(o[1])<=e||Number(o[0])<n:Number(o[0])<=n}(16,0,!0)}function YM(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}function uo(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?YM(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):YM(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}Qn.setLogger(y);class At extends zt{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e){let t;if(super(),S(this,"store",void 0),S(this,"_uid",void 0),S(this,"_channelName",void 0),S(this,"_uintUid",void 0),S(this,"_users",[]),S(this,"_config",void 0),S(this,"_clientId",void 0),S(this,"_appId",void 0),S(this,"_sessionId",null),S(this,"_key",void 0),S(this,"_rtmConfig",{}),S(this,"_joinInfo",void 0),S(this,"_gateway",void 0),S(this,"_statsCollector",void 0),S(this,"_configDistribute",void 0),S(this,"_leaveMutex",new Qn("client-leave")),S(this,"_publishMutex",new Qn("client-publish")),S(this,"_renewTokenMutex",new Qn("client-renewtoken")),S(this,"_subscribeMutex",new Qn("client-subscribe")),S(this,"_encryptionMode","none"),S(this,"_encryptionSecret",null),S(this,"_encryptionSalt",null),S(this,"_encryptDataStream",!1),S(this,"_encryptDataStreamKey",null),S(this,"_encryptDataStreamIv",null),S(this,"_proxyServer",void 0),S(this,"_turnServer",{servers:[],mode:"auto"}),S(this,"_cloudProxyServerMode","disabled"),S(this,"_isDualStreamEnabled",!1),S(this,"_defaultStreamFallbackType",void 0),S(this,"_lowStreamParameter",void 0),S(this,"_streamFallbackTypeCacheMap",new Map),S(this,"_remoteStreamTypeCacheMap",new Map),S(this,"_axiosCancelSource",rr.CancelToken.source()),S(this,"_audioVolumeIndicationInterval",void 0),S(this,"_networkQualityInterval",void 0),S(this,"_userOfflineTimeout",void 0),S(this,"_streamRemovedTimeout",void 0),S(this,"_injectStreamingClient",void 0),S(this,"_liveTranscodeStreamingClient",void 0),S(this,"_liveRawStreamingClient",void 0),S(this,"_channelMediaRelayClient",void 0),S(this,"_networkQualitySensitivity","normal"),S(this,"_p2pChannel",void 0),S(this,"_useLocalAccessPoint",!1),S(this,"_setLocalAPVersion",void 0),S(this,"_joinAndNotLeaveYet",!1),S(this,"_numberOfJoinCount",0),S(this,"_remoteDefaultVideoStreamType",void 0),S(this,"_inspect",void 0),S(this,"_moderation",void 0),S(this,"_license",void 0),S(this,"_pendingPublishedUsers",[]),S(this,"ntpAlignErrorCount",0),S(this,"remoteInboundOffset",0),S(this,"_handleLocalTrackEnable",(i,o,a)=>{this.publish(i,!1).then(o).catch(a)}),S(this,"_handleLocalTrackDisable",(i,o,a)=>{this.unpublish(i).then(o).catch(a)}),S(this,"_handleUserOnline",i=>{if(V("BLOCK_LOCAL_CLIENT")&&yl(i.uid,this.channelName))return void y.debug("[".concat(i.uid,"] will be ignored in local"));this.isStringUID&&typeof i.uid!="string"&&y.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const o=this._users.find(a=>a.uid===i.uid);if(o)o._trust_in_room_=!0,o._is_pre_created&&(o._is_pre_created=!1,this.safeEmit(at.USER_JOINED,o));else{const a=new si(i.uid,i.uint_id||i.uid);this._users.push(a),y.debug("[".concat(this._clientId,"] user online"),i.uid),this.safeEmit(at.USER_JOINED,a)}}),S(this,"_handleUserOffline",i=>{if(V("BLOCK_LOCAL_CLIENT")&&yl(i.uid,this.channelName))return;const o=this._users.find(a=>a.uid===i.uid);o&&(this._handleRemoveStream(i),this._handleRemoveDataChannels(i),o._audio_pre_subscribed||o._video_pre_subscribed?o._is_pre_created=!0:$m(this._users,o),this._remoteStreamTypeCacheMap.delete(o.uid),this._streamFallbackTypeCacheMap.delete(o.uid),y.debug("[".concat(this._clientId,"] user offline"),i.uid,"reason:",i.reason),this.safeEmit(at.USER_LEAVED,o,i.reason))}),S(this,"_handleAddAudioOrVideoStream",(i,o,a,l,u,h,f)=>{if(V("BLOCK_LOCAL_CLIENT")&&yl(o,this.channelName))return;const m=this._users.find(v=>v.uid===o);if(!m)return void y.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));y.debug("[".concat(this._clientId,"] stream added with uid ").concat(o,", type ").concat(i)),this.store.subscribe(m.uid,i,void 0,void 0,void 0,Date.now());const E=i==="audio"?m.hasAudio:m.hasVideo;m._uintid||(m._uintid=u||o),i==="audio"?m._trust_audio_stream_added_state_=!0:m._trust_video_stream_added_state_=!0,i==="audio"?(m._audio_added_=!0,a!==void 0&&(m._audioSSRC=a),l!==void 0&&(m._cname=l),h&&(m._audioOrtc=h)):(m._video_added_=!0,a!==void 0&&(m._videoSSRC=a),l!==void 0&&(m._cname=l),f!==void 0&&(m._rtxSsrcId=f),h&&(m._videoOrtc=h)),(i==="audio"?m.hasAudio:m.hasVideo)&&!E&&(y.info("[".concat(this._clientId,"] remote user ").concat(m.uid," published ").concat(i)),this.safeEmit(at.USER_PUBLISHED,m,i)),i==="video"?Oe.onGatewayStream(this._sessionId,Dn.ON_ADD_VIDEO_STREAM,Gt.ON_ADD_VIDEO_STREAM,{peer:u||o,ssrc:m._videoSSRC}):Oe.onGatewayStream(this._sessionId,Dn.ON_ADD_AUDIO_STREAM,Gt.ON_ADD_AUDIO_STREAM,{peer:u||o,ssrc:m._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(m,i,a).then(v=>{if(v&&(y.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(m.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof ti))return this._p2pChannel.unsubscribe(m,i,!0).then(()=>this._subscribe(m,i,!0).catch(T=>{y.error("[".concat(this._clientId,"] resubscribe error"),T.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(m,i)&&(y.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(m.uid," after reconnect.")),this._subscribe(m,i,!0).catch(v=>{y.error("[".concat(this._clientId,"] resubscribe error"),v.toString())}))}),S(this,"_handleRemoveStream",i=>{if(V("BLOCK_LOCAL_CLIENT")&&yl(i.uid,this.channelName))return;const o=this._users.find(l=>l.uid===i.uid);if(!o)return void y.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));y.debug("[".concat(this._clientId,"] stream removed with uid ").concat(i.uid));let a=()=>{};o.hasAudio&&o.hasVideo?a=()=>{y.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished audio track")),this.safeEmit(at.USER_UNPUBLISHED,o,"audio"),y.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished video track")),this.safeEmit(at.USER_UNPUBLISHED,o,"video")}:o.hasVideo?a=()=>{y.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished video track")),this.safeEmit(at.USER_UNPUBLISHED,o,"video")}:o.hasAudio&&(a=()=>{y.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished audio track")),this.safeEmit(at.USER_UNPUBLISHED,o,"audio")}),o._video_pre_subscribed||o._audio_pre_subscribed||(o._trust_audio_stream_added_state_=!0,o._trust_video_stream_added_state_=!0,o._audio_added_=!1,o._video_added_=!1,this._p2pChannel instanceof ti&&this._p2pChannel.unsubscribe(o).then(l=>{if(l)return this._gateway.unsubscribe(l,o.uid)}),o._audioSSRC=void 0,o._videoSSRC=void 0,o._audioOrtc=void 0,o._videoOrtc=void 0,o._rtxSsrcId=void 0),Oe.onGatewayStream(this._sessionId,Dn.ON_REMOVE_STREAM,Gt.ON_REMOVE_STREAM,{peer:i.uint_id||i.uid}),a()}),S(this,"_handleSetStreamLocalEnable",(i,o,a)=>{if(V("BLOCK_LOCAL_CLIENT")&&yl(o,this.channelName))return;const l=this._users.find(f=>f.uid===o);if(!l)return void y.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));y.debug("[".concat(this._clientId,"] local ").concat(i," ").concat(a?"enabled":"disabled"," with uid ").concat(o));const u=i==="audio"?l.hasAudio:l.hasVideo;if(i==="audio"){l._trust_audio_enabled_state_=!0;const f=l._audio_enabled_;if(l._audio_enabled_=a,l._audio_enabled_===f)return;{const m=l._audio_enabled_?"enable-local-audio":"disable-local-audio";y.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(o,", msg: ").concat(m)),this.safeEmit(at.USER_INFO_UPDATED,o,m)}}else{l._trust_video_enabled_state_=!0;const f=l._video_enabled_;if(l._video_enabled_=a,l._video_enabled_===f)return;{const m=l._video_enabled_?"enable-local-video":"disable-local-video";y.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(o,", msg: ").concat(m)),this.safeEmit(at.USER_INFO_UPDATED,o,m)}}const h=i==="audio"?l.hasAudio:l.hasVideo;return u!==h?!u&&h?(y.info("[".concat(this._clientId,"] remote user ").concat(o," published ").concat(i)),void this.safeEmit(at.USER_PUBLISHED,l,i)):(i==="video"&&l._videoTrack&&l._videoTrack._destroy(),i==="audio"&&l._audioTrack,this._p2pChannel.muteRemote(l,i),y.info("[".concat(this._clientId,"] remote user ").concat(o," unpublished ").concat(i)),void this.safeEmit(at.USER_UNPUBLISHED,l,i)):void 0}),S(this,"_handleMuteStream",(i,o,a)=>{if(V("BLOCK_LOCAL_CLIENT")&&yl(i,this.channelName))return;y.debug("[".concat(this._clientId,"] receive mute message"),i,o,a);const l=this._users.find(f=>f.uid===i);if(!l)return void y.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i));const u=o==="audio"?l.hasAudio:l.hasVideo;if(o==="audio"){l._trust_audio_mute_state_=!0;const f=l._audio_muted_;if(l._audio_muted_=a,l._audio_muted_===f)return;{const m=l._audio_muted_?"mute-audio":"unmute-audio";y.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(m)),this.safeEmit(at.USER_INFO_UPDATED,i,m)}}else{l._trust_video_mute_state_=!0;const f=l._video_muted_;if(l._video_muted_=a,l._video_muted_===f)return;{const m=l._video_muted_?"mute-video":"unmute-video";y.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(m)),this.safeEmit(at.USER_INFO_UPDATED,i,m)}}const h=o==="audio"?l.hasAudio:l.hasVideo;if(u!==h){if(!u&&h)return(o==="audio"?l._audioSSRC:l._videoSSRC)?(y.info("[".concat(this._clientId,"] remote user ").concat(i," published ").concat(o)),void this.safeEmit(at.USER_PUBLISHED,l,o)):void y.warning("[".concat(this._clientId,"] remote user ").concat(i," receive ").concat(o," unmute message  before add stream message, ").concat(o," SSRC doesn't exist yet."));o==="video"&&l._videoTrack&&!l._video_pre_subscribed&&l._videoTrack._destroy(),o==="audio"&&l._audioTrack,this._p2pChannel.muteRemote(l,o),y.info("[".concat(this._clientId,"] remote user ").concat(i," unpublished ").concat(o)),this.safeEmit(at.USER_UNPUBLISHED,l,o)}}),S(this,"_handleP2PLost",async i=>{y.debug("[".concat(this._clientId,"] receive p2p lost"),i),parseInt(i.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():y.warning("[".concat(this._clientId,"] P2PLost stream not found"),i)}),S(this,"_handleTokenWillExpire",()=>{y.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(at.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),S(this,"_handleBeforeUnload",i=>{i.type==="beforeunload"&&i.returnValue!==void 0&&i.returnValue!==""||(this.leave(),y.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),S(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(at.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const i={downlinkNetworkQuality:0,uplinkNetworkQuality:0};i.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),i.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(at.NETWORK_QUALITY,i)}),S(this,"_handleP2PAddAudioOrVideoStream",(i,o,a,l)=>{const u=this._users.find(f=>f.uid===o);if(!u)return void y.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));y.debug("[".concat(this._clientId,"] stream added with uid ").concat(o,", type ").concat(i)),this.store.subscribe(u.uid,i,void 0,void 0,void 0,Date.now());const h=i==="audio"?u.hasAudio:u.hasVideo;i==="audio"?u._trust_audio_stream_added_state_=!0:u._trust_video_stream_added_state_=!0,i==="audio"?(u._audio_added_=!0,a!==void 0&&(u._audioSSRC=a),l!==void 0&&(u._audioMid=l)):(u._video_added_=!0,a!==void 0&&(u._videoSSRC=a),l!==void 0&&(u._videoMid=l)),(i==="audio"?u.hasAudio:u.hasVideo)&&!h&&(y.info("[".concat(this._clientId,"] remote user ").concat(u.uid," published ").concat(i)),this.safeEmit(at.USER_PUBLISHED,u,i)),this._p2pChannel.hasPendingRemoteMedia(u,i)&&(y.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(u.uid," after reconnect.")),this._subscribe(u,i,!0).catch(f=>{y.error("[".concat(this._clientId,"] resubscribe error"),f.toString())}))}),this._config=e,this._clientId=Lt(5,"client-"),this.store=new xK(e.codec,e.audioCodec,e.mode,this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),y.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(es," build: ").concat(ny,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{yP(e.clientRoleOptions),t=Object.assign({},e.clientRoleOptions)}catch(i){y.warning("[".concat(this._clientId,"] ").concat(i.toString()))}this._statsCollector=new Lp(this.store),this._statsCollector.onStatsException=(i,o,a)=>{y.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(i,", msg: ").concat(o,", uid: ").concat(a)),this.safeEmit(at.EXCEPTION,{code:i,msg:o,uid:a})},this._statsCollector.onUploadPublishDuration=(i,o,a,l)=>{const u=this._users.find(h=>h.uid===i);u&&Oe.peerPublishStatus(this._sessionId,{subscribeElapse:l,audioPublishDuration:o,videoPublishDuration:a,peer:u._uintid})},this.store.useDataChannel=mt().supportDataChannel&&V("SIGNAL_CHANNEL"),this.store.useP2P=e.mode==="p2p",this._gateway=new Sz(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||yn,httpRetryConfig:e.httpRetryConfig||yn,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:t}),this._configDistribute=new Oz,this.store.useP2P?(this._p2pChannel=new Mn(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new ti(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,i,o,a){let l=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],u=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Nt("JOIN_GATEWAY_USE_443PORT_ONLY",l),Nt("JOIN_GATEWAY_USE_DUAL_DOMAIN",u);const h=this._gateway.signal.websocket;return h instanceof ep&&(h.use443PortOnly=l,h.tryDoubleDomain=u),async function(f,m,E){zm.get(f)||zm.set(f,[]),Ym.get(f)||Ym.set(f,m),wo.get(f)||wo.set(f,0);const v=zm.get(f),T=Ym.get(f);if(!v||!T)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(wo.get(f)===T){const M=Gh();v.push(M),await M.promise}wo.set(f,wo.get(f)+1);for(var A=arguments.length,C=new Array(A>3?A-3:0),b=3;b<A;b++)C[b-3]=arguments[b];const D=await E(...C);return wo.set(f,wo.get(f)-1),wo.get(f)===T-1&&v.length>0&&(v[0].resolve(),v.shift()),wo.get(f)===0&&(zm.set(f,[]),Ym.set(f,0),wo.set(f,0)),D}("client.join",V("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,i,o,a)}async join(e,t,i,o,a){const l=++this._numberOfJoinCount;this.store.joinStart(),o&&(this.store.uid=o);const u=MK(),h=h1()?window.isSecureContext:"Browser Not Support";(!h1()&&!u||!window.isSecureContext)&&y.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");const f=LT();this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),y.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart)));const m=Oe.reportApiInvoke(f,{name:vn.JOIN,options:[e,t,i,o],states:{isHttps:u,isSecureContext:h},tag:Qt.TRACER});Oe.setAppId(e);try{if(!i&&i!==null)throw new W(N.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&fi(i,"token",1,2047),fi(e,"appid",1,2047),oy(t),o&&ay(o),a&&fi(a,"optionalInfo",1,2047)}catch(C){throw m.onError(C),C}if(y.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(l)),this._leaveMutex.isLocked&&(y.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),y.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const C=new W(N.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw m.onError(C),C}this._sessionId||(this._sessionId=f,this.store.sessionId=this._sessionId),this._gateway.state="CONNECTING";const E=uo(uo({},this._rtmConfig),{},{clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof o!="string"?o:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:i||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:a,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(E.setLocalAPVersion=this._setLocalAPVersion),typeof o=="string"&&(E.stringUid=o,this._uintUid?(E.uid=this._uintUid,this._uintUid=void 0):E.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(E.aesmode=this._encryptionMode,E.aespassword=await ZH(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new W(N.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(E.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const C=new TextEncoder,b=V("USE_PURE_ENCRYPTION_MASTER_KEY")?C.encode(E.appId+this._encryptionSecret+this._encryptionSecret):C.encode(E.appId+E.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(D,M,B){const J=await window.crypto.subtle.importKey("raw",M,"PBKDF2",!1,["deriveBits","deriveKey"]),G=D==="aes-128-gcm2"?128:256,q=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:_1,hash:"SHA-256",salt:B},J,G+UK);return new Uint8Array(q).subarray(G/8)}(this._encryptionMode,b,Kh(this._encryptionSalt)),this._encryptDataStreamKey=await async function(D,M,B){const J=await window.crypto.subtle.importKey("raw",M,"PBKDF2",!1,["deriveBits","deriveKey"]),G=D==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:_1,hash:"SHA-256",salt:B},J,{name:"AES-GCM",length:G},!0,["encrypt","decrypt"])}(this._encryptionMode,b,Kh(this._encryptionSalt))}else h?y.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):y.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,y.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:E.stringUid});const v=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&v===this._sessionId&&Oe.joinChannelTimeout(this._sessionId,5)},5e3);try{var T;let C;const b=E.cloudProxyServer;if(Ie(T=["proxy3","proxy4","proxy5"]).call(T,b)){const G=V("PROXY_SERVER_TYPE3");Array.isArray(G)?E.proxyServer=G[0]:E.proxyServer=G}if(Oe.setProxyServer(E.proxyServer),y.setProxyServer(E.proxyServer),this.store.requestAPStart(),E.stringUid&&!E.uid){let G;[G,C]=await X.all([sD(E.stringUid,E,this._axiosCancelSource.token,this._config.httpRetryConfig||yn,this.store),rD(E,this._axiosCancelSource.token,this._config.httpRetryConfig||yn,!0,this.store)]),y.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(E.stringUid," => ").concat(G)),E.uid=G,C.gatewayInfo.uid=G,C.gatewayInfo.res.uid=G}else C=await rD(E,this._axiosCancelSource.token,this._config.httpRetryConfig||yn,!0,this.store);if(!this._joinAndNotLeaveYet)throw new W(N.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(E,this._axiosCancelSource.token),this._configDistribute.on(Zh.UPDATE_BITRATE_LIMIT,G=>{this._p2pChannel.updateBitrateLimit(G)})},0),this._key=i||e;const D=C.gatewayInfo,M=E.uid?E.uid:D.uid;this._joinInfo=uo(uo({},E),{},{cid:D.cid,uid:M,vid:D.vid,apResponse:D.res,uni_lbs_ip:D.uni_lbs_ip,gatewayAddrs:D.gatewayAddrs}),this.store.intUid=M;const B=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new W(N.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));m.onSuccess(B),this._appId=e,this._channelName=E.cname,this._uid=B,this.store.uid=B,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(ii()?"beforeunload":"pagehide",this._handleBeforeUnload)},0);const J=E.stringUid?"string uid: ".concat(E.stringUid,",uid: ").concat(E.uid):"uid: ".concat(this._uid);return y.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(J)),setTimeout(()=>{y.startUpload()},5e3),this.store.joinEnd(),A=this,Ie(oc).call(oc,A)||oc.push(A),B}catch(C){const b=Array.isArray(C)?C[0]:C;throw b&&b.code===N.OPERATION_ABORTED?y.warning("[".concat(this._clientId,"] join number: ").concat(l,", Joining channel failed, rollback"),b):y.error("[".concat(this._clientId,"] join number: ").concat(l,", Joining channel failed, rollback"),b),b.code!==N.OPERATION_ABORTED&&this._numberOfJoinCount===l&&(this._gateway.state="DISCONNECTED",this._reset()),m.onError(b),b}var A}_joinGateway(){if(!this._joinInfo||!this._key)throw new W(N.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!V("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then(e=>e).catch(e=>{if(e.code===N.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,ot.FALLBACK),e;if(e.code===N.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,ot.FALLBACK),e;throw e}).then(e=>{if(e instanceof W){if(e.code===N.INIT_WEBSOCKET_TIMEOUT){if(y.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new W(N.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";const t=V("PROXY_SERVER_TYPE3");if(Array.isArray(t))if(this._joinInfo.apUrl){const o=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),a=o.slice(o.length-2).join(".");t.forEach(l=>{this._joinInfo&&Ie(l).call(l,a)&&(this._joinInfo.proxyServer=l)}),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=t[0])}else this._joinInfo.proxyServer=t[0];else this._joinInfo.proxyServer=t;const i=V("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return i&&i[1]&&i[1]!=="443"&&y.setProxyServer(this._joinInfo.proxyServer),V("STATS_COLLECTOR_PORT").toString()!=="443"&&Oe.setProxyServer(this._joinInfo.proxyServer),Oe.reportApiInvoke(this._sessionId,{name:vn.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:Qt.TRACER}).onSuccess(),this.safeEmit(at.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),V("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&this._joinInfo.turnServer.servers.forEach(o=>{"forceturn"in o&&(o.forceturn=!0)}),this._gateway.join(this._joinInfo,this._key)}if(y.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new W(N.INVALID_OPERATION);return Oe.reportApiInvoke(this._sessionId,{name:vn.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:Qt.TRACER}).onSuccess(),this._joinGateway()}return e}).then(e=>e)}async leave(){y.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(ii()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){const i=oc.indexOf(t);i!==-1&&oc.splice(i,1)}(this);const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return y.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED"),y.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof _i))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new W(N.INVALID_PARAMS,"param list is empty");const i=e;if(this._gateway.role==="audience")throw new W(N.INVALID_OPERATION,"audience can not publish stream");for(const a of i){if(!(a instanceof _i))throw new W(N.INVALID_PARAMS,"parameter is not local track");if(!a._enabled&&t)throw new W(N.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(a.getTrackId()))}y.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(i.map(a=>"".concat(a.getTrackId()," "))));const o=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&i.forEach(a=>{const l=this._configDistribute.getBitrateLimit();a instanceof et&&l&&a.setBitrateLimit(l.uplink)});try{await this._publishHighStream(i),y.info("[".concat(this._clientId,"] Publish success, id ").concat(i.map(a=>"".concat(a.getTrackId()," "))))}catch(a){throw y.error("[".concat(this._clientId,"] publish error"),a.toString()),a}finally{o()}}async _publishDataChannel(e){Ot(e.id,"id",0,65535,!0),sa(e.ordered,"ordered"),fi(e.metadata,"metadata",0,512),y.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(o=>o.id===e.id)!==-1)throw new W(N.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new W(N.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new W(N.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&V("FORCE_TURN")&&!V("TURN_ENABLE_TCP")&&!V("TURN_ENABLE_UDP"))throw new W(N.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const i=new Mk(e);if(await this._p2pChannel.publishDataChannel([i]),!this._p2pChannel.isP2PDisconnected()){if(typeof i._originDataChannelId!="number")throw y.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new W(N.CREATE_DATACHANNEL_ERROR);try{const o={streamId:e.id,ordered:e.ordered,maxRetransmits:V("DATASTREAM_MAX_RETRANSMITS"),metadata:e.metadata,channelId:i._originDataChannelId};await this._gateway.publishDataChannel(this._uid,o,!0),await i._waitTillOpen()}catch(o){if(o.code!==N.DISCONNECT_P2P)throw o}}return y.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(i.id)),i}catch(i){throw y.error("[".concat(this._clientId,"] publish datachannels error"),i.toString()),i}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new W(N.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof _i))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);y.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(o=>"".concat(o.getTrackId()," "))," "));const i=await this._publishMutex.lock();try{if(this._p2pChannel instanceof Mn){const o=await this._p2pChannel.unpublish(t);o&&await this._gateway.sendExtensionMessage(sn.UNPUBLISH,{unpubMsg:o},!0)}else{const o=await this._p2pChannel.unpublish(t);o&&await this._gateway.unpublish(o,this._uid),y.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(a=>"".concat(a.getTrackId()))))}}catch(o){throw y.error("[".concat(this._clientId,"] unpublish error"),o.toString()),o}finally{i&&i()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),y.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(i=>"".concat(i.id," "))," "));const t=await this._publishMutex.lock();try{const i=await this._p2pChannel.unpublishDataChannel(e);i&&await this._gateway.unpublishDataChannel(i),y.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(o=>"".concat(o.id))))}catch(i){throw y.error("[".concat(this._clientId,"] unpublish dataChannel error"),i.toString()),i}finally{t&&t()}}async subscribe(e,t,i){return t==="datachannel"?this._subscribeDataChannel(e,i):this._subscribe(e,t)}async presubscribe(e,t){if(Pn(t,"mediaType",["audio","video"]),this._p2pChannel instanceof Mn)throw new W(N.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new W(N.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new W(N.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const i=t===be.AUDIO,o=t===be.VIDEO,a=await this._subscribeMutex.lock();try{const{ssrcId:l,ortc:u,rtxSsrcId:h,cname:f,uint_id:m}=await this._gateway.presubscribe(e,t,!0);if(l==null)throw new W(N.UNEXPECTED_RESPONSE,"no ssrc id");let E=this._users.find(T=>T.uid===e);E||(E=new si(e,m||e),E._is_pre_created=!0,this._users.push(E)),f&&(E._cname=f),E._uintid||(E._uintid=m||e),i&&(E._audioSSRC=l,E._audio_pre_subscribed=!0,u&&(E._audioOrtc=u)),o&&(E._videoSSRC=l,E._video_pre_subscribed=!0,u&&(E._videoOrtc=u),h!=null&&(E._rtxSsrcId=h)),y.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(l)),await this._p2pChannel.subscribe(E,t,l,h,u);const v=i?E._audioTrack:E._videoTrack;if(!v)throw new W(N.UNEXPECTED_ERROR,"can not find remote track in user");return i&&(E._trust_audio_stream_added_state_=!0,E._audio_added_=!0),o&&(E._trust_video_stream_added_state_=!0,E._video_added_=!0),v}catch(l){throw y.error("[".concat(this._clientId,"] presub user ").concat(e," error"),l),l}finally{a()}}async _subscribeDataChannel(e,t){var i;if(Ot(t,"channelId",0,65535,!0),!this._joinInfo)throw new W(N.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new W(N.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===e))throw y.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new W(N.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw y.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new W(N.INVALID_REMOTE_USER,"user is not published");const o=(i=e._dataChannels)===null||i===void 0?void 0:i.find(u=>u.id===t);if(!o)throw y.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new W(N.REMOTE_USER_IS_NOT_PUBLISHED);const a=await this._subscribeMutex.lock();y.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const u=await this._p2pChannel.subscribeDataChannel(e,[o]);if(u&&Ie(u).call(u,o.id))try{var l;if(typeof o._originDataChannelId!="number")throw y.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new W(N.CREATE_DATACHANNEL_ERROR);const h={id:o.id,datachannelId:o._originDataChannelId,ordered:o.ordered,maxRetransmits:o.maxRetransmits,metadata:(l=o.metadata)!==null&&l!==void 0?l:""};await this._gateway.subscribeDataChannel(e.uid,h,!0),await o._waitTillOpen()}catch(h){if((h==null?void 0:h.code)!==N.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[o]),h;await this._p2pChannel.unsubscribeDataChannel(e,[o]),this._p2pChannel.setPendingRemoteDataChannel(e,o.id)}return y.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),o}finally{a()}}async _p2pSubscribe(e,t,i){if(Pn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new W(N.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new W(N.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(a=>a===e)){const a=new W(N.INVALID_REMOTE_USER,"user is not in the channel");throw y.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),a}if(!e.hasAudio&&!e.hasVideo){const a=new W(N.INVALID_REMOTE_USER,"user is not published");throw y.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),a}if(!i&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){const a=new W(N.REMOTE_USER_IS_NOT_PUBLISHED);throw y.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),a}const o=await this._subscribeMutex.lock();y.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const l=t==="audio"?e._audioSSRC:e._videoSSRC,u=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this._p2pChannel instanceof Mn&&await this._p2pChannel.subscribe(e,t,l,u)}catch(l){throw l}y.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(l=>{y.warning("[".concat(this._clientId,"] auto set fallback failed"),l)});const a=t==="audio"?e._audioTrack:e._videoTrack;if(!a)throw new W(N.UNEXPECTED_ERROR,"can not find remote track in user object");return a}catch(a){throw y.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),a),a}finally{o()}}async _subscribe(e,t,i){if(this._p2pChannel instanceof Mn)return this._p2pSubscribe(e,t);if(Pn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new W(N.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new W(N.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(f=>f===e)){const f=new W(N.INVALID_REMOTE_USER,"user is not in the channel");throw y.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),f}if(!e.hasAudio&&!e.hasVideo){const f=new W(N.INVALID_REMOTE_USER,"user is not published");throw y.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),f}if(!(i||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const f=new W(N.REMOTE_USER_IS_NOT_PUBLISHED);throw y.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),f}let o=t==="audio"?e._audioSSRC:e._videoSSRC,a=t==="audio"?e._audioOrtc:e._videoOrtc,l=t==="video"?e._rtxSsrcId:void 0,u={stream_type:t==="audio"?be.AUDIO:be.VIDEO,ssrcId:o};const h=await this._subscribeMutex.lock();y.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const m=t==="audio"?e._audioSSRC:e._videoSSRC;m!==void 0&&m!==o&&(o=m,a=t==="audio"?e._audioOrtc:e._videoOrtc,l=t==="video"?e._rtxSsrcId:void 0,u={stream_type:t==="audio"?be.AUDIO:be.VIDEO,ssrcId:o}),Ei.markSubscribeStart(this.store.clientId,o),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,o,l,a);try{await this._gateway.subscribe(e.uid,u,!0)}catch(E){if((E==null?void 0:E.code)!==N.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),E;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(m){throw this._p2pChannel.reportSubscribeEvent(!1,m==null?void 0:m.code,e,t),m}y.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(m=>{y.warning("[".concat(this._clientId,"] auto set fallback failed"),m)});const f=t==="audio"?e._audioTrack:e._videoTrack;if(!f)throw new W(N.UNEXPECTED_ERROR,"can not find remote track in user object");return f}catch(f){throw y.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),f),f}finally{h()}}async massSubscribe(e){if(oa(e,"subscribeList"),!this._joinInfo)throw new W(N.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new W(N.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),i=new Map,o=await this._subscribeMutex.lock();y.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(h=>{let{user:f,mediaType:m}=h;return"user: ".concat(f==null?void 0:f.uid,", mediaType: ").concat(m)}).join("; ")));const a=(e=[...e]).map(h=>{let{user:f,mediaType:m}=h;return{user:f,mediaType:m}}),l=await this._p2pChannel.globalLock();try{var u;for(let f=e.length-1;f>=0;f--){const m=e[f],{user:E,mediaType:v}=m;if(Pn(v,"mediaType",["audio","video"]),!E){const C=new W(N.INVALID_PARAMS,"user property does not exist in subscribeList item");throw y.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),C}if(!this._users.find(C=>C===E)){const C=new W(N.INVALID_REMOTE_USER,"user is not in the channel");y.error("[".concat(this._clientId,"] can not massSubscribe ").concat(E.uid,", this user is not in the channel")),a[f].error=C,e.splice(f,1);continue}if(v==="audio"&&(!E.hasAudio||E._audioSSRC===void 0)||v==="video"&&(!E.hasVideo||E._videoSSRC===void 0)){const C=new W(N.REMOTE_USER_IS_NOT_PUBLISHED);y.error("[".concat(this._clientId,"] can not subscribe ").concat(E.uid," with mediaType ").concat(v,", remote user is not published")),a[f].error=C,e.splice(f,1);continue}const T=Cn.Video|Cn.LwoVideo,A=i.get(E);if(A){if(v==="video"?A&T:A&Cn.Audio){e.splice(f,1),y.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(E.uid,", mediaType:").concat(v," twice"));continue}i.set(E,A|(v==="video"?T:Cn.Audio))}else i.set(E,v==="video"?T:Cn.Audio)}for(let f=e.length-1;f>=0;f--){const m=e[f],{user:E,mediaType:v}=m,T=Cn.Video|Cn.LwoVideo;if(this._p2pChannel.hasRemoteMedia(E,v)){await this._p2pChannel.unmuteRemoteNoLock(E,v);const A=i.get(E);i.set(E,v==="video"?A^T:A^Cn.Audio),e.splice(f,1)}}this.store.massSubscribe(e.map(f=>({userId:f.user.uid,type:f.mediaType})),t);const h=ca(u=Array.from(i.entries())).call(u,(f,m)=>{let[E,v]=m;if(v===0)return f;const T={stream_id:E.uid,stream_type:v};return v&Cn.Audio&&(T.audio_ssrc=E._audioSSRC),v&Cn.Video&&(T.video_ssrc=E._videoSSRC),f.push(T),f},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(m=>{let{user:E,mediaType:v}=m;return{user:E,mediaType:v,ssrcId:v===be.VIDEO?E._videoSSRC:E._audioSSRC,rtxSsrcId:v===be.VIDEO?E._rtxSsrcId:void 0}}));const f=new Map;if(h.length>0){const m=await this._gateway.subscribeAll(h,!0);((m==null?void 0:m.users)||[]).forEach(E=>{let{stream_id:v,video_error_code:T,audio_error_code:A,error_code:C}=E;(T||A||C)&&f.set(v,{video_error_code:T,audio_error_code:A,error_code:C})})}if(Array.from(f.entries()).length>0){const m=[];Array.from(f.entries()).forEach(E=>{let[v,T]=E;const A=this.remoteUsers.find(C=>C.uid===v);if(A){let C;T.error_code||T.video_error_code&&T.audio_error_code?C=void 0:T.video_error_code?C=be.VIDEO:T.audio_error_code&&(C=be.AUDIO),m.push({user:A,mediaType:C})}}),m.length>0&&await this._p2pChannel.massUnsubscribeNoLock(m)}for(const m of a){const E=f.get(m.user.uid);if(E){const v=E.error_code||m.mediaType==="audio"&&E.audio_error_code||m.mediaType==="video"&&E.video_error_code;if(v){const T=Cl(v);y.error("user:".concat(m.user.uid," mediaType:").concat(m.mediaType," has massSubscribe error ").concat(T.desc)),m.error=new W(N.SUBSCRIBE_FAILED,"code ".concat(v,": ").concat(T.desc))}}m.error||(m.mediaType==="video"?m.track=m.user.videoTrack:m.track=m.user.audioTrack)}return this.store.massSubscribe(a.filter(m=>!m.error).map(m=>({userId:m.user.uid,type:m.mediaType})),void 0,Date.now()),a.forEach(m=>{var E;Oe.subscribe(this.store.sessionId,{succ:!!m.error,ec:((E=m.error)===null||E===void 0?void 0:E.code)||null,video:m.mediaType===be.VIDEO,audio:m.mediaType===be.AUDIO,peerid:m.user.uid,subscribeRequestid:m.mediaType===be.VIDEO?m.user._videoSSRC:m.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t)},!0)}),y.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(m=>{let{user:E,mediaType:v}=m;return"user: ".concat(E==null?void 0:E.uid,", mediaType: ").concat(v)}).join("; "))),a}catch(f){throw await this._p2pChannel.massUnsubscribeNoLock(e),f}}finally{l(),o()}}async unsubscribe(e,t,i){if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,i)}else await this._unsubscribeDataChannel(e,i);if(t&&Pn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new W(N.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(a=>a===e)){const a=new W(N.INVALID_REMOTE_USER,"user is not in the channel");throw y.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),a}y.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const o=await this._subscribeMutex.lock();try{if(this._p2pChannel instanceof Mn)await this._p2pChannel.unsubscribe(e,t);else{const a=await this._p2pChannel.unsubscribe(e,t);a&&await this._gateway.unsubscribe(a,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&$m(this._users,e),y.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(a){if(a.code===N.DISCONNECT_P2P)return void y.warning("disconnecting p2p, abort unsubscribe request.");throw y.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),a.toString()),a}finally{o()}}async _unsubscribeDataChannel(e,t){if(t&&Ot(t,"id",0,65535,!0),!this._joinInfo)throw new W(N.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(o=>o===e)){const o=new W(N.INVALID_REMOTE_USER,"user is not in the channel");throw y.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),o}let i;if(typeof t=="number"){const o=e._dataChannels.find(a=>a.id===t);o&&(i=[o])}else i=e._dataChannels;if(i===void 0){const o=new W(N.REMOTE_USER_IS_NOT_PUBLISHED);throw y.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),o}y.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(i.map(o=>o.id)));try{const o=await this._p2pChannel.unsubscribeDataChannel(e,i);o&&await this._gateway.unsubscribeDataChannel(o,e.uid),y.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(o))}catch(o){if(o.code===N.DISCONNECT_P2P)return void y.warning("disconnecting p2p, abort unsubscribe request.");throw y.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),o.toString()),o}}async massUnsubscribe(e){if(oa(e,"unsubscribeList"),!this._joinInfo)throw new W(N.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");y.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(i=>{let{user:o,mediaType:a}=i;return"user: ".concat(o==null?void 0:o.uid,", mediaType: ").concat(a,";")}).join())),e=[...e];const t=new Map;for(let i=e.length-1;i>=0;i--){const{user:o,mediaType:a}=e[i];if(!o){const u=new W(N.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw y.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),u}if(Pn(a,"mediaType",["video","audio",void 0]),!this._users.find(u=>u===o)){y.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(o.uid,", user is not in the channel")),e.splice(i,1);continue}const l=Cn.Video|Cn.LwoVideo;if(t.has(o)){const u=t.get(o);let h;switch(a){case"video":h=u&l;break;case"audio":h=u&Cn.Audio;break;default:h=u&(Cn.Audio|l)}if(h){y.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(o.uid,",mediaType:").concat(a," twice.")),e.splice(i,1);continue}a?a==="audio"?t.set(o,u|Cn.Audio):a==="video"&&t.set(o,u|l):t.set(o,u|Cn.Audio|l)}else a?a==="audio"?t.set(o,Cn.Audio):a==="video"&&t.set(o,l):t.set(o,Cn.Audio|l)}try{const i=await this._p2pChannel.massUnsubscribe(e);i&&await this._gateway.massUnsubscribe(i),y.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(o=>{let{user:a,mediaType:l}=o;return"user: ".concat(a==null?void 0:a.uid,", mediaType: ").concat(l,";")}).join()))}catch(i){if(i.code===N.DISCONNECT_P2P)return void y.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw y.error("[".concat(this._clientId,"] massUnsubscribe error"),i.toString()),i}}async setLowStreamParameter(e){(function(i){if(!i)throw new ne(N.INVALID_PARAMS);tn(i.width)||OT(i.width,"streamParameter.width"),tn(i.height)||OT(i.height,"streamParameter.height"),tn(i.framerate)||OT(i.framerate,"streamParameter.framerate"),tn(i.bitrate)||Ot(i.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&y.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),y.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,ce.LocalVideoLowTrack)}async enableDualStream(){if(!mt().supportDualStream)throw Oe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new W(N.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new W(N.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw Oe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,Oe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),y.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new W(N.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(ce.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw Oe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,Oe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),y.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(i){Pn(i,"role",["audience","host"])}(e),t&&yP(t),this.mode==="rtc"||this.mode==="p2p")throw y.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new W(N.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new W(N.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new W(N.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(e,t),this._config.role=e,y.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}getRemoteInboundOffset(){var e;const t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const i=t.timestamp-Date.now();return Math.abs(i)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?i:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(fi(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new W(N.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new W(N.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,Oe.setProxyServer(this._proxyServer),y.setProxyServer(this._proxyServer),y.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new W(N.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new W(N.INVALID_OPERATION,"You have already set the proxy")}if(xd(e))return this._turnServer={servers:e,mode:"original-manual"},void y.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(i=>i.urls).join(","),"."));e.forEach(i=>TP(i)),this._turnServer={servers:e,mode:"manual"},y.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new W(N.INVALID_OPERATION,"you should set license before join channel");if(fi(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new W(N.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,y.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new W(N.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new W(N.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let i;switch(e===void 0&&(e=3),e){case 1:case 2:throw new W(N.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:i="proxy3";break;case 4:i="proxy4";break;case 5:i="proxy5";break;default:throw new W(N.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=i,this.store.cloudProxyServerMode=i,y.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new W(N.INVALID_OPERATION,"Stop proxy server after leave channel");Oe.setProxyServer(),y.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",y.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new W(N.INVALID_PARAMS,"accessPoints is required.");oa(e.accessPoints.serverList,"accessPoints.serverList"),fi(e.accessPoints.domain,"accessPoints.domain");const t=(T,A)=>{Ot(T,A,0,65535,!0)};let i=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),i=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new W(N.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");V("CLOSE_AFB_FOR_LOCAL_AP")&&(Nt("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Nt("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const o=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,a=e.accessPoints.domain,l=e.accessPoints.serverList.map(T=>o.test(T)?"".concat(T.replace(/\./g,"-"),".").concat(a):T),u=l.map(T=>"".concat(T,":").concat(i));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Nt("WEBCS_DOMAIN",u),Nt("WEBCS_DOMAIN_BACKUP_LIST",u),Nt("GATEWAY_DOMAINS",[a]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(oa(e.report.hostname,"report.hostname"),Nt("EVENT_REPORT_DOMAIN",e.report.hostname[0]),Nt("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(Nt("EVENT_REPORT_DOMAIN",l[0]),Nt("EVENT_REPORT_BACKUP_DOMAIN",l[1]||l[0]));let h=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),h=e.report.port),Nt("STATS_COLLECTOR_PORT",h),e.report?Nt("ENABLE_EVENT_REPORT",!0):Nt("ENABLE_EVENT_REPORT",!1);let f="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(oa(e.log.hostname,"log.hostname"),f=e.log.hostname[0]):f=l[0];let m=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),m=e.log.port),Nt("LOG_UPLOAD_SERVER","".concat(f,":").concat(m));let E=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(oa(e.cds.hostname,"cds.hostname"),E=e.cds.hostname):E=l;let v=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),v=e.cds.port),Nt("CDS_AP",E.map(T=>"".concat(T,":").concat(v))),e.cds?Nt("ENABLE_CONFIG_DISTRIBUTE",!0):Nt("ENABLE_CONFIG_DISTRIBUTE",!1),y.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(oa(e,"serverList"),fi(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new W(N.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const i=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(o=>i.test(o)?"".concat(o.replace(/\./g,"-"),".").concat(t):o),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Nt("WEBCS_DOMAIN",e),Nt("WEBCS_DOMAIN_BACKUP_LIST",e),Nt("GATEWAY_DOMAINS",[t]),Nt("EVENT_REPORT_DOMAIN",e[0]),Nt("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),Nt("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),y.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(Pn(e,"streamType",[0,1]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw y.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else y.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){Pn(t,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const i=this._users.find(o=>o.uid===e);i&&i.videoTrack&&i.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(i){throw y.error("[".concat(this._clientId,"] set remote video stream type error"),i.toString()),i}y.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){Pn(t,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(i){throw y.error("[".concat(this._clientId,"] set stream fallback option"),i.toString()),i}y.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,i,o){(function(l){Pn(l,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),fi(t,"secret");const a=["aes-128-gcm2","aes-256-gcm2"];if(Ie(a).call(a,e)){if(!i||!(i instanceof Uint8Array&&i.length===32))throw new W(N.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(i)throw new W(N.INVALID_PARAMS,"current encrypt mode does not need salt");if(o){if(sa(o,"encryptDataStream"),!Ie(a).call(a,e))throw new W(N.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||y.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,i&&(this._encryptionSalt=Fd(i))}async renewToken(e){if(fi(e,"token",1,2047),!this._key||!this._joinInfo)throw new W(N.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const i=await this._renewTokenMutex.lock();try{if(V("USE_NEW_TOKEN")){y.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const o=await Az(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||yn);y.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:o})}else y.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});y.debug("[".concat(this._clientId,"] renewToken success"))}catch(o){throw this._key=t,this._joinInfo.token=t,y.error("[".concat(this._clientId,"] renewToken failed"),o.toString()),o}finally{i()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?y.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(at.VOLUME_INDICATOR,e)},V("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new W(N.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new W(N.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new W(N.LIVE_STREAMING_TASK_CONFLICT);const i=t?kn.TRANSCODE:kn.RAW;return this._createLiveStreamingClient(i).startLiveStreamingTask(e,i)}setLiveTranscoding(e){return this._createLiveStreamingClient(kn.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(i=>i&&i.hasUrl(e));if(!t.length)throw new W(N.INVALID_PARAMS,"can not find live streaming url to stop");await X.all(t.map(i=>i&&i.stopLiveStreamingTask(e)))}async addInjectStreamUrl(e,t){if(!this._joinInfo)throw new W(N.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const i=this._createLiveStreamingClient(kn.INJECT);i.setInjectStreamConfig(t,0),await i.startLiveStreamingTask(e,kn.INJECT)}async removeInjectStreamUrl(){var e;const t=this._createLiveStreamingClient(kn.INJECT),i=Array.from(no(e=t.streamingTasks).call(e)).find(o=>o.mode===kn.INJECT);if(!this._joinInfo||!i)throw new W(N.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await t.stopLiveStreamingTask(i.url)}async startChannelMediaRelay(e){cM(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){cM(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}async sendStreamMessage(e){var t;let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new W(N.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const a=new TextEncoder;e.payload=a.encode(e.payload)}let o=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Ie(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(o=!0,e.payload=await async function(a,l,u){var h;const f=ca(h=Array.from(u)).call(h,(b,D)=>b+D,0),m={serverTs:0,seq:VK++,length:u.length,checkSum:f},E=new Uint8Array(PP(f,2)),v=new ArrayBuffer(Wd),T=new DataView(v);T.setUint32(0,m.serverTs),T.setUint16(4,m.seq),T.setUint16(6,m.length),T.setUint16(8,m.checkSum);const A=16-u.length%16;u=wP(u,new Uint8Array(A));const C=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:a,tagLength:m1,additionalData:E},l,u);return wP(new Uint8Array(v),new Uint8Array(C))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new W(N.INVALID_PARAMS,o?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Ne.DATA_STREAM,{payload:Fd(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-Cq},!i)}sendMetadata(e){if(!this._joinInfo)throw new W(N.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new W(N.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Ne.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Fd(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(jK),!this._joinInfo)throw new W(N.INVALID_OPERATION,"can not send custom report, not joined");await Oe.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){Pn(t.spatialLayer,"spatialLayer",[0,1,2,3]),Pn(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(i){throw y.error("[".concat(this._clientId,"] pick SVC layer failed"),i.toString()),i}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:i}=e;if(sa(t,"apRTM"),Ot(i,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=i,y.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=i,this._gateway.setRTM2Flag(i)}_reset(){if(y.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=rr.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Qn("client-publish"),this._subscribeMutex=new Qn("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var i;const o=e||LT();e?y.debug("[".concat(this._clientId,"] new Session ").concat(o)):y.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(o));const a=e?"":this._sessionId||"";this._sessionId=o,this.store.sessionId=o;const l={lts:new Date().getTime(),mode:this.mode,stringUid:(t==null?void 0:t.stringUid)||((i=this._joinInfo)===null||i===void 0?void 0:i.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:a,clientRole:this.role==="audience"?2:1};t?Oe.sessionInit(this._sessionId,uo({cname:t.channel,appid:t.appId},l)):this._joinInfo?Oe.sessionInit(this._sessionId,uo({cname:this._joinInfo.cname,appid:this._joinInfo.appId},l)):this._gateway.joinInfo&&Oe.sessionInit(this._sessionId,uo({cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId},l)),this._joinInfo&&(this._joinInfo.sid=o),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=o)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new W(N.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new W(N.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&V("FORCE_TURN")&&!V("TURN_ENABLE_TCP")&&!V("TURN_ENABLE_UDP"))throw new W(N.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");y.debug("[".concat(this._clientId,"] publish high stream"));try{const i=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this._p2pChannel instanceof Mn){const o=(await i.next()).value;if(o){try{await this._gateway.sendExtensionMessage(sn.PUBLISH,o,!0)}catch(a){throw i.throw(a),a}await i.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const o=(await i.next()).value;if(o){var t;let a;try{a=await this._gateway.publish(this._uid,o,!0)}catch(l){if(l.code!==N.DISCONNECT_P2P)throw i.throw(l),l}await i.next(((t=a)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const a of e)a instanceof et&&a._encoderConfig&&this._gateway.setVideoProfile(a._encoderConfig),!a.muted&&a.enabled||await this._p2pChannel.muteLocalTrack(a)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,e),(i==null?void 0:i.code)===N.WS_ABORT)return;throw i}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new W(N.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new W(N.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));y.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const i=await this._p2pChannel.publishLowStream(this._lowStreamParameter),o=(await i.next()).value;if(o){var t;let a;try{a=await this._gateway.publish(this._uid,o,!0)}catch(l){if(l.code!==N.DISCONNECT_P2P)throw i.throw(l),l}i.next(((t=a)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,void 0,!0),(i==null?void 0:i.code)===N.WS_ABORT)return;throw i}}_createLiveStreamingClient(e){if(!this._joinInfo||!this._appId)return new W(N.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const t=()=>new tq(this._joinInfo,this._config.websocketRetryConfig||yn,this._config.httpRetryConfig||yn),i=o=>{o.onLiveStreamError=(a,l)=>{Oe.reportApiInvoke(this._sessionId,{name:vn.ON_LIVE_STREAM_ERROR,options:[a,l],tag:Qt.TRACER}).onSuccess(),this.safeEmit(at.LIVE_STREAMING_ERROR,a,l)},o.onLiveStreamWarning=(a,l)=>{Oe.reportApiInvoke(this._sessionId,{name:vn.ON_LIVE_STREAM_WARNING,options:[a,l],tag:Qt.TRACER}).onSuccess(),this.safeEmit(at.LIVE_STREAMING_WARNING,a,l)},o.on(Kd.REQUEST_WORKER_MANAGER_LIST,(a,l,u)=>{if(!this._joinInfo)return u(new W(N.INVALID_OPERATION,"can not find join info to get worker manager"));aD(a,this._joinInfo,this._axiosCancelSource.token,yn).then(l).catch(u)})};switch(e){case kn.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=t(),i(this._liveRawStreamingClient)),this._liveRawStreamingClient;case kn.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=t(),i(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case kn.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=t(),this._injectStreamingClient.on(Kd.REQUEST_WORKER_MANAGER_LIST,(o,a,l)=>{if(!this._joinInfo)return l(new W(N.INVALID_OPERATION,"can not find join info to get worker manager"));aD(o,this._joinInfo,this._axiosCancelSource.token,yn).then(a).catch(l)}),this._injectStreamingClient.onInjectStatusChange=(o,a,l)=>{this.safeEmit(at.INJECT_STREAM_STATUS,o,a,l)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){if(!this._joinInfo)return new W(N.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:e,sendResolutionHeight:t}=this.getLocalVideoStats(),i={width:e,height:t};this._channelMediaRelayClient=new iq(this._joinInfo,this._clientId,this._config.websocketRetryConfig||yn,this._config.httpRetryConfig||yn,i),this._channelMediaRelayClient.on("state",o=>{o===Hi.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.safeEmit(at.CHANNEL_MEDIA_RELAY_STATE,o)}),this._channelMediaRelayClient.on("event",o=>{this.safeEmit(at.CHANNEL_MEDIA_RELAY_EVENT,o)}),this._statsCollector.onStatsChanged=(o,a)=>{var l;o==="resolution"&&((l=this._channelMediaRelayClient)===null||l===void 0||l.setVideoProfile(a))}}return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:i,deleted:o}=e,a=[];Array.isArray(i)&&i.length>0&&i.forEach(l=>{const{uid:u,stream_id:h,ordered:f,max_retrans_times:m,metadata:E}=l,v=this._users.find(T=>T._uintid===u);if(!v)return void y.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(y.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(u)),Ie(a).call(a,v)||a.push(v),v._uintid||(v._uintid=u),v._dataChannels.findIndex(T=>T.id===l.stream_id)===-1){const T={id:h,ordered:!!f,maxRetransmits:m,metadata:E},A=new q9(T);v._dataChannels.push(A),y.info("[".concat(this._clientId,"] remote user ").concat(v.uid," published datachannel")),t||this.safeEmit(at.USER_PUBLISHED,v,"datachannel",T)}this._p2pChannel.hasPendingRemoteDataChannel(v,l.stream_id)&&(y.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(v.uid," after reconnect.")),this._subscribeDataChannel(v,l.stream_id).catch(T=>{y.error("[".concat(this._clientId,"] resubscribe datachannel error"),T.toString())}))}),t&&(this.safeEmit(at.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(o)&&o.length>0&&o.forEach(l=>{const{uid:u,stream_id:h}=l,f=this._users.find(E=>E._uintid===u);if(!f)return void y.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const m=f._dataChannels.find(E=>E.id===l.stream_id);m&&(y.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(u)),this._p2pChannel.unsubscribeDataChannel(f,[m]).then(E=>{if(f._dataChannels=f._dataChannels.filter(v=>v!==m),E)return this._gateway.unsubscribeDataChannel(E,f.uid)}),y.info("[".concat(this._clientId,"] remote user ").concat(u," unpublished datachannel ,id:").concat(m.id)),this.safeEmit(at.USER_UNPUBLISHED,f,"datachannel",m._config))})}_handleRemoveDataChannels(e){const t=this._users.find(i=>i.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){y.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const i=()=>{y.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(o=>{this.safeEmit(at.USER_UNPUBLISHED,t,"datachannel",o._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(o=>{if(o)return this._gateway.unsubscribeDataChannel(o,t.uid)}),i()}}else y.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(rn.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(rn.CONNECTION_STATE_CHANGE,(e,t,i)=>{var o;if(i===ot.FALLBACK)return;const a=()=>{this.safeEmit(at.CONNECTION_STATE_CHANGE,e,t,i)};if(Oe.reportApiInvoke(this._sessionId||((o=this._gateway.joinInfo)===null||o===void 0?void 0:o.sid)||null,{name:vn.CONNECTION_STATE_CHANGE,options:[e,t,i],tag:Qt.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:i})),y.info("[".concat(this._clientId,"] connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void a();if(e==="RECONNECTING")this._users.forEach(u=>{u._trust_in_room_=!1,u._trust_audio_enabled_state_=!1,u._trust_video_enabled_state_=!1,u._trust_audio_mute_state_=!1,u._trust_video_mute_state_=!1,u._trust_audio_stream_added_state_=!1,u._trust_video_stream_added_state_=!1,u._is_pre_created||(u._audio_pre_subscribed||(u._audioSSRC=void 0,u._audioOrtc=void 0),u._video_pre_subscribed||(u._videoSSRC=void 0,u._videoOrtc=void 0,u._rtxSsrcId=void 0),u._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var l;this._streamFallbackTypeCacheMap.forEach((u,h)=>{this._gateway.setStreamFallbackOption(h,u).catch(f=>{y.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),f)})}),this._remoteStreamTypeCacheMap.forEach((u,h)=>{this._gateway.setRemoteVideoStreamType(h,u).catch(f=>{y.warning("[".concat(this._clientId,"] auto set remote stream type failed"),f)})}),this._remoteDefaultVideoStreamType!==void 0&&((l=this._joinInfo)===null||l===void 0?void 0:l.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{y.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(u=>{y.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(u))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(u=>!u._trust_in_room_).forEach(u=>{y.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(u.uid)),this._handleUserOffline({uid:u.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(u=>{u._trust_audio_mute_state_||(y.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(u.uid)),this._handleMuteStream(u.uid,be.AUDIO,!1)),u._trust_video_mute_state_||(y.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(u.uid)),this._handleMuteStream(u.uid,be.VIDEO,!1)),u._trust_audio_enabled_state_||(y.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(u.uid)),this._handleSetStreamLocalEnable("audio",u.uid,!0)),u._trust_video_enabled_state_||(y.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(u.uid)),this._handleSetStreamLocalEnable("video",u.uid,!0)),u._trust_video_stream_added_state_||(y.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(u.uid)),this._handleResetAddStream(u,"video")),u._trust_audio_stream_added_state_||(y.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(u.uid)),this._handleResetAddStream(u,"audio")),u._video_added_||u._audio_added_||(y.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(u.uid)),this._handleRemoveStream({uid:u.uid,uint_id:u._uintid}))}))},1e3))}a()}),this._gateway.on(rn.REQUEST_NEW_GATEWAY_LIST,(e,t)=>{if(!this._joinInfo)return t(new W(N.UNEXPECTED_ERROR,"can not recover, no join info"));Iy(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||yn,this.store).then(i=>{this._joinInfo&&(this._joinInfo.apResponse=i.gatewayInfo.res,this._joinInfo.gatewayAddrs=i.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=i.gatewayInfo.uni_lbs_ip);const o=[];i.gatewayInfo.gatewayAddrs.forEach(a=>{let{address:l}=a;const[u,h]=l.split(":");this._joinInfo&&this._joinInfo.proxyServer?o.push({proxy:this._joinInfo.proxyServer,host:u,port:h}):o.push({host:u,port:h})}),e(o)}).catch(t)}),this._gateway.on(rn.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(at.NETWORK_QUALITY,e)}),this._gateway.on(rn.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(at.STREAM_TYPE_CHANGED,e,t),Oe.reportApiInvoke(this._sessionId,{name:vn.STREAM_TYPE_CHANGE,options:[e,t],tag:Qt.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.on(rn.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(rn.NEED_RENEW_SESSION,()=>{this._startSession()}),this._gateway.on(rn.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,i)=>{try{t(await this._p2pChannel.startP2PConnection(e))}catch(o){i(o)}}),this._gateway.on(rn.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;const{dtlsParameters:i,iceParameters:o,candidates:a,rtpCapabilities:l,setup:u,cname:h}=QL(e.ortc,t);this._p2pChannel.connect(o,i,a,l,u,h)}),this._gateway.on(rn.REQUEST_DC_CONNECTION_PARAMS,e=>{e(this._p2pChannel.getEstablishParams())}),this._gateway.on(rn.RESET_SIGNAL,e=>{this._p2pChannel.resetConnection(e),this._handleGatewaySignalEvents()}),this._gateway.on(rn.DATACHANNEL_FAILBACK,()=>{this._joinGateway()}),this._gateway.on(rn.DATACHANNEL_PRECONNECT,async(e,t,i,o)=>{var a,l,u,h,f,m;await this._p2pChannel.startP2PConnection({turnServer:(a=this._joinInfo)===null||a===void 0?void 0:a.turnServer},!0);const E=function(v,T){let A;return T&&T.ip&&typeof T.port=="number"?(A=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:T.ip,port:T.port.toString(),type:"host",extension:{}}],y.debug("Using remote candidate from AP ".concat(T.ip,":").concat(T.port)),T.ip6&&(A.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:T.ip6,port:T.port.toString(),type:"host",extension:{}}),y.debug("Using IPV6 remote candidate from AP ".concat(T.ip6,":").concat(T.port)))):A=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:v.ip,port:v.port.toString(),type:"host",extension:{}}],A}(e,t);return this._p2pChannel.preConnect({iceUfrag:"".concat((l=this._joinInfo)===null||l===void 0?void 0:l.apResponse.cid,"_").concat((u=this._joinInfo)===null||u===void 0?void 0:u.apResponse.cert),icePwd:"".concat((h=this._joinInfo)===null||h===void 0?void 0:h.apResponse.cid,"_").concat((f=this._joinInfo)===null||f===void 0?void 0:f.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:(m=V("FINGERPRINT"))!==null&&m!==void 0?m:e.fingerprint}]},E,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(i).catch(o)})}_handleGatewaySignalEvents(){this._gateway.signal.on(He.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(He.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(He.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(He.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(He.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(He.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams,deleted:[]},!0)}),this._gateway.signal.on(He.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(He.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(He.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,be.AUDIO,!0)),this._gateway.signal.on(He.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,be.AUDIO,!1)),this._gateway.signal.on(He.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,be.VIDEO,!0)),this._gateway.signal.on(He.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,be.VIDEO,!1)),this._gateway.signal.on(He.RECEIVE_METADATA,e=>{const t=Kh(e.metadata);this.safeEmit(at.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(He.ON_DATA_STREAM,async e=>{var t;if(!e)return;let i=Kh(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Ie(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<Wd)throw new W(N.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(Wd));i=await async function(l,u,h){const f=h.subarray(0,Wd),m=f.slice(8,Wd),E=(m[0]<<8)+m[1],v=(f[6]<<8)+f[7],T=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:l,tagLength:m1,additionalData:new Uint8Array(PP(E,2))},u,h.subarray(Wd));return new Uint8Array(T).subarray(0,v)}(this._encryptDataStreamIv,this._encryptDataStreamKey,i)}let o=0;if(e.ordered||e.syncWithAudio){const a=this._p2pChannel.getStats(),l=this.remoteUsers.find(h=>h.uid===e.uid),u=a==null?void 0:a.audioRecv.find(h=>h.ssrc===(l==null?void 0:l._audioSSRC));o=u==null?void 0:u.jitterBufferMs}o==null&&(o=0),wq(uo(uo({},e),{},{payload:i}),o,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(He.ON_CRYPT_ERROR,()=>{Vd(()=>{y.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(at.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(He.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(He.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{y.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,ot.TOKEN_EXPIRE),this.safeEmit(at.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(He.ON_STREAM_FALLBACK_UPDATE,e=>{y.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(at.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(He.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),y.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(He.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(He.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(ye.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case Ne.PUBLISH:{if(!t)return;const a=t.ortc;if(a){var i,o;const l=a.some(f=>{let{stream_type:m}=f;return m===vt.Audio}),u=a.some(f=>{let{stream_type:m}=f;return m!==vt.Audio}),h=a.some(f=>{let{stream_type:m}=f;return m===vt.Screen||m===vt.ScreenLow});t.state==="offer"&&Oe.publish(this._joinInfo.sid,{eventElapse:Ei.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:N.TIMEOUT,audio:l,video:u,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:h,audioName:l?(i=a.find(f=>{let{stream_type:m}=f;return m===vt.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0,videoName:u?(o=a.find(f=>{let{stream_type:m}=f;return m!==vt.Audio}))===null||o===void 0||(o=o.ssrcs[0])===null||o===void 0?void 0:o.ssrcId.toString():void 0})}break}case Ne.SUBSCRIBE:t&&Oe.subscribe(this._joinInfo.sid,{succ:!1,ec:N.TIMEOUT,audio:t.stream_type===be.AUDIO,video:t.stream_type===be.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:Ei.measureFromSubscribeStart(this.store.clientId,t.ssrcId)})}}),this._gateway.signal.on(He.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(He.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;V("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(o=>!yl(o.string_id||o.stream_id,this.channelName)));const t=[],i=[];for(const o of e.users){let a=this._users.find(E=>E._uintid===o.stream_id);a?a._trust_in_room_=!0:(a=new si(o.string_id||o.stream_id,o.stream_id),this._users.push(a),this.getListeners(at.PUBLISHED_USER_LIST).length===0&&(y.debug("[".concat(this._clientId,"] user online"),o.stream_id),this.safeEmit(at.USER_JOINED,a)));const l=Cn.Audio&o.stream_type,u=(Cn.Video|Cn.LwoVideo)&o.stream_type,h=(65280&o.stream_type)!=0,f=l&&a.hasAudio,m=u&&a.hasVideo;u&&(a._trust_video_stream_added_state_=!0,a._video_added_=!0,a._videoSSRC=o.video_ssrc,a._rtxSsrcId=o.video_rtx),l&&(a._trust_audio_stream_added_state_=!0,a._audio_added_=!0,a._audioSSRC=o.audio_ssrc),l&&!f&&this.getListeners(at.PUBLISHED_USER_LIST).length===0&&(y.info("[".concat(this._clientId,"] remote user ").concat(a.uid," published audio")),this.safeEmit(at.USER_PUBLISHED,a,"audio")),u&&!m&&this.getListeners(at.PUBLISHED_USER_LIST).length===0&&(y.info("[".concat(this._clientId,"] remote user ").concat(a.uid," published video")),this.safeEmit(at.USER_PUBLISHED,a,"video")),(l&&!f||u&&!m||h)&&t.push(a),u&&this._p2pChannel.hasPendingRemoteMedia(a,"video")&&i.push({user:a,mediaType:"video"}),l&&this._p2pChannel.hasPendingRemoteMedia(a,"audio")&&i.push({user:a,mediaType:"audio"})}i.length>0&&(y.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(i.map(o=>"user: ".concat(o.user.uid,", mediaType: ").concat(o.mediaType)).join("; ")," ")),this.massSubscribe(i).catch(o=>{y.error("[".concat(this._clientId,"] mass resubscribe error"),o.toString())})),this.getListeners(at.PUBLISHED_USER_LIST).length>0?V("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(y.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(o=>o.uid).join(", "))),this.safeEmit(at.PUBLISHED_USER_LIST,t)):y.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(o=>o.uid).join(", ")))}),this._gateway.signal.on(He.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:t}=e;this._p2pChannel instanceof ti&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(i=>i.toLowerCase()).filter(i=>{var o;return Ie(o=Object.keys(sc)).call(o,i)}))})}_handleP2PEvents(){this._gateway.signal.on(He.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(sn.PUBLISH,(e,t,i)=>{const{uid:o}=e;e.forEach(a=>{const{kind:l,ssrcs:u,mid:h,isMuted:f}=a;this._handleP2PAddAudioOrVideoStream(l,o,u[0].ssrcId,h);const m=this._users.find(E=>E.uid===o);return m&&this._p2pChannel instanceof Mn?this._p2pChannel.mockSubscribe(m,l,u[0].ssrcId,h).then(()=>{t()}).catch(i):t(),this._handleMuteStream(o,l,!!f)})}),this._gateway.signal.on(sn.CALL,async(e,t,i)=>{if(this._p2pChannel instanceof Mn)try{var o;t(await this._p2pChannel.startP2P({turnServer:(o=this._joinInfo)===null||o===void 0?void 0:o.turnServer},e))}catch(a){i(a)}}),this._gateway.signal.on(ye.P2P_CONNECTION,async e=>{this._p2pChannel instanceof Mn&&await this._p2pChannel.p2pConnect(e)}),this._gateway.signal.on(sn.UNPUBLISH,async(e,t,i)=>{if(this._p2pChannel instanceof Mn){const{unpubMsg:o,uid:a}=e,l=this._users.find(u=>u.uid===a);if(!l)return y.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(a)),void t();try{o.forEach(async u=>{let{stream_type:h}=u;const f=h===vt.Audio?be.AUDIO:be.VIDEO;await this._p2pChannel.unsubscribe(l,f),this._handleMuteStream(a,f,!0)}),t()}catch(u){i(u)}}}),this._gateway.signal.on(sn.CONTROL,async(e,t)=>{const{action:i}=e;switch(i){case Do.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,be.VIDEO,!0);break;case Do.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,be.AUDIO,!0);break;case Do.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,be.VIDEO,!1);break;case Do.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,be.AUDIO,!1)}}),this._gateway.signal.on(sn.RESTART_ICE,async(e,t,i)=>{if(this._p2pChannel instanceof Mn)try{const{direction:o,iceParameter:a}=e;o!==Ii.SEND_ONLY||a?t(await this._p2pChannel.restartICE(o,a)):(this._p2pChannel.handleDisconnect(o),t())}catch(o){i(o)}}),this._gateway.signal.on(sn.CANDIDATE,e=>{if(this._p2pChannel instanceof Mn){const{candidate:t,direction:i}=e;this._p2pChannel.addRemoteCandidate(t,i)}}),this._p2pChannel.on(Me.RequestP2PRestartICE,async(e,t,i)=>{try{const{direction:o}=e;t(await this._gateway.sendExtensionMessage(sn.RESTART_ICE,e,o===Ii.SEND_ONLY))}catch(o){i(o)}}),this._p2pChannel.on(Me.LocalCandidate,e=>{this._gateway.sendExtensionMessage(sn.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(Me.RequestP2PMuteLocal,async(e,t,i)=>{try{await this._gateway.sendExtensionMessage(sn.CONTROL,e,!0),t()}catch(o){i(o)}}),this._p2pChannel.on(Me.RequestP2PUnmuteRemote,async(e,t,i)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(o){o.code===N.DISCONNECT_P2P?t():i(o)}else t()}),this._p2pChannel.on(Me.RequestP2PMuteRemote,async(e,t,i)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(o){o.code===N.DISCONNECT_P2P?t():i(o)}else t()}),this._p2pChannel.on(Me.StateChange,(e,t)=>{t===Tt.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Me.RequestMuteLocal,async(e,t,i)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(o){o.code===N.DISCONNECT_P2P?t():i(o)}else t()}),this._p2pChannel.on(Me.RequestUnmuteLocal,async(e,t,i)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(o){o.code===N.DISCONNECT_P2P?t():i(o)}else t()}),this._p2pChannel.on(Me.RequestRePublish,(e,t,i)=>{this.publish(e,!1).then(t).catch(i)}),this._p2pChannel.on(Me.RequestRePublishDataChannel,(e,t,i)=>{X.all(e.map(async o=>{await this._p2pChannel.publishDataChannel([o]);const a={streamId:o.id,ordered:o.ordered,maxRetransmits:o.maxRetransmits,metadata:o.metadata,channelId:o._originDataChannelId};try{await this._gateway.publishDataChannel(this._uid,a,!0)}catch(l){if(l.code!==N.DISCONNECT_P2P)throw l}})).then(t).catch(i)}),this._p2pChannel.on(Me.RequestReSubscribe,async(e,t,i)=>{try{for(const{user:o,kind:a}of e)a===be.VIDEO?await this.subscribe(o,"video"):await this.subscribe(o,"audio");t()}catch(o){i(o)}}),this._p2pChannel.on(Me.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(Me.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(Me.MediaReconnectStart,e=>{this.safeEmit(at.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Me.MediaReconnectEnd,e=>{this.safeEmit(at.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Me.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Me.RequestRestartICE,async e=>{if(this._p2pChannel instanceof Mn)return;const t=await this._p2pChannel.restartICE(e),i=await t.next();if(i.done)return;const o=i.value;let a;try{a=await this._gateway.restartICE({iceParameters:o})}catch(u){return void t.throw(u)}const{iceParameters:l}=function(u){const h=u.iceParameters;return{iceParameters:{iceUfrag:h.iceUfrag,icePwd:h.icePwd}}}(a);await t.next({remoteIceParameters:l})}),this._p2pChannel.on(Me.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Me.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:i,rtpCapabilities:o}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:a,gatewayAddress:l}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:i,rtpCapabilities:o}),{dtlsParameters:u,iceParameters:h,candidates:f,rtpCapabilities:m,setup:E,cname:v}=QL(a,l);await this._p2pChannel.connect(h,u,f,m,E,v),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Me.RequestUnpublishForReconnectPC,async(e,t,i)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):i()}),this._p2pChannel.on(Me.P2PLost,()=>{this.safeEmit(at.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Me.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Me.ConnectionTypeChange,e=>{this.safeEmit(at.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(Me.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Me.QueryClientConnectionState,e=>{e(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(this.connectionState!=="CONNECTED"||!this._joinInfo)throw new W(N.INVALID_OPERATION,"[".concat(this._clientId,"] Client did not join channel"));if(this._inspect)throw new W(N.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));if(!e)throw new W(N.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig is necessary"));if(!e.inspectType||!Array.isArray(e.inspectType))throw new W(N.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{const t=[...new Set(e.inspectType)];t.forEach(i=>{var o;if(!Ie(o=["supervise","moderation"]).call(o,i))throw new W(N.INVALID_PARAMS,"[".concat(this._clientId,"] ").concat(i," is not a valid inspect type."))}),e.inspectType=t}if(e&&e.extraInfo&&e.extraInfo.length>1024)throw new W(N.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{const t=new EE(e);this._inspect=t,this.handleVideoInspectEvents(this._inspect),await t.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},yn)}catch(t){throw Array.isArray(t)?t[0]:t}}async disableContentInspect(){if(!this._inspect)throw new W(N.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(sa(e,"enabled"),e){if(!t)throw new W(N.INVALID_PARAMS,"[".concat(this._clientId,"] config is necessary"));if(Ot(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new W(N.INVALID_PARAMS,"[".concat(this._clientId,"] config.extraInfo length cannot exceed 1024 bytes"));if(t&&t.vendor&&t.vendor.length>1024)throw new W(N.INVALID_PARAMS,"[".concat(this._clientId,"] config.vendor length cannot exceed 1024 bytes"));if(this.connectionState!=="CONNECTED"||!this._joinInfo)throw new W(N.INVALID_OPERATION,"[".concat(this._clientId,'] can not enable image moderation, not joined"'));try{if(this._moderation)return void this._moderation.updateConfig(t);const i=new uR(t);this._moderation=i,this.handleImageModerationEvents(this._moderation),await i.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},yn)}catch(i){throw Array.isArray(i)?i[0]:i}}else{if(!this._moderation)throw new W(N.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(i){throw Array.isArray(i)?i[0]:i}}}setP2PTransport(e){if(function(t){Pn(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new W(N.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,y.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}handleImageModerationEvents(e){e.on(ns.CONNECTION_STATE_CHANGE,(t,i)=>{if(this.safeEmit(at.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,i),t===gr.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new W(N.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(ns.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}handleVideoInspectEvents(e){e.on(Ln.CONNECTION_STATE_CHANGE,(t,i)=>{if(this.safeEmit(at.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,i),i===Lr.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(at.CONTENT_INSPECT_ERROR,new W(N.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(Ln.INSPECT_RESULT,(t,i)=>{var o;if((i==null?void 0:i.code)===N.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return y.debug("Stop inspect content because that has left channel"),this==null||(o=this._inspect)===null||o===void 0||o.close(),void(this._inspect=void 0);this.safeEmit(at.CONTENT_INSPECT_RESULT,t,i)}),e.on(Ln.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}getJoinChannelServiceRecords(){return y.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){sa(e,"enabled"),Nt("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}}ie([Le(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",X)],At.prototype,"leave",null),ie([Le({argsMap:(n,e)=>{if(!Array.isArray(e)){if(!(e instanceof _i))return[e];e=[e]}return e.map(t=>t?Object(t).toString():"null")}}),O("design:type",Function),O("design:paramtypes",[Object,Boolean]),O("design:returntype",X)],At.prototype,"publish",null),ie([Le({argsMap:(n,e)=>(e||(e=[]),e instanceof Mk?[e.getChannelId()]:(Array.isArray(e)||(e=[e]),e.map(t=>t.getTrackId())))}),O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",X)],At.prototype,"unpublish",null),ie([Le({argsMap:(n,e,t,i)=>[e.uid,t,i]}),O("design:type",Function),O("design:paramtypes",[si,String,Number]),O("design:returntype",X)],At.prototype,"subscribe",null),ie([Le({argsMap:(n,e,t)=>[e,t]}),O("design:type",Function),O("design:paramtypes",[Object,String]),O("design:returntype",X)],At.prototype,"presubscribe",null),ie([Le({argsMap:(n,e)=>e.map(t=>{let{user:i,mediaType:o}=t;return[i==null?void 0:i.uid,o]})}),O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",X)],At.prototype,"massSubscribe",null),ie([Le({argsMap:(n,e,t,i)=>[e.uid,t,i]}),O("design:type",Function),O("design:paramtypes",[si,String,Number]),O("design:returntype",X)],At.prototype,"unsubscribe",null),ie([Le({argsMap:(n,e)=>e.map(t=>{let{user:i,mediaType:o}=t;return{uid:i==null?void 0:i.uid,mediaType:o}})}),O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",X)],At.prototype,"massUnsubscribe",null),ie([Le(),O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",X)],At.prototype,"setLowStreamParameter",null),ie([Le(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",X)],At.prototype,"enableDualStream",null),ie([Le(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",X)],At.prototype,"disableDualStream",null),ie([Le(),O("design:type",Function),O("design:paramtypes",[String,Object]),O("design:returntype",X)],At.prototype,"setClientRole",null),ie([Le(),O("design:type",Function),O("design:paramtypes",[String,Boolean]),O("design:returntype",void 0)],At.prototype,"setProxyServer",null),ie([Le(),O("design:type",Function),O("design:paramtypes",[Object,Boolean]),O("design:returntype",void 0)],At.prototype,"setTurnServer",null),ie([Le(),O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",void 0)],At.prototype,"setLicense",null),ie([Le(),O("design:type",Function),O("design:paramtypes",[Number]),O("design:returntype",void 0)],At.prototype,"startProxyServer",null),ie([Le(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],At.prototype,"stopProxyServer",null),ie([Le(),O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",void 0)],At.prototype,"setLocalAccessPointsV2",null),ie([Le(),O("design:type",Function),O("design:paramtypes",[Array,String]),O("design:returntype",void 0)],At.prototype,"setLocalAccessPoints",null),ie([Le(),O("design:type",Function),O("design:paramtypes",[Number]),O("design:returntype",X)],At.prototype,"setRemoteDefaultVideoStreamType",null),ie([Le(),O("design:type",Function),O("design:paramtypes",[Object,Number]),O("design:returntype",X)],At.prototype,"setRemoteVideoStreamType",null),ie([Le(),O("design:type",Function),O("design:paramtypes",[Object,Number]),O("design:returntype",X)],At.prototype,"setStreamFallbackOption",null),ie([Le({argsMap:(n,e)=>[e]}),O("design:type",Function),O("design:paramtypes",[String,String,Uint8Array,Boolean]),O("design:returntype",void 0)],At.prototype,"setEncryptionConfig",null),ie([Le(),O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",X)],At.prototype,"renewToken",null),ie([Le(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],At.prototype,"enableAudioVolumeIndicator",null),ie([Le(),O("design:type",Function),O("design:paramtypes",[String,Boolean]),O("design:returntype",X)],At.prototype,"startLiveStreaming",null),ie([Le(),O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",X)],At.prototype,"setLiveTranscoding",null),ie([Le(),O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",X)],At.prototype,"stopLiveStreaming",null),ie([Le(),O("design:type",Function),O("design:paramtypes",[String,Object]),O("design:returntype",X)],At.prototype,"addInjectStreamUrl",null),ie([Le(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",X)],At.prototype,"removeInjectStreamUrl",null),ie([Le(),O("design:type",Function),O("design:paramtypes",[uE]),O("design:returntype",X)],At.prototype,"startChannelMediaRelay",null),ie([Le(),O("design:type",Function),O("design:paramtypes",[uE]),O("design:returntype",X)],At.prototype,"updateChannelMediaRelay",null),ie([Le(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",X)],At.prototype,"stopChannelMediaRelay",null),ie([Le({argsMap:(n,e)=>(Array.isArray(e)||(e=[e]),[JSON.stringify(e)])}),O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",X)],At.prototype,"sendCustomReportMessage",null),ie([Le(),O("design:type",Function),O("design:paramtypes",[Object,Object]),O("design:returntype",X)],At.prototype,"pickSVCLayer",null),ie([Le(),O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",X)],At.prototype,"setRTMConfig",null),ie([Le(),O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",X)],At.prototype,"enableContentInspect",null),ie([Le(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",X)],At.prototype,"disableContentInspect",null),ie([Le(),O("design:type",Function),O("design:paramtypes",[Boolean,Object]),O("design:returntype",X)],At.prototype,"setImageModeration",null),ie([Le(),O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",void 0)],At.prototype,"setP2PTransport",null),ie([Le({reportResult:!0}),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",Array)],At.prototype,"getJoinChannelServiceRecords",null),ie([Le(),O("design:type",Function),O("design:paramtypes",[Boolean]),O("design:returntype",X)],At.prototype,"setPublishAudioFilterEnabled",null);class Vp{constructor(e,t){S(this,"id",0),S(this,"element",void 0),S(this,"peerPair",void 0),S(this,"context",void 0),S(this,"audioPlayerElement",void 0),S(this,"audioTrack",void 0),Vp.count+=1,this.id=Vp.count,this.element=e,this.context=t}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{const t=document.createElement("audio");t.srcObject=new MediaStream([e.track]),t.play(),this.audioPlayerElement=t}}async switchSdp(){if(!this.peerPair)return;const e=async(i,o)=>{const a=o==="offer"?await i.createOffer():await i.createAnswer();return await i.setLocalDescription(a),i.iceGatheringState==="complete"?i.localDescription:new X(l=>{i.onicegatheringstatechange=()=>{i.iceGatheringState==="complete"&&l(i.localDescription)}})},t=async(i,o)=>await i.setRemoteDescription(o);try{const i=await e(this.peerPair[0],"offer");await t(this.peerPair[1],i);const o=await e(this.peerPair[1],"answer");await t(this.peerPair[0],o)}catch(i){throw new W(N.LOCAL_AEC_ERROR,i.toString()).print()}}async getTracksFromMediaElement(e){if(this.audioTrack)return this.audioTrack;let t;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),t=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(t)}catch(o){throw new W(N.LOCAL_AEC_ERROR,o.toString()).print()}if(!t)throw new W(N.LOCAL_AEC_ERROR,"no dest node when local aec").print();const i=t.stream.getAudioTracks()[0];return this.audioTrack=i,i}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const e=this.element,t=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(t),await this.switchSdp()}close(){y.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(e=>{e.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}S(Vp,"count",0);const Oq=window.AudioContext||window.webkitAudioContext;class qM{constructor(){S(this,"units",[]),S(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return y.debug("the system does not need to process local aec"),-1;this.context||(this.context=new Oq);let t=this.units.find(i=>i&&i.getElement()===e);return t||(t=new Vp(e,this.context),this.units.push(t)),t.startEchoCancellation(),y.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return ft().name!==St.SAFARI}}ie([Le({report:Oe}),O("design:type",Function),O("design:paramtypes",[HTMLAudioElement]),O("design:returntype",Number)],qM.prototype,"processExternalMediaAEC",null);const Nq=new qM;function JM(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,i)}return t}function XM(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?JM(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):JM(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}const pR=window||document;function QM(n){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!pR)return;const t=Rn._cspEventHandlerPointer;if(t&&e)return void console.error(t,e);const i=o=>{if(!(o&&o.blockedURI&&(Rn.onSecurityPolicyViolation||Rn.getListeners(bs.SECURITY_POLICY_VIOLATION).length>0)))return;const a=o.blockedURI;V("CSP_DETECTED_HOSTNAME_LIST").some(l=>Ie(a).call(a,l))&&(Rn.onSecurityPolicyViolation&&typeof Rn.onSecurityPolicyViolation=="function"&&Rn.onSecurityPolicyViolation(o),Rn.getListeners(bs.SECURITY_POLICY_VIOLATION).length>0&&Rn.safeEmit(bs.SECURITY_POLICY_VIOLATION,o))};t&&pR.removeEventListener("securitypolicyviolation",t),(e||n&&typeof n=="function"||Rn.getListeners(bs.SECURITY_POLICY_VIOLATION).length>0)&&pR.addEventListener("securitypolicyviolation",i),Rn._cspEventHandlerPointer=i}Nt("PROCESS_ID","process-".concat(Lt(8,""),"-").concat(Lt(4,""),"-").concat(Lt(4,""),"-").concat(Lt(4,""),"-").concat(Lt(12,""))),function(){let n;try{n=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void y.error("Error loading sdk config",e.message)}if(n)try{const e=JSON.parse(window.atob(n)),t=Date.now();y.debug("Loading global parameters from cache",e),Object.keys(e).forEach(i=>{if(Object.prototype.hasOwnProperty.call(Vi,i)){const{value:o,expires:a}=e[i];if(a&&a<=t)return;rc[i]=o,Vi[i]=o}})}catch(e){y.error("Error loading mutableParamsCache: ".concat(n),e.message)}}(),Array.isArray(rc.AREAS)&&rc.AREAS.length>0&&Ty(rc.AREAS,!0);const $M=(n,e,t)=>{y.debug("setParameter key:".concat(n,", value:").concat(JSON.stringify(e))),Nt(n,e,t)},Rn=function(n){const e=new zt,t=n,i={getListeners:e.getListeners.bind(e),on:(o,a)=>(function(l,u){l===bs.SECURITY_POLICY_VIOLATION&&QM(u,!0)}(o,a),e.on.bind(e)(o,a)),addListener:e.addListener.bind(e),once:e.once.bind(e),off:e.off.bind(e),removeAllListeners:e.removeAllListeners.bind(e),emit:e.emit.bind(e),safeEmit:e.safeEmit.bind(e)};return XM(XM({},t),i)}({__TRACK_LIST__:Jd,VERSION:es,BUILD:ny,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:$M,getParameter:V,getSupportedCodec:async function(){let n={audio:[],video:[]};try{let e=new RTCPeerConnection;e.addTransceiver("video",{direction:"recvonly"}),e.addTransceiver("audio",{direction:"recvonly"});const t=(await e.createOffer()).sdp;if(!t)return n;e.close(),e=null,n=function(i){const o={video:[],audio:[]};return i.match(/ VP8/i)&&o.video.push("VP8"),i.match(/ VP9/i)&&o.video.push("VP9"),i.match(/ AV1/i)&&o.video.push("AV1"),i.match(/ H264/i)&&o.video.push("H264"),i.match(/ H265/i)&&o.video.push("H265"),i.match(/ opus/i)&&o.audio.push("OPUS"),i.match(/ PCMU/i)&&o.audio.push("PCMU"),i.match(/ PCMA/i)&&o.audio.push("PCMA"),i.match(/ G722/i)&&o.audio.push("G722"),o}(t)}catch(e){throw new W(N.CREATE_OFFER_FAILED,e.toString&&e.toString()).print()}return n},checkSystemRequirements:function(){const n=Oe.reportApiInvoke(null,{name:vn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Qt.TRACER});let e=!1;try{const a=window.RTCPeerConnection,l=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,u=window.WebSocket;e=!!(a&&l&&u)}catch(a){return y.error("check system requirement failed: ",a),!1}let t=!1;const i=ft();i.name===St.CHROME&&Number(i.version)>=58&&(!$H()||QH())&&(t=!0),i.name===St.FIREFOX&&Number(i.version)>=56&&(t=!0),i.name===St.OPERA&&Number(i.version)>=45&&(t=!0),i.name===St.SAFARI&&Number(i.version)>=11&&(t=!0),(hP()||ft().name===St.QQ)&&(t=!0),y.debug("checkSystemRequirements, api:",e,"browser",t);const o=e&&t;return n.onSuccess(o),o},getDevices:function(n){return Fr.enumerateDevices(!0,!0,n)},getMicrophones:function(n){return Fr.getRecordingDevices(n)},getCameras:function(n){return Fr.getCamerasDevices(n)},getElectronScreenSources:TD,getPlaybackDevices:function(n){return Fr.getSpeakers(n)},createClient:function(){var n;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const t=Oe.reportApiInvoke(null,{name:vn.CREATE_CLIENT,options:[e],tag:Qt.TRACER});try{(function(i){Pn(i.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Pn(i.mode,"config.mode",["rtc","live","p2p"]),i.audioCodec!==void 0&&Pn(i.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),i.proxyServer!==void 0&&fi(i.proxyServer,"config.proxyServer",1,1e4),i.turnServer!==void 0&&TP(i.turnServer),i.httpRetryConfig!==void 0&&SP(i.httpRetryConfig),i.websocketRetryConfig!==void 0&&SP(i.websocketRetryConfig)})(e)}catch(i){throw t.onError(i),i}return Aq()||(e.codec==="vp9"&&(e.codec="vp8",y.debug("browser not support vp9, force use vp8")),Nt("UNSUPPORTED_VIDEO_CODEC",["vp9"])),e.audioCodec===void 0&&(e.audioCodec="opus"),t.onSuccess(),new At(uo(uo({forceWaitGatewayResponse:!0},e),{},{role:Ie(n=["rtc","p2p"]).call(n,e.mode)?"host":e.role||"audience"}))},createCameraVideoTrack:async function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=Oe.reportApiInvoke(null,{tag:Qt.TRACER,name:vn.CREATE_CAM_VIDEO_TRACK,options:[P_({},n)]}),t=N_(n),i=Lt(8,"track-cam-");let o=null;const a=n.encoderConfig==="720p_auto";y.info("start create camera video track with config",JSON.stringify(n),"trackId",i);try{o=(await Vr({video:t},i)).getVideoTracks()[0]||null}catch(u){throw e.onError(u),u}if(!o){const u=new ne(N.UNEXPECTED_ERROR,"can not find track in media stream");return e.onError(u),u.throw(y)}n.optimizationMode&&By(i,o,n,ko(n.encoderConfig));const l=new gc(o,n,t,n.scalabiltyMode?w_(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,i);return a&&l.startMonitorStats(),e.onSuccess(l.getTrackId()),y.info("create camera video success, trackId:",i),l},createCustomVideoTrack:function(n){const e=Oe.reportApiInvoke(null,{tag:Qt.TRACER,name:vn.CREATE_CUSTOM_VIDEO_TRACK,options:[n]}),t=new et(n.mediaStreamTrack,{width:n.width,height:n.height,frameRate:n.frameRate,bitrateMax:n.bitrateMax,bitrateMin:n.bitrateMin},n.scalabiltyMode?w_(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,Lt(8,"track-cus-"),[Ut.CUSTOM_TRACK]);return e.onSuccess(t.getTrackId()),y.info("create custom video track success with config",n,"trackId",t.getTrackId()),t},createScreenVideoTrack:async function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const t=Oe.reportApiInvoke(null,{tag:Qt.TRACER,name:vn.CREATE_SCREEN_VIDEO_TRACK,options:[P_({},n),e]}),i=n.encoderConfig==="720p_auto";n.encoderConfig?typeof n.encoderConfig=="string"||n.encoderConfig.width&&n.encoderConfig.height||(n.encoderConfig.width={max:1920},n.encoderConfig.height={max:1080}):n.encoderConfig="1080p_2";const o=function(E){const v={};E.screenSourceType&&(v.mediaSource=E.screenSourceType),E.extensionId&&ra()&&(v.extensionId=E.extensionId);const{displaySurface:T,selfBrowserSurface:A,surfaceSwitching:C,systemAudio:b}=E;(bT(107)||aP(107)||cP(93))&&(T&&(Pn(T,"displaySurface",["browser","window","monitor"]),v.displaySurface=T),A?(Pn(A,"selfBrowserSurface",["exclude","include"]),v.selfBrowserSurface=A):v.selfBrowserSurface="include",C&&(Pn(C,"surfaceSwitching",["exclude","include"]),v.surfaceSwitching=C)),(bT(105)||aP(105)||cP(91))&&b&&(Pn(b,"systemAudio",["exclude","include"]),v.systemAudio=b),E.electronScreenSourceId&&(v.sourceId=E.electronScreenSourceId);const D=E.encoderConfig?by(E.encoderConfig):null;return v.mandatory={chromeMediaSource:"desktop",maxWidth:D?D.width:void 0,maxHeight:D?D.height:void 0},D&&(D.frameRate&&(typeof D.frameRate=="number"?(v.mandatory.maxFrameRate=D.frameRate,v.mandatory.minFrameRate=D.frameRate):(v.mandatory.maxFrameRate=D.frameRate.max||D.frameRate.ideal||D.frameRate.exact||void 0,v.mandatory.minFrameRate=D.frameRate.min||D.frameRate.ideal||D.frameRate.exact||void 0),v.frameRate=D.frameRate),D.width&&(v.width=D.width),D.height&&(v.height=D.height)),v}(n),a=Lt(8,"track-scr-v-");let l=null,u=null;const h=mt();if(!h.supportShareAudio&&e==="enable"){const E=new ne(N.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return t.onError(E),E.throw(y)}y.info("start create screen video track with config",n,"withAudio",e,"trackId",a);try{const E=await Vr({screen:o,screenAudio:e==="auto"?h.supportShareAudio:e==="enable"},a);l=E.getVideoTracks()[0]||null,u=E.getAudioTracks()[0]||null}catch(E){throw t.onError(E),E}if(!l){const E=new ne(N.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(E),E.throw(y)}if(!u&&e==="enable"){l&&l.stop();const E=new ne(N.SHARE_AUDIO_NOT_ALLOWED);return t.onError(E),E.throw(y)}n.optimizationMode||(n.optimizationMode="detail"),n.optimizationMode&&(By(a,l,n,n.encoderConfig&&by(n.encoderConfig)||void 0),n.encoderConfig&&typeof n.encoderConfig!="string"&&(n.encoderConfig.bitrateMin=n.encoderConfig.bitrateMax));const f=new et(l,n.encoderConfig?by(n.encoderConfig):{},n.scalabiltyMode?w_(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,a,[Ut.SCREEN_TRACK]);if(i&&f.startMonitorStats(),!u)return t.onSuccess(f.getTrackId()),y.info("create screen video track success","video:",f.getTrackId()),f;const m=new bt(u,void 0,Lt(8,"track-scr-a-"),!1);return t.onSuccess([f.getTrackId(),m.getTrackId()]),y.info("create screen video track success","video:",f.getTrackId(),"audio:",m.getTrackId()),[f,m]},createMicrophoneAndCameraTracks:async function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=Oe.reportApiInvoke(null,{tag:Qt.TRACER,name:vn.CREATE_MIC_AND_CAM_TRACKS,options:[n,e]}),i=e.encoderConfig==="720p_auto",o=N_(e),a=MD(n),l=Lt(8,"track-mic-"),u=Lt(8,"track-cam-");let h=null,f=null;y.info("start create camera video track(".concat(u,") and microphone audio track(").concat(l,") with config, audio: ").concat(JSON.stringify(n),", video: ").concat(JSON.stringify(e)));try{const v=await Vr({audio:a,video:o},"".concat(l,"-").concat(u));h=v.getAudioTracks()[0],f=v.getVideoTracks()[0]}catch(v){throw t.onError(v),v}if(!h||!f){const v=new ne(N.UNEXPECTED_ERROR,"can not find tracks in media stream");return t.onError(v),v.throw(y)}e.optimizationMode&&By(u,f,e,ko(e.encoderConfig));const m=new Al(h,n,a,l),E=new gc(f,e,o,e.scalabiltyMode?w_(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,u);return i&&E.startMonitorStats(),t.onSuccess([m.getTrackId(),E.getTrackId()]),y.info("create camera video track(".concat(u,") and microphone audio track(").concat(l,") success")),[m,E]},createMicrophoneAudioTrack:async function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=Oe.reportApiInvoke(null,{tag:Qt.TRACER,name:vn.CREATE_MIC_AUDIO_TRACK,options:[n]}),t=MD(n),i=Lt(8,"track-mic-");let o=null;y.info("start create microphone audio track with config",JSON.stringify(n),"trackId",i);try{o=(await Vr({audio:t},i)).getAudioTracks()[0]||null}catch(l){throw e.onError(l),l}if(!o){const l=new ne(N.UNEXPECTED_ERROR,"can not find track in media stream");return e.onError(l),l.throw(y)}const a=new Al(o,n,t,i);return e.onSuccess(a.getTrackId()),y.info("create microphone audio track success, trackId:",i),a},createCustomAudioTrack:function(n){const e=Oe.reportApiInvoke(null,{tag:Qt.TRACER,name:vn.CREATE_CUSTOM_AUDIO_TRACK,options:[n]}),t=new bt(n.mediaStreamTrack,n.encoderConfig?b_(n.encoderConfig):{},Lt(8,"track-cus-"),!1);return y.info("create custom audio track success with config",n,"trackId",t.getTrackId()),e.onSuccess(t.getTrackId()),t},createBufferSourceAudioTrack:async function(n){var e;const{cacheOnlineFile:t,encoderConfig:i}=n;let{source:o}=n;const a={source:o instanceof AudioBuffer?"AudioBuffer":o instanceof File?(e=File.name)!==null&&e!==void 0?e:"File":o,cacheOnlineFile:t,encoderConfig:i},l=Oe.reportApiInvoke(null,{tag:Qt.TRACER,name:vn.CREATE_BUFFER_AUDIO_TRACK,options:[a]});if(V("DISABLE_WEBAUDIO"))throw new ne(N.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const u=Lt(8,"track-buf-");y.info("start create buffer source audio track with config",JSON.stringify(a),"trackId",u);const h=o;if(!(o instanceof AudioBuffer))try{o=await Bz(o,t)}catch(E){return l.onError(E),E.throw(y)}const f=new jz(o),m=new Ec(h,f,i?b_(i):{},u);return y.info("create buffer source audio track success, trackId:",u),l.onSuccess(m.getTrackId()),m},setAppType:function(n){if(y.debug("setAppType: ".concat(n)),!(Number.isInteger(n)&&n>=0))throw y.debug("Invalid appType"),new W(N.INVALID_PARAMS,"invalid app type",n);Nt("APP_TYPE",Math.floor(n))},setLogLevel:function(n){y.setLogLevel(n)},enableLogUpload:function(){V("USE_NEW_LOG")?Nt("UPLOAD_LOG",!0):y.enableLogUpload()},disableLogUpload:function(){V("USE_NEW_LOG")?Nt("UPLOAD_LOG",!1):y.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new uE},checkAudioTrackIsActive:async function(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const t=Oe.reportApiInvoke(null,{tag:Qt.TRACER,name:vn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[e]});if(!(n instanceof bt||n instanceof Ps)){const h=new W(N.INVALID_TRACK,"the parameter is not a audio track");return t.onError(h),h.throw()}e&&e<1e3&&(e=1e3);const i=n instanceof bt?n.getTrackLabel():"remote_track",o=n.getVolumeLevel();let a=o,l=o;const u=Date.now();return new X(h=>{const f=setInterval(()=>{const m=n.getVolumeLevel();a=m>a?m:a,l=m<l?m:l;const E=a-l>1e-4,v=Date.now()-u;if(E||v>e){clearInterval(f);const T=E,A={duration:v,deviceLabel:i,maxVolumeLevel:a,result:T};y.info("[track-".concat(n.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(A))),t.onSuccess(A),h(T)}},200)})},checkVideoTrackIsActive:async function(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const t=Oe.reportApiInvoke(null,{tag:Qt.TRACER,name:vn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[e]});if(!(n instanceof et||n instanceof Lo)){const E=new W(N.INVALID_TRACK,"the parameter is not a video track");return t.onError(E),E.throw()}e&&e<1e3&&(e=1e3);const i=n instanceof et?n.getTrackLabel():"remote_track",o=n.getMediaStreamTrack(!0),a=document.createElement("video");a.style.width="1px",a.style.height="1px",a.setAttribute("muted",""),a.muted=!0,a.setAttribute("playsinline",""),a.controls=!1,(ii()||Jm())&&(a.style.opacity="0.01",a.style.position="fixed",a.style.left="0",a.style.top="0",document.body.appendChild(a)),a.srcObject=new MediaStream([o]),a.play();const l=document.createElement("canvas");l.width=160,l.height=120;let u=0,h=0;try{const E=Date.now();u=await function(v,T,A,C){let b,D=0,M=null;return new X((B,J)=>{function G(){D>C&&b&&(b(),B(D));const q=A.getContext("2d");if(!q){const ue=new W(N.UNEXPECTED_ERROR,"can not get canvas 2d context.");return y.error(ue.toString()),void J(ue)}q.drawImage(v,0,0,160,120);const Q=q.getImageData(0,0,A.width,A.height),$=Math.floor(Q.data.length/3);if(M){for(let ue=0;ue<$;ue+=3)if(Q.data[ue]!==M[ue])return D+=1,void(M=Q.data);M=Q.data}else M=Q.data}setTimeout(()=>{b&&(b(),B(D))},T),b=Ly(()=>{G()},30)})}(a,e,l,4),h=Date.now()-E}catch(E){throw t.onError(E),E}bq===St.SAFARI&&(a.pause(),a.remove()),a.srcObject=null;const f=u>4,m={duration:h,changedPicNum:u,deviceLabel:i,result:f};return y.info("[track-".concat(n.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(m))),t.onSuccess(m),f},setArea:Ty,audioElementPlayCenter:qi,resumeAudioContext:function(){qi.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(n){Nq.processExternalMediaAEC(n)},registerExtensions:function(n){const e=V("PLUGIN_INFO")||[];n.forEach(t=>{"name"in t&&!Ie(e).call(e,t.name)&&e.push(t.name);const i=t;i.__registered__=!0,i.logger.hookLog=y.extLog,i.reporter.hookApiInvoke=Oe.extApiInvoke,i.parameters&&Object.keys(i.parameters).forEach(o=>{i.parameters[o]=V(o)})}),$M("PLUGIN_INFO",e)},ChannelMediaRelayError:cc,ChannelMediaRelayEvent:io,ChannelMediaRelayState:Hi,RemoteStreamFallbackType:Oy,RemoteStreamType:Ay,ConnectionDisconnectedReason:ot,AudienceLatencyLevelType:DT,AREAS:pt});return Object.defineProperties(Rn,{onAudioAutoplayFailed:{get:()=>jr.onAudioAutoplayFailed,set:n=>{jr.onAudioAutoplayFailed=n}},onAutoplayFailed:{get:()=>jr.onAutoplayFailed,set:n=>{jr.onAutoplayFailed=n}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Rn._onSecurityPolicyViolation,set(n){Rn._onSecurityPolicyViolation=n,QM(n)}},__CLIENT_LIST__:{get:()=>V("SHOW_GLOBAL_CLIENT_LIST")?oc:[]}}),Fr.on(fa.CAMERA_DEVICE_CHANGED,n=>{y.info("camera device changed",JSON.stringify(n)),Rn.onCameraChanged&&Rn.onCameraChanged(n),Rn.safeEmit(bs.CAMERA_CHANGED,n)}),Fr.on(fa.RECORDING_DEVICE_CHANGED,n=>{y.info("microphone device changed",JSON.stringify(n)),Rn.onMicrophoneChanged&&Rn.onMicrophoneChanged(n),Rn.safeEmit(bs.MICROPHONE_CHANGED,n)}),Fr.on(fa.PLAYOUT_DEVICE_CHANGED,n=>{y.debug("playout device changed",JSON.stringify(n)),Rn.onPlaybackDeviceChanged&&Rn.onPlaybackDeviceChanged(n),Rn.safeEmit(bs.PLAYBACK_DEVICE_CHANGED,n)}),qi.onAutoplayFailed=()=>{y.info("detect audio element autoplay failed"),jr.onAudioAutoplayFailed&&jr.onAudioAutoplayFailed()},wt.on("autoplay-failed",()=>{y.info("detect webaudio autoplay failed"),jr.onAudioAutoplayFailed&&jr.onAudioAutoplayFailed(),Rn.safeEmit(bs.AUTOPLAY_FAILED)}),wt.on(jn.STATE_CHANGE,(n,e)=>{y.info("audio context state changed: ".concat(e," => ").concat(n)),Rn.onAudioContextStateChanged&&Rn.onAudioContextStateChanged(n,e),Rn.safeEmit(bs.AUDIO_CONTEXT_STATE_CHANGED,n,e)}),Tn.on(aa.NETWORK_STATE_CHANGE,(n,e)=>{y.info("[network-indicator] network state changed, ".concat(e," => ").concat(n))}),window&&(window.__ARTC__=Rn),Rn})})(n3);var b$=n3.exports;const BE=sv(b$),A$=({uuid:r,socket:s,setUser:c,userData:d})=>{const[p,_]=Ce.useState(""),[g,R]=Ce.useState(""),I=Sw(),P=x=>{x.preventDefault();const H={name:g,roomID:p,userID:r(),host:!1,presenter:!1};c(H),I(`/${p}`),s.emit("userJoined",H),d.current=H};r();let k={localAudioTracks:null,remoteAudioTracks:{}},L;return Ce.useEffect(()=>{s.on("userLeftEvent",async()=>{k.localAudioTracks.stop(),k.localAudioTracks.leave(),L.unpublish(),L.leave(),console.log("left"),I("/")})},[]),Se.jsxs("div",{className:" h-80 w-96 px-4 flex flex-col justify-around mx-4 bg-[#F4DF4EFF] rounded-xl",children:[Se.jsx("div",{className:"text-center text-2xl",children:Se.jsx("h1",{children:"Join Room"})}),Se.jsx("div",{children:Se.jsx("input",{type:"text",placeholder:"  Enter your name",value:g,onChange:x=>R(x.target.value),name:"name",id:"name",className:"rounded-lg w-full h-10",required:!0})}),Se.jsx("div",{children:Se.jsx("input",{type:"text",placeholder:"  Enter Room ID",name:"roomId",id:"roomId",value:p,onChange:x=>_(x.target.value),className:"rounded-lg w-full h-10",required:!0})}),Se.jsx("button",{type:"submit",onClick:P,className:"p-4 mb-2 cursor-pointer text-center bg-[#00A4CCFF] rounded-xl",children:"Join Room"})]})},O$=({uuid:r,socket:s,setUser:c,userData:d})=>{const[p,_]=Ce.useState(""),[g,R]=Ce.useState(r()),I=Sw(),P=H=>{H.preventDefault();const K={name:p,roomID:g,userID:r(),host:!0,presenter:!0};c(K),I(`/${g}`),console.log(K),s.emit("userJoined",K),d.current=K};r();let k={localAudioTracks:null,remoteAudioTracks:{}},L;Ce.useEffect(()=>{s.on("userLeftEvent",()=>{k.localAudioTracks.stop(),k.localAudioTracks.leave(),L.unpublish(),L.leave(),I("/"),console.log("userLeft")})},[]);const x=()=>{navigator.clipboard.writeText(g)};return Se.jsx("div",{children:Se.jsxs("div",{className:" h-80 w-96 px-4 flex flex-col justify-around  mx-4  bg-[#F4DF4EFF] rounded-xl",children:[Se.jsx("div",{className:"text-center text-2xl",children:Se.jsx("h1",{children:"Generate Room"})}),Se.jsx("div",{children:Se.jsx("input",{type:"text",placeholder:"  Enter your name",value:p,onChange:H=>_(H.target.value),name:"name",id:"name",className:"rounded-lg w-full h-10 "})}),Se.jsxs("div",{children:[Se.jsx("input",{type:"text",placeholder:"Generate your room id",value:g,name:"roomId",id:"roomId",className:"rounded-lg h-10  ",readOnly:!0}),Se.jsx("input",{type:"button",value:"Generate",onClick:()=>R(r()),className:"p-2 mx-1 hover:bg-blue-600 rounded-lg"}),Se.jsx("button",{id:"copy",className:"p-2 hover:bg-blue-600 rounded-lg",onClick:x,children:"Copy"})]}),Se.jsx("button",{type:"submit",onClick:P,className:"p-4 mb-2 cursor-pointer text-center bg-[#00A4CCFF] rounded-xl",children:"Create Room"})]})})},N$=({uuid:r,setUser:s,socket:c,user:d,userData:p})=>Se.jsxs("form",{className:"h-screen w-full flex justify-center items-center bg-[#28334AFF]",children:[Se.jsx("div",{children:Se.jsx(O$,{uuid:r,setUser:s,socket:c,userData:p})}),Se.jsx("div",{children:Se.jsx(A$,{user:d,uuid:r,setUser:s,socket:c,userData:p})})]});function WR(r,s,c){if(r&&r.length){const[d,p]=s,_=Math.PI/180*c,g=Math.cos(_),R=Math.sin(_);for(const I of r){const[P,k]=I;I[0]=(P-d)*g-(k-p)*R+d,I[1]=(P-d)*R+(k-p)*g+p}}}function P$(r,s){return r[0]===s[0]&&r[1]===s[1]}function D$(r,s,c,d=1){const p=c,_=Math.max(s,.1),g=r[0]&&r[0][0]&&typeof r[0][0]=="number"?[r]:r,R=[0,0];if(p)for(const P of g)WR(P,R,p);const I=function(P,k,L){const x=[];for(const F of P){const z=[...F];P$(z[0],z[z.length-1])||z.push([z[0][0],z[0][1]]),z.length>2&&x.push(z)}const H=[];k=Math.max(k,.1);const K=[];for(const F of x)for(let z=0;z<F.length-1;z++){const le=F[z],ge=F[z+1];if(le[1]!==ge[1]){const Z=Math.min(le[1],ge[1]);K.push({ymin:Z,ymax:Math.max(le[1],ge[1]),x:Z===le[1]?le[0]:ge[0],islope:(ge[0]-le[0])/(ge[1]-le[1])})}}if(K.sort((F,z)=>F.ymin<z.ymin?-1:F.ymin>z.ymin?1:F.x<z.x?-1:F.x>z.x?1:F.ymax===z.ymax?0:(F.ymax-z.ymax)/Math.abs(F.ymax-z.ymax)),!K.length)return H;let ee=[],re=K[0].ymin,Y=0;for(;ee.length||K.length;){if(K.length){let F=-1;for(let z=0;z<K.length&&!(K[z].ymin>re);z++)F=z;K.splice(0,F+1).forEach(z=>{ee.push({s:re,edge:z})})}if(ee=ee.filter(F=>!(F.edge.ymax<=re)),ee.sort((F,z)=>F.edge.x===z.edge.x?0:(F.edge.x-z.edge.x)/Math.abs(F.edge.x-z.edge.x)),(L!==1||Y%k==0)&&ee.length>1)for(let F=0;F<ee.length;F+=2){const z=F+1;if(z>=ee.length)break;const le=ee[F].edge,ge=ee[z].edge;H.push([[Math.round(le.x),re],[Math.round(ge.x),re]])}re+=L,ee.forEach(F=>{F.edge.x=F.edge.x+L*F.edge.islope}),Y++}return H}(g,_,d);if(p){for(const P of g)WR(P,R,-p);(function(P,k,L){const x=[];P.forEach(H=>x.push(...H)),WR(x,k,L)})(I,R,-p)}return I}function Qf(r,s){var c;const d=s.hachureAngle+90;let p=s.hachureGap;p<0&&(p=4*s.strokeWidth),p=Math.round(Math.max(p,.1));let _=1;return s.roughness>=1&&(((c=s.randomizer)===null||c===void 0?void 0:c.next())||Math.random())>.7&&(_=p),D$(r,p,d,_||1)}class Tw{constructor(s){this.helper=s}fillPolygons(s,c){return this._fillPolygons(s,c)}_fillPolygons(s,c){const d=Qf(s,c);return{type:"fillSketch",ops:this.renderLines(d,c)}}renderLines(s,c){const d=[];for(const p of s)d.push(...this.helper.doubleLineOps(p[0][0],p[0][1],p[1][0],p[1][1],c));return d}}function bv(r){const s=r[0],c=r[1];return Math.sqrt(Math.pow(s[0]-c[0],2)+Math.pow(s[1]-c[1],2))}class k$ extends Tw{fillPolygons(s,c){let d=c.hachureGap;d<0&&(d=4*c.strokeWidth),d=Math.max(d,.1);const p=Qf(s,Object.assign({},c,{hachureGap:d})),_=Math.PI/180*c.hachureAngle,g=[],R=.5*d*Math.cos(_),I=.5*d*Math.sin(_);for(const[P,k]of p)bv([P,k])&&g.push([[P[0]-R,P[1]+I],[...k]],[[P[0]+R,P[1]-I],[...k]]);return{type:"fillSketch",ops:this.renderLines(g,c)}}}class L$ extends Tw{fillPolygons(s,c){const d=this._fillPolygons(s,c),p=Object.assign({},c,{hachureAngle:c.hachureAngle+90}),_=this._fillPolygons(s,p);return d.ops=d.ops.concat(_.ops),d}}let M$=class{constructor(s){this.helper=s}fillPolygons(s,c){const d=Qf(s,c=Object.assign({},c,{hachureAngle:0}));return this.dotsOnLines(d,c)}dotsOnLines(s,c){const d=[];let p=c.hachureGap;p<0&&(p=4*c.strokeWidth),p=Math.max(p,.1);let _=c.fillWeight;_<0&&(_=c.strokeWidth/2);const g=p/4;for(const R of s){const I=bv(R),P=I/p,k=Math.ceil(P)-1,L=I-k*p,x=(R[0][0]+R[1][0])/2-p/4,H=Math.min(R[0][1],R[1][1]);for(let K=0;K<k;K++){const ee=H+L+K*p,re=x-g+2*Math.random()*g,Y=ee-g+2*Math.random()*g,F=this.helper.ellipse(re,Y,_,_,c);d.push(...F.ops)}}return{type:"fillSketch",ops:d}}};class x${constructor(s){this.helper=s}fillPolygons(s,c){const d=Qf(s,c);return{type:"fillSketch",ops:this.dashedLine(d,c)}}dashedLine(s,c){const d=c.dashOffset<0?c.hachureGap<0?4*c.strokeWidth:c.hachureGap:c.dashOffset,p=c.dashGap<0?c.hachureGap<0?4*c.strokeWidth:c.hachureGap:c.dashGap,_=[];return s.forEach(g=>{const R=bv(g),I=Math.floor(R/(d+p)),P=(R+p-I*(d+p))/2;let k=g[0],L=g[1];k[0]>L[0]&&(k=g[1],L=g[0]);const x=Math.atan((L[1]-k[1])/(L[0]-k[0]));for(let H=0;H<I;H++){const K=H*(d+p),ee=K+d,re=[k[0]+K*Math.cos(x)+P*Math.cos(x),k[1]+K*Math.sin(x)+P*Math.sin(x)],Y=[k[0]+ee*Math.cos(x)+P*Math.cos(x),k[1]+ee*Math.sin(x)+P*Math.sin(x)];_.push(...this.helper.doubleLineOps(re[0],re[1],Y[0],Y[1],c))}}),_}}class U${constructor(s){this.helper=s}fillPolygons(s,c){const d=c.hachureGap<0?4*c.strokeWidth:c.hachureGap,p=c.zigzagOffset<0?d:c.zigzagOffset,_=Qf(s,c=Object.assign({},c,{hachureGap:d+p}));return{type:"fillSketch",ops:this.zigzagLines(_,p,c)}}zigzagLines(s,c,d){const p=[];return s.forEach(_=>{const g=bv(_),R=Math.round(g/(2*c));let I=_[0],P=_[1];I[0]>P[0]&&(I=_[1],P=_[0]);const k=Math.atan((P[1]-I[1])/(P[0]-I[0]));for(let L=0;L<R;L++){const x=2*L*c,H=2*(L+1)*c,K=Math.sqrt(2*Math.pow(c,2)),ee=[I[0]+x*Math.cos(k),I[1]+x*Math.sin(k)],re=[I[0]+H*Math.cos(k),I[1]+H*Math.sin(k)],Y=[ee[0]+K*Math.cos(k+Math.PI/4),ee[1]+K*Math.sin(k+Math.PI/4)];p.push(...this.helper.doubleLineOps(ee[0],ee[1],Y[0],Y[1],d),...this.helper.doubleLineOps(Y[0],Y[1],re[0],re[1],d))}}),p}}const zr={};let V$=class{constructor(s){this.seed=s}next(){return this.seed?(2**31-1&(this.seed=Math.imul(48271,this.seed)))/2**31:Math.random()}};const F$=0,HR=1,Px=2,GE={A:7,a:7,C:6,c:6,H:1,h:1,L:2,l:2,M:2,m:2,Q:4,q:4,S:4,s:4,T:2,t:2,V:1,v:1,Z:0,z:0};function KR(r,s){return r.type===s}function yw(r){const s=[],c=function(g){const R=new Array;for(;g!=="";)if(g.match(/^([ \t\r\n,]+)/))g=g.substr(RegExp.$1.length);else if(g.match(/^([aAcChHlLmMqQsStTvVzZ])/))R[R.length]={type:F$,text:RegExp.$1},g=g.substr(RegExp.$1.length);else{if(!g.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/))return[];R[R.length]={type:HR,text:`${parseFloat(RegExp.$1)}`},g=g.substr(RegExp.$1.length)}return R[R.length]={type:Px,text:""},R}(r);let d="BOD",p=0,_=c[p];for(;!KR(_,Px);){let g=0;const R=[];if(d==="BOD"){if(_.text!=="M"&&_.text!=="m")return yw("M0,0"+r);p++,g=GE[_.text],d=_.text}else KR(_,HR)?g=GE[d]:(p++,g=GE[_.text],d=_.text);if(!(p+g<c.length))throw new Error("Path data ended short");for(let I=p;I<p+g;I++){const P=c[I];if(!KR(P,HR))throw new Error("Param not a number: "+d+","+P.text);R[R.length]=+P.text}if(typeof GE[d]!="number")throw new Error("Bad segment: "+d);{const I={key:d,data:R};s.push(I),p+=g,_=c[p],d==="M"&&(d="L"),d==="m"&&(d="l")}}return s}function i3(r){let s=0,c=0,d=0,p=0;const _=[];for(const{key:g,data:R}of r)switch(g){case"M":_.push({key:"M",data:[...R]}),[s,c]=R,[d,p]=R;break;case"m":s+=R[0],c+=R[1],_.push({key:"M",data:[s,c]}),d=s,p=c;break;case"L":_.push({key:"L",data:[...R]}),[s,c]=R;break;case"l":s+=R[0],c+=R[1],_.push({key:"L",data:[s,c]});break;case"C":_.push({key:"C",data:[...R]}),s=R[4],c=R[5];break;case"c":{const I=R.map((P,k)=>k%2?P+c:P+s);_.push({key:"C",data:I}),s=I[4],c=I[5];break}case"Q":_.push({key:"Q",data:[...R]}),s=R[2],c=R[3];break;case"q":{const I=R.map((P,k)=>k%2?P+c:P+s);_.push({key:"Q",data:I}),s=I[2],c=I[3];break}case"A":_.push({key:"A",data:[...R]}),s=R[5],c=R[6];break;case"a":s+=R[5],c+=R[6],_.push({key:"A",data:[R[0],R[1],R[2],R[3],R[4],s,c]});break;case"H":_.push({key:"H",data:[...R]}),s=R[0];break;case"h":s+=R[0],_.push({key:"H",data:[s]});break;case"V":_.push({key:"V",data:[...R]}),c=R[0];break;case"v":c+=R[0],_.push({key:"V",data:[c]});break;case"S":_.push({key:"S",data:[...R]}),s=R[2],c=R[3];break;case"s":{const I=R.map((P,k)=>k%2?P+c:P+s);_.push({key:"S",data:I}),s=I[2],c=I[3];break}case"T":_.push({key:"T",data:[...R]}),s=R[0],c=R[1];break;case"t":s+=R[0],c+=R[1],_.push({key:"T",data:[s,c]});break;case"Z":case"z":_.push({key:"Z",data:[]}),s=d,c=p}return _}function r3(r){const s=[];let c="",d=0,p=0,_=0,g=0,R=0,I=0;for(const{key:P,data:k}of r){switch(P){case"M":s.push({key:"M",data:[...k]}),[d,p]=k,[_,g]=k;break;case"C":s.push({key:"C",data:[...k]}),d=k[4],p=k[5],R=k[2],I=k[3];break;case"L":s.push({key:"L",data:[...k]}),[d,p]=k;break;case"H":d=k[0],s.push({key:"L",data:[d,p]});break;case"V":p=k[0],s.push({key:"L",data:[d,p]});break;case"S":{let L=0,x=0;c==="C"||c==="S"?(L=d+(d-R),x=p+(p-I)):(L=d,x=p),s.push({key:"C",data:[L,x,...k]}),R=k[0],I=k[1],d=k[2],p=k[3];break}case"T":{const[L,x]=k;let H=0,K=0;c==="Q"||c==="T"?(H=d+(d-R),K=p+(p-I)):(H=d,K=p);const ee=d+2*(H-d)/3,re=p+2*(K-p)/3,Y=L+2*(H-L)/3,F=x+2*(K-x)/3;s.push({key:"C",data:[ee,re,Y,F,L,x]}),R=H,I=K,d=L,p=x;break}case"Q":{const[L,x,H,K]=k,ee=d+2*(L-d)/3,re=p+2*(x-p)/3,Y=H+2*(L-H)/3,F=K+2*(x-K)/3;s.push({key:"C",data:[ee,re,Y,F,H,K]}),R=L,I=x,d=H,p=K;break}case"A":{const L=Math.abs(k[0]),x=Math.abs(k[1]),H=k[2],K=k[3],ee=k[4],re=k[5],Y=k[6];L===0||x===0?(s.push({key:"C",data:[d,p,re,Y,re,Y]}),d=re,p=Y):(d!==re||p!==Y)&&(s3(d,p,re,Y,L,x,H,K,ee).forEach(function(F){s.push({key:"C",data:F})}),d=re,p=Y);break}case"Z":s.push({key:"Z",data:[]}),d=_,p=g}c=P}return s}function Xp(r,s,c){return[r*Math.cos(c)-s*Math.sin(c),r*Math.sin(c)+s*Math.cos(c)]}function s3(r,s,c,d,p,_,g,R,I,P){const k=(L=g,Math.PI*L/180);var L;let x=[],H=0,K=0,ee=0,re=0;if(P)[H,K,ee,re]=P;else{[r,s]=Xp(r,s,-k),[c,d]=Xp(c,d,-k);const lt=(r-c)/2,Ge=(s-d)/2;let Mt=lt*lt/(p*p)+Ge*Ge/(_*_);Mt>1&&(Mt=Math.sqrt(Mt),p*=Mt,_*=Mt);const Zt=p*p,Ft=_*_,xe=Zt*Ft-Zt*Ge*Ge-Ft*lt*lt,We=Zt*Ge*Ge+Ft*lt*lt,ct=(R===I?-1:1)*Math.sqrt(Math.abs(xe/We));ee=ct*p*Ge/_+(r+c)/2,re=ct*-_*lt/p+(s+d)/2,H=Math.asin(parseFloat(((s-re)/_).toFixed(9))),K=Math.asin(parseFloat(((d-re)/_).toFixed(9))),r<ee&&(H=Math.PI-H),c<ee&&(K=Math.PI-K),H<0&&(H=2*Math.PI+H),K<0&&(K=2*Math.PI+K),I&&H>K&&(H-=2*Math.PI),!I&&K>H&&(K-=2*Math.PI)}let Y=K-H;if(Math.abs(Y)>120*Math.PI/180){const lt=K,Ge=c,Mt=d;K=I&&K>H?H+120*Math.PI/180*1:H+120*Math.PI/180*-1,x=s3(c=ee+p*Math.cos(K),d=re+_*Math.sin(K),Ge,Mt,p,_,g,0,I,[K,lt,ee,re])}Y=K-H;const F=Math.cos(H),z=Math.sin(H),le=Math.cos(K),ge=Math.sin(K),Z=Math.tan(Y/4),fe=4/3*p*Z,ae=4/3*_*Z,_e=[r,s],me=[r+fe*z,s-ae*F],Ue=[c+fe*ge,d-ae*le],Ve=[c,d];if(me[0]=2*_e[0]-me[0],me[1]=2*_e[1]-me[1],P)return[me,Ue,Ve].concat(x);{x=[me,Ue,Ve].concat(x);const lt=[];for(let Ge=0;Ge<x.length;Ge+=3){const Mt=Xp(x[Ge][0],x[Ge][1],k),Zt=Xp(x[Ge+1][0],x[Ge+1][1],k),Ft=Xp(x[Ge+2][0],x[Ge+2][1],k);lt.push([Mt[0],Mt[1],Zt[0],Zt[1],Ft[0],Ft[1]])}return lt}}const j$={randOffset:function(r,s){return ht(r,s)},randOffsetWithRange:function(r,s,c){return Qg(r,s,c)},ellipse:function(r,s,c,d,p){const _=a3(c,d,p);return $C(r,s,p,_).opset},doubleLineOps:function(r,s,c,d,p){return nl(r,s,c,d,p,!0)}};function o3(r,s,c,d,p){return{type:"path",ops:nl(r,s,c,d,p)}}function Eg(r,s,c){const d=(r||[]).length;if(d>2){const p=[];for(let _=0;_<d-1;_++)p.push(...nl(r[_][0],r[_][1],r[_+1][0],r[_+1][1],c));return s&&p.push(...nl(r[d-1][0],r[d-1][1],r[0][0],r[0][1],c)),{type:"path",ops:p}}return d===2?o3(r[0][0],r[0][1],r[1][0],r[1][1],c):{type:"path",ops:[]}}function B$(r,s,c,d,p){return function(_,g){return Eg(_,!0,g)}([[r,s],[r+c,s],[r+c,s+d],[r,s+d]],p)}function Dx(r,s){if(r.length){const c=typeof r[0][0]=="number"?[r]:r,d=WE(c[0],1*(1+.2*s.roughness),s),p=s.disableMultiStroke?[]:WE(c[0],1.5*(1+.22*s.roughness),Mx(s));for(let _=1;_<c.length;_++){const g=c[_];if(g.length){const R=WE(g,1*(1+.2*s.roughness),s),I=s.disableMultiStroke?[]:WE(g,1.5*(1+.22*s.roughness),Mx(s));for(const P of R)P.op!=="move"&&d.push(P);for(const P of I)P.op!=="move"&&p.push(P)}}return{type:"path",ops:d.concat(p)}}return{type:"path",ops:[]}}function a3(r,s,c){const d=Math.sqrt(2*Math.PI*Math.sqrt((Math.pow(r/2,2)+Math.pow(s/2,2))/2)),p=Math.ceil(Math.max(c.curveStepCount,c.curveStepCount/Math.sqrt(200)*d)),_=2*Math.PI/p;let g=Math.abs(r/2),R=Math.abs(s/2);const I=1-c.curveFitting;return g+=ht(g*I,c),R+=ht(R*I,c),{increment:_,rx:g,ry:R}}function $C(r,s,c,d){const[p,_]=xx(d.increment,r,s,d.rx,d.ry,1,d.increment*Qg(.1,Qg(.4,1,c),c),c);let g=$g(p,null,c);if(!c.disableMultiStroke&&c.roughness!==0){const[R]=xx(d.increment,r,s,d.rx,d.ry,1.5,0,c),I=$g(R,null,c);g=g.concat(I)}return{estimatedPoints:_,opset:{type:"path",ops:g}}}function kx(r,s,c,d,p,_,g,R,I){const P=r,k=s;let L=Math.abs(c/2),x=Math.abs(d/2);L+=ht(.01*L,I),x+=ht(.01*x,I);let H=p,K=_;for(;H<0;)H+=2*Math.PI,K+=2*Math.PI;K-H>2*Math.PI&&(H=0,K=2*Math.PI);const ee=2*Math.PI/I.curveStepCount,re=Math.min(ee/2,(K-H)/2),Y=Ux(re,P,k,L,x,H,K,1,I);if(!I.disableMultiStroke){const F=Ux(re,P,k,L,x,H,K,1.5,I);Y.push(...F)}return g&&(R?Y.push(...nl(P,k,P+L*Math.cos(H),k+x*Math.sin(H),I),...nl(P,k,P+L*Math.cos(K),k+x*Math.sin(K),I)):Y.push({op:"lineTo",data:[P,k]},{op:"lineTo",data:[P+L*Math.cos(H),k+x*Math.sin(H)]})),{type:"path",ops:Y}}function Lx(r,s){const c=r3(i3(yw(r))),d=[];let p=[0,0],_=[0,0];for(const{key:g,data:R}of c)switch(g){case"M":_=[R[0],R[1]],p=[R[0],R[1]];break;case"L":d.push(...nl(_[0],_[1],R[0],R[1],s)),_=[R[0],R[1]];break;case"C":{const[I,P,k,L,x,H]=R;d.push(...G$(I,P,k,L,x,H,_,s)),_=[x,H];break}case"Z":d.push(...nl(_[0],_[1],p[0],p[1],s)),_=[p[0],p[1]]}return{type:"path",ops:d}}function zR(r,s){const c=[];for(const d of r)if(d.length){const p=s.maxRandomnessOffset||0,_=d.length;if(_>2){c.push({op:"move",data:[d[0][0]+ht(p,s),d[0][1]+ht(p,s)]});for(let g=1;g<_;g++)c.push({op:"lineTo",data:[d[g][0]+ht(p,s),d[g][1]+ht(p,s)]})}}return{type:"fillPath",ops:c}}function Iu(r,s){return function(c,d){let p=c.fillStyle||"hachure";if(!zr[p])switch(p){case"zigzag":zr[p]||(zr[p]=new k$(d));break;case"cross-hatch":zr[p]||(zr[p]=new L$(d));break;case"dots":zr[p]||(zr[p]=new M$(d));break;case"dashed":zr[p]||(zr[p]=new x$(d));break;case"zigzag-line":zr[p]||(zr[p]=new U$(d));break;default:p="hachure",zr[p]||(zr[p]=new Tw(d))}return zr[p]}(s,j$).fillPolygons(r,s)}function Mx(r){const s=Object.assign({},r);return s.randomizer=void 0,r.seed&&(s.seed=r.seed+1),s}function c3(r){return r.randomizer||(r.randomizer=new V$(r.seed||0)),r.randomizer.next()}function Qg(r,s,c,d=1){return c.roughness*d*(c3(c)*(s-r)+r)}function ht(r,s,c=1){return Qg(-r,r,s,c)}function nl(r,s,c,d,p,_=!1){const g=_?p.disableMultiStrokeFill:p.disableMultiStroke,R=ZC(r,s,c,d,p,!0,!1);if(g)return R;const I=ZC(r,s,c,d,p,!0,!0);return R.concat(I)}function ZC(r,s,c,d,p,_,g){const R=Math.pow(r-c,2)+Math.pow(s-d,2),I=Math.sqrt(R);let P=1;P=I<200?1:I>500?.4:-.0016668*I+1.233334;let k=p.maxRandomnessOffset||0;k*k*100>R&&(k=I/10);const L=k/2,x=.2+.2*c3(p);let H=p.bowing*p.maxRandomnessOffset*(d-s)/200,K=p.bowing*p.maxRandomnessOffset*(r-c)/200;H=ht(H,p,P),K=ht(K,p,P);const ee=[],re=()=>ht(L,p,P),Y=()=>ht(k,p,P),F=p.preserveVertices;return _&&(g?ee.push({op:"move",data:[r+(F?0:re()),s+(F?0:re())]}):ee.push({op:"move",data:[r+(F?0:ht(k,p,P)),s+(F?0:ht(k,p,P))]})),g?ee.push({op:"bcurveTo",data:[H+r+(c-r)*x+re(),K+s+(d-s)*x+re(),H+r+2*(c-r)*x+re(),K+s+2*(d-s)*x+re(),c+(F?0:re()),d+(F?0:re())]}):ee.push({op:"bcurveTo",data:[H+r+(c-r)*x+Y(),K+s+(d-s)*x+Y(),H+r+2*(c-r)*x+Y(),K+s+2*(d-s)*x+Y(),c+(F?0:Y()),d+(F?0:Y())]}),ee}function WE(r,s,c){if(!r.length)return[];const d=[];d.push([r[0][0]+ht(s,c),r[0][1]+ht(s,c)]),d.push([r[0][0]+ht(s,c),r[0][1]+ht(s,c)]);for(let p=1;p<r.length;p++)d.push([r[p][0]+ht(s,c),r[p][1]+ht(s,c)]),p===r.length-1&&d.push([r[p][0]+ht(s,c),r[p][1]+ht(s,c)]);return $g(d,null,c)}function $g(r,s,c){const d=r.length,p=[];if(d>3){const _=[],g=1-c.curveTightness;p.push({op:"move",data:[r[1][0],r[1][1]]});for(let R=1;R+2<d;R++){const I=r[R];_[0]=[I[0],I[1]],_[1]=[I[0]+(g*r[R+1][0]-g*r[R-1][0])/6,I[1]+(g*r[R+1][1]-g*r[R-1][1])/6],_[2]=[r[R+1][0]+(g*r[R][0]-g*r[R+2][0])/6,r[R+1][1]+(g*r[R][1]-g*r[R+2][1])/6],_[3]=[r[R+1][0],r[R+1][1]],p.push({op:"bcurveTo",data:[_[1][0],_[1][1],_[2][0],_[2][1],_[3][0],_[3][1]]})}if(s&&s.length===2){const R=c.maxRandomnessOffset;p.push({op:"lineTo",data:[s[0]+ht(R,c),s[1]+ht(R,c)]})}}else d===3?(p.push({op:"move",data:[r[1][0],r[1][1]]}),p.push({op:"bcurveTo",data:[r[1][0],r[1][1],r[2][0],r[2][1],r[2][0],r[2][1]]})):d===2&&p.push(...ZC(r[0][0],r[0][1],r[1][0],r[1][1],c,!0,!0));return p}function xx(r,s,c,d,p,_,g,R){const I=[],P=[];if(R.roughness===0){r/=4,P.push([s+d*Math.cos(-r),c+p*Math.sin(-r)]);for(let k=0;k<=2*Math.PI;k+=r){const L=[s+d*Math.cos(k),c+p*Math.sin(k)];I.push(L),P.push(L)}P.push([s+d*Math.cos(0),c+p*Math.sin(0)]),P.push([s+d*Math.cos(r),c+p*Math.sin(r)])}else{const k=ht(.5,R)-Math.PI/2;P.push([ht(_,R)+s+.9*d*Math.cos(k-r),ht(_,R)+c+.9*p*Math.sin(k-r)]);const L=2*Math.PI+k-.01;for(let x=k;x<L;x+=r){const H=[ht(_,R)+s+d*Math.cos(x),ht(_,R)+c+p*Math.sin(x)];I.push(H),P.push(H)}P.push([ht(_,R)+s+d*Math.cos(k+2*Math.PI+.5*g),ht(_,R)+c+p*Math.sin(k+2*Math.PI+.5*g)]),P.push([ht(_,R)+s+.98*d*Math.cos(k+g),ht(_,R)+c+.98*p*Math.sin(k+g)]),P.push([ht(_,R)+s+.9*d*Math.cos(k+.5*g),ht(_,R)+c+.9*p*Math.sin(k+.5*g)])}return[P,I]}function Ux(r,s,c,d,p,_,g,R,I){const P=_+ht(.1,I),k=[];k.push([ht(R,I)+s+.9*d*Math.cos(P-r),ht(R,I)+c+.9*p*Math.sin(P-r)]);for(let L=P;L<=g;L+=r)k.push([ht(R,I)+s+d*Math.cos(L),ht(R,I)+c+p*Math.sin(L)]);return k.push([s+d*Math.cos(g),c+p*Math.sin(g)]),k.push([s+d*Math.cos(g),c+p*Math.sin(g)]),$g(k,null,I)}function G$(r,s,c,d,p,_,g,R){const I=[],P=[R.maxRandomnessOffset||1,(R.maxRandomnessOffset||1)+.3];let k=[0,0];const L=R.disableMultiStroke?1:2,x=R.preserveVertices;for(let H=0;H<L;H++)H===0?I.push({op:"move",data:[g[0],g[1]]}):I.push({op:"move",data:[g[0]+(x?0:ht(P[0],R)),g[1]+(x?0:ht(P[0],R))]}),k=x?[p,_]:[p+ht(P[H],R),_+ht(P[H],R)],I.push({op:"bcurveTo",data:[r+ht(P[H],R),s+ht(P[H],R),c+ht(P[H],R),d+ht(P[H],R),k[0],k[1]]});return I}function Qp(r){return[...r]}function Vx(r,s=0){const c=r.length;if(c<3)throw new Error("A curve must have at least three points.");const d=[];if(c===3)d.push(Qp(r[0]),Qp(r[1]),Qp(r[2]),Qp(r[2]));else{const p=[];p.push(r[0],r[0]);for(let R=1;R<r.length;R++)p.push(r[R]),R===r.length-1&&p.push(r[R]);const _=[],g=1-s;d.push(Qp(p[0]));for(let R=1;R+2<p.length;R++){const I=p[R];_[0]=[I[0],I[1]],_[1]=[I[0]+(g*p[R+1][0]-g*p[R-1][0])/6,I[1]+(g*p[R+1][1]-g*p[R-1][1])/6],_[2]=[p[R+1][0]+(g*p[R][0]-g*p[R+2][0])/6,p[R+1][1]+(g*p[R][1]-g*p[R+2][1])/6],_[3]=[p[R+1][0],p[R+1][1]],d.push(_[1],_[2],_[3])}}return d}function gg(r,s){return Math.pow(r[0]-s[0],2)+Math.pow(r[1]-s[1],2)}function W$(r,s,c){const d=gg(s,c);if(d===0)return gg(r,s);let p=((r[0]-s[0])*(c[0]-s[0])+(r[1]-s[1])*(c[1]-s[1]))/d;return p=Math.max(0,Math.min(1,p)),gg(r,Kl(s,c,p))}function Kl(r,s,c){return[r[0]+(s[0]-r[0])*c,r[1]+(s[1]-r[1])*c]}function eI(r,s,c,d){const p=d||[];if(function(R,I){const P=R[I+0],k=R[I+1],L=R[I+2],x=R[I+3];let H=3*k[0]-2*P[0]-x[0];H*=H;let K=3*k[1]-2*P[1]-x[1];K*=K;let ee=3*L[0]-2*x[0]-P[0];ee*=ee;let re=3*L[1]-2*x[1]-P[1];return re*=re,H<ee&&(H=ee),K<re&&(K=re),H+K}(r,s)<c){const R=r[s+0];p.length?(_=p[p.length-1],g=R,Math.sqrt(gg(_,g))>1&&p.push(R)):p.push(R),p.push(r[s+3])}else{const I=r[s+0],P=r[s+1],k=r[s+2],L=r[s+3],x=Kl(I,P,.5),H=Kl(P,k,.5),K=Kl(k,L,.5),ee=Kl(x,H,.5),re=Kl(H,K,.5),Y=Kl(ee,re,.5);eI([I,x,ee,Y],0,c,p),eI([Y,re,K,L],0,c,p)}var _,g;return p}function H$(r,s){return Zg(r,0,r.length,s)}function Zg(r,s,c,d,p){const _=p||[],g=r[s],R=r[c-1];let I=0,P=1;for(let k=s+1;k<c-1;++k){const L=W$(r[k],g,R);L>I&&(I=L,P=k)}return Math.sqrt(I)>d?(Zg(r,s,P+1,d,_),Zg(r,P,c,d,_)):(_.length||_.push(g),_.push(R)),_}function YR(r,s=.15,c){const d=[],p=(r.length-1)/3;for(let _=0;_<p;_++)eI(r,3*_,s,d);return c&&c>0?Zg(d,0,d.length,c):d}const ds="none";class ev{constructor(s){this.defaultOptions={maxRandomnessOffset:2,roughness:1,bowing:1,stroke:"#000",strokeWidth:1,curveTightness:0,curveFitting:.95,curveStepCount:9,fillStyle:"hachure",fillWeight:-1,hachureAngle:-41,hachureGap:-1,dashOffset:-1,dashGap:-1,zigzagOffset:-1,seed:0,disableMultiStroke:!1,disableMultiStrokeFill:!1,preserveVertices:!1,fillShapeRoughnessGain:.8},this.config=s||{},this.config.options&&(this.defaultOptions=this._o(this.config.options))}static newSeed(){return Math.floor(Math.random()*2**31)}_o(s){return s?Object.assign({},this.defaultOptions,s):this.defaultOptions}_d(s,c,d){return{shape:s,sets:c||[],options:d||this.defaultOptions}}line(s,c,d,p,_){const g=this._o(_);return this._d("line",[o3(s,c,d,p,g)],g)}rectangle(s,c,d,p,_){const g=this._o(_),R=[],I=B$(s,c,d,p,g);if(g.fill){const P=[[s,c],[s+d,c],[s+d,c+p],[s,c+p]];g.fillStyle==="solid"?R.push(zR([P],g)):R.push(Iu([P],g))}return g.stroke!==ds&&R.push(I),this._d("rectangle",R,g)}ellipse(s,c,d,p,_){const g=this._o(_),R=[],I=a3(d,p,g),P=$C(s,c,g,I);if(g.fill)if(g.fillStyle==="solid"){const k=$C(s,c,g,I).opset;k.type="fillPath",R.push(k)}else R.push(Iu([P.estimatedPoints],g));return g.stroke!==ds&&R.push(P.opset),this._d("ellipse",R,g)}circle(s,c,d,p){const _=this.ellipse(s,c,d,d,p);return _.shape="circle",_}linearPath(s,c){const d=this._o(c);return this._d("linearPath",[Eg(s,!1,d)],d)}arc(s,c,d,p,_,g,R=!1,I){const P=this._o(I),k=[],L=kx(s,c,d,p,_,g,R,!0,P);if(R&&P.fill)if(P.fillStyle==="solid"){const x=Object.assign({},P);x.disableMultiStroke=!0;const H=kx(s,c,d,p,_,g,!0,!1,x);H.type="fillPath",k.push(H)}else k.push(function(x,H,K,ee,re,Y,F){const z=x,le=H;let ge=Math.abs(K/2),Z=Math.abs(ee/2);ge+=ht(.01*ge,F),Z+=ht(.01*Z,F);let fe=re,ae=Y;for(;fe<0;)fe+=2*Math.PI,ae+=2*Math.PI;ae-fe>2*Math.PI&&(fe=0,ae=2*Math.PI);const _e=(ae-fe)/F.curveStepCount,me=[];for(let Ue=fe;Ue<=ae;Ue+=_e)me.push([z+ge*Math.cos(Ue),le+Z*Math.sin(Ue)]);return me.push([z+ge*Math.cos(ae),le+Z*Math.sin(ae)]),me.push([z,le]),Iu([me],F)}(s,c,d,p,_,g,P));return P.stroke!==ds&&k.push(L),this._d("arc",k,P)}curve(s,c){const d=this._o(c),p=[],_=Dx(s,d);if(d.fill&&d.fill!==ds)if(d.fillStyle==="solid"){const g=Dx(s,Object.assign(Object.assign({},d),{disableMultiStroke:!0,roughness:d.roughness?d.roughness+d.fillShapeRoughnessGain:0}));p.push({type:"fillPath",ops:this._mergedShape(g.ops)})}else{const g=[],R=s;if(R.length){const I=typeof R[0][0]=="number"?[R]:R;for(const P of I)P.length<3?g.push(...P):P.length===3?g.push(...YR(Vx([P[0],P[0],P[1],P[2]]),10,(1+d.roughness)/2)):g.push(...YR(Vx(P),10,(1+d.roughness)/2))}g.length&&p.push(Iu([g],d))}return d.stroke!==ds&&p.push(_),this._d("curve",p,d)}polygon(s,c){const d=this._o(c),p=[],_=Eg(s,!0,d);return d.fill&&(d.fillStyle==="solid"?p.push(zR([s],d)):p.push(Iu([s],d))),d.stroke!==ds&&p.push(_),this._d("polygon",p,d)}path(s,c){const d=this._o(c),p=[];if(!s)return this._d("path",p,d);s=(s||"").replace(/\n/g," ").replace(/(-\s)/g,"-").replace("/(ss)/g"," ");const _=d.fill&&d.fill!=="transparent"&&d.fill!==ds,g=d.stroke!==ds,R=!!(d.simplification&&d.simplification<1),I=function(k,L,x){const H=r3(i3(yw(k))),K=[];let ee=[],re=[0,0],Y=[];const F=()=>{Y.length>=4&&ee.push(...YR(Y,L)),Y=[]},z=()=>{F(),ee.length&&(K.push(ee),ee=[])};for(const{key:ge,data:Z}of H)switch(ge){case"M":z(),re=[Z[0],Z[1]],ee.push(re);break;case"L":F(),ee.push([Z[0],Z[1]]);break;case"C":if(!Y.length){const fe=ee.length?ee[ee.length-1]:re;Y.push([fe[0],fe[1]])}Y.push([Z[0],Z[1]]),Y.push([Z[2],Z[3]]),Y.push([Z[4],Z[5]]);break;case"Z":F(),ee.push([re[0],re[1]])}if(z(),!x)return K;const le=[];for(const ge of K){const Z=H$(ge,x);Z.length&&le.push(Z)}return le}(s,1,R?4-4*(d.simplification||1):(1+d.roughness)/2),P=Lx(s,d);if(_)if(d.fillStyle==="solid")if(I.length===1){const k=Lx(s,Object.assign(Object.assign({},d),{disableMultiStroke:!0,roughness:d.roughness?d.roughness+d.fillShapeRoughnessGain:0}));p.push({type:"fillPath",ops:this._mergedShape(k.ops)})}else p.push(zR(I,d));else p.push(Iu(I,d));return g&&(R?I.forEach(k=>{p.push(Eg(k,!1,d))}):p.push(P)),this._d("path",p,d)}opsToPath(s,c){let d="";for(const p of s.ops){const _=typeof c=="number"&&c>=0?p.data.map(g=>+g.toFixed(c)):p.data;switch(p.op){case"move":d+=`M${_[0]} ${_[1]} `;break;case"bcurveTo":d+=`C${_[0]} ${_[1]}, ${_[2]} ${_[3]}, ${_[4]} ${_[5]} `;break;case"lineTo":d+=`L${_[0]} ${_[1]} `}}return d.trim()}toPaths(s){const c=s.sets||[],d=s.options||this.defaultOptions,p=[];for(const _ of c){let g=null;switch(_.type){case"path":g={d:this.opsToPath(_),stroke:d.stroke,strokeWidth:d.strokeWidth,fill:ds};break;case"fillPath":g={d:this.opsToPath(_),stroke:ds,strokeWidth:0,fill:d.fill||ds};break;case"fillSketch":g=this.fillSketch(_,d)}g&&p.push(g)}return p}fillSketch(s,c){let d=c.fillWeight;return d<0&&(d=c.strokeWidth/2),{d:this.opsToPath(s),stroke:c.fill||ds,strokeWidth:d,fill:ds}}_mergedShape(s){return s.filter((c,d)=>d===0||c.op!=="move")}}class K${constructor(s,c){this.canvas=s,this.ctx=this.canvas.getContext("2d"),this.gen=new ev(c)}draw(s){const c=s.sets||[],d=s.options||this.getDefaultOptions(),p=this.ctx,_=s.options.fixedDecimalPlaceDigits;for(const g of c)switch(g.type){case"path":p.save(),p.strokeStyle=d.stroke==="none"?"transparent":d.stroke,p.lineWidth=d.strokeWidth,d.strokeLineDash&&p.setLineDash(d.strokeLineDash),d.strokeLineDashOffset&&(p.lineDashOffset=d.strokeLineDashOffset),this._drawToContext(p,g,_),p.restore();break;case"fillPath":{p.save(),p.fillStyle=d.fill||"";const R=s.shape==="curve"||s.shape==="polygon"||s.shape==="path"?"evenodd":"nonzero";this._drawToContext(p,g,_,R),p.restore();break}case"fillSketch":this.fillSketch(p,g,d)}}fillSketch(s,c,d){let p=d.fillWeight;p<0&&(p=d.strokeWidth/2),s.save(),d.fillLineDash&&s.setLineDash(d.fillLineDash),d.fillLineDashOffset&&(s.lineDashOffset=d.fillLineDashOffset),s.strokeStyle=d.fill||"",s.lineWidth=p,this._drawToContext(s,c,d.fixedDecimalPlaceDigits),s.restore()}_drawToContext(s,c,d,p="nonzero"){s.beginPath();for(const _ of c.ops){const g=typeof d=="number"&&d>=0?_.data.map(R=>+R.toFixed(d)):_.data;switch(_.op){case"move":s.moveTo(g[0],g[1]);break;case"bcurveTo":s.bezierCurveTo(g[0],g[1],g[2],g[3],g[4],g[5]);break;case"lineTo":s.lineTo(g[0],g[1])}}c.type==="fillPath"?s.fill(p):s.stroke()}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}line(s,c,d,p,_){const g=this.gen.line(s,c,d,p,_);return this.draw(g),g}rectangle(s,c,d,p,_){const g=this.gen.rectangle(s,c,d,p,_);return this.draw(g),g}ellipse(s,c,d,p,_){const g=this.gen.ellipse(s,c,d,p,_);return this.draw(g),g}circle(s,c,d,p){const _=this.gen.circle(s,c,d,p);return this.draw(_),_}linearPath(s,c){const d=this.gen.linearPath(s,c);return this.draw(d),d}polygon(s,c){const d=this.gen.polygon(s,c);return this.draw(d),d}arc(s,c,d,p,_,g,R=!1,I){const P=this.gen.arc(s,c,d,p,_,g,R,I);return this.draw(P),P}curve(s,c){const d=this.gen.curve(s,c);return this.draw(d),d}path(s,c){const d=this.gen.path(s,c);return this.draw(d),d}}const HE="http://www.w3.org/2000/svg";class z${constructor(s,c){this.svg=s,this.gen=new ev(c)}draw(s){const c=s.sets||[],d=s.options||this.getDefaultOptions(),p=this.svg.ownerDocument||window.document,_=p.createElementNS(HE,"g"),g=s.options.fixedDecimalPlaceDigits;for(const R of c){let I=null;switch(R.type){case"path":I=p.createElementNS(HE,"path"),I.setAttribute("d",this.opsToPath(R,g)),I.setAttribute("stroke",d.stroke),I.setAttribute("stroke-width",d.strokeWidth+""),I.setAttribute("fill","none"),d.strokeLineDash&&I.setAttribute("stroke-dasharray",d.strokeLineDash.join(" ").trim()),d.strokeLineDashOffset&&I.setAttribute("stroke-dashoffset",`${d.strokeLineDashOffset}`);break;case"fillPath":I=p.createElementNS(HE,"path"),I.setAttribute("d",this.opsToPath(R,g)),I.setAttribute("stroke","none"),I.setAttribute("stroke-width","0"),I.setAttribute("fill",d.fill||""),s.shape!=="curve"&&s.shape!=="polygon"||I.setAttribute("fill-rule","evenodd");break;case"fillSketch":I=this.fillSketch(p,R,d)}I&&_.appendChild(I)}return _}fillSketch(s,c,d){let p=d.fillWeight;p<0&&(p=d.strokeWidth/2);const _=s.createElementNS(HE,"path");return _.setAttribute("d",this.opsToPath(c,d.fixedDecimalPlaceDigits)),_.setAttribute("stroke",d.fill||""),_.setAttribute("stroke-width",p+""),_.setAttribute("fill","none"),d.fillLineDash&&_.setAttribute("stroke-dasharray",d.fillLineDash.join(" ").trim()),d.fillLineDashOffset&&_.setAttribute("stroke-dashoffset",`${d.fillLineDashOffset}`),_}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}opsToPath(s,c){return this.gen.opsToPath(s,c)}line(s,c,d,p,_){const g=this.gen.line(s,c,d,p,_);return this.draw(g)}rectangle(s,c,d,p,_){const g=this.gen.rectangle(s,c,d,p,_);return this.draw(g)}ellipse(s,c,d,p,_){const g=this.gen.ellipse(s,c,d,p,_);return this.draw(g)}circle(s,c,d,p){const _=this.gen.circle(s,c,d,p);return this.draw(_)}linearPath(s,c){const d=this.gen.linearPath(s,c);return this.draw(d)}polygon(s,c){const d=this.gen.polygon(s,c);return this.draw(d)}arc(s,c,d,p,_,g,R=!1,I){const P=this.gen.arc(s,c,d,p,_,g,R,I);return this.draw(P)}curve(s,c){const d=this.gen.curve(s,c);return this.draw(d)}path(s,c){const d=this.gen.path(s,c);return this.draw(d)}}var l3={canvas:(r,s)=>new K$(r,s),svg:(r,s)=>new z$(r,s),generator:r=>new ev(r),newSeed:()=>ev.newSeed()};const Y$=l3.generator(),q$=Math.random()*1e4,J$=({color:r,tool:s,user:c,socket:d,canvasRef:p,elements:_,setElements:g,brushWidth:R,roughness:I,fillType:P})=>{const[k,L]=Ce.useState(null),x=Ce.useRef(null),[H,K]=Ce.useState(!1),[ee,re]=Ce.useState(null);if(Ce.useEffect(()=>{d.on("whiteboardDataResponce",Z=>{L(Z.imgURL)})},[]),!(c!=null&&c.presenter))return Se.jsx("div",{width:window.innerWidth,height:window.innerHeight,children:Se.jsx("img",{src:k,alt:"Real time Whiteboard image"})});Ce.useEffect(()=>{const fe=p.current.getContext("2d");fe.strokeWidth=1,fe.lineCap="round",fe.strokeStyle=r,fe.lineWidth=R,x.current=fe},[]),Ce.useEffect(()=>{});const Y=Z=>{const{offsetX:fe,offsetY:ae}=Z.nativeEvent;K(!0),g(s==="pencil"?_e=>[..._e,{x1:fe,y1:ae,path:[[fe,ae]],stroke:r,element:s,width:R,rough:I}]:s==="arrow"?_e=>[..._e,{x1:fe,y1:ae,x2:fe,y2:ae,stroke:r,element:s,width:R,rough:I}]:_e=>[..._e,{x1:fe,y1:ae,stroke:r,element:s,width:R,rough:I,filltype:P}])},F=Z=>{const{offsetX:fe,offsetY:ae}=Z.nativeEvent,_e=fe,me=ae;if(s==="move")for(let Ue=_.length-1;Ue>=0;Ue--){const Ve=_[Ue];if(Ve.element==="rect"){if(_e>=Ve.x1&&_e<=Ve.x2&&me>=Ve.y1&&me<=Ve.y2){re({shape:Ve,startX:_e-Ve.x1,startY:me-Ve.y1,index:Ue});break}}else if(Ve.element==="line"){if(_e>=Ve.x1-5&&_e<=Ve.x2+5&&me>=Ve.y1-5&&me<=Ve.y2+5){re({shape:Ve,startX:_e-Ve.x1,startY:me-Ve.y1,index:Ue});break}}else if(Ve.element==="oval"){const lt=Ve.x1+Ve.owidth/2,Ge=Ve.y1+Ve.oheight/2;if((_e-lt)**2/(Ve.owidth/2)**2+(me-Ge)**2/(Ve.oheight/2)**2<=1){re({shape:Ve,startX:_e-Ve.x1,startY:me-Ve.y1,index:Ue});break}}else if(Ve.element==="arrow"&&_e>=Ve.x1&&_e<=Ve.x2&&me>=Ve.y1&&me<=Ve.y2){re({shape:Ve,startX:_e-Ve.x1,startY:me-Ve.y1,index:Ue});break}}};Ce.useLayoutEffect(()=>{const Z=l3.canvas(p.current);_.length>0&&x.current.clearRect(0,0,p.current.width,p.current.height),_.forEach((ae,_e)=>{if(ae.element==="rect")x.current.strokeStyle=ae.stroke,x.current.fillStyle=ae.stroke,console.log(ae.filltype,"filltype"),ae.filltype==="none"?x.current.strokeRect(ae.x1,ae.y1,ae.x2-ae.x1,ae.y2-ae.y1):x.current.fillRect(ae.x1,ae.y1,ae.x2-ae.x1,ae.y2-ae.y1);else if(ae.element==="line")Z.draw(Y$.line(ae.x1,ae.y1,ae.x2,ae.y2,{stroke:ae.stroke,roughness:ae.rough,strokeWidth:ae.width}));else if(ae.element==="pencil")Z.linearPath(ae.path,{stroke:ae.stroke,roughness:ae.rough,strokeWidth:ae.width}),console.log(ae);else if(ae.element==="oval"){const me=(ae.x1+ae.x2)/2,Ue=(ae.y1+ae.y2)/2,Ve=Math.abs(ae.x2-ae.x1)/2,lt=Math.abs(ae.y2-ae.y1)/2;x.current.beginPath(),x.current.strokeStyle=ae.stroke,x.current.ellipse(me,Ue,Ve,lt,0,0,2*Math.PI),ae.filltype==="none"?x.current.ellipse(me,Ue,Ve,lt,0,0,2*Math.PI):(x.current.ellipse(me,Ue,Ve,lt,0,0,2*Math.PI),x.current.fillStyle=ae.stroke,x.current.fill()),x.current.stroke()}else if(ae.element==="arrow"){Z.line(ae.x1,ae.y1,ae.x2,ae.y2,{stroke:ae.stroke,roughness:ae.rough,strokeWidth:ae.width});const me=20,Ue=Math.atan2(ae.y2-ae.y1,ae.x2-ae.x1);Z.polygon([[ae.x2,ae.y2],[ae.x2-me*Math.cos(Ue-Math.PI/6),ae.y2-me*Math.sin(Ue-Math.PI/6)],[ae.x2-me*Math.cos(Ue+Math.PI/6),ae.y2-me*Math.sin(Ue+Math.PI/6)]],{stroke:ae.stroke,strokeWidth:ae.width,roughness:0})}});const fe=p.current.toDataURL();d.emit("whiteboardData",fe)},[_]);const z=Z=>{const{offsetX:fe,offsetY:ae}=Z.nativeEvent;if(s==="move"&&ee){const{shape:_e,startX:me,startY:Ue}=ee,Ve=fe-me,lt=ae-Ue;if(_e.element==="rect")g(Ge=>{const Mt=[...Ge];return Mt[ee.index]={..._e,x1:Ve,y1:lt,x2:Ve+(_e.x2-_e.x1),y2:lt+(_e.y2-_e.y1)},Mt});else if(_e.element==="line")g(Ge=>{const Mt=[...Ge];return Mt[ee.index]={..._e,x1:Ve,y1:lt,x2:Ve+(_e.x2-_e.x1),y2:lt+(_e.y2-_e.y1)},Mt});else if(_e.element==="oval"){const Ge=_e.x1+_e.owidth/2,Mt=_e.y1+_e.oheight/2,Zt=Ve+_e.owidth/2,Ft=lt+_e.oheight/2,xe=Zt-Ge,We=Ft-Mt;g(ct=>{const gt=[...ct];return gt[ee.index]={..._e,x1:Ve,y1:lt,x2:_e.x2+xe,y2:_e.y2+We},gt})}else _e.element==="arrow"&&g(Ge=>{const Mt=[...Ge];return Mt[ee.index]={..._e,x1:Ve,y1:lt,x2:Ve+(_e.x2-_e.x1),y2:lt+(_e.y2-_e.y1)},Mt})}else s==="rect"&&H?g(_e=>_e.map((me,Ue)=>Ue===_.length-1?{x1:me.x1,y1:me.y1,x2:fe,y2:ae,stroke:me.stroke,element:me.element,width:me.width,rough:me.rough,filltype:me.filltype}:me)):s==="line"&&H?g(_e=>_e.map((me,Ue)=>Ue===_.length-1?{x1:me.x1,y1:me.y1,x2:fe,y2:ae,stroke:me.stroke,element:me.element,width:me.width,rough:me.rough}:me)):s==="pencil"&&H?g(_e=>_e.map((me,Ue)=>Ue===_.length-1?{x1:me.x1,y1:me.y1,path:[...me.path,[fe,ae]],stroke:me.stroke,element:me.element,width:me.width,rough:me.rough}:me)):s==="oval"&&H?g(_e=>_e.map((me,Ue)=>Ue===_.length-1?{x1:me.x1,y1:me.y1,x2:fe,y2:ae,owidth:Math.abs(fe-me.x1),oheight:Math.abs(ae-me.y1),stroke:me.stroke,element:me.element,width:me.width,rough:me.rough,filltype:me.filltype}:me)):s==="arrow"&&H&&g(_e=>_e.map((me,Ue)=>Ue===_.length-1?{x1:me.x1,y1:me.y1,x2:fe,y2:ae,stroke:me.stroke,element:me.element,width:me.width,rough:me.rough}:me))},le=()=>{K(!1),re(null),inputText.style.display="none"},ge=()=>{const Z=document.getElementById("inputText");Z.style.display="none"};return Se.jsxs(Se.Fragment,{children:[Se.jsx("canvas",{ref:p,width:window.innerWidth,height:window.innerHeight,id:"canvas",onMouseDown:s==="move"?F:Y,onMouseMove:z,onMouseUp:le,onContextMenu:ge,style:{cursor:'url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0nMjBweCcgaGVpZ2h0PScyNnB4JyB0cmFuc2Zvcm0gPSAncm90YXRlKDgwKScgeG1sbnM9J2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyB2aWV3Qm94PScwIDAgNTEyIDUxMic+PHBhdGggZD0nTTQxMC4zIDIzMWwxMS4zLTExLjMtMzMuOS0zMy45LTYyLjEtNjIuMUwyOTEuNyA4OS44bC0xMS4zIDExLjMtMjIuNiAyMi42TDU4LjYgMzIyLjljLTEwLjQgMTAuNC0xOCAyMy4zLTIyLjIgMzcuNEwxIDQ4MC43Yy0yLjUgOC40LS4yIDE3LjUgNi4xIDIzLjdzMTUuMyA4LjUgMjMuNyA2LjFsMTIwLjMtMzUuNGMxNC4xLTQuMiAyNy0xMS44IDM3LjQtMjIuMkwzODcuNyAyNTMuNyA0MTAuMyAyMzF6TTE2MCAzOTkuNGwtOS4xIDIyLjdjLTQgMy4xLTguNSA1LjQtMTMuMyA2LjlMNTkuNCA0NTJsMjMtNzguMWMxLjQtNC45IDMuOC05LjQgNi45LTEzLjNsMjIuNy05LjF2MzJjMCA4LjggNy4yIDE2IDE2IDE2aDMyek0zNjIuNyAxOC43TDM0OC4zIDMzLjIgMzI1LjcgNTUuOCAzMTQuMyA2Ny4xbDMzLjkgMzMuOSA2Mi4xIDYyLjEgMzMuOSAzMy45IDExLjMtMTEuMyAyMi42LTIyLjYgMTQuNS0xNC41YzI1LTI1IDI1LTY1LjUgMC05MC41TDQ1My4zIDE4LjdjLTI1LTI1LTY1LjUtMjUtOTAuNSAwem0tNDcuNCAxNjhsLTE0NCAxNDRjLTYuMiA2LjItMTYuNCA2LjItMjIuNiAwcy02LjItMTYuNCAwLTIyLjZsMTQ0LTE0NGM2LjItNi4yIDE2LjQtNi4yIDIyLjYgMHM2LjIgMTYuNCAwIDIyLjZ6Jy8+PC9zdmc+"), auto'}}),Se.jsx("textarea",{id:"inputText",className:"z-[1] absolute bg-transparent",style:{display:"none"}})]})};function X$(){var r=document.getElementById("canvas"),s=document.createElement("a");s.download=`${q$}`,s.href=r.toDataURL("image/png"),s.click()}function Fx(r,s){var c=Object.keys(r);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(r);s&&(d=d.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),c.push.apply(c,d)}return c}function ze(r){for(var s=1;s<arguments.length;s++){var c=arguments[s]!=null?arguments[s]:{};s%2?Fx(Object(c),!0).forEach(function(d){Bi(r,d,c[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(c)):Fx(Object(c)).forEach(function(d){Object.defineProperty(r,d,Object.getOwnPropertyDescriptor(c,d))})}return r}function tv(r){"@babel/helpers - typeof";return tv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},tv(r)}function Q$(r,s){if(!(r instanceof s))throw new TypeError("Cannot call a class as a function")}function jx(r,s){for(var c=0;c<s.length;c++){var d=s[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(r,d.key,d)}}function $$(r,s,c){return s&&jx(r.prototype,s),c&&jx(r,c),Object.defineProperty(r,"prototype",{writable:!1}),r}function Bi(r,s,c){return s in r?Object.defineProperty(r,s,{value:c,enumerable:!0,configurable:!0,writable:!0}):r[s]=c,r}function Rw(r,s){return eZ(r)||nZ(r,s)||d3(r,s)||rZ()}function $f(r){return Z$(r)||tZ(r)||d3(r)||iZ()}function Z$(r){if(Array.isArray(r))return tI(r)}function eZ(r){if(Array.isArray(r))return r}function tZ(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function nZ(r,s){var c=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(c!=null){var d=[],p=!0,_=!1,g,R;try{for(c=c.call(r);!(p=(g=c.next()).done)&&(d.push(g.value),!(s&&d.length===s));p=!0);}catch(I){_=!0,R=I}finally{try{!p&&c.return!=null&&c.return()}finally{if(_)throw R}}return d}}function d3(r,s){if(r){if(typeof r=="string")return tI(r,s);var c=Object.prototype.toString.call(r).slice(8,-1);if(c==="Object"&&r.constructor&&(c=r.constructor.name),c==="Map"||c==="Set")return Array.from(r);if(c==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return tI(r,s)}}function tI(r,s){(s==null||s>r.length)&&(s=r.length);for(var c=0,d=new Array(s);c<s;c++)d[c]=r[c];return d}function iZ(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function rZ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Bx=function(){},Cw={},u3={},h3=null,p3={mark:Bx,measure:Bx};try{typeof window<"u"&&(Cw=window),typeof document<"u"&&(u3=document),typeof MutationObserver<"u"&&(h3=MutationObserver),typeof performance<"u"&&(p3=performance)}catch{}var sZ=Cw.navigator||{},Gx=sZ.userAgent,Wx=Gx===void 0?"":Gx,il=Cw,Kn=u3,Hx=h3,KE=p3;il.document;var Va=!!Kn.documentElement&&!!Kn.head&&typeof Kn.addEventListener=="function"&&typeof Kn.createElement=="function",f3=~Wx.indexOf("MSIE")||~Wx.indexOf("Trident/"),zE,YE,qE,JE,XE,ka="___FONT_AWESOME___",nI=16,m3="fa",_3="svg-inline--fa",ad="data-fa-i2svg",iI="data-fa-pseudo-element",oZ="data-fa-pseudo-element-pending",Iw="data-prefix",ww="data-icon",Kx="fontawesome-i2svg",aZ="async",cZ=["HTML","HEAD","STYLE","SCRIPT"],E3=function(){try{return!0}catch{return!1}}(),Wn="classic",pi="sharp",bw=[Wn,pi];function Zf(r){return new Proxy(r,{get:function(c,d){return d in c?c[d]:c[Wn]}})}var Ff=Zf((zE={},Bi(zE,Wn,{fa:"solid",fas:"solid","fa-solid":"solid",far:"regular","fa-regular":"regular",fal:"light","fa-light":"light",fat:"thin","fa-thin":"thin",fad:"duotone","fa-duotone":"duotone",fab:"brands","fa-brands":"brands",fak:"kit",fakd:"kit","fa-kit":"kit","fa-kit-duotone":"kit"}),Bi(zE,pi,{fa:"solid",fass:"solid","fa-solid":"solid",fasr:"regular","fa-regular":"regular",fasl:"light","fa-light":"light",fast:"thin","fa-thin":"thin"}),zE)),jf=Zf((YE={},Bi(YE,Wn,{solid:"fas",regular:"far",light:"fal",thin:"fat",duotone:"fad",brands:"fab",kit:"fak"}),Bi(YE,pi,{solid:"fass",regular:"fasr",light:"fasl",thin:"fast"}),YE)),Bf=Zf((qE={},Bi(qE,Wn,{fab:"fa-brands",fad:"fa-duotone",fak:"fa-kit",fal:"fa-light",far:"fa-regular",fas:"fa-solid",fat:"fa-thin"}),Bi(qE,pi,{fass:"fa-solid",fasr:"fa-regular",fasl:"fa-light",fast:"fa-thin"}),qE)),lZ=Zf((JE={},Bi(JE,Wn,{"fa-brands":"fab","fa-duotone":"fad","fa-kit":"fak","fa-light":"fal","fa-regular":"far","fa-solid":"fas","fa-thin":"fat"}),Bi(JE,pi,{"fa-solid":"fass","fa-regular":"fasr","fa-light":"fasl","fa-thin":"fast"}),JE)),dZ=/fa(s|r|l|t|d|b|k|ss|sr|sl|st)?[\-\ ]/,g3="fa-layers-text",uZ=/Font ?Awesome ?([56 ]*)(Solid|Regular|Light|Thin|Duotone|Brands|Free|Pro|Sharp|Kit)?.*/i,hZ=Zf((XE={},Bi(XE,Wn,{900:"fas",400:"far",normal:"far",300:"fal",100:"fat"}),Bi(XE,pi,{900:"fass",400:"fasr",300:"fasl",100:"fast"}),XE)),v3=[1,2,3,4,5,6,7,8,9,10],pZ=v3.concat([11,12,13,14,15,16,17,18,19,20]),fZ=["class","data-prefix","data-icon","data-fa-transform","data-fa-mask"],$l={GROUP:"duotone-group",SWAP_OPACITY:"swap-opacity",PRIMARY:"primary",SECONDARY:"secondary"},Gf=new Set;Object.keys(jf[Wn]).map(Gf.add.bind(Gf));Object.keys(jf[pi]).map(Gf.add.bind(Gf));var mZ=[].concat(bw,$f(Gf),["2xs","xs","sm","lg","xl","2xl","beat","border","fade","beat-fade","bounce","flip-both","flip-horizontal","flip-vertical","flip","fw","inverse","layers-counter","layers-text","layers","li","pull-left","pull-right","pulse","rotate-180","rotate-270","rotate-90","rotate-by","shake","spin-pulse","spin-reverse","spin","stack-1x","stack-2x","stack","ul",$l.GROUP,$l.SWAP_OPACITY,$l.PRIMARY,$l.SECONDARY]).concat(v3.map(function(r){return"".concat(r,"x")})).concat(pZ.map(function(r){return"w-".concat(r)})),Ef=il.FontAwesomeConfig||{};function _Z(r){var s=Kn.querySelector("script["+r+"]");if(s)return s.getAttribute(r)}function EZ(r){return r===""?!0:r==="false"?!1:r==="true"?!0:r}if(Kn&&typeof Kn.querySelector=="function"){var gZ=[["data-family-prefix","familyPrefix"],["data-css-prefix","cssPrefix"],["data-family-default","familyDefault"],["data-style-default","styleDefault"],["data-replacement-class","replacementClass"],["data-auto-replace-svg","autoReplaceSvg"],["data-auto-add-css","autoAddCss"],["data-auto-a11y","autoA11y"],["data-search-pseudo-elements","searchPseudoElements"],["data-observe-mutations","observeMutations"],["data-mutate-approach","mutateApproach"],["data-keep-original-source","keepOriginalSource"],["data-measure-performance","measurePerformance"],["data-show-missing-icons","showMissingIcons"]];gZ.forEach(function(r){var s=Rw(r,2),c=s[0],d=s[1],p=EZ(_Z(c));p!=null&&(Ef[d]=p)})}var S3={styleDefault:"solid",familyDefault:"classic",cssPrefix:m3,replacementClass:_3,autoReplaceSvg:!0,autoAddCss:!0,autoA11y:!0,searchPseudoElements:!1,observeMutations:!0,mutateApproach:"async",keepOriginalSource:!0,measurePerformance:!1,showMissingIcons:!0};Ef.familyPrefix&&(Ef.cssPrefix=Ef.familyPrefix);var oh=ze(ze({},S3),Ef);oh.autoReplaceSvg||(oh.observeMutations=!1);var nt={};Object.keys(S3).forEach(function(r){Object.defineProperty(nt,r,{enumerable:!0,set:function(c){oh[r]=c,gf.forEach(function(d){return d(nt)})},get:function(){return oh[r]}})});Object.defineProperty(nt,"familyPrefix",{enumerable:!0,set:function(s){oh.cssPrefix=s,gf.forEach(function(c){return c(nt)})},get:function(){return oh.cssPrefix}});il.FontAwesomeConfig=nt;var gf=[];function vZ(r){return gf.push(r),function(){gf.splice(gf.indexOf(r),1)}}var xc=nI,qo={size:16,x:0,y:0,rotate:0,flipX:!1,flipY:!1};function SZ(r){if(!(!r||!Va)){var s=Kn.createElement("style");s.setAttribute("type","text/css"),s.innerHTML=r;for(var c=Kn.head.childNodes,d=null,p=c.length-1;p>-1;p--){var _=c[p],g=(_.tagName||"").toUpperCase();["STYLE","LINK"].indexOf(g)>-1&&(d=_)}return Kn.head.insertBefore(s,d),r}}var TZ="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";function Wf(){for(var r=12,s="";r-- >0;)s+=TZ[Math.random()*62|0];return s}function uh(r){for(var s=[],c=(r||[]).length>>>0;c--;)s[c]=r[c];return s}function Aw(r){return r.classList?uh(r.classList):(r.getAttribute("class")||"").split(" ").filter(function(s){return s})}function T3(r){return"".concat(r).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function yZ(r){return Object.keys(r||{}).reduce(function(s,c){return s+"".concat(c,'="').concat(T3(r[c]),'" ')},"").trim()}function Av(r){return Object.keys(r||{}).reduce(function(s,c){return s+"".concat(c,": ").concat(r[c].trim(),";")},"")}function Ow(r){return r.size!==qo.size||r.x!==qo.x||r.y!==qo.y||r.rotate!==qo.rotate||r.flipX||r.flipY}function RZ(r){var s=r.transform,c=r.containerWidth,d=r.iconWidth,p={transform:"translate(".concat(c/2," 256)")},_="translate(".concat(s.x*32,", ").concat(s.y*32,") "),g="scale(".concat(s.size/16*(s.flipX?-1:1),", ").concat(s.size/16*(s.flipY?-1:1),") "),R="rotate(".concat(s.rotate," 0 0)"),I={transform:"".concat(_," ").concat(g," ").concat(R)},P={transform:"translate(".concat(d/2*-1," -256)")};return{outer:p,inner:I,path:P}}function CZ(r){var s=r.transform,c=r.width,d=c===void 0?nI:c,p=r.height,_=p===void 0?nI:p,g=r.startCentered,R=g===void 0?!1:g,I="";return R&&f3?I+="translate(".concat(s.x/xc-d/2,"em, ").concat(s.y/xc-_/2,"em) "):R?I+="translate(calc(-50% + ".concat(s.x/xc,"em), calc(-50% + ").concat(s.y/xc,"em)) "):I+="translate(".concat(s.x/xc,"em, ").concat(s.y/xc,"em) "),I+="scale(".concat(s.size/xc*(s.flipX?-1:1),", ").concat(s.size/xc*(s.flipY?-1:1),") "),I+="rotate(".concat(s.rotate,"deg) "),I}var IZ=`:root, :host {
  --fa-font-solid: normal 900 1em/1 "Font Awesome 6 Solid";
  --fa-font-regular: normal 400 1em/1 "Font Awesome 6 Regular";
  --fa-font-light: normal 300 1em/1 "Font Awesome 6 Light";
  --fa-font-thin: normal 100 1em/1 "Font Awesome 6 Thin";
  --fa-font-duotone: normal 900 1em/1 "Font Awesome 6 Duotone";
  --fa-font-sharp-solid: normal 900 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-regular: normal 400 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-light: normal 300 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-thin: normal 100 1em/1 "Font Awesome 6 Sharp";
  --fa-font-brands: normal 400 1em/1 "Font Awesome 6 Brands";
}

svg:not(:root).svg-inline--fa, svg:not(:host).svg-inline--fa {
  overflow: visible;
  box-sizing: content-box;
}

.svg-inline--fa {
  display: var(--fa-display, inline-block);
  height: 1em;
  overflow: visible;
  vertical-align: -0.125em;
}
.svg-inline--fa.fa-2xs {
  vertical-align: 0.1em;
}
.svg-inline--fa.fa-xs {
  vertical-align: 0em;
}
.svg-inline--fa.fa-sm {
  vertical-align: -0.0714285705em;
}
.svg-inline--fa.fa-lg {
  vertical-align: -0.2em;
}
.svg-inline--fa.fa-xl {
  vertical-align: -0.25em;
}
.svg-inline--fa.fa-2xl {
  vertical-align: -0.3125em;
}
.svg-inline--fa.fa-pull-left {
  margin-right: var(--fa-pull-margin, 0.3em);
  width: auto;
}
.svg-inline--fa.fa-pull-right {
  margin-left: var(--fa-pull-margin, 0.3em);
  width: auto;
}
.svg-inline--fa.fa-li {
  width: var(--fa-li-width, 2em);
  top: 0.25em;
}
.svg-inline--fa.fa-fw {
  width: var(--fa-fw-width, 1.25em);
}

.fa-layers svg.svg-inline--fa {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
}

.fa-layers-counter, .fa-layers-text {
  display: inline-block;
  position: absolute;
  text-align: center;
}

.fa-layers {
  display: inline-block;
  height: 1em;
  position: relative;
  text-align: center;
  vertical-align: -0.125em;
  width: 1em;
}
.fa-layers svg.svg-inline--fa {
  -webkit-transform-origin: center center;
          transform-origin: center center;
}

.fa-layers-text {
  left: 50%;
  top: 50%;
  -webkit-transform: translate(-50%, -50%);
          transform: translate(-50%, -50%);
  -webkit-transform-origin: center center;
          transform-origin: center center;
}

.fa-layers-counter {
  background-color: var(--fa-counter-background-color, #ff253a);
  border-radius: var(--fa-counter-border-radius, 1em);
  box-sizing: border-box;
  color: var(--fa-inverse, #fff);
  line-height: var(--fa-counter-line-height, 1);
  max-width: var(--fa-counter-max-width, 5em);
  min-width: var(--fa-counter-min-width, 1.5em);
  overflow: hidden;
  padding: var(--fa-counter-padding, 0.25em 0.5em);
  right: var(--fa-right, 0);
  text-overflow: ellipsis;
  top: var(--fa-top, 0);
  -webkit-transform: scale(var(--fa-counter-scale, 0.25));
          transform: scale(var(--fa-counter-scale, 0.25));
  -webkit-transform-origin: top right;
          transform-origin: top right;
}

.fa-layers-bottom-right {
  bottom: var(--fa-bottom, 0);
  right: var(--fa-right, 0);
  top: auto;
  -webkit-transform: scale(var(--fa-layers-scale, 0.25));
          transform: scale(var(--fa-layers-scale, 0.25));
  -webkit-transform-origin: bottom right;
          transform-origin: bottom right;
}

.fa-layers-bottom-left {
  bottom: var(--fa-bottom, 0);
  left: var(--fa-left, 0);
  right: auto;
  top: auto;
  -webkit-transform: scale(var(--fa-layers-scale, 0.25));
          transform: scale(var(--fa-layers-scale, 0.25));
  -webkit-transform-origin: bottom left;
          transform-origin: bottom left;
}

.fa-layers-top-right {
  top: var(--fa-top, 0);
  right: var(--fa-right, 0);
  -webkit-transform: scale(var(--fa-layers-scale, 0.25));
          transform: scale(var(--fa-layers-scale, 0.25));
  -webkit-transform-origin: top right;
          transform-origin: top right;
}

.fa-layers-top-left {
  left: var(--fa-left, 0);
  right: auto;
  top: var(--fa-top, 0);
  -webkit-transform: scale(var(--fa-layers-scale, 0.25));
          transform: scale(var(--fa-layers-scale, 0.25));
  -webkit-transform-origin: top left;
          transform-origin: top left;
}

.fa-1x {
  font-size: 1em;
}

.fa-2x {
  font-size: 2em;
}

.fa-3x {
  font-size: 3em;
}

.fa-4x {
  font-size: 4em;
}

.fa-5x {
  font-size: 5em;
}

.fa-6x {
  font-size: 6em;
}

.fa-7x {
  font-size: 7em;
}

.fa-8x {
  font-size: 8em;
}

.fa-9x {
  font-size: 9em;
}

.fa-10x {
  font-size: 10em;
}

.fa-2xs {
  font-size: 0.625em;
  line-height: 0.1em;
  vertical-align: 0.225em;
}

.fa-xs {
  font-size: 0.75em;
  line-height: 0.0833333337em;
  vertical-align: 0.125em;
}

.fa-sm {
  font-size: 0.875em;
  line-height: 0.0714285718em;
  vertical-align: 0.0535714295em;
}

.fa-lg {
  font-size: 1.25em;
  line-height: 0.05em;
  vertical-align: -0.075em;
}

.fa-xl {
  font-size: 1.5em;
  line-height: 0.0416666682em;
  vertical-align: -0.125em;
}

.fa-2xl {
  font-size: 2em;
  line-height: 0.03125em;
  vertical-align: -0.1875em;
}

.fa-fw {
  text-align: center;
  width: 1.25em;
}

.fa-ul {
  list-style-type: none;
  margin-left: var(--fa-li-margin, 2.5em);
  padding-left: 0;
}
.fa-ul > li {
  position: relative;
}

.fa-li {
  left: calc(var(--fa-li-width, 2em) * -1);
  position: absolute;
  text-align: center;
  width: var(--fa-li-width, 2em);
  line-height: inherit;
}

.fa-border {
  border-color: var(--fa-border-color, #eee);
  border-radius: var(--fa-border-radius, 0.1em);
  border-style: var(--fa-border-style, solid);
  border-width: var(--fa-border-width, 0.08em);
  padding: var(--fa-border-padding, 0.2em 0.25em 0.15em);
}

.fa-pull-left {
  float: left;
  margin-right: var(--fa-pull-margin, 0.3em);
}

.fa-pull-right {
  float: right;
  margin-left: var(--fa-pull-margin, 0.3em);
}

.fa-beat {
  -webkit-animation-name: fa-beat;
          animation-name: fa-beat;
  -webkit-animation-delay: var(--fa-animation-delay, 0s);
          animation-delay: var(--fa-animation-delay, 0s);
  -webkit-animation-direction: var(--fa-animation-direction, normal);
          animation-direction: var(--fa-animation-direction, normal);
  -webkit-animation-duration: var(--fa-animation-duration, 1s);
          animation-duration: var(--fa-animation-duration, 1s);
  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);
          animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  -webkit-animation-timing-function: var(--fa-animation-timing, ease-in-out);
          animation-timing-function: var(--fa-animation-timing, ease-in-out);
}

.fa-bounce {
  -webkit-animation-name: fa-bounce;
          animation-name: fa-bounce;
  -webkit-animation-delay: var(--fa-animation-delay, 0s);
          animation-delay: var(--fa-animation-delay, 0s);
  -webkit-animation-direction: var(--fa-animation-direction, normal);
          animation-direction: var(--fa-animation-direction, normal);
  -webkit-animation-duration: var(--fa-animation-duration, 1s);
          animation-duration: var(--fa-animation-duration, 1s);
  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);
          animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  -webkit-animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.28, 0.84, 0.42, 1));
          animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.28, 0.84, 0.42, 1));
}

.fa-fade {
  -webkit-animation-name: fa-fade;
          animation-name: fa-fade;
  -webkit-animation-delay: var(--fa-animation-delay, 0s);
          animation-delay: var(--fa-animation-delay, 0s);
  -webkit-animation-direction: var(--fa-animation-direction, normal);
          animation-direction: var(--fa-animation-direction, normal);
  -webkit-animation-duration: var(--fa-animation-duration, 1s);
          animation-duration: var(--fa-animation-duration, 1s);
  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);
          animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  -webkit-animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));
          animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));
}

.fa-beat-fade {
  -webkit-animation-name: fa-beat-fade;
          animation-name: fa-beat-fade;
  -webkit-animation-delay: var(--fa-animation-delay, 0s);
          animation-delay: var(--fa-animation-delay, 0s);
  -webkit-animation-direction: var(--fa-animation-direction, normal);
          animation-direction: var(--fa-animation-direction, normal);
  -webkit-animation-duration: var(--fa-animation-duration, 1s);
          animation-duration: var(--fa-animation-duration, 1s);
  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);
          animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  -webkit-animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));
          animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));
}

.fa-flip {
  -webkit-animation-name: fa-flip;
          animation-name: fa-flip;
  -webkit-animation-delay: var(--fa-animation-delay, 0s);
          animation-delay: var(--fa-animation-delay, 0s);
  -webkit-animation-direction: var(--fa-animation-direction, normal);
          animation-direction: var(--fa-animation-direction, normal);
  -webkit-animation-duration: var(--fa-animation-duration, 1s);
          animation-duration: var(--fa-animation-duration, 1s);
  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);
          animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  -webkit-animation-timing-function: var(--fa-animation-timing, ease-in-out);
          animation-timing-function: var(--fa-animation-timing, ease-in-out);
}

.fa-shake {
  -webkit-animation-name: fa-shake;
          animation-name: fa-shake;
  -webkit-animation-delay: var(--fa-animation-delay, 0s);
          animation-delay: var(--fa-animation-delay, 0s);
  -webkit-animation-direction: var(--fa-animation-direction, normal);
          animation-direction: var(--fa-animation-direction, normal);
  -webkit-animation-duration: var(--fa-animation-duration, 1s);
          animation-duration: var(--fa-animation-duration, 1s);
  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);
          animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  -webkit-animation-timing-function: var(--fa-animation-timing, linear);
          animation-timing-function: var(--fa-animation-timing, linear);
}

.fa-spin {
  -webkit-animation-name: fa-spin;
          animation-name: fa-spin;
  -webkit-animation-delay: var(--fa-animation-delay, 0s);
          animation-delay: var(--fa-animation-delay, 0s);
  -webkit-animation-direction: var(--fa-animation-direction, normal);
          animation-direction: var(--fa-animation-direction, normal);
  -webkit-animation-duration: var(--fa-animation-duration, 2s);
          animation-duration: var(--fa-animation-duration, 2s);
  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);
          animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  -webkit-animation-timing-function: var(--fa-animation-timing, linear);
          animation-timing-function: var(--fa-animation-timing, linear);
}

.fa-spin-reverse {
  --fa-animation-direction: reverse;
}

.fa-pulse,
.fa-spin-pulse {
  -webkit-animation-name: fa-spin;
          animation-name: fa-spin;
  -webkit-animation-direction: var(--fa-animation-direction, normal);
          animation-direction: var(--fa-animation-direction, normal);
  -webkit-animation-duration: var(--fa-animation-duration, 1s);
          animation-duration: var(--fa-animation-duration, 1s);
  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);
          animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  -webkit-animation-timing-function: var(--fa-animation-timing, steps(8));
          animation-timing-function: var(--fa-animation-timing, steps(8));
}

@media (prefers-reduced-motion: reduce) {
  .fa-beat,
.fa-bounce,
.fa-fade,
.fa-beat-fade,
.fa-flip,
.fa-pulse,
.fa-shake,
.fa-spin,
.fa-spin-pulse {
    -webkit-animation-delay: -1ms;
            animation-delay: -1ms;
    -webkit-animation-duration: 1ms;
            animation-duration: 1ms;
    -webkit-animation-iteration-count: 1;
            animation-iteration-count: 1;
    -webkit-transition-delay: 0s;
            transition-delay: 0s;
    -webkit-transition-duration: 0s;
            transition-duration: 0s;
  }
}
@-webkit-keyframes fa-beat {
  0%, 90% {
    -webkit-transform: scale(1);
            transform: scale(1);
  }
  45% {
    -webkit-transform: scale(var(--fa-beat-scale, 1.25));
            transform: scale(var(--fa-beat-scale, 1.25));
  }
}
@keyframes fa-beat {
  0%, 90% {
    -webkit-transform: scale(1);
            transform: scale(1);
  }
  45% {
    -webkit-transform: scale(var(--fa-beat-scale, 1.25));
            transform: scale(var(--fa-beat-scale, 1.25));
  }
}
@-webkit-keyframes fa-bounce {
  0% {
    -webkit-transform: scale(1, 1) translateY(0);
            transform: scale(1, 1) translateY(0);
  }
  10% {
    -webkit-transform: scale(var(--fa-bounce-start-scale-x, 1.1), var(--fa-bounce-start-scale-y, 0.9)) translateY(0);
            transform: scale(var(--fa-bounce-start-scale-x, 1.1), var(--fa-bounce-start-scale-y, 0.9)) translateY(0);
  }
  30% {
    -webkit-transform: scale(var(--fa-bounce-jump-scale-x, 0.9), var(--fa-bounce-jump-scale-y, 1.1)) translateY(var(--fa-bounce-height, -0.5em));
            transform: scale(var(--fa-bounce-jump-scale-x, 0.9), var(--fa-bounce-jump-scale-y, 1.1)) translateY(var(--fa-bounce-height, -0.5em));
  }
  50% {
    -webkit-transform: scale(var(--fa-bounce-land-scale-x, 1.05), var(--fa-bounce-land-scale-y, 0.95)) translateY(0);
            transform: scale(var(--fa-bounce-land-scale-x, 1.05), var(--fa-bounce-land-scale-y, 0.95)) translateY(0);
  }
  57% {
    -webkit-transform: scale(1, 1) translateY(var(--fa-bounce-rebound, -0.125em));
            transform: scale(1, 1) translateY(var(--fa-bounce-rebound, -0.125em));
  }
  64% {
    -webkit-transform: scale(1, 1) translateY(0);
            transform: scale(1, 1) translateY(0);
  }
  100% {
    -webkit-transform: scale(1, 1) translateY(0);
            transform: scale(1, 1) translateY(0);
  }
}
@keyframes fa-bounce {
  0% {
    -webkit-transform: scale(1, 1) translateY(0);
            transform: scale(1, 1) translateY(0);
  }
  10% {
    -webkit-transform: scale(var(--fa-bounce-start-scale-x, 1.1), var(--fa-bounce-start-scale-y, 0.9)) translateY(0);
            transform: scale(var(--fa-bounce-start-scale-x, 1.1), var(--fa-bounce-start-scale-y, 0.9)) translateY(0);
  }
  30% {
    -webkit-transform: scale(var(--fa-bounce-jump-scale-x, 0.9), var(--fa-bounce-jump-scale-y, 1.1)) translateY(var(--fa-bounce-height, -0.5em));
            transform: scale(var(--fa-bounce-jump-scale-x, 0.9), var(--fa-bounce-jump-scale-y, 1.1)) translateY(var(--fa-bounce-height, -0.5em));
  }
  50% {
    -webkit-transform: scale(var(--fa-bounce-land-scale-x, 1.05), var(--fa-bounce-land-scale-y, 0.95)) translateY(0);
            transform: scale(var(--fa-bounce-land-scale-x, 1.05), var(--fa-bounce-land-scale-y, 0.95)) translateY(0);
  }
  57% {
    -webkit-transform: scale(1, 1) translateY(var(--fa-bounce-rebound, -0.125em));
            transform: scale(1, 1) translateY(var(--fa-bounce-rebound, -0.125em));
  }
  64% {
    -webkit-transform: scale(1, 1) translateY(0);
            transform: scale(1, 1) translateY(0);
  }
  100% {
    -webkit-transform: scale(1, 1) translateY(0);
            transform: scale(1, 1) translateY(0);
  }
}
@-webkit-keyframes fa-fade {
  50% {
    opacity: var(--fa-fade-opacity, 0.4);
  }
}
@keyframes fa-fade {
  50% {
    opacity: var(--fa-fade-opacity, 0.4);
  }
}
@-webkit-keyframes fa-beat-fade {
  0%, 100% {
    opacity: var(--fa-beat-fade-opacity, 0.4);
    -webkit-transform: scale(1);
            transform: scale(1);
  }
  50% {
    opacity: 1;
    -webkit-transform: scale(var(--fa-beat-fade-scale, 1.125));
            transform: scale(var(--fa-beat-fade-scale, 1.125));
  }
}
@keyframes fa-beat-fade {
  0%, 100% {
    opacity: var(--fa-beat-fade-opacity, 0.4);
    -webkit-transform: scale(1);
            transform: scale(1);
  }
  50% {
    opacity: 1;
    -webkit-transform: scale(var(--fa-beat-fade-scale, 1.125));
            transform: scale(var(--fa-beat-fade-scale, 1.125));
  }
}
@-webkit-keyframes fa-flip {
  50% {
    -webkit-transform: rotate3d(var(--fa-flip-x, 0), var(--fa-flip-y, 1), var(--fa-flip-z, 0), var(--fa-flip-angle, -180deg));
            transform: rotate3d(var(--fa-flip-x, 0), var(--fa-flip-y, 1), var(--fa-flip-z, 0), var(--fa-flip-angle, -180deg));
  }
}
@keyframes fa-flip {
  50% {
    -webkit-transform: rotate3d(var(--fa-flip-x, 0), var(--fa-flip-y, 1), var(--fa-flip-z, 0), var(--fa-flip-angle, -180deg));
            transform: rotate3d(var(--fa-flip-x, 0), var(--fa-flip-y, 1), var(--fa-flip-z, 0), var(--fa-flip-angle, -180deg));
  }
}
@-webkit-keyframes fa-shake {
  0% {
    -webkit-transform: rotate(-15deg);
            transform: rotate(-15deg);
  }
  4% {
    -webkit-transform: rotate(15deg);
            transform: rotate(15deg);
  }
  8%, 24% {
    -webkit-transform: rotate(-18deg);
            transform: rotate(-18deg);
  }
  12%, 28% {
    -webkit-transform: rotate(18deg);
            transform: rotate(18deg);
  }
  16% {
    -webkit-transform: rotate(-22deg);
            transform: rotate(-22deg);
  }
  20% {
    -webkit-transform: rotate(22deg);
            transform: rotate(22deg);
  }
  32% {
    -webkit-transform: rotate(-12deg);
            transform: rotate(-12deg);
  }
  36% {
    -webkit-transform: rotate(12deg);
            transform: rotate(12deg);
  }
  40%, 100% {
    -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
  }
}
@keyframes fa-shake {
  0% {
    -webkit-transform: rotate(-15deg);
            transform: rotate(-15deg);
  }
  4% {
    -webkit-transform: rotate(15deg);
            transform: rotate(15deg);
  }
  8%, 24% {
    -webkit-transform: rotate(-18deg);
            transform: rotate(-18deg);
  }
  12%, 28% {
    -webkit-transform: rotate(18deg);
            transform: rotate(18deg);
  }
  16% {
    -webkit-transform: rotate(-22deg);
            transform: rotate(-22deg);
  }
  20% {
    -webkit-transform: rotate(22deg);
            transform: rotate(22deg);
  }
  32% {
    -webkit-transform: rotate(-12deg);
            transform: rotate(-12deg);
  }
  36% {
    -webkit-transform: rotate(12deg);
            transform: rotate(12deg);
  }
  40%, 100% {
    -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
  }
}
@-webkit-keyframes fa-spin {
  0% {
    -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
            transform: rotate(360deg);
  }
}
@keyframes fa-spin {
  0% {
    -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
            transform: rotate(360deg);
  }
}
.fa-rotate-90 {
  -webkit-transform: rotate(90deg);
          transform: rotate(90deg);
}

.fa-rotate-180 {
  -webkit-transform: rotate(180deg);
          transform: rotate(180deg);
}

.fa-rotate-270 {
  -webkit-transform: rotate(270deg);
          transform: rotate(270deg);
}

.fa-flip-horizontal {
  -webkit-transform: scale(-1, 1);
          transform: scale(-1, 1);
}

.fa-flip-vertical {
  -webkit-transform: scale(1, -1);
          transform: scale(1, -1);
}

.fa-flip-both,
.fa-flip-horizontal.fa-flip-vertical {
  -webkit-transform: scale(-1, -1);
          transform: scale(-1, -1);
}

.fa-rotate-by {
  -webkit-transform: rotate(var(--fa-rotate-angle, none));
          transform: rotate(var(--fa-rotate-angle, none));
}

.fa-stack {
  display: inline-block;
  vertical-align: middle;
  height: 2em;
  position: relative;
  width: 2.5em;
}

.fa-stack-1x,
.fa-stack-2x {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
  z-index: var(--fa-stack-z-index, auto);
}

.svg-inline--fa.fa-stack-1x {
  height: 1em;
  width: 1.25em;
}
.svg-inline--fa.fa-stack-2x {
  height: 2em;
  width: 2.5em;
}

.fa-inverse {
  color: var(--fa-inverse, #fff);
}

.sr-only,
.fa-sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

.sr-only-focusable:not(:focus),
.fa-sr-only-focusable:not(:focus) {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

.svg-inline--fa .fa-primary {
  fill: var(--fa-primary-color, currentColor);
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa .fa-secondary {
  fill: var(--fa-secondary-color, currentColor);
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-primary {
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-secondary {
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa mask .fa-primary,
.svg-inline--fa mask .fa-secondary {
  fill: black;
}

.fad.fa-inverse,
.fa-duotone.fa-inverse {
  color: var(--fa-inverse, #fff);
}`;function y3(){var r=m3,s=_3,c=nt.cssPrefix,d=nt.replacementClass,p=IZ;if(c!==r||d!==s){var _=new RegExp("\\.".concat(r,"\\-"),"g"),g=new RegExp("\\--".concat(r,"\\-"),"g"),R=new RegExp("\\.".concat(s),"g");p=p.replace(_,".".concat(c,"-")).replace(g,"--".concat(c,"-")).replace(R,".".concat(d))}return p}var zx=!1;function qR(){nt.autoAddCss&&!zx&&(SZ(y3()),zx=!0)}var wZ={mixout:function(){return{dom:{css:y3,insertCss:qR}}},hooks:function(){return{beforeDOMElementCreation:function(){qR()},beforeI2svg:function(){qR()}}}},La=il||{};La[ka]||(La[ka]={});La[ka].styles||(La[ka].styles={});La[ka].hooks||(La[ka].hooks={});La[ka].shims||(La[ka].shims=[]);var vo=La[ka],R3=[],bZ=function r(){Kn.removeEventListener("DOMContentLoaded",r),nv=1,R3.map(function(s){return s()})},nv=!1;Va&&(nv=(Kn.documentElement.doScroll?/^loaded|^c/:/^loaded|^i|^c/).test(Kn.readyState),nv||Kn.addEventListener("DOMContentLoaded",bZ));function AZ(r){Va&&(nv?setTimeout(r,0):R3.push(r))}function em(r){var s=r.tag,c=r.attributes,d=c===void 0?{}:c,p=r.children,_=p===void 0?[]:p;return typeof r=="string"?T3(r):"<".concat(s," ").concat(yZ(d),">").concat(_.map(em).join(""),"</").concat(s,">")}function Yx(r,s,c){if(r&&r[s]&&r[s][c])return{prefix:s,iconName:c,icon:r[s][c]}}var OZ=function(s,c){return function(d,p,_,g){return s.call(c,d,p,_,g)}},JR=function(s,c,d,p){var _=Object.keys(s),g=_.length,R=p!==void 0?OZ(c,p):c,I,P,k;for(d===void 0?(I=1,k=s[_[0]]):(I=0,k=d);I<g;I++)P=_[I],k=R(k,s[P],P,s);return k};function NZ(r){for(var s=[],c=0,d=r.length;c<d;){var p=r.charCodeAt(c++);if(p>=55296&&p<=56319&&c<d){var _=r.charCodeAt(c++);(_&64512)==56320?s.push(((p&1023)<<10)+(_&1023)+65536):(s.push(p),c--)}else s.push(p)}return s}function rI(r){var s=NZ(r);return s.length===1?s[0].toString(16):null}function PZ(r,s){var c=r.length,d=r.charCodeAt(s),p;return d>=55296&&d<=56319&&c>s+1&&(p=r.charCodeAt(s+1),p>=56320&&p<=57343)?(d-55296)*1024+p-56320+65536:d}function qx(r){return Object.keys(r).reduce(function(s,c){var d=r[c],p=!!d.icon;return p?s[d.iconName]=d.icon:s[c]=d,s},{})}function sI(r,s){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},d=c.skipHooks,p=d===void 0?!1:d,_=qx(s);typeof vo.hooks.addPack=="function"&&!p?vo.hooks.addPack(r,qx(s)):vo.styles[r]=ze(ze({},vo.styles[r]||{}),_),r==="fas"&&sI("fa",s)}var QE,$E,ZE,Bu=vo.styles,DZ=vo.shims,kZ=(QE={},Bi(QE,Wn,Object.values(Bf[Wn])),Bi(QE,pi,Object.values(Bf[pi])),QE),Nw=null,C3={},I3={},w3={},b3={},A3={},LZ=($E={},Bi($E,Wn,Object.keys(Ff[Wn])),Bi($E,pi,Object.keys(Ff[pi])),$E);function MZ(r){return~mZ.indexOf(r)}function xZ(r,s){var c=s.split("-"),d=c[0],p=c.slice(1).join("-");return d===r&&p!==""&&!MZ(p)?p:null}var O3=function(){var s=function(_){return JR(Bu,function(g,R,I){return g[I]=JR(R,_,{}),g},{})};C3=s(function(p,_,g){if(_[3]&&(p[_[3]]=g),_[2]){var R=_[2].filter(function(I){return typeof I=="number"});R.forEach(function(I){p[I.toString(16)]=g})}return p}),I3=s(function(p,_,g){if(p[g]=g,_[2]){var R=_[2].filter(function(I){return typeof I=="string"});R.forEach(function(I){p[I]=g})}return p}),A3=s(function(p,_,g){var R=_[2];return p[g]=g,R.forEach(function(I){p[I]=g}),p});var c="far"in Bu||nt.autoFetchSvg,d=JR(DZ,function(p,_){var g=_[0],R=_[1],I=_[2];return R==="far"&&!c&&(R="fas"),typeof g=="string"&&(p.names[g]={prefix:R,iconName:I}),typeof g=="number"&&(p.unicodes[g.toString(16)]={prefix:R,iconName:I}),p},{names:{},unicodes:{}});w3=d.names,b3=d.unicodes,Nw=Ov(nt.styleDefault,{family:nt.familyDefault})};vZ(function(r){Nw=Ov(r.styleDefault,{family:nt.familyDefault})});O3();function Pw(r,s){return(C3[r]||{})[s]}function UZ(r,s){return(I3[r]||{})[s]}function Zl(r,s){return(A3[r]||{})[s]}function N3(r){return w3[r]||{prefix:null,iconName:null}}function VZ(r){var s=b3[r],c=Pw("fas",r);return s||(c?{prefix:"fas",iconName:c}:null)||{prefix:null,iconName:null}}function rl(){return Nw}var Dw=function(){return{prefix:null,iconName:null,rest:[]}};function Ov(r){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},c=s.family,d=c===void 0?Wn:c,p=Ff[d][r],_=jf[d][r]||jf[d][p],g=r in vo.styles?r:null;return _||g||null}var Jx=(ZE={},Bi(ZE,Wn,Object.keys(Bf[Wn])),Bi(ZE,pi,Object.keys(Bf[pi])),ZE);function Nv(r){var s,c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=c.skipLookups,p=d===void 0?!1:d,_=(s={},Bi(s,Wn,"".concat(nt.cssPrefix,"-").concat(Wn)),Bi(s,pi,"".concat(nt.cssPrefix,"-").concat(pi)),s),g=null,R=Wn;(r.includes(_[Wn])||r.some(function(P){return Jx[Wn].includes(P)}))&&(R=Wn),(r.includes(_[pi])||r.some(function(P){return Jx[pi].includes(P)}))&&(R=pi);var I=r.reduce(function(P,k){var L=xZ(nt.cssPrefix,k);if(Bu[k]?(k=kZ[R].includes(k)?lZ[R][k]:k,g=k,P.prefix=k):LZ[R].indexOf(k)>-1?(g=k,P.prefix=Ov(k,{family:R})):L?P.iconName=L:k!==nt.replacementClass&&k!==_[Wn]&&k!==_[pi]&&P.rest.push(k),!p&&P.prefix&&P.iconName){var x=g==="fa"?N3(P.iconName):{},H=Zl(P.prefix,P.iconName);x.prefix&&(g=null),P.iconName=x.iconName||H||P.iconName,P.prefix=x.prefix||P.prefix,P.prefix==="far"&&!Bu.far&&Bu.fas&&!nt.autoFetchSvg&&(P.prefix="fas")}return P},Dw());return(r.includes("fa-brands")||r.includes("fab"))&&(I.prefix="fab"),(r.includes("fa-duotone")||r.includes("fad"))&&(I.prefix="fad"),!I.prefix&&R===pi&&(Bu.fass||nt.autoFetchSvg)&&(I.prefix="fass",I.iconName=Zl(I.prefix,I.iconName)||I.iconName),(I.prefix==="fa"||g==="fa")&&(I.prefix=rl()||"fas"),I}var FZ=function(){function r(){Q$(this,r),this.definitions={}}return $$(r,[{key:"add",value:function(){for(var c=this,d=arguments.length,p=new Array(d),_=0;_<d;_++)p[_]=arguments[_];var g=p.reduce(this._pullDefinitions,{});Object.keys(g).forEach(function(R){c.definitions[R]=ze(ze({},c.definitions[R]||{}),g[R]),sI(R,g[R]);var I=Bf[Wn][R];I&&sI(I,g[R]),O3()})}},{key:"reset",value:function(){this.definitions={}}},{key:"_pullDefinitions",value:function(c,d){var p=d.prefix&&d.iconName&&d.icon?{0:d}:d;return Object.keys(p).map(function(_){var g=p[_],R=g.prefix,I=g.iconName,P=g.icon,k=P[2];c[R]||(c[R]={}),k.length>0&&k.forEach(function(L){typeof L=="string"&&(c[R][L]=P)}),c[R][I]=P}),c}}]),r}(),Xx=[],Gu={},Xu={},jZ=Object.keys(Xu);function BZ(r,s){var c=s.mixoutsTo;return Xx=r,Gu={},Object.keys(Xu).forEach(function(d){jZ.indexOf(d)===-1&&delete Xu[d]}),Xx.forEach(function(d){var p=d.mixout?d.mixout():{};if(Object.keys(p).forEach(function(g){typeof p[g]=="function"&&(c[g]=p[g]),tv(p[g])==="object"&&Object.keys(p[g]).forEach(function(R){c[g]||(c[g]={}),c[g][R]=p[g][R]})}),d.hooks){var _=d.hooks();Object.keys(_).forEach(function(g){Gu[g]||(Gu[g]=[]),Gu[g].push(_[g])})}d.provides&&d.provides(Xu)}),c}function oI(r,s){for(var c=arguments.length,d=new Array(c>2?c-2:0),p=2;p<c;p++)d[p-2]=arguments[p];var _=Gu[r]||[];return _.forEach(function(g){s=g.apply(null,[s].concat(d))}),s}function cd(r){for(var s=arguments.length,c=new Array(s>1?s-1:0),d=1;d<s;d++)c[d-1]=arguments[d];var p=Gu[r]||[];p.forEach(function(_){_.apply(null,c)})}function Ma(){var r=arguments[0],s=Array.prototype.slice.call(arguments,1);return Xu[r]?Xu[r].apply(null,s):void 0}function aI(r){r.prefix==="fa"&&(r.prefix="fas");var s=r.iconName,c=r.prefix||rl();if(s)return s=Zl(c,s)||s,Yx(P3.definitions,c,s)||Yx(vo.styles,c,s)}var P3=new FZ,GZ=function(){nt.autoReplaceSvg=!1,nt.observeMutations=!1,cd("noAuto")},WZ={i2svg:function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Va?(cd("beforeI2svg",s),Ma("pseudoElements2svg",s),Ma("i2svg",s)):Promise.reject("Operation requires a DOM of some kind.")},watch:function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},c=s.autoReplaceSvgRoot;nt.autoReplaceSvg===!1&&(nt.autoReplaceSvg=!0),nt.observeMutations=!0,AZ(function(){KZ({autoReplaceSvgRoot:c}),cd("watch",s)})}},HZ={icon:function(s){if(s===null)return null;if(tv(s)==="object"&&s.prefix&&s.iconName)return{prefix:s.prefix,iconName:Zl(s.prefix,s.iconName)||s.iconName};if(Array.isArray(s)&&s.length===2){var c=s[1].indexOf("fa-")===0?s[1].slice(3):s[1],d=Ov(s[0]);return{prefix:d,iconName:Zl(d,c)||c}}if(typeof s=="string"&&(s.indexOf("".concat(nt.cssPrefix,"-"))>-1||s.match(dZ))){var p=Nv(s.split(" "),{skipLookups:!0});return{prefix:p.prefix||rl(),iconName:Zl(p.prefix,p.iconName)||p.iconName}}if(typeof s=="string"){var _=rl();return{prefix:_,iconName:Zl(_,s)||s}}}},gs={noAuto:GZ,config:nt,dom:WZ,parse:HZ,library:P3,findIconDefinition:aI,toHtml:em},KZ=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},c=s.autoReplaceSvgRoot,d=c===void 0?Kn:c;(Object.keys(vo.styles).length>0||nt.autoFetchSvg)&&Va&&nt.autoReplaceSvg&&gs.dom.i2svg({node:d})};function Pv(r,s){return Object.defineProperty(r,"abstract",{get:s}),Object.defineProperty(r,"html",{get:function(){return r.abstract.map(function(d){return em(d)})}}),Object.defineProperty(r,"node",{get:function(){if(Va){var d=Kn.createElement("div");return d.innerHTML=r.html,d.children}}}),r}function zZ(r){var s=r.children,c=r.main,d=r.mask,p=r.attributes,_=r.styles,g=r.transform;if(Ow(g)&&c.found&&!d.found){var R=c.width,I=c.height,P={x:R/I/2,y:.5};p.style=Av(ze(ze({},_),{},{"transform-origin":"".concat(P.x+g.x/16,"em ").concat(P.y+g.y/16,"em")}))}return[{tag:"svg",attributes:p,children:s}]}function YZ(r){var s=r.prefix,c=r.iconName,d=r.children,p=r.attributes,_=r.symbol,g=_===!0?"".concat(s,"-").concat(nt.cssPrefix,"-").concat(c):_;return[{tag:"svg",attributes:{style:"display: none;"},children:[{tag:"symbol",attributes:ze(ze({},p),{},{id:g}),children:d}]}]}function kw(r){var s=r.icons,c=s.main,d=s.mask,p=r.prefix,_=r.iconName,g=r.transform,R=r.symbol,I=r.title,P=r.maskId,k=r.titleId,L=r.extra,x=r.watchable,H=x===void 0?!1:x,K=d.found?d:c,ee=K.width,re=K.height,Y=p==="fak",F=[nt.replacementClass,_?"".concat(nt.cssPrefix,"-").concat(_):""].filter(function(_e){return L.classes.indexOf(_e)===-1}).filter(function(_e){return _e!==""||!!_e}).concat(L.classes).join(" "),z={children:[],attributes:ze(ze({},L.attributes),{},{"data-prefix":p,"data-icon":_,class:F,role:L.attributes.role||"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 ".concat(ee," ").concat(re)})},le=Y&&!~L.classes.indexOf("fa-fw")?{width:"".concat(ee/re*16*.0625,"em")}:{};H&&(z.attributes[ad]=""),I&&(z.children.push({tag:"title",attributes:{id:z.attributes["aria-labelledby"]||"title-".concat(k||Wf())},children:[I]}),delete z.attributes.title);var ge=ze(ze({},z),{},{prefix:p,iconName:_,main:c,mask:d,maskId:P,transform:g,symbol:R,styles:ze(ze({},le),L.styles)}),Z=d.found&&c.found?Ma("generateAbstractMask",ge)||{children:[],attributes:{}}:Ma("generateAbstractIcon",ge)||{children:[],attributes:{}},fe=Z.children,ae=Z.attributes;return ge.children=fe,ge.attributes=ae,R?YZ(ge):zZ(ge)}function Qx(r){var s=r.content,c=r.width,d=r.height,p=r.transform,_=r.title,g=r.extra,R=r.watchable,I=R===void 0?!1:R,P=ze(ze(ze({},g.attributes),_?{title:_}:{}),{},{class:g.classes.join(" ")});I&&(P[ad]="");var k=ze({},g.styles);Ow(p)&&(k.transform=CZ({transform:p,startCentered:!0,width:c,height:d}),k["-webkit-transform"]=k.transform);var L=Av(k);L.length>0&&(P.style=L);var x=[];return x.push({tag:"span",attributes:P,children:[s]}),_&&x.push({tag:"span",attributes:{class:"sr-only"},children:[_]}),x}function qZ(r){var s=r.content,c=r.title,d=r.extra,p=ze(ze(ze({},d.attributes),c?{title:c}:{}),{},{class:d.classes.join(" ")}),_=Av(d.styles);_.length>0&&(p.style=_);var g=[];return g.push({tag:"span",attributes:p,children:[s]}),c&&g.push({tag:"span",attributes:{class:"sr-only"},children:[c]}),g}var XR=vo.styles;function cI(r){var s=r[0],c=r[1],d=r.slice(4),p=Rw(d,1),_=p[0],g=null;return Array.isArray(_)?g={tag:"g",attributes:{class:"".concat(nt.cssPrefix,"-").concat($l.GROUP)},children:[{tag:"path",attributes:{class:"".concat(nt.cssPrefix,"-").concat($l.SECONDARY),fill:"currentColor",d:_[0]}},{tag:"path",attributes:{class:"".concat(nt.cssPrefix,"-").concat($l.PRIMARY),fill:"currentColor",d:_[1]}}]}:g={tag:"path",attributes:{fill:"currentColor",d:_}},{found:!0,width:s,height:c,icon:g}}var JZ={found:!1,width:512,height:512};function XZ(r,s){!E3&&!nt.showMissingIcons&&r&&console.error('Icon with name "'.concat(r,'" and prefix "').concat(s,'" is missing.'))}function lI(r,s){var c=s;return s==="fa"&&nt.styleDefault!==null&&(s=rl()),new Promise(function(d,p){if(Ma("missingIconAbstract"),c==="fa"){var _=N3(r)||{};r=_.iconName||r,s=_.prefix||s}if(r&&s&&XR[s]&&XR[s][r]){var g=XR[s][r];return d(cI(g))}XZ(r,s),d(ze(ze({},JZ),{},{icon:nt.showMissingIcons&&r?Ma("missingIconAbstract")||{}:{}}))})}var $x=function(){},dI=nt.measurePerformance&&KE&&KE.mark&&KE.measure?KE:{mark:$x,measure:$x},sf='FA "6.5.1"',QZ=function(s){return dI.mark("".concat(sf," ").concat(s," begins")),function(){return D3(s)}},D3=function(s){dI.mark("".concat(sf," ").concat(s," ends")),dI.measure("".concat(sf," ").concat(s),"".concat(sf," ").concat(s," begins"),"".concat(sf," ").concat(s," ends"))},Lw={begin:QZ,end:D3},vg=function(){};function Zx(r){var s=r.getAttribute?r.getAttribute(ad):null;return typeof s=="string"}function $Z(r){var s=r.getAttribute?r.getAttribute(Iw):null,c=r.getAttribute?r.getAttribute(ww):null;return s&&c}function ZZ(r){return r&&r.classList&&r.classList.contains&&r.classList.contains(nt.replacementClass)}function eee(){if(nt.autoReplaceSvg===!0)return Sg.replace;var r=Sg[nt.autoReplaceSvg];return r||Sg.replace}function tee(r){return Kn.createElementNS("http://www.w3.org/2000/svg",r)}function nee(r){return Kn.createElement(r)}function k3(r){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},c=s.ceFn,d=c===void 0?r.tag==="svg"?tee:nee:c;if(typeof r=="string")return Kn.createTextNode(r);var p=d(r.tag);Object.keys(r.attributes||[]).forEach(function(g){p.setAttribute(g,r.attributes[g])});var _=r.children||[];return _.forEach(function(g){p.appendChild(k3(g,{ceFn:d}))}),p}function iee(r){var s=" ".concat(r.outerHTML," ");return s="".concat(s,"Font Awesome fontawesome.com "),s}var Sg={replace:function(s){var c=s[0];if(c.parentNode)if(s[1].forEach(function(p){c.parentNode.insertBefore(k3(p),c)}),c.getAttribute(ad)===null&&nt.keepOriginalSource){var d=Kn.createComment(iee(c));c.parentNode.replaceChild(d,c)}else c.remove()},nest:function(s){var c=s[0],d=s[1];if(~Aw(c).indexOf(nt.replacementClass))return Sg.replace(s);var p=new RegExp("".concat(nt.cssPrefix,"-.*"));if(delete d[0].attributes.id,d[0].attributes.class){var _=d[0].attributes.class.split(" ").reduce(function(R,I){return I===nt.replacementClass||I.match(p)?R.toSvg.push(I):R.toNode.push(I),R},{toNode:[],toSvg:[]});d[0].attributes.class=_.toSvg.join(" "),_.toNode.length===0?c.removeAttribute("class"):c.setAttribute("class",_.toNode.join(" "))}var g=d.map(function(R){return em(R)}).join(`
`);c.setAttribute(ad,""),c.innerHTML=g}};function eU(r){r()}function L3(r,s){var c=typeof s=="function"?s:vg;if(r.length===0)c();else{var d=eU;nt.mutateApproach===aZ&&(d=il.requestAnimationFrame||eU),d(function(){var p=eee(),_=Lw.begin("mutate");r.map(p),_(),c()})}}var Mw=!1;function M3(){Mw=!0}function uI(){Mw=!1}var iv=null;function tU(r){if(Hx&&nt.observeMutations){var s=r.treeCallback,c=s===void 0?vg:s,d=r.nodeCallback,p=d===void 0?vg:d,_=r.pseudoElementsCallback,g=_===void 0?vg:_,R=r.observeMutationsRoot,I=R===void 0?Kn:R;iv=new Hx(function(P){if(!Mw){var k=rl();uh(P).forEach(function(L){if(L.type==="childList"&&L.addedNodes.length>0&&!Zx(L.addedNodes[0])&&(nt.searchPseudoElements&&g(L.target),c(L.target)),L.type==="attributes"&&L.target.parentNode&&nt.searchPseudoElements&&g(L.target.parentNode),L.type==="attributes"&&Zx(L.target)&&~fZ.indexOf(L.attributeName))if(L.attributeName==="class"&&$Z(L.target)){var x=Nv(Aw(L.target)),H=x.prefix,K=x.iconName;L.target.setAttribute(Iw,H||k),K&&L.target.setAttribute(ww,K)}else ZZ(L.target)&&p(L.target)})}}),Va&&iv.observe(I,{childList:!0,attributes:!0,characterData:!0,subtree:!0})}}function ree(){iv&&iv.disconnect()}function see(r){var s=r.getAttribute("style"),c=[];return s&&(c=s.split(";").reduce(function(d,p){var _=p.split(":"),g=_[0],R=_.slice(1);return g&&R.length>0&&(d[g]=R.join(":").trim()),d},{})),c}function oee(r){var s=r.getAttribute("data-prefix"),c=r.getAttribute("data-icon"),d=r.innerText!==void 0?r.innerText.trim():"",p=Nv(Aw(r));return p.prefix||(p.prefix=rl()),s&&c&&(p.prefix=s,p.iconName=c),p.iconName&&p.prefix||(p.prefix&&d.length>0&&(p.iconName=UZ(p.prefix,r.innerText)||Pw(p.prefix,rI(r.innerText))),!p.iconName&&nt.autoFetchSvg&&r.firstChild&&r.firstChild.nodeType===Node.TEXT_NODE&&(p.iconName=r.firstChild.data)),p}function aee(r){var s=uh(r.attributes).reduce(function(p,_){return p.name!=="class"&&p.name!=="style"&&(p[_.name]=_.value),p},{}),c=r.getAttribute("title"),d=r.getAttribute("data-fa-title-id");return nt.autoA11y&&(c?s["aria-labelledby"]="".concat(nt.replacementClass,"-title-").concat(d||Wf()):(s["aria-hidden"]="true",s.focusable="false")),s}function cee(){return{iconName:null,title:null,titleId:null,prefix:null,transform:qo,symbol:!1,mask:{iconName:null,prefix:null,rest:[]},maskId:null,extra:{classes:[],styles:{},attributes:{}}}}function nU(r){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{styleParser:!0},c=oee(r),d=c.iconName,p=c.prefix,_=c.rest,g=aee(r),R=oI("parseNodeAttributes",{},r),I=s.styleParser?see(r):[];return ze({iconName:d,title:r.getAttribute("title"),titleId:r.getAttribute("data-fa-title-id"),prefix:p,transform:qo,mask:{iconName:null,prefix:null,rest:[]},maskId:null,symbol:!1,extra:{classes:_,styles:I,attributes:g}},R)}var lee=vo.styles;function x3(r){var s=nt.autoReplaceSvg==="nest"?nU(r,{styleParser:!1}):nU(r);return~s.extra.classes.indexOf(g3)?Ma("generateLayersText",r,s):Ma("generateSvgReplacementMutation",r,s)}var sl=new Set;bw.map(function(r){sl.add("fa-".concat(r))});Object.keys(Ff[Wn]).map(sl.add.bind(sl));Object.keys(Ff[pi]).map(sl.add.bind(sl));sl=$f(sl);function iU(r){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(!Va)return Promise.resolve();var c=Kn.documentElement.classList,d=function(L){return c.add("".concat(Kx,"-").concat(L))},p=function(L){return c.remove("".concat(Kx,"-").concat(L))},_=nt.autoFetchSvg?sl:bw.map(function(k){return"fa-".concat(k)}).concat(Object.keys(lee));_.includes("fa")||_.push("fa");var g=[".".concat(g3,":not([").concat(ad,"])")].concat(_.map(function(k){return".".concat(k,":not([").concat(ad,"])")})).join(", ");if(g.length===0)return Promise.resolve();var R=[];try{R=uh(r.querySelectorAll(g))}catch{}if(R.length>0)d("pending"),p("complete");else return Promise.resolve();var I=Lw.begin("onTree"),P=R.reduce(function(k,L){try{var x=x3(L);x&&k.push(x)}catch(H){E3||H.name==="MissingIcon"&&console.error(H)}return k},[]);return new Promise(function(k,L){Promise.all(P).then(function(x){L3(x,function(){d("active"),d("complete"),p("pending"),typeof s=="function"&&s(),I(),k()})}).catch(function(x){I(),L(x)})})}function dee(r){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;x3(r).then(function(c){c&&L3([c],s)})}function uee(r){return function(s){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=(s||{}).icon?s:aI(s||{}),p=c.mask;return p&&(p=(p||{}).icon?p:aI(p||{})),r(d,ze(ze({},c),{},{mask:p}))}}var hee=function(s){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=c.transform,p=d===void 0?qo:d,_=c.symbol,g=_===void 0?!1:_,R=c.mask,I=R===void 0?null:R,P=c.maskId,k=P===void 0?null:P,L=c.title,x=L===void 0?null:L,H=c.titleId,K=H===void 0?null:H,ee=c.classes,re=ee===void 0?[]:ee,Y=c.attributes,F=Y===void 0?{}:Y,z=c.styles,le=z===void 0?{}:z;if(s){var ge=s.prefix,Z=s.iconName,fe=s.icon;return Pv(ze({type:"icon"},s),function(){return cd("beforeDOMElementCreation",{iconDefinition:s,params:c}),nt.autoA11y&&(x?F["aria-labelledby"]="".concat(nt.replacementClass,"-title-").concat(K||Wf()):(F["aria-hidden"]="true",F.focusable="false")),kw({icons:{main:cI(fe),mask:I?cI(I.icon):{found:!1,width:null,height:null,icon:{}}},prefix:ge,iconName:Z,transform:ze(ze({},qo),p),symbol:g,title:x,maskId:k,titleId:K,extra:{attributes:F,styles:le,classes:re}})})}},pee={mixout:function(){return{icon:uee(hee)}},hooks:function(){return{mutationObserverCallbacks:function(c){return c.treeCallback=iU,c.nodeCallback=dee,c}}},provides:function(s){s.i2svg=function(c){var d=c.node,p=d===void 0?Kn:d,_=c.callback,g=_===void 0?function(){}:_;return iU(p,g)},s.generateSvgReplacementMutation=function(c,d){var p=d.iconName,_=d.title,g=d.titleId,R=d.prefix,I=d.transform,P=d.symbol,k=d.mask,L=d.maskId,x=d.extra;return new Promise(function(H,K){Promise.all([lI(p,R),k.iconName?lI(k.iconName,k.prefix):Promise.resolve({found:!1,width:512,height:512,icon:{}})]).then(function(ee){var re=Rw(ee,2),Y=re[0],F=re[1];H([c,kw({icons:{main:Y,mask:F},prefix:R,iconName:p,transform:I,symbol:P,maskId:L,title:_,titleId:g,extra:x,watchable:!0})])}).catch(K)})},s.generateAbstractIcon=function(c){var d=c.children,p=c.attributes,_=c.main,g=c.transform,R=c.styles,I=Av(R);I.length>0&&(p.style=I);var P;return Ow(g)&&(P=Ma("generateAbstractTransformGrouping",{main:_,transform:g,containerWidth:_.width,iconWidth:_.width})),d.push(P||_.icon),{children:d,attributes:p}}}},fee={mixout:function(){return{layer:function(c){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},p=d.classes,_=p===void 0?[]:p;return Pv({type:"layer"},function(){cd("beforeDOMElementCreation",{assembler:c,params:d});var g=[];return c(function(R){Array.isArray(R)?R.map(function(I){g=g.concat(I.abstract)}):g=g.concat(R.abstract)}),[{tag:"span",attributes:{class:["".concat(nt.cssPrefix,"-layers")].concat($f(_)).join(" ")},children:g}]})}}}},mee={mixout:function(){return{counter:function(c){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},p=d.title,_=p===void 0?null:p,g=d.classes,R=g===void 0?[]:g,I=d.attributes,P=I===void 0?{}:I,k=d.styles,L=k===void 0?{}:k;return Pv({type:"counter",content:c},function(){return cd("beforeDOMElementCreation",{content:c,params:d}),qZ({content:c.toString(),title:_,extra:{attributes:P,styles:L,classes:["".concat(nt.cssPrefix,"-layers-counter")].concat($f(R))}})})}}}},_ee={mixout:function(){return{text:function(c){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},p=d.transform,_=p===void 0?qo:p,g=d.title,R=g===void 0?null:g,I=d.classes,P=I===void 0?[]:I,k=d.attributes,L=k===void 0?{}:k,x=d.styles,H=x===void 0?{}:x;return Pv({type:"text",content:c},function(){return cd("beforeDOMElementCreation",{content:c,params:d}),Qx({content:c,transform:ze(ze({},qo),_),title:R,extra:{attributes:L,styles:H,classes:["".concat(nt.cssPrefix,"-layers-text")].concat($f(P))}})})}}},provides:function(s){s.generateLayersText=function(c,d){var p=d.title,_=d.transform,g=d.extra,R=null,I=null;if(f3){var P=parseInt(getComputedStyle(c).fontSize,10),k=c.getBoundingClientRect();R=k.width/P,I=k.height/P}return nt.autoA11y&&!p&&(g.attributes["aria-hidden"]="true"),Promise.resolve([c,Qx({content:c.innerHTML,width:R,height:I,transform:_,title:p,extra:g,watchable:!0})])}}},Eee=new RegExp('"',"ug"),rU=[1105920,1112319];function gee(r){var s=r.replace(Eee,""),c=PZ(s,0),d=c>=rU[0]&&c<=rU[1],p=s.length===2?s[0]===s[1]:!1;return{value:rI(p?s[0]:s),isSecondary:d||p}}function sU(r,s){var c="".concat(oZ).concat(s.replace(":","-"));return new Promise(function(d,p){if(r.getAttribute(c)!==null)return d();var _=uh(r.children),g=_.filter(function(fe){return fe.getAttribute(iI)===s})[0],R=il.getComputedStyle(r,s),I=R.getPropertyValue("font-family").match(uZ),P=R.getPropertyValue("font-weight"),k=R.getPropertyValue("content");if(g&&!I)return r.removeChild(g),d();if(I&&k!=="none"&&k!==""){var L=R.getPropertyValue("content"),x=~["Sharp"].indexOf(I[2])?pi:Wn,H=~["Solid","Regular","Light","Thin","Duotone","Brands","Kit"].indexOf(I[2])?jf[x][I[2].toLowerCase()]:hZ[x][P],K=gee(L),ee=K.value,re=K.isSecondary,Y=I[0].startsWith("FontAwesome"),F=Pw(H,ee),z=F;if(Y){var le=VZ(ee);le.iconName&&le.prefix&&(F=le.iconName,H=le.prefix)}if(F&&!re&&(!g||g.getAttribute(Iw)!==H||g.getAttribute(ww)!==z)){r.setAttribute(c,z),g&&r.removeChild(g);var ge=cee(),Z=ge.extra;Z.attributes[iI]=s,lI(F,H).then(function(fe){var ae=kw(ze(ze({},ge),{},{icons:{main:fe,mask:Dw()},prefix:H,iconName:z,extra:Z,watchable:!0})),_e=Kn.createElementNS("http://www.w3.org/2000/svg","svg");s==="::before"?r.insertBefore(_e,r.firstChild):r.appendChild(_e),_e.outerHTML=ae.map(function(me){return em(me)}).join(`
`),r.removeAttribute(c),d()}).catch(p)}else d()}else d()})}function vee(r){return Promise.all([sU(r,"::before"),sU(r,"::after")])}function See(r){return r.parentNode!==document.head&&!~cZ.indexOf(r.tagName.toUpperCase())&&!r.getAttribute(iI)&&(!r.parentNode||r.parentNode.tagName!=="svg")}function oU(r){if(Va)return new Promise(function(s,c){var d=uh(r.querySelectorAll("*")).filter(See).map(vee),p=Lw.begin("searchPseudoElements");M3(),Promise.all(d).then(function(){p(),uI(),s()}).catch(function(){p(),uI(),c()})})}var Tee={hooks:function(){return{mutationObserverCallbacks:function(c){return c.pseudoElementsCallback=oU,c}}},provides:function(s){s.pseudoElements2svg=function(c){var d=c.node,p=d===void 0?Kn:d;nt.searchPseudoElements&&oU(p)}}},aU=!1,yee={mixout:function(){return{dom:{unwatch:function(){M3(),aU=!0}}}},hooks:function(){return{bootstrap:function(){tU(oI("mutationObserverCallbacks",{}))},noAuto:function(){ree()},watch:function(c){var d=c.observeMutationsRoot;aU?uI():tU(oI("mutationObserverCallbacks",{observeMutationsRoot:d}))}}}},cU=function(s){var c={size:16,x:0,y:0,flipX:!1,flipY:!1,rotate:0};return s.toLowerCase().split(" ").reduce(function(d,p){var _=p.toLowerCase().split("-"),g=_[0],R=_.slice(1).join("-");if(g&&R==="h")return d.flipX=!0,d;if(g&&R==="v")return d.flipY=!0,d;if(R=parseFloat(R),isNaN(R))return d;switch(g){case"grow":d.size=d.size+R;break;case"shrink":d.size=d.size-R;break;case"left":d.x=d.x-R;break;case"right":d.x=d.x+R;break;case"up":d.y=d.y-R;break;case"down":d.y=d.y+R;break;case"rotate":d.rotate=d.rotate+R;break}return d},c)},Ree={mixout:function(){return{parse:{transform:function(c){return cU(c)}}}},hooks:function(){return{parseNodeAttributes:function(c,d){var p=d.getAttribute("data-fa-transform");return p&&(c.transform=cU(p)),c}}},provides:function(s){s.generateAbstractTransformGrouping=function(c){var d=c.main,p=c.transform,_=c.containerWidth,g=c.iconWidth,R={transform:"translate(".concat(_/2," 256)")},I="translate(".concat(p.x*32,", ").concat(p.y*32,") "),P="scale(".concat(p.size/16*(p.flipX?-1:1),", ").concat(p.size/16*(p.flipY?-1:1),") "),k="rotate(".concat(p.rotate," 0 0)"),L={transform:"".concat(I," ").concat(P," ").concat(k)},x={transform:"translate(".concat(g/2*-1," -256)")},H={outer:R,inner:L,path:x};return{tag:"g",attributes:ze({},H.outer),children:[{tag:"g",attributes:ze({},H.inner),children:[{tag:d.icon.tag,children:d.icon.children,attributes:ze(ze({},d.icon.attributes),H.path)}]}]}}}},QR={x:0,y:0,width:"100%",height:"100%"};function lU(r){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return r.attributes&&(r.attributes.fill||s)&&(r.attributes.fill="black"),r}function Cee(r){return r.tag==="g"?r.children:[r]}var Iee={hooks:function(){return{parseNodeAttributes:function(c,d){var p=d.getAttribute("data-fa-mask"),_=p?Nv(p.split(" ").map(function(g){return g.trim()})):Dw();return _.prefix||(_.prefix=rl()),c.mask=_,c.maskId=d.getAttribute("data-fa-mask-id"),c}}},provides:function(s){s.generateAbstractMask=function(c){var d=c.children,p=c.attributes,_=c.main,g=c.mask,R=c.maskId,I=c.transform,P=_.width,k=_.icon,L=g.width,x=g.icon,H=RZ({transform:I,containerWidth:L,iconWidth:P}),K={tag:"rect",attributes:ze(ze({},QR),{},{fill:"white"})},ee=k.children?{children:k.children.map(lU)}:{},re={tag:"g",attributes:ze({},H.inner),children:[lU(ze({tag:k.tag,attributes:ze(ze({},k.attributes),H.path)},ee))]},Y={tag:"g",attributes:ze({},H.outer),children:[re]},F="mask-".concat(R||Wf()),z="clip-".concat(R||Wf()),le={tag:"mask",attributes:ze(ze({},QR),{},{id:F,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse"}),children:[K,Y]},ge={tag:"defs",children:[{tag:"clipPath",attributes:{id:z},children:Cee(x)},le]};return d.push(ge,{tag:"rect",attributes:ze({fill:"currentColor","clip-path":"url(#".concat(z,")"),mask:"url(#".concat(F,")")},QR)}),{children:d,attributes:p}}}},wee={provides:function(s){var c=!1;il.matchMedia&&(c=il.matchMedia("(prefers-reduced-motion: reduce)").matches),s.missingIconAbstract=function(){var d=[],p={fill:"currentColor"},_={attributeType:"XML",repeatCount:"indefinite",dur:"2s"};d.push({tag:"path",attributes:ze(ze({},p),{},{d:"M156.5,447.7l-12.6,29.5c-18.7-9.5-35.9-21.2-51.5-34.9l22.7-22.7C127.6,430.5,141.5,440,156.5,447.7z M40.6,272H8.5 c1.4,21.2,5.4,41.7,11.7,61.1L50,321.2C45.1,305.5,41.8,289,40.6,272z M40.6,240c1.4-18.8,5.2-37,11.1-54.1l-29.5-12.6 C14.7,194.3,10,216.7,8.5,240H40.6z M64.3,156.5c7.8-14.9,17.2-28.8,28.1-41.5L69.7,92.3c-13.7,15.6-25.5,32.8-34.9,51.5 L64.3,156.5z M397,419.6c-13.9,12-29.4,22.3-46.1,30.4l11.9,29.8c20.7-9.9,39.8-22.6,56.9-37.6L397,419.6z M115,92.4 c13.9-12,29.4-22.3,46.1-30.4l-11.9-29.8c-20.7,9.9-39.8,22.6-56.8,37.6L115,92.4z M447.7,355.5c-7.8,14.9-17.2,28.8-28.1,41.5 l22.7,22.7c13.7-15.6,25.5-32.9,34.9-51.5L447.7,355.5z M471.4,272c-1.4,18.8-5.2,37-11.1,54.1l29.5,12.6 c7.5-21.1,12.2-43.5,13.6-66.8H471.4z M321.2,462c-15.7,5-32.2,8.2-49.2,9.4v32.1c21.2-1.4,41.7-5.4,61.1-11.7L321.2,462z M240,471.4c-18.8-1.4-37-5.2-54.1-11.1l-12.6,29.5c21.1,7.5,43.5,12.2,66.8,13.6V471.4z M462,190.8c5,15.7,8.2,32.2,9.4,49.2h32.1 c-1.4-21.2-5.4-41.7-11.7-61.1L462,190.8z M92.4,397c-12-13.9-22.3-29.4-30.4-46.1l-29.8,11.9c9.9,20.7,22.6,39.8,37.6,56.9 L92.4,397z M272,40.6c18.8,1.4,36.9,5.2,54.1,11.1l12.6-29.5C317.7,14.7,295.3,10,272,8.5V40.6z M190.8,50 c15.7-5,32.2-8.2,49.2-9.4V8.5c-21.2,1.4-41.7,5.4-61.1,11.7L190.8,50z M442.3,92.3L419.6,115c12,13.9,22.3,29.4,30.5,46.1 l29.8-11.9C470,128.5,457.3,109.4,442.3,92.3z M397,92.4l22.7-22.7c-15.6-13.7-32.8-25.5-51.5-34.9l-12.6,29.5 C370.4,72.1,384.4,81.5,397,92.4z"})});var g=ze(ze({},_),{},{attributeName:"opacity"}),R={tag:"circle",attributes:ze(ze({},p),{},{cx:"256",cy:"364",r:"28"}),children:[]};return c||R.children.push({tag:"animate",attributes:ze(ze({},_),{},{attributeName:"r",values:"28;14;28;28;14;28;"})},{tag:"animate",attributes:ze(ze({},g),{},{values:"1;0;1;1;0;1;"})}),d.push(R),d.push({tag:"path",attributes:ze(ze({},p),{},{opacity:"1",d:"M263.7,312h-16c-6.6,0-12-5.4-12-12c0-71,77.4-63.9,77.4-107.8c0-20-17.8-40.2-57.4-40.2c-29.1,0-44.3,9.6-59.2,28.7 c-3.9,5-11.1,6-16.2,2.4l-13.1-9.2c-5.6-3.9-6.9-11.8-2.6-17.2c21.2-27.2,46.4-44.7,91.2-44.7c52.3,0,97.4,29.8,97.4,80.2 c0,67.6-77.4,63.5-77.4,107.8C275.7,306.6,270.3,312,263.7,312z"}),children:c?[]:[{tag:"animate",attributes:ze(ze({},g),{},{values:"1;0;0;0;0;1;"})}]}),c||d.push({tag:"path",attributes:ze(ze({},p),{},{opacity:"0",d:"M232.5,134.5l7,168c0.3,6.4,5.6,11.5,12,11.5h9c6.4,0,11.7-5.1,12-11.5l7-168c0.3-6.8-5.2-12.5-12-12.5h-23 C237.7,122,232.2,127.7,232.5,134.5z"}),children:[{tag:"animate",attributes:ze(ze({},g),{},{values:"0;0;1;1;0;0;"})}]}),{tag:"g",attributes:{class:"missing"},children:d}}}},bee={hooks:function(){return{parseNodeAttributes:function(c,d){var p=d.getAttribute("data-fa-symbol"),_=p===null?!1:p===""?!0:p;return c.symbol=_,c}}}},Aee=[wZ,pee,fee,mee,_ee,Tee,yee,Ree,Iee,wee,bee];BZ(Aee,{mixoutsTo:gs});gs.noAuto;gs.config;gs.library;gs.dom;var hI=gs.parse;gs.findIconDefinition;gs.toHtml;var Oee=gs.icon;gs.layer;gs.text;gs.counter;var U3={exports:{}},Nee="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",Pee=Nee,Dee=Pee;function V3(){}function F3(){}F3.resetWarningCache=V3;var kee=function(){function r(d,p,_,g,R,I){if(I!==Dee){var P=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw P.name="Invariant Violation",P}}r.isRequired=r;function s(){return r}var c={array:r,bigint:r,bool:r,func:r,number:r,object:r,string:r,symbol:r,any:r,arrayOf:s,element:r,elementType:r,instanceOf:s,node:r,objectOf:s,oneOf:s,oneOfType:s,shape:s,exact:s,checkPropTypes:F3,resetWarningCache:V3};return c.PropTypes=c,c};U3.exports=kee();var Lee=U3.exports;const Bt=sv(Lee);function dU(r,s){var c=Object.keys(r);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(r);s&&(d=d.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),c.push.apply(c,d)}return c}function Hc(r){for(var s=1;s<arguments.length;s++){var c=arguments[s]!=null?arguments[s]:{};s%2?dU(Object(c),!0).forEach(function(d){Wu(r,d,c[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(c)):dU(Object(c)).forEach(function(d){Object.defineProperty(r,d,Object.getOwnPropertyDescriptor(c,d))})}return r}function rv(r){"@babel/helpers - typeof";return rv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},rv(r)}function Wu(r,s,c){return s in r?Object.defineProperty(r,s,{value:c,enumerable:!0,configurable:!0,writable:!0}):r[s]=c,r}function Mee(r,s){if(r==null)return{};var c={},d=Object.keys(r),p,_;for(_=0;_<d.length;_++)p=d[_],!(s.indexOf(p)>=0)&&(c[p]=r[p]);return c}function xee(r,s){if(r==null)return{};var c=Mee(r,s),d,p;if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(r);for(p=0;p<_.length;p++)d=_[p],!(s.indexOf(d)>=0)&&Object.prototype.propertyIsEnumerable.call(r,d)&&(c[d]=r[d])}return c}function pI(r){return Uee(r)||Vee(r)||Fee(r)||jee()}function Uee(r){if(Array.isArray(r))return fI(r)}function Vee(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function Fee(r,s){if(r){if(typeof r=="string")return fI(r,s);var c=Object.prototype.toString.call(r).slice(8,-1);if(c==="Object"&&r.constructor&&(c=r.constructor.name),c==="Map"||c==="Set")return Array.from(r);if(c==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return fI(r,s)}}function fI(r,s){(s==null||s>r.length)&&(s=r.length);for(var c=0,d=new Array(s);c<s;c++)d[c]=r[c];return d}function jee(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Bee(r){var s,c=r.beat,d=r.fade,p=r.beatFade,_=r.bounce,g=r.shake,R=r.flash,I=r.spin,P=r.spinPulse,k=r.spinReverse,L=r.pulse,x=r.fixedWidth,H=r.inverse,K=r.border,ee=r.listItem,re=r.flip,Y=r.size,F=r.rotation,z=r.pull,le=(s={"fa-beat":c,"fa-fade":d,"fa-beat-fade":p,"fa-bounce":_,"fa-shake":g,"fa-flash":R,"fa-spin":I,"fa-spin-reverse":k,"fa-spin-pulse":P,"fa-pulse":L,"fa-fw":x,"fa-inverse":H,"fa-border":K,"fa-li":ee,"fa-flip":re===!0,"fa-flip-horizontal":re==="horizontal"||re==="both","fa-flip-vertical":re==="vertical"||re==="both"},Wu(s,"fa-".concat(Y),typeof Y<"u"&&Y!==null),Wu(s,"fa-rotate-".concat(F),typeof F<"u"&&F!==null&&F!==0),Wu(s,"fa-pull-".concat(z),typeof z<"u"&&z!==null),Wu(s,"fa-swap-opacity",r.swapOpacity),s);return Object.keys(le).map(function(ge){return le[ge]?ge:null}).filter(function(ge){return ge})}function Gee(r){return r=r-0,r===r}function j3(r){return Gee(r)?r:(r=r.replace(/[\-_\s]+(.)?/g,function(s,c){return c?c.toUpperCase():""}),r.substr(0,1).toLowerCase()+r.substr(1))}var Wee=["style"];function Hee(r){return r.charAt(0).toUpperCase()+r.slice(1)}function Kee(r){return r.split(";").map(function(s){return s.trim()}).filter(function(s){return s}).reduce(function(s,c){var d=c.indexOf(":"),p=j3(c.slice(0,d)),_=c.slice(d+1).trim();return p.startsWith("webkit")?s[Hee(p)]=_:s[p]=_,s},{})}function B3(r,s){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(typeof s=="string")return s;var d=(s.children||[]).map(function(I){return B3(r,I)}),p=Object.keys(s.attributes||{}).reduce(function(I,P){var k=s.attributes[P];switch(P){case"class":I.attrs.className=k,delete s.attributes.class;break;case"style":I.attrs.style=Kee(k);break;default:P.indexOf("aria-")===0||P.indexOf("data-")===0?I.attrs[P.toLowerCase()]=k:I.attrs[j3(P)]=k}return I},{attrs:{}}),_=c.style,g=_===void 0?{}:_,R=xee(c,Wee);return p.attrs.style=Hc(Hc({},p.attrs.style),g),r.apply(void 0,[s.tag,Hc(Hc({},p.attrs),R)].concat(pI(d)))}var G3=!1;try{G3=!0}catch{}function zee(){if(!G3&&console&&typeof console.error=="function"){var r;(r=console).error.apply(r,arguments)}}function uU(r){if(r&&rv(r)==="object"&&r.prefix&&r.iconName&&r.icon)return r;if(hI.icon)return hI.icon(r);if(r===null)return null;if(r&&rv(r)==="object"&&r.prefix&&r.iconName)return r;if(Array.isArray(r)&&r.length===2)return{prefix:r[0],iconName:r[1]};if(typeof r=="string")return{prefix:"fas",iconName:r}}function $R(r,s){return Array.isArray(s)&&s.length>0||!Array.isArray(s)&&s?Wu({},r,s):{}}var $i=II.forwardRef(function(r,s){var c=r.icon,d=r.mask,p=r.symbol,_=r.className,g=r.title,R=r.titleId,I=r.maskId,P=uU(c),k=$R("classes",[].concat(pI(Bee(r)),pI(_.split(" ")))),L=$R("transform",typeof r.transform=="string"?hI.transform(r.transform):r.transform),x=$R("mask",uU(d)),H=Oee(P,Hc(Hc(Hc(Hc({},k),L),x),{},{symbol:p,title:g,titleId:R,maskId:I}));if(!H)return zee("Could not find icon",P),null;var K=H.abstract,ee={ref:s};return Object.keys(r).forEach(function(re){$i.defaultProps.hasOwnProperty(re)||(ee[re]=r[re])}),Yee(K[0],ee)});$i.displayName="FontAwesomeIcon";$i.propTypes={beat:Bt.bool,border:Bt.bool,beatFade:Bt.bool,bounce:Bt.bool,className:Bt.string,fade:Bt.bool,flash:Bt.bool,mask:Bt.oneOfType([Bt.object,Bt.array,Bt.string]),maskId:Bt.string,fixedWidth:Bt.bool,inverse:Bt.bool,flip:Bt.oneOf([!0,!1,"horizontal","vertical","both"]),icon:Bt.oneOfType([Bt.object,Bt.array,Bt.string]),listItem:Bt.bool,pull:Bt.oneOf(["right","left"]),pulse:Bt.bool,rotation:Bt.oneOf([0,90,180,270]),shake:Bt.bool,size:Bt.oneOf(["2xs","xs","sm","lg","xl","2xl","1x","2x","3x","4x","5x","6x","7x","8x","9x","10x"]),spin:Bt.bool,spinPulse:Bt.bool,spinReverse:Bt.bool,symbol:Bt.oneOfType([Bt.bool,Bt.string]),title:Bt.string,titleId:Bt.string,transform:Bt.oneOfType([Bt.string,Bt.object]),swapOpacity:Bt.bool};$i.defaultProps={border:!1,className:"",mask:null,maskId:null,fixedWidth:!1,inverse:!1,flip:!1,icon:null,listItem:!1,pull:null,pulse:!1,rotation:null,size:null,spin:!1,spinPulse:!1,spinReverse:!1,beat:!1,fade:!1,beatFade:!1,bounce:!1,shake:!1,symbol:!1,title:"",titleId:null,transform:null,swapOpacity:!1};var Yee=B3.bind(null,II.createElement),qee={prefix:"fas",iconName:"message",icon:[512,512,["comment-alt"],"f27a","M64 0C28.7 0 0 28.7 0 64V352c0 35.3 28.7 64 64 64h96v80c0 6.1 3.4 11.6 8.8 14.3s11.9 2.1 16.8-1.5L309.3 416H448c35.3 0 64-28.7 64-64V64c0-35.3-28.7-64-64-64H64z"]},Jee={prefix:"fas",iconName:"pencil",icon:[512,512,[9999,61504,"pencil-alt"],"f303","M410.3 231l11.3-11.3-33.9-33.9-62.1-62.1L291.7 89.8l-11.3 11.3-22.6 22.6L58.6 322.9c-10.4 10.4-18 23.3-22.2 37.4L1 480.7c-2.5 8.4-.2 17.5 6.1 23.7s15.3 8.5 23.7 6.1l120.3-35.4c14.1-4.2 27-11.8 37.4-22.2L387.7 253.7 410.3 231zM160 399.4l-9.1 22.7c-4 3.1-8.5 5.4-13.3 6.9L59.4 452l23-78.1c1.4-4.9 3.8-9.4 6.9-13.3l22.7-9.1v32c0 8.8 7.2 16 16 16h32zM362.7 18.7L348.3 33.2 325.7 55.8 314.3 67.1l33.9 33.9 62.1 62.1 33.9 33.9 11.3-11.3 22.6-22.6 14.5-14.5c25-25 25-65.5 0-90.5L453.3 18.7c-25-25-65.5-25-90.5 0zm-47.4 168l-144 144c-6.2 6.2-16.4 6.2-22.6 0s-6.2-16.4 0-22.6l144-144c6.2-6.2 16.4-6.2 22.6 0s6.2 16.4 0 22.6z"]},Xee={prefix:"fas",iconName:"microphone-slash",icon:[640,512,[],"f131","M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L472.1 344.7c15.2-26 23.9-56.3 23.9-88.7V216c0-13.3-10.7-24-24-24s-24 10.7-24 24v40c0 21.2-5.1 41.1-14.2 58.7L416 300.8V96c0-53-43-96-96-96s-96 43-96 96v54.3L38.8 5.1zm362.5 407l-43.1-33.9C346.1 382 333.3 384 320 384c-70.7 0-128-57.3-128-128v-8.7L144.7 210c-.5 1.9-.7 3.9-.7 6v40c0 89.1 66.2 162.7 152 174.4V464H248c-13.3 0-24 10.7-24 24s10.7 24 24 24h72 72c13.3 0 24-10.7 24-24s-10.7-24-24-24H344V430.4c20.4-2.8 39.7-9.1 57.3-18.2z"]},Qee={prefix:"fas",iconName:"arrow-right-from-bracket",icon:[512,512,["sign-out"],"f08b","M502.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-128-128c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L402.7 224 192 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l210.7 0-73.4 73.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l128-128zM160 96c17.7 0 32-14.3 32-32s-14.3-32-32-32L96 32C43 32 0 75 0 128L0 384c0 53 43 96 96 96l64 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-64 0c-17.7 0-32-14.3-32-32l0-256c0-17.7 14.3-32 32-32l64 0z"]},$ee={prefix:"fas",iconName:"user",icon:[448,512,[128100,62144],"f007","M224 256A128 128 0 1 0 224 0a128 128 0 1 0 0 256zm-45.7 48C79.8 304 0 383.8 0 482.3C0 498.7 13.3 512 29.7 512H418.3c16.4 0 29.7-13.3 29.7-29.7C448 383.8 368.2 304 269.7 304H178.3z"]},Zee={prefix:"fas",iconName:"slash",icon:[640,512,[],"f715","M5.1 9.2C13.3-1.2 28.4-3.1 38.8 5.1l592 464c10.4 8.2 12.3 23.3 4.1 33.7s-23.3 12.3-33.7 4.1L9.2 42.9C-1.2 34.7-3.1 19.6 5.1 9.2z"]},ete={prefix:"fas",iconName:"rotate-left",icon:[512,512,["rotate-back","rotate-backward","undo-alt"],"f2ea","M48.5 224H40c-13.3 0-24-10.7-24-24V72c0-9.7 5.8-18.5 14.8-22.2s19.3-1.7 26.2 5.2L98.6 96.6c87.6-86.5 228.7-86.2 315.8 1c87.5 87.5 87.5 229.3 0 316.8s-229.3 87.5-316.8 0c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0c62.5 62.5 163.8 62.5 226.3 0s62.5-163.8 0-226.3c-62.2-62.2-162.7-62.5-225.3-1L185 183c6.9 6.9 8.9 17.2 5.2 26.2s-12.5 14.8-22.2 14.8H48.5z"]},tte=ete,nte={prefix:"fas",iconName:"up-down-left-right",icon:[512,512,["arrows-alt"],"f0b2","M278.6 9.4c-12.5-12.5-32.8-12.5-45.3 0l-64 64c-9.2 9.2-11.9 22.9-6.9 34.9s16.6 19.8 29.6 19.8h32v96H128V192c0-12.9-7.8-24.6-19.8-29.6s-25.7-2.2-34.9 6.9l-64 64c-12.5 12.5-12.5 32.8 0 45.3l64 64c9.2 9.2 22.9 11.9 34.9 6.9s19.8-16.6 19.8-29.6V288h96v96H192c-12.9 0-24.6 7.8-29.6 19.8s-2.2 25.7 6.9 34.9l64 64c12.5 12.5 32.8 12.5 45.3 0l64-64c9.2-9.2 11.9-22.9 6.9-34.9s-16.6-19.8-29.6-19.8H288V288h96v32c0 12.9 7.8 24.6 19.8 29.6s25.7 2.2 34.9-6.9l64-64c12.5-12.5 12.5-32.8 0-45.3l-64-64c-9.2-9.2-22.9-11.9-34.9-6.9s-19.8 16.6-19.8 29.6v32H288V128h32c12.9 0 24.6-7.8 29.6-19.8s2.2-25.7-6.9-34.9l-64-64z"]},ite={prefix:"fas",iconName:"download",icon:[512,512,[],"f019","M288 32c0-17.7-14.3-32-32-32s-32 14.3-32 32V274.7l-73.4-73.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l128 128c12.5 12.5 32.8 12.5 45.3 0l128-128c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L288 274.7V32zM64 352c-35.3 0-64 28.7-64 64v32c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V416c0-35.3-28.7-64-64-64H346.5l-45.3 45.3c-25 25-65.5 25-90.5 0L165.5 352H64zm368 56a24 24 0 1 1 0 48 24 24 0 1 1 0-48z"]},rte={prefix:"fas",iconName:"rotate-right",icon:[512,512,["redo-alt","rotate-forward"],"f2f9","M463.5 224H472c13.3 0 24-10.7 24-24V72c0-9.7-5.8-18.5-14.8-22.2s-19.3-1.7-26.2 5.2L413.4 96.6c-87.6-86.5-228.7-86.2-315.8 1c-87.5 87.5-87.5 229.3 0 316.8s229.3 87.5 316.8 0c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0c-62.5 62.5-163.8 62.5-226.3 0s-62.5-163.8 0-226.3c62.2-62.2 162.7-62.5 225.3-1L327 183c-6.9 6.9-8.9 17.2-5.2 26.2s12.5 14.8 22.2 14.8H463.5z"]},ste=rte,ote={prefix:"fas",iconName:"arrow-right-long",icon:[512,512,["long-arrow-right"],"f178","M502.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-128-128c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L402.7 224 32 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l370.7 0-73.4 73.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l128-128z"]};const hU=({isMessage:r,setIsMessage:s,socket:c})=>{const[d,p]=Ce.useState(""),[_,g]=Ce.useState([]),R=I=>{I.preventDefault();const P=new Date,k=P.getHours().toString(),L=P.getMinutes().toString(),x=k+":"+L;d.trim()!==""&&(g(H=>[...H,{message:d,name:"You",time:x}]),c.emit("message",{message:d,time:x}),p(""))};return Ce.useEffect(()=>{c.on("messageResponse",I=>{g(P=>[...P,I])})},[d]),console.log(_,"all chat in this site"),Se.jsxs("div",{className:"h-screen w-72 items-center [transition:width_0.5s] bg-blue-950 z-[1]",children:[Se.jsx("button",{onClick:()=>s(!r),className:"h-fit w-full p-2 bg-slate-300  rounded-md mb-3",children:"Leave"}),Se.jsx("div",{className:"text-wrap h-[80%] border-solid border border-white",children:_.map((I,P)=>Se.jsxs("div",{className:"text-center text-white flex justify-between border border-solid border-white ",children:[Se.jsxs("div",{className:"p-2",children:[I.name," :"]}),Se.jsx("div",{className:"p-2",children:I.message}),Se.jsx("div",{className:"p-2",children:I.time})]},P*999))}),Se.jsx("div",{className:"w-[95%] flex pt-3 mx-auto",children:Se.jsxs("form",{onSubmit:R,className:"flex w-full",children:[Se.jsx("input",{type:"text",placeholder:"Enter text",value:d,onChange:I=>p(I.target.value),className:"w-[75%] bg-transparent border-solid border h-12 mr-4 rounded-md"}),Se.jsx("button",{type:"submit",className:"bg-blue-500 w-[20%] rounded-md",children:"Send"})]})})]})};function pU({users:r,user:s,showUser:c,setShowUser:d}){return Se.jsxs("div",{className:"h-screen w-72 items-center [transition:width_0.5s] bg-blue-950 z-[1]",children:[Se.jsx("button",{onClick:()=>d(!c),className:"h-fit w-full p-2 bg-slate-300  rounded-md mb-3",children:"Leave"}),r.map((p,_)=>Se.jsxs("div",{className:"text-white mt-1 text-center my-1",children:[p.name,s&&s.userID===p.userID&&" (You)"]},_*999)),Se.jsx("div",{id:"video-Player",className:"h-[200px] w-[200px] z-[2] "})]})}var ate={prefix:"far",iconName:"square",icon:[448,512,[9632,9723,9724,61590],"f0c8","M384 80c8.8 0 16 7.2 16 16V416c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16V96c0-8.8 7.2-16 16-16H384zM64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64z"]},cte={prefix:"far",iconName:"circle",icon:[512,512,[128308,128309,128992,128993,128994,128995,128996,9679,9898,9899,11044,61708,61915],"f111","M464 256A208 208 0 1 0 48 256a208 208 0 1 0 416 0zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256z"]};function lte({tool:r,setTool:s,chooseColor:c,setChooseColor:d,undo:p,redo:_,elements:g,history:R,mikeMuted:I,setMikeMuted:P}){const k={backgroundColor:c,display:"inline-block"};return Se.jsxs("nav",{className:"absolute flex flex-col items-center bg-[#F4DF4EFF] w-fit h-fit mt-5 ml-5 rounded-3xl",children:[Se.jsxs("div",{className:"p-3",children:[Se.jsx("input",{id:"inputColor",type:"color",name:"inputColor",value:c,onChange:L=>d(L.target.value),className:"rounded-[100%] w-6 h-6 ",style:{display:"none"}}),Se.jsx("label",{style:k,htmlFor:"inputColor",className:" w-6 h-6 rounded-xl"})]}),Se.jsx("div",{className:` ${r==="pencil"?"bg-[#00B1D2FF] rounded-lg":""} p-3  h-full `,children:Se.jsx($i,{icon:Jee,size:"lg",onClick:()=>s("pencil")})}),Se.jsx("div",{className:` ${r==="rect"?"bg-[#00B1D2FF] rounded-lg":""} p-3 h-full `,children:Se.jsx($i,{icon:ate,size:"lg",onClick:()=>s("rect")})}),Se.jsx("div",{className:` ${r==="line"?"bg-[#00B1D2FF] rounded-lg":""} p-3 h-full `,children:Se.jsx($i,{icon:Zee,size:"lg",onClick:()=>s("line")})}),Se.jsx("div",{className:` ${r==="oval"?"bg-[#00B1D2FF] rounded-lg":""} p-3 h-full `,children:Se.jsx($i,{icon:cte,size:"lg",onClick:()=>s("oval")})}),Se.jsx("div",{className:` ${r==="arrow"?"bg-[#00B1D2FF] rounded-lg":""} p-3 h-full `,children:Se.jsx($i,{icon:ote,size:"lg",onClick:()=>s("arrow")})}),Se.jsx("div",{className:` ${r==="move"?"bg-[#00B1D2FF] rounded-lg":""} p-3 h-full `,children:Se.jsx($i,{icon:nte,size:"lg",onClick:()=>s("move")})}),Se.jsx("button",{type:"button",className:" w-fit p-3",disabled:g.length===0,onClick:p,children:Se.jsx($i,{icon:tte})}),Se.jsx("button",{type:"button",className:"w-fit p-3",disabled:R.length<1,onClick:_,children:Se.jsx($i,{icon:ste})})]})}function dte({brushWidth:r,setBrushWidth:s,roughness:c,setRoughness:d,downloadCanvasAsImage:p,filleType:_,setFillType:g}){return Se.jsx("div",{className:" w-full absolute top-3 flex justify-center",children:Se.jsxs("div",{className:"flex w-fit bg-[#A2A2A1FF] p-2 rounded-xl",children:[Se.jsxs("div",{className:"flex flex-col text-center",children:["Brush Width",Se.jsx("input",{type:"range",min:1,max:5,value:r,onChange:R=>s(R.target.value),list:"markers"}),Se.jsxs("datalist",{id:"markers",children:[Se.jsx("option",{value:"1"}),Se.jsx("option",{value:"2"}),Se.jsx("option",{value:"3"}),Se.jsx("option",{value:"4"}),Se.jsx("option",{value:"5"})]})]}),Se.jsxs("div",{className:"flex flex-col text-center mx-4",children:["Brush Roughness",Se.jsx("input",{type:"range",min:0,max:3,step:.5,value:c,onChange:R=>d(R.target.value),list:"markers2"}),Se.jsxs("datalist",{id:"markers2",children:[Se.jsx("option",{value:"0"}),Se.jsx("option",{value:"0.5"}),Se.jsx("option",{value:"1"}),Se.jsx("option",{value:"1.5"}),Se.jsx("option",{value:"2"}),Se.jsx("option",{value:"2.5"}),Se.jsx("option",{value:"3"})]})]}),Se.jsxs("div",{className:"flex flex-col text-center mx-4",children:[Se.jsx($i,{icon:ite,onClick:p,id:"download",name:"download"}),Se.jsx("label",{htmlFor:"Download"})]}),Se.jsxs("div",{className:"flex flex-col text-center mx-4",children:[Se.jsx("label",{htmlFor:"filled",children:"Filled Type"}),Se.jsxs("select",{name:"filled",id:"filled",onChange:R=>g(R.target.value),children:[Se.jsx("option",{value:"none",children:"No Fill"}),Se.jsx("option",{value:"solid",children:"Solid"})]})]})]})})}function ute({user:r,socket:s,users:c,audioTracks:d,rtcClient:p,mikeMuted:_,setMikeMuted:g,leaveRoom:R}){const[I,P]=Ce.useState("pencil"),[k,L]=Ce.useState("#ffffff"),[x,H]=Ce.useState(!1),[K,ee]=Ce.useState(!1),[re,Y]=Ce.useState(!1),[F,z]=Ce.useState([]),[le,ge]=Ce.useState(1),[Z,fe]=Ce.useState(1),[ae,_e]=Ce.useState([]),[me,Ue]=Ce.useState([]),[Ve,lt]=Ce.useState("none"),Ge=Ce.useRef(null),Mt=Ce.useRef(null),Zt=Sw(),Ft=()=>{Mt.current=Ge.current.getContext("2d"),Mt.current.clearRect(0,0,window.innerWidth,window.innerHeight),z([])},xe=()=>{z(gt=>[...gt,ae[ae.length-1]]),_e(gt=>gt.slice(0,gt.length-1))},We=()=>{_e(gt=>[...gt,F[F.length-1]]),z(gt=>gt.slice(0,gt.length-1))},ct=()=>{Zt("/"),s.disconnect(r),R()};return Se.jsxs("div",{className:"bg-[#00203FFF]",children:[Se.jsx("div",{className:"w-full flex justify-center bottom-6 absolute",children:Se.jsxs("nav",{className:"bg-[#ADEFD1FF] rounded-xl p-3 w-fit h-fit flex z-[2]",children:[Se.jsxs("div",{className:"mx-3",children:[Se.jsx($i,{icon:$ee,onClick:()=>H(!x),size:"2x",className:"relative"}),Se.jsx("div",{className:"absolute ml-7 bg-slate-600 px-2 rounded-[100%] top-0",children:c.length})]}),Se.jsx("div",{className:"message ml-7 mr-3",children:Se.jsx($i,{icon:Qee,size:"2x",onClick:ct,color:"red"})}),Se.jsx("div",{className:`${_?"bg-red-600  rounded-full":""} bg-[{}] message ml-7 mr-3 `,children:Se.jsx($i,{icon:Xee,size:"lg",onClick:()=>g(!_),className:"p-2"})}),Se.jsx("div",{className:"message ml-7 mr-3",children:Se.jsx($i,{icon:qee,size:"2x",onClick:()=>ee(!K)})}),Se.jsx("div",{className:"clearcanvasm mx-3",children:Se.jsx("input",{type:"button",value:"Clear Canvas",onClick:Ft,className:"p-2 bg-[linear-gradient(145deg,_#B94800,_#F36000)] rounded-lg [box-shadow:inset_9.91px_9.91px_15px_#C34C00,_inset_-9.91px_-9.91px_15px_#E95C00]"})})]})}),(r==null?void 0:r.presenter)&&Se.jsx(dte,{brushWidth:le,setBrushWidth:ge,roughness:Z,setRoughness:fe,downloadCanvasAsImage:X$,fillType:Ve,setFillType:lt}),(r==null?void 0:r.presenter)&&Se.jsx(lte,{tool:I,setTool:P,chooseColor:k,setChooseColor:L,clearCanvas:Ft,redo:xe,undo:We,elements:F,history:ae,mikeMuted:_,setMikeMuted:g}),Se.jsx("div",{className:"w-full h-screen",children:Se.jsx(J$,{color:k,tool:I,user:r,socket:s,canvasRef:Ge,elements:F,setElements:z,brushWidth:le,roughness:Z,selectedFile:me,filled:re,fillType:Ve})}),x?Se.jsx("div",{className:"visible absolute right-2 top-0",children:Se.jsx(pU,{users:c,user:r,showUser:x,setShowUser:H})}):Se.jsx("div",{className:"invisible absolute right-2 top-0",children:Se.jsx(pU,{users:c,user:r,showUser:x,setShowUser:H})}),K?Se.jsx("div",{className:"absolute right-2 top-0 [transition:width_0.5s]",children:Se.jsx(hU,{isMessage:K,setIsMessage:ee,socket:s})}):Se.jsx("div",{className:"absolute right-2 hidden top-0 [transition:width_0.5s]",children:Se.jsx(hU,{isMessage:K,setIsMessage:ee,socket:s})})]})}const Qo=Object.create(null);Qo.open="0";Qo.close="1";Qo.ping="2";Qo.pong="3";Qo.message="4";Qo.upgrade="5";Qo.noop="6";const Tg=Object.create(null);Object.keys(Qo).forEach(r=>{Tg[Qo[r]]=r});const mI={type:"error",data:"parser error"},W3=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",H3=typeof ArrayBuffer=="function",K3=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer,xw=({type:r,data:s},c,d)=>W3&&s instanceof Blob?c?d(s):fU(s,d):H3&&(s instanceof ArrayBuffer||K3(s))?c?d(s):fU(new Blob([s]),d):d(Qo[r]+(s||"")),fU=(r,s)=>{const c=new FileReader;return c.onload=function(){const d=c.result.split(",")[1];s("b"+(d||""))},c.readAsDataURL(r)};function mU(r){return r instanceof Uint8Array?r:r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer,r.byteOffset,r.byteLength)}let ZR;function hte(r,s){if(W3&&r.data instanceof Blob)return r.data.arrayBuffer().then(mU).then(s);if(H3&&(r.data instanceof ArrayBuffer||K3(r.data)))return s(mU(r.data));xw(r,!1,c=>{ZR||(ZR=new TextEncoder),s(ZR.encode(c))})}const _U="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",of=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let r=0;r<_U.length;r++)of[_U.charCodeAt(r)]=r;const pte=r=>{let s=r.length*.75,c=r.length,d,p=0,_,g,R,I;r[r.length-1]==="="&&(s--,r[r.length-2]==="="&&s--);const P=new ArrayBuffer(s),k=new Uint8Array(P);for(d=0;d<c;d+=4)_=of[r.charCodeAt(d)],g=of[r.charCodeAt(d+1)],R=of[r.charCodeAt(d+2)],I=of[r.charCodeAt(d+3)],k[p++]=_<<2|g>>4,k[p++]=(g&15)<<4|R>>2,k[p++]=(R&3)<<6|I&63;return P},fte=typeof ArrayBuffer=="function",Uw=(r,s)=>{if(typeof r!="string")return{type:"message",data:z3(r,s)};const c=r.charAt(0);return c==="b"?{type:"message",data:mte(r.substring(1),s)}:Tg[c]?r.length>1?{type:Tg[c],data:r.substring(1)}:{type:Tg[c]}:mI},mte=(r,s)=>{if(fte){const c=pte(r);return z3(c,s)}else return{base64:!0,data:r}},z3=(r,s)=>{switch(s){case"blob":return r instanceof Blob?r:new Blob([r]);case"arraybuffer":default:return r instanceof ArrayBuffer?r:r.buffer}},Y3="",_te=(r,s)=>{const c=r.length,d=new Array(c);let p=0;r.forEach((_,g)=>{xw(_,!1,R=>{d[g]=R,++p===c&&s(d.join(Y3))})})},Ete=(r,s)=>{const c=r.split(Y3),d=[];for(let p=0;p<c.length;p++){const _=Uw(c[p],s);if(d.push(_),_.type==="error")break}return d};function gte(){return new TransformStream({transform(r,s){hte(r,c=>{const d=c.length;let p;if(d<126)p=new Uint8Array(1),new DataView(p.buffer).setUint8(0,d);else if(d<65536){p=new Uint8Array(3);const _=new DataView(p.buffer);_.setUint8(0,126),_.setUint16(1,d)}else{p=new Uint8Array(9);const _=new DataView(p.buffer);_.setUint8(0,127),_.setBigUint64(1,BigInt(d))}r.data&&typeof r.data!="string"&&(p[0]|=128),s.enqueue(p),s.enqueue(c)})}})}let eC;function eg(r){return r.reduce((s,c)=>s+c.length,0)}function tg(r,s){if(r[0].length===s)return r.shift();const c=new Uint8Array(s);let d=0;for(let p=0;p<s;p++)c[p]=r[0][d++],d===r[0].length&&(r.shift(),d=0);return r.length&&d<r[0].length&&(r[0]=r[0].slice(d)),c}function vte(r,s){eC||(eC=new TextDecoder);const c=[];let d=0,p=-1,_=!1;return new TransformStream({transform(g,R){for(c.push(g);;){if(d===0){if(eg(c)<1)break;const I=tg(c,1);_=(I[0]&128)===128,p=I[0]&127,p<126?d=3:p===126?d=1:d=2}else if(d===1){if(eg(c)<2)break;const I=tg(c,2);p=new DataView(I.buffer,I.byteOffset,I.length).getUint16(0),d=3}else if(d===2){if(eg(c)<8)break;const I=tg(c,8),P=new DataView(I.buffer,I.byteOffset,I.length),k=P.getUint32(0);if(k>Math.pow(2,21)-1){R.enqueue(mI);break}p=k*Math.pow(2,32)+P.getUint32(4),d=3}else{if(eg(c)<p)break;const I=tg(c,p);R.enqueue(Uw(_?I:eC.decode(I),s)),d=0}if(p===0||p>r){R.enqueue(mI);break}}}})}const q3=4;function Di(r){if(r)return Ste(r)}function Ste(r){for(var s in Di.prototype)r[s]=Di.prototype[s];return r}Di.prototype.on=Di.prototype.addEventListener=function(r,s){return this._callbacks=this._callbacks||{},(this._callbacks["$"+r]=this._callbacks["$"+r]||[]).push(s),this};Di.prototype.once=function(r,s){function c(){this.off(r,c),s.apply(this,arguments)}return c.fn=s,this.on(r,c),this};Di.prototype.off=Di.prototype.removeListener=Di.prototype.removeAllListeners=Di.prototype.removeEventListener=function(r,s){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var c=this._callbacks["$"+r];if(!c)return this;if(arguments.length==1)return delete this._callbacks["$"+r],this;for(var d,p=0;p<c.length;p++)if(d=c[p],d===s||d.fn===s){c.splice(p,1);break}return c.length===0&&delete this._callbacks["$"+r],this};Di.prototype.emit=function(r){this._callbacks=this._callbacks||{};for(var s=new Array(arguments.length-1),c=this._callbacks["$"+r],d=1;d<arguments.length;d++)s[d-1]=arguments[d];if(c){c=c.slice(0);for(var d=0,p=c.length;d<p;++d)c[d].apply(this,s)}return this};Di.prototype.emitReserved=Di.prototype.emit;Di.prototype.listeners=function(r){return this._callbacks=this._callbacks||{},this._callbacks["$"+r]||[]};Di.prototype.hasListeners=function(r){return!!this.listeners(r).length};const zs=typeof self<"u"?self:typeof window<"u"?window:Function("return this")();function J3(r,...s){return s.reduce((c,d)=>(r.hasOwnProperty(d)&&(c[d]=r[d]),c),{})}const Tte=zs.setTimeout,yte=zs.clearTimeout;function Dv(r,s){s.useNativeTimers?(r.setTimeoutFn=Tte.bind(zs),r.clearTimeoutFn=yte.bind(zs)):(r.setTimeoutFn=zs.setTimeout.bind(zs),r.clearTimeoutFn=zs.clearTimeout.bind(zs))}const Rte=1.33;function Cte(r){return typeof r=="string"?Ite(r):Math.ceil((r.byteLength||r.size)*Rte)}function Ite(r){let s=0,c=0;for(let d=0,p=r.length;d<p;d++)s=r.charCodeAt(d),s<128?c+=1:s<2048?c+=2:s<55296||s>=57344?c+=3:(d++,c+=4);return c}function wte(r){let s="";for(let c in r)r.hasOwnProperty(c)&&(s.length&&(s+="&"),s+=encodeURIComponent(c)+"="+encodeURIComponent(r[c]));return s}function bte(r){let s={},c=r.split("&");for(let d=0,p=c.length;d<p;d++){let _=c[d].split("=");s[decodeURIComponent(_[0])]=decodeURIComponent(_[1])}return s}class Ate extends Error{constructor(s,c,d){super(s),this.description=c,this.context=d,this.type="TransportError"}}class Vw extends Di{constructor(s){super(),this.writable=!1,Dv(this,s),this.opts=s,this.query=s.query,this.socket=s.socket}onError(s,c,d){return super.emitReserved("error",new Ate(s,c,d)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(s){this.readyState==="open"&&this.write(s)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(s){const c=Uw(s,this.socket.binaryType);this.onPacket(c)}onPacket(s){super.emitReserved("packet",s)}onClose(s){this.readyState="closed",super.emitReserved("close",s)}pause(s){}createUri(s,c={}){return s+"://"+this._hostname()+this._port()+this.opts.path+this._query(c)}_hostname(){const s=this.opts.hostname;return s.indexOf(":")===-1?s:"["+s+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(s){const c=wte(s);return c.length?"?"+c:""}}const X3="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),_I=64,Ote={};let EU=0,ng=0,gU;function vU(r){let s="";do s=X3[r%_I]+s,r=Math.floor(r/_I);while(r>0);return s}function Q3(){const r=vU(+new Date);return r!==gU?(EU=0,gU=r):r+"."+vU(EU++)}for(;ng<_I;ng++)Ote[X3[ng]]=ng;let $3=!1;try{$3=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Nte=$3;function Z3(r){const s=r.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!s||Nte))return new XMLHttpRequest}catch{}if(!s)try{return new zs[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function Pte(){}const Dte=function(){return new Z3({xdomain:!1}).responseType!=null}();class kte extends Vw{constructor(s){if(super(s),this.polling=!1,typeof location<"u"){const d=location.protocol==="https:";let p=location.port;p||(p=d?"443":"80"),this.xd=typeof location<"u"&&s.hostname!==location.hostname||p!==s.port}const c=s&&s.forceBase64;this.supportsBinary=Dte&&!c,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(s){this.readyState="pausing";const c=()=>{this.readyState="paused",s()};if(this.polling||!this.writable){let d=0;this.polling&&(d++,this.once("pollComplete",function(){--d||c()})),this.writable||(d++,this.once("drain",function(){--d||c()}))}else c()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(s){const c=d=>{if(this.readyState==="opening"&&d.type==="open"&&this.onOpen(),d.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(d)};Ete(s,this.socket.binaryType).forEach(c),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const s=()=>{this.write([{type:"close"}])};this.readyState==="open"?s():this.once("open",s)}write(s){this.writable=!1,_te(s,c=>{this.doWrite(c,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const s=this.opts.secure?"https":"http",c=this.query||{};return this.opts.timestampRequests!==!1&&(c[this.opts.timestampParam]=Q3()),!this.supportsBinary&&!c.sid&&(c.b64=1),this.createUri(s,c)}request(s={}){return Object.assign(s,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new Qu(this.uri(),s)}doWrite(s,c){const d=this.request({method:"POST",data:s});d.on("success",c),d.on("error",(p,_)=>{this.onError("xhr post error",p,_)})}doPoll(){const s=this.request();s.on("data",this.onData.bind(this)),s.on("error",(c,d)=>{this.onError("xhr poll error",c,d)}),this.pollXhr=s}}let Qu=class yg extends Di{constructor(s,c){super(),Dv(this,c),this.opts=c,this.method=c.method||"GET",this.uri=s,this.data=c.data!==void 0?c.data:null,this.create()}create(){var s;const c=J3(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");c.xdomain=!!this.opts.xd;const d=this.xhr=new Z3(c);try{d.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){d.setDisableHeaderCheck&&d.setDisableHeaderCheck(!0);for(let p in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(p)&&d.setRequestHeader(p,this.opts.extraHeaders[p])}}catch{}if(this.method==="POST")try{d.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{d.setRequestHeader("Accept","*/*")}catch{}(s=this.opts.cookieJar)===null||s===void 0||s.addCookies(d),"withCredentials"in d&&(d.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(d.timeout=this.opts.requestTimeout),d.onreadystatechange=()=>{var p;d.readyState===3&&((p=this.opts.cookieJar)===null||p===void 0||p.parseCookies(d)),d.readyState===4&&(d.status===200||d.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof d.status=="number"?d.status:0)},0))},d.send(this.data)}catch(p){this.setTimeoutFn(()=>{this.onError(p)},0);return}typeof document<"u"&&(this.index=yg.requestsCount++,yg.requests[this.index]=this)}onError(s){this.emitReserved("error",s,this.xhr),this.cleanup(!0)}cleanup(s){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=Pte,s)try{this.xhr.abort()}catch{}typeof document<"u"&&delete yg.requests[this.index],this.xhr=null}}onLoad(){const s=this.xhr.responseText;s!==null&&(this.emitReserved("data",s),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}};Qu.requestsCount=0;Qu.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",SU);else if(typeof addEventListener=="function"){const r="onpagehide"in zs?"pagehide":"unload";addEventListener(r,SU,!1)}}function SU(){for(let r in Qu.requests)Qu.requests.hasOwnProperty(r)&&Qu.requests[r].abort()}const Fw=typeof Promise=="function"&&typeof Promise.resolve=="function"?s=>Promise.resolve().then(s):(s,c)=>c(s,0),ig=zs.WebSocket||zs.MozWebSocket,TU=!0,Lte="arraybuffer",yU=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Mte extends Vw{constructor(s){super(s),this.supportsBinary=!s.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const s=this.uri(),c=this.opts.protocols,d=yU?{}:J3(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(d.headers=this.opts.extraHeaders);try{this.ws=TU&&!yU?c?new ig(s,c):new ig(s):new ig(s,c,d)}catch(p){return this.emitReserved("error",p)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=s=>this.onClose({description:"websocket connection closed",context:s}),this.ws.onmessage=s=>this.onData(s.data),this.ws.onerror=s=>this.onError("websocket error",s)}write(s){this.writable=!1;for(let c=0;c<s.length;c++){const d=s[c],p=c===s.length-1;xw(d,this.supportsBinary,_=>{const g={};try{TU&&this.ws.send(_)}catch{}p&&Fw(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const s=this.opts.secure?"wss":"ws",c=this.query||{};return this.opts.timestampRequests&&(c[this.opts.timestampParam]=Q3()),this.supportsBinary||(c.b64=1),this.createUri(s,c)}check(){return!!ig}}class xte extends Vw{get name(){return"webtransport"}doOpen(){typeof WebTransport=="function"&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(s=>{this.onError("webtransport error",s)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(s=>{const c=vte(Number.MAX_SAFE_INTEGER,this.socket.binaryType),d=s.readable.pipeThrough(c).getReader(),p=gte();p.readable.pipeTo(s.writable),this.writer=p.writable.getWriter();const _=()=>{d.read().then(({done:R,value:I})=>{R||(this.onPacket(I),_())}).catch(R=>{})};_();const g={type:"open"};this.query.sid&&(g.data=`{"sid":"${this.query.sid}"}`),this.writer.write(g).then(()=>this.onOpen())})}))}write(s){this.writable=!1;for(let c=0;c<s.length;c++){const d=s[c],p=c===s.length-1;this.writer.write(d).then(()=>{p&&Fw(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var s;(s=this.transport)===null||s===void 0||s.close()}}const Ute={websocket:Mte,webtransport:xte,polling:kte},Vte=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Fte=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function EI(r){if(r.length>2e3)throw"URI too long";const s=r,c=r.indexOf("["),d=r.indexOf("]");c!=-1&&d!=-1&&(r=r.substring(0,c)+r.substring(c,d).replace(/:/g,";")+r.substring(d,r.length));let p=Vte.exec(r||""),_={},g=14;for(;g--;)_[Fte[g]]=p[g]||"";return c!=-1&&d!=-1&&(_.source=s,_.host=_.host.substring(1,_.host.length-1).replace(/;/g,":"),_.authority=_.authority.replace("[","").replace("]","").replace(/;/g,":"),_.ipv6uri=!0),_.pathNames=jte(_,_.path),_.queryKey=Bte(_,_.query),_}function jte(r,s){const c=/\/{2,9}/g,d=s.replace(c,"/").split("/");return(s.slice(0,1)=="/"||s.length===0)&&d.splice(0,1),s.slice(-1)=="/"&&d.splice(d.length-1,1),d}function Bte(r,s){const c={};return s.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(d,p,_){p&&(c[p]=_)}),c}let ej=class Au extends Di{constructor(s,c={}){super(),this.binaryType=Lte,this.writeBuffer=[],s&&typeof s=="object"&&(c=s,s=null),s?(s=EI(s),c.hostname=s.host,c.secure=s.protocol==="https"||s.protocol==="wss",c.port=s.port,s.query&&(c.query=s.query)):c.host&&(c.hostname=EI(c.host).host),Dv(this,c),this.secure=c.secure!=null?c.secure:typeof location<"u"&&location.protocol==="https:",c.hostname&&!c.port&&(c.port=this.secure?"443":"80"),this.hostname=c.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=c.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=c.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},c),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=bte(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(s){const c=Object.assign({},this.opts.query);c.EIO=q3,c.transport=s,this.id&&(c.sid=this.id);const d=Object.assign({},this.opts,{query:c,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[s]);return new Ute[s](d)}open(){let s;if(this.opts.rememberUpgrade&&Au.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)s="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else s=this.transports[0];this.readyState="opening";try{s=this.createTransport(s)}catch{this.transports.shift(),this.open();return}s.open(),this.setTransport(s)}setTransport(s){this.transport&&this.transport.removeAllListeners(),this.transport=s,s.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",c=>this.onClose("transport close",c))}probe(s){let c=this.createTransport(s),d=!1;Au.priorWebsocketSuccess=!1;const p=()=>{d||(c.send([{type:"ping",data:"probe"}]),c.once("packet",L=>{if(!d)if(L.type==="pong"&&L.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",c),!c)return;Au.priorWebsocketSuccess=c.name==="websocket",this.transport.pause(()=>{d||this.readyState!=="closed"&&(k(),this.setTransport(c),c.send([{type:"upgrade"}]),this.emitReserved("upgrade",c),c=null,this.upgrading=!1,this.flush())})}else{const x=new Error("probe error");x.transport=c.name,this.emitReserved("upgradeError",x)}}))};function _(){d||(d=!0,k(),c.close(),c=null)}const g=L=>{const x=new Error("probe error: "+L);x.transport=c.name,_(),this.emitReserved("upgradeError",x)};function R(){g("transport closed")}function I(){g("socket closed")}function P(L){c&&L.name!==c.name&&_()}const k=()=>{c.removeListener("open",p),c.removeListener("error",g),c.removeListener("close",R),this.off("close",I),this.off("upgrading",P)};c.once("open",p),c.once("error",g),c.once("close",R),this.once("close",I),this.once("upgrading",P),this.upgrades.indexOf("webtransport")!==-1&&s!=="webtransport"?this.setTimeoutFn(()=>{d||c.open()},200):c.open()}onOpen(){if(this.readyState="open",Au.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let s=0;const c=this.upgrades.length;for(;s<c;s++)this.probe(this.upgrades[s])}}onPacket(s){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",s),this.emitReserved("heartbeat"),this.resetPingTimeout(),s.type){case"open":this.onHandshake(JSON.parse(s.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const c=new Error("server error");c.code=s.data,this.onError(c);break;case"message":this.emitReserved("data",s.data),this.emitReserved("message",s.data);break}}onHandshake(s){this.emitReserved("handshake",s),this.id=s.sid,this.transport.query.sid=s.sid,this.upgrades=this.filterUpgrades(s.upgrades),this.pingInterval=s.pingInterval,this.pingTimeout=s.pingTimeout,this.maxPayload=s.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const s=this.getWritablePackets();this.transport.send(s),this.prevBufferLen=s.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let c=1;for(let d=0;d<this.writeBuffer.length;d++){const p=this.writeBuffer[d].data;if(p&&(c+=Cte(p)),d>0&&c>this.maxPayload)return this.writeBuffer.slice(0,d);c+=2}return this.writeBuffer}write(s,c,d){return this.sendPacket("message",s,c,d),this}send(s,c,d){return this.sendPacket("message",s,c,d),this}sendPacket(s,c,d,p){if(typeof c=="function"&&(p=c,c=void 0),typeof d=="function"&&(p=d,d=null),this.readyState==="closing"||this.readyState==="closed")return;d=d||{},d.compress=d.compress!==!1;const _={type:s,data:c,options:d};this.emitReserved("packetCreate",_),this.writeBuffer.push(_),p&&this.once("flush",p),this.flush()}close(){const s=()=>{this.onClose("forced close"),this.transport.close()},c=()=>{this.off("upgrade",c),this.off("upgradeError",c),s()},d=()=>{this.once("upgrade",c),this.once("upgradeError",c)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?d():s()}):this.upgrading?d():s()),this}onError(s){Au.priorWebsocketSuccess=!1,this.emitReserved("error",s),this.onClose("transport error",s)}onClose(s,c){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",s,c),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(s){const c=[];let d=0;const p=s.length;for(;d<p;d++)~this.transports.indexOf(s[d])&&c.push(s[d]);return c}};ej.protocol=q3;function Gte(r,s="",c){let d=r;c=c||typeof location<"u"&&location,r==null&&(r=c.protocol+"//"+c.host),typeof r=="string"&&(r.charAt(0)==="/"&&(r.charAt(1)==="/"?r=c.protocol+r:r=c.host+r),/^(https?|wss?):\/\//.test(r)||(typeof c<"u"?r=c.protocol+"//"+r:r="https://"+r),d=EI(r)),d.port||(/^(http|ws)$/.test(d.protocol)?d.port="80":/^(http|ws)s$/.test(d.protocol)&&(d.port="443")),d.path=d.path||"/";const _=d.host.indexOf(":")!==-1?"["+d.host+"]":d.host;return d.id=d.protocol+"://"+_+":"+d.port+s,d.href=d.protocol+"://"+_+(c&&c.port===d.port?"":":"+d.port),d}const Wte=typeof ArrayBuffer=="function",Hte=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r.buffer instanceof ArrayBuffer,tj=Object.prototype.toString,Kte=typeof Blob=="function"||typeof Blob<"u"&&tj.call(Blob)==="[object BlobConstructor]",zte=typeof File=="function"||typeof File<"u"&&tj.call(File)==="[object FileConstructor]";function jw(r){return Wte&&(r instanceof ArrayBuffer||Hte(r))||Kte&&r instanceof Blob||zte&&r instanceof File}function Rg(r,s){if(!r||typeof r!="object")return!1;if(Array.isArray(r)){for(let c=0,d=r.length;c<d;c++)if(Rg(r[c]))return!0;return!1}if(jw(r))return!0;if(r.toJSON&&typeof r.toJSON=="function"&&arguments.length===1)return Rg(r.toJSON(),!0);for(const c in r)if(Object.prototype.hasOwnProperty.call(r,c)&&Rg(r[c]))return!0;return!1}function Yte(r){const s=[],c=r.data,d=r;return d.data=gI(c,s),d.attachments=s.length,{packet:d,buffers:s}}function gI(r,s){if(!r)return r;if(jw(r)){const c={_placeholder:!0,num:s.length};return s.push(r),c}else if(Array.isArray(r)){const c=new Array(r.length);for(let d=0;d<r.length;d++)c[d]=gI(r[d],s);return c}else if(typeof r=="object"&&!(r instanceof Date)){const c={};for(const d in r)Object.prototype.hasOwnProperty.call(r,d)&&(c[d]=gI(r[d],s));return c}return r}function qte(r,s){return r.data=vI(r.data,s),delete r.attachments,r}function vI(r,s){if(!r)return r;if(r&&r._placeholder===!0){if(typeof r.num=="number"&&r.num>=0&&r.num<s.length)return s[r.num];throw new Error("illegal attachments")}else if(Array.isArray(r))for(let c=0;c<r.length;c++)r[c]=vI(r[c],s);else if(typeof r=="object")for(const c in r)Object.prototype.hasOwnProperty.call(r,c)&&(r[c]=vI(r[c],s));return r}const Jte=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Xte=5;var qt;(function(r){r[r.CONNECT=0]="CONNECT",r[r.DISCONNECT=1]="DISCONNECT",r[r.EVENT=2]="EVENT",r[r.ACK=3]="ACK",r[r.CONNECT_ERROR=4]="CONNECT_ERROR",r[r.BINARY_EVENT=5]="BINARY_EVENT",r[r.BINARY_ACK=6]="BINARY_ACK"})(qt||(qt={}));class Qte{constructor(s){this.replacer=s}encode(s){return(s.type===qt.EVENT||s.type===qt.ACK)&&Rg(s)?this.encodeAsBinary({type:s.type===qt.EVENT?qt.BINARY_EVENT:qt.BINARY_ACK,nsp:s.nsp,data:s.data,id:s.id}):[this.encodeAsString(s)]}encodeAsString(s){let c=""+s.type;return(s.type===qt.BINARY_EVENT||s.type===qt.BINARY_ACK)&&(c+=s.attachments+"-"),s.nsp&&s.nsp!=="/"&&(c+=s.nsp+","),s.id!=null&&(c+=s.id),s.data!=null&&(c+=JSON.stringify(s.data,this.replacer)),c}encodeAsBinary(s){const c=Yte(s),d=this.encodeAsString(c.packet),p=c.buffers;return p.unshift(d),p}}function RU(r){return Object.prototype.toString.call(r)==="[object Object]"}class Bw extends Di{constructor(s){super(),this.reviver=s}add(s){let c;if(typeof s=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");c=this.decodeString(s);const d=c.type===qt.BINARY_EVENT;d||c.type===qt.BINARY_ACK?(c.type=d?qt.EVENT:qt.ACK,this.reconstructor=new $te(c),c.attachments===0&&super.emitReserved("decoded",c)):super.emitReserved("decoded",c)}else if(jw(s)||s.base64)if(this.reconstructor)c=this.reconstructor.takeBinaryData(s),c&&(this.reconstructor=null,super.emitReserved("decoded",c));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+s)}decodeString(s){let c=0;const d={type:Number(s.charAt(0))};if(qt[d.type]===void 0)throw new Error("unknown packet type "+d.type);if(d.type===qt.BINARY_EVENT||d.type===qt.BINARY_ACK){const _=c+1;for(;s.charAt(++c)!=="-"&&c!=s.length;);const g=s.substring(_,c);if(g!=Number(g)||s.charAt(c)!=="-")throw new Error("Illegal attachments");d.attachments=Number(g)}if(s.charAt(c+1)==="/"){const _=c+1;for(;++c&&!(s.charAt(c)===","||c===s.length););d.nsp=s.substring(_,c)}else d.nsp="/";const p=s.charAt(c+1);if(p!==""&&Number(p)==p){const _=c+1;for(;++c;){const g=s.charAt(c);if(g==null||Number(g)!=g){--c;break}if(c===s.length)break}d.id=Number(s.substring(_,c+1))}if(s.charAt(++c)){const _=this.tryParse(s.substr(c));if(Bw.isPayloadValid(d.type,_))d.data=_;else throw new Error("invalid payload")}return d}tryParse(s){try{return JSON.parse(s,this.reviver)}catch{return!1}}static isPayloadValid(s,c){switch(s){case qt.CONNECT:return RU(c);case qt.DISCONNECT:return c===void 0;case qt.CONNECT_ERROR:return typeof c=="string"||RU(c);case qt.EVENT:case qt.BINARY_EVENT:return Array.isArray(c)&&(typeof c[0]=="number"||typeof c[0]=="string"&&Jte.indexOf(c[0])===-1);case qt.ACK:case qt.BINARY_ACK:return Array.isArray(c)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class $te{constructor(s){this.packet=s,this.buffers=[],this.reconPack=s}takeBinaryData(s){if(this.buffers.push(s),this.buffers.length===this.reconPack.attachments){const c=qte(this.reconPack,this.buffers);return this.finishedReconstruction(),c}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Zte=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Bw,Encoder:Qte,get PacketType(){return qt},protocol:Xte},Symbol.toStringTag,{value:"Module"}));function Eo(r,s,c){return r.on(s,c),function(){r.off(s,c)}}const ene=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class nj extends Di{constructor(s,c,d){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=s,this.nsp=c,d&&d.auth&&(this.auth=d.auth),this._opts=Object.assign({},d),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const s=this.io;this.subs=[Eo(s,"open",this.onopen.bind(this)),Eo(s,"packet",this.onpacket.bind(this)),Eo(s,"error",this.onerror.bind(this)),Eo(s,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...s){return s.unshift("message"),this.emit.apply(this,s),this}emit(s,...c){if(ene.hasOwnProperty(s))throw new Error('"'+s.toString()+'" is a reserved event name');if(c.unshift(s),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(c),this;const d={type:qt.EVENT,data:c};if(d.options={},d.options.compress=this.flags.compress!==!1,typeof c[c.length-1]=="function"){const g=this.ids++,R=c.pop();this._registerAckCallback(g,R),d.id=g}const p=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!p||!this.connected)||(this.connected?(this.notifyOutgoingListeners(d),this.packet(d)):this.sendBuffer.push(d)),this.flags={},this}_registerAckCallback(s,c){var d;const p=(d=this.flags.timeout)!==null&&d!==void 0?d:this._opts.ackTimeout;if(p===void 0){this.acks[s]=c;return}const _=this.io.setTimeoutFn(()=>{delete this.acks[s];for(let g=0;g<this.sendBuffer.length;g++)this.sendBuffer[g].id===s&&this.sendBuffer.splice(g,1);c.call(this,new Error("operation has timed out"))},p);this.acks[s]=(...g)=>{this.io.clearTimeoutFn(_),c.apply(this,[null,...g])}}emitWithAck(s,...c){const d=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((p,_)=>{c.push((g,R)=>d?g?_(g):p(R):p(g)),this.emit(s,...c)})}_addToQueue(s){let c;typeof s[s.length-1]=="function"&&(c=s.pop());const d={id:this._queueSeq++,tryCount:0,pending:!1,args:s,flags:Object.assign({fromQueue:!0},this.flags)};s.push((p,..._)=>d!==this._queue[0]?void 0:(p!==null?d.tryCount>this._opts.retries&&(this._queue.shift(),c&&c(p)):(this._queue.shift(),c&&c(null,..._)),d.pending=!1,this._drainQueue())),this._queue.push(d),this._drainQueue()}_drainQueue(s=!1){if(!this.connected||this._queue.length===0)return;const c=this._queue[0];c.pending&&!s||(c.pending=!0,c.tryCount++,this.flags=c.flags,this.emit.apply(this,c.args))}packet(s){s.nsp=this.nsp,this.io._packet(s)}onopen(){typeof this.auth=="function"?this.auth(s=>{this._sendConnectPacket(s)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(s){this.packet({type:qt.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},s):s})}onerror(s){this.connected||this.emitReserved("connect_error",s)}onclose(s,c){this.connected=!1,delete this.id,this.emitReserved("disconnect",s,c)}onpacket(s){if(s.nsp===this.nsp)switch(s.type){case qt.CONNECT:s.data&&s.data.sid?this.onconnect(s.data.sid,s.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case qt.EVENT:case qt.BINARY_EVENT:this.onevent(s);break;case qt.ACK:case qt.BINARY_ACK:this.onack(s);break;case qt.DISCONNECT:this.ondisconnect();break;case qt.CONNECT_ERROR:this.destroy();const d=new Error(s.data.message);d.data=s.data.data,this.emitReserved("connect_error",d);break}}onevent(s){const c=s.data||[];s.id!=null&&c.push(this.ack(s.id)),this.connected?this.emitEvent(c):this.receiveBuffer.push(Object.freeze(c))}emitEvent(s){if(this._anyListeners&&this._anyListeners.length){const c=this._anyListeners.slice();for(const d of c)d.apply(this,s)}super.emit.apply(this,s),this._pid&&s.length&&typeof s[s.length-1]=="string"&&(this._lastOffset=s[s.length-1])}ack(s){const c=this;let d=!1;return function(...p){d||(d=!0,c.packet({type:qt.ACK,id:s,data:p}))}}onack(s){const c=this.acks[s.id];typeof c=="function"&&(c.apply(this,s.data),delete this.acks[s.id])}onconnect(s,c){this.id=s,this.recovered=c&&this._pid===c,this._pid=c,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(s=>this.emitEvent(s)),this.receiveBuffer=[],this.sendBuffer.forEach(s=>{this.notifyOutgoingListeners(s),this.packet(s)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(s=>s()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:qt.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(s){return this.flags.compress=s,this}get volatile(){return this.flags.volatile=!0,this}timeout(s){return this.flags.timeout=s,this}onAny(s){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(s),this}prependAny(s){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(s),this}offAny(s){if(!this._anyListeners)return this;if(s){const c=this._anyListeners;for(let d=0;d<c.length;d++)if(s===c[d])return c.splice(d,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(s){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(s),this}prependAnyOutgoing(s){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(s),this}offAnyOutgoing(s){if(!this._anyOutgoingListeners)return this;if(s){const c=this._anyOutgoingListeners;for(let d=0;d<c.length;d++)if(s===c[d])return c.splice(d,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(s){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const c=this._anyOutgoingListeners.slice();for(const d of c)d.apply(this,s.data)}}}function hh(r){r=r||{},this.ms=r.min||100,this.max=r.max||1e4,this.factor=r.factor||2,this.jitter=r.jitter>0&&r.jitter<=1?r.jitter:0,this.attempts=0}hh.prototype.duration=function(){var r=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var s=Math.random(),c=Math.floor(s*this.jitter*r);r=Math.floor(s*10)&1?r+c:r-c}return Math.min(r,this.max)|0};hh.prototype.reset=function(){this.attempts=0};hh.prototype.setMin=function(r){this.ms=r};hh.prototype.setMax=function(r){this.max=r};hh.prototype.setJitter=function(r){this.jitter=r};class SI extends Di{constructor(s,c){var d;super(),this.nsps={},this.subs=[],s&&typeof s=="object"&&(c=s,s=void 0),c=c||{},c.path=c.path||"/socket.io",this.opts=c,Dv(this,c),this.reconnection(c.reconnection!==!1),this.reconnectionAttempts(c.reconnectionAttempts||1/0),this.reconnectionDelay(c.reconnectionDelay||1e3),this.reconnectionDelayMax(c.reconnectionDelayMax||5e3),this.randomizationFactor((d=c.randomizationFactor)!==null&&d!==void 0?d:.5),this.backoff=new hh({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(c.timeout==null?2e4:c.timeout),this._readyState="closed",this.uri=s;const p=c.parser||Zte;this.encoder=new p.Encoder,this.decoder=new p.Decoder,this._autoConnect=c.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(s){return arguments.length?(this._reconnection=!!s,this):this._reconnection}reconnectionAttempts(s){return s===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=s,this)}reconnectionDelay(s){var c;return s===void 0?this._reconnectionDelay:(this._reconnectionDelay=s,(c=this.backoff)===null||c===void 0||c.setMin(s),this)}randomizationFactor(s){var c;return s===void 0?this._randomizationFactor:(this._randomizationFactor=s,(c=this.backoff)===null||c===void 0||c.setJitter(s),this)}reconnectionDelayMax(s){var c;return s===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=s,(c=this.backoff)===null||c===void 0||c.setMax(s),this)}timeout(s){return arguments.length?(this._timeout=s,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(s){if(~this._readyState.indexOf("open"))return this;this.engine=new ej(this.uri,this.opts);const c=this.engine,d=this;this._readyState="opening",this.skipReconnect=!1;const p=Eo(c,"open",function(){d.onopen(),s&&s()}),_=R=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",R),s?s(R):this.maybeReconnectOnOpen()},g=Eo(c,"error",_);if(this._timeout!==!1){const R=this._timeout,I=this.setTimeoutFn(()=>{p(),_(new Error("timeout")),c.close()},R);this.opts.autoUnref&&I.unref(),this.subs.push(()=>{this.clearTimeoutFn(I)})}return this.subs.push(p),this.subs.push(g),this}connect(s){return this.open(s)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const s=this.engine;this.subs.push(Eo(s,"ping",this.onping.bind(this)),Eo(s,"data",this.ondata.bind(this)),Eo(s,"error",this.onerror.bind(this)),Eo(s,"close",this.onclose.bind(this)),Eo(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(s){try{this.decoder.add(s)}catch(c){this.onclose("parse error",c)}}ondecoded(s){Fw(()=>{this.emitReserved("packet",s)},this.setTimeoutFn)}onerror(s){this.emitReserved("error",s)}socket(s,c){let d=this.nsps[s];return d?this._autoConnect&&!d.active&&d.connect():(d=new nj(this,s,c),this.nsps[s]=d),d}_destroy(s){const c=Object.keys(this.nsps);for(const d of c)if(this.nsps[d].active)return;this._close()}_packet(s){const c=this.encoder.encode(s);for(let d=0;d<c.length;d++)this.engine.write(c[d],s.options)}cleanup(){this.subs.forEach(s=>s()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(s,c){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",s,c),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const s=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const c=this.backoff.duration();this._reconnecting=!0;const d=this.setTimeoutFn(()=>{s.skipReconnect||(this.emitReserved("reconnect_attempt",s.backoff.attempts),!s.skipReconnect&&s.open(p=>{p?(s._reconnecting=!1,s.reconnect(),this.emitReserved("reconnect_error",p)):s.onreconnect()}))},c);this.opts.autoUnref&&d.unref(),this.subs.push(()=>{this.clearTimeoutFn(d)})}}onreconnect(){const s=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",s)}}const $p={};function Cg(r,s){typeof r=="object"&&(s=r,r=void 0),s=s||{};const c=Gte(r,s.path||"/socket.io"),d=c.source,p=c.id,_=c.path,g=$p[p]&&_ in $p[p].nsps,R=s.forceNew||s["force new connection"]||s.multiplex===!1||g;let I;return R?I=new SI(d,s):($p[p]||($p[p]=new SI(d,s)),I=$p[p]),c.query&&!s.query&&(s.query=c.queryKey),I.socket(c.path,s)}Object.assign(Cg,{Manager:SI,Socket:nj,io:Cg,connect:Cg});const tne="http://localhost:5000",wu=Cg(tne,{transports:["websocket"],forceNew:!0,reconnectionAttempts:"Infinity",timeout:1e4});function nne(){const r=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,z=>{let le=Math.floor(Math.random()*16);return(z==="x"?le:le&3|8).toString(16)}),[s,c]=Ce.useState(null),[d,p]=Ce.useState([]),_=Ce.useRef(),[g,R]=Ce.useState(!0);Ce.useState(!0);const I=null,P=r(),k="2062152623704a5a8c28f1ab65ef6258";let L,x={localAudioTrack:null,remoteAudioTracks:{}},H={localVideoTrack:null,remoteVideoTracks:{}},K,ee=async()=>{var ge;K=BE.createClient({mode:"rtc",codec:"vp8"}),(await BE.createCameraVideoTrack()).getMediaStreamTrack(),K.on("user-published",re),await K.join(k,L,I,P),x.localAudioTrack=await BE.createMicrophoneAudioTrack(),H.localVideoTrack=await BE.createCameraVideoTrack(),x.localAudioTrack.setMuted(g);const le=`<div class='video-frames-container' id='user-container-${k}'>
    <div id='user-${k}' class='video-frames'>
    </div>
    </div>`;(ge=document.getElementById("video-Player"))==null||ge.insertAdjacentHTML("beforeend",le),await H.localVideoTrack.play(`user-${k}`),K.publish([x.localAudioTrack,H.localVideoTrack])},re=async(z,le)=>{await K.subscribe(z,le),le=="audio"&&(x.remoteAudioTracks[z.uid]=[z.audioTrack],z.audioTrack.play())},Y=async()=>{x.localAudioTrack.stop(),x.localAudioTrack.close(),K.unpublish(),K.leave(),H.localVideoTrack.stop(),H.localVideoTrack.close()};Ce.useEffect(()=>{wu.on("userIsJoined",z=>{z.success?(console.log("userIsJoined"),localStorage.setItem(`${z.users[0].roomID}`,JSON.stringify(z.users)),p(z.users),L=z.users[0].roomID,ee()):console.error("error")}),wu.on("joinedUser",z=>{p(z)}),wu.on("userJoinedMessage",z=>{}),wu.on("userLeftMessage",z=>{console.log(z,"userLeftMessage");const le=localStorage.getItem(`${z.roomID}`);let ge=JSON.parse(le);ge=ge.filter(Z=>Z.socketID!==z.socketID),localStorage.setItem(`${z.roomID}`,JSON.stringify(ge)),p(ge)})},[]),localStorage.setItem("userData",JSON.stringify(_.current));const F=_$(QC(Se.jsxs(Se.Fragment,{children:[Se.jsx(XC,{path:"/",element:Se.jsx(N$,{user:s,uuid:r,setUser:c,socket:wu,userData:_})}),Se.jsx(XC,{path:"/:roomId",element:Se.jsx(ute,{Page:!0,user:s,socket:wu,users:d,audioTracks:x,rtcClient:K,mikeMuted:g,setMikeMuted:R,leaveRoom:Y})})]})));return Se.jsx(Se.Fragment,{children:Se.jsx(I$,{router:F})})}tC.createRoot(document.getElementById("root")).render(Se.jsx(nne,{}));
